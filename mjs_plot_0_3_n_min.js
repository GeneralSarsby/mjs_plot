mjs_plot=function(){function hslToRgb(t,e,i){function a(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var s,n,o;if(0==e)s=n=o=i;else{var _=.5>i?i*(1+e):i+e-i*e,l=2*i-_;s=a(l,_,t+1/3),n=a(l,_,t),o=a(l,_,t-1/3)}return"rgb("+Math.round(255*s)+","+Math.round(255*n)+","+Math.round(255*o)+")"}function get_color(t,e){if(e<color_table.length)return color_table[e][t];var i=1-Math.exp(-1.1*e),a=.5+(1-Math.exp(-1.1*e))*Math.cos(t*Math.PI)*.15;return hslToRgb(t/(e+1),i,a)}function parseExpression(text,ax,ay){for(var sin=Math.sin,cos=Math.cos,tan=Math.tan,ln=Math.log,pi=Math.PI,e=Math.E,pow=Math.pow,sqrt=Math.sqrt,log=function(t){return Math.log(t)/Math.log(10)},now=(new Date).getTime(),returny=[],i=0;i<ax.length;i++){var x=ax[i],y=ay[i];returny.push(eval(text))}return returny}function color_from_string(t){for(var e=321,i=0;i<50*t.length;i++)e=t.charCodeAt(i%t.length)+((e<<5)-e);return e&=e,hue=Math.abs(e%256/256),sat=.9,lightness=.3+.2*(Math.abs(e)%3),hslToRgb(hue,sat,lightness)}function clone(t){var e=t instanceof Array?[]:{};for(i in t)"clone"!=i&&(e[i]=t[i]&&"object"==typeof t[i]?clone(t[i]):t[i]);return e}function hasLocalStorage(){try{return localStorage.setItem("MJSplot","Stored"),localStorage.removeItem("MJSplot"),!0}catch(t){return!1}}function isMobile(){var t={Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},Windows:function(){return/IEMobile/i.test(navigator.userAgent)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Windows()}};return t.any()}function is_touch_device(){var t="ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0;return t&&isMobile()||DEBUGG_FORCE_TOUCH}function download_text(t,e,i){var a=i||"data:text/plain;charset=utf-8",s=document.createElement("a");s.setAttribute("href",a+","+encodeURIComponent(t)),s.setAttribute("download",e),s.style.display="none",document.body.appendChild(s),console.log("downloading "+e),s.click(),document.body.removeChild(s)}function show_text_to_screen(t,e){var i=document.createElement("button"),a=document.createElement("div");i.setAttribute("onclick","location.reload()"),i.innerHTML="back",i.style.display="block";var s=document.createElement("textarea");s.style.width=.8*e.canvas.width+"px",s.style.height=.8*e.canvas.height+"px",a.appendChild(i),a.appendChild(s),s.value=t,e.canvas.parentNode.appendChild(a),e.canvas.parentNode.removeChild(e.canvas)}function save_gs(t,e){if(hasLocalStorage()){var i=JSON.stringify(e);localStorage.setItem(t,i)}else console.log("No local storage!")}function load_gs(t){var e=mjs_plot.get_graph_style();if(hasLocalStorage()){var i=localStorage.getItem(t);i&&(i=JSON.parse(i)),i&&(e=i)}else console.log("No local storage!");return e}function linear_regression(t,e){for(var i=0,a=0,s=0,n=0,o=0;o<t.length;o++)i+=t[o],s+=t[o]*t[o],a+=e[o],n+=t[o]*e[o];var _=t.length;n-=i*a/_,s-=i*i/_;var l=n/s,r=a/_-l*i/_;return slope={a:r,b:l}}function series_stats(t,e){for(var i=0,a=0,s=0,n=0,o=0,_=0;_<t.length;_++)i+=t[_],s+=t[_]*t[_],a+=e[_],n+=t[_]*e[_],o+=e[_]*e[_];var l=t.length;n-=i*a/l,s-=i*i/l,o-=a*a/l;var r=n*n/s/o,g=i/l,h=a/l,d=Math.sqrt(s/l),c=Math.sqrt(o/l),x=n/l,m=n/s,f=a/l-m*i/l,p=Math.sqrt((o-n*n/s)/(l-2)),u=p/Math.sqrt(s),y=p*Math.sqrt(1/l+g*g/s),v=Math.min.apply(null,e),w=Math.max.apply(null,e),T=Math.min.apply(null,t),b=Math.max.apply(null,t);return stats={x_mean:g,y_mean:h,sigma_x:d,sigma_y:c,cov:x,b:m,a:f,s_b:u,s_a:y,n:l,r_2:r,ymin:v,ymax:w,xmin:T,xmax:b}}function padLeft(t,e,i){return Array(e-String(t).length+1).join(i||"0")+t}function trim(t,e,i){return t=Math.max(t,e),t=Math.min(t,i)}function mjs_time_difference_print(t){var e=t/1e3;t%=1e3;var i=Math.floor(e%60),a=Math.floor(e/60%60),s=Math.floor(e/60/60%24),n=Math.floor(e/60/60/24),o="";return i>0&&(o=i+"seconds "+t.toFixed(0)+"ms"),a>0&&(o=a+"min "+i+"seconds"),s>0&&(o=s+"hours "+a+"min "+i+"seconds"),n>0&&(o=n+"days "+s+"hours "+a+"min"),o}function mjs_date_print(t,e,i){e=isFinite(e)?e:0,i=isFinite(i)?i:8,e=trim(e,0,8),i=trim(i,0,8),e=Math.min(e,i);var a=new Date(t),s="",n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return 2==e&&2==i&&(s+=a.getMonth()+1+"-"),1==e&&i>1&&(s+=n[a.getMonth()]+"-",e++),3!=e||4!=i&&3!=i?4==e&&4==i?(s+=padLeft(a.getHours(),2,"0"),s+=":"+padLeft(a.getMinutes(),2,"0")):4==e&&5==i?(s+=padLeft(a.getMinutes(),2,"0"),s+="m"+padLeft(a.getSeconds(),2,"0")+"s"):1==e&&1==i?s=n[a.getMonth()]:(0>=e&&(s+=a.getFullYear()),0>=e&&i>=1&&(s+="-"),1>=e&&i>=1&&(s+=a.getMonth()+1),1>=e&&i>=2&&(s+="-"),2>=e&&i>=2&&(s+=a.getDate()),2>=e&&i>=3&&(s+=" "),3>=e&&i>=3&&(s+=padLeft(a.getHours(),2,"0")),3>=e&&i>=4&&(s+=":"),4>=e&&i>=4&&(s+=padLeft(a.getMinutes(),2,"0")),4>=e&&i>=5&&(s+=":"),5>=e&&i>=5&&(s+=padLeft(a.getSeconds(),2,"0")),5>=e&&i>=6&&(s+="."),6>=e&&i>=6&&(s+=padLeft(a.getMilliseconds(),3,"0")[0]),7>=e&&i>=7&&(s+=padLeft(a.getMilliseconds(),3,"0")[1]),8>=e&&i>=8&&(s+=padLeft(a.getMilliseconds(),3,"0")[2]),3==i&&3>=e&&(s+="h"),4==i&&4==e&&(s+="m"),5!=i||5!=e&&4!=e||(s+="s"),s):(s+=padLeft(a.getHours(),2,"0"),s+=":"+padLeft(a.getMinutes(),2,"0"))}function round_to_month(t){var e=new Date(t),i=e.getDate(),a=new Date(e.getFullYear(),e.getMonth()+1,0),s=a.getDate()-i;return s>i?t-24*(i-1)*60*60*1e3:t+24*(s+1)*60*60*1e3}function round_to_year(t){var e=new Date(t),i=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear()+1,0,1);return e.getTime()-i.getTime()<a.getTime()-e.getTime()?i.getTime():a.getTime()}function mjs_precision(t,e){var e=Math.max(1,e);if(1>e&&(e=1),e>21&&(e=21),Math.abs(t)<.001)return i=t.toExponential(e);var i=t.toPrecision(e);return i.length>t.toPrecision(e+2).length&&(i=t.toPrecision(e+2)),i.length>t.toPrecision(e+1).length&&(i=t.toPrecision(e+1)),i.length>t.toPrecision(e+3).length&&(i=t.toPrecision(e+3)),i}function number_quote(t,e){return isFinite(e)||(e=1e-20),isFinite(t)||(t=0),mjs_precision(t,Math.max(2,Math.floor(Math.log10(Math.abs(t)))-Math.floor(Math.log10(Math.abs(e)))+2))}function drawEllipse(t,e,i,a,s){t.beginPath();for(var n=.5,o=0*Math.PI;o<2*Math.PI;o+=.01){var _=e-a*Math.sin(o)*Math.sin(n*Math.PI)+s*Math.cos(o)*Math.cos(n*Math.PI),l=i+s*Math.cos(o)*Math.sin(n*Math.PI)+a*Math.sin(o)*Math.cos(n*Math.PI);0==o?t.moveTo(graph.units_to_pixels(_,"x"),graph.units_to_pixels(l,"y")):t.lineTo(graph.units_to_pixels(_,"x"),graph.units_to_pixels(l,"y"))}t.stroke()}function mouse_move_event(t,e){e.ui.latestEvent=t,e.ui.ticking||(e.ui.ticking=!0,requestAnimationFrame(function(){mouse_move_event_shim(e.ui.latestEvent,e)}))}function mouse_move_event_shim(t,e){var i=new Date;mouse_move_event_actual(t,e);var a=new Date;e.ui.copy_time=a.getTime()-i.getTime(),e.ui.ticking=!1}function mouse_move_event_actual(t,e){var i=e.canvas,a=i.getContext("2d"),s=e.graphics_style,n=i.getBoundingClientRect(),o=t.clientX-n.left,_=t.clientY-n.top,l=e.pixels_to_units(o,"x"),r=e.pixels_to_units(_,"y");if(a.putImageData(e.graph_image,0,0),e.ui.touch)var g=Math.min(Math.min(i.width/22,i.height/15));else var g=Math.min(s.tick_labels_font_size/.55*s.scaling_factor,Math.min(i.width/22,i.height/15));e.ui.size=g;var h=g/4;if(a.font=.55*g+"px "+s.font_name,DEBUGG_FPS&&a.fillText("fps: "+1/e.ui.copy_time*1e3,30,30),0==mouse_down){if(s.o>=1){a.fillStyle=s.color_bg,a.globalAlpha=.5,a.beginPath(),a.fillRect(0,0,i.width,i.height),a.fill(),a.stroke(),a.globalAlpha=1,a.fillStyle=s.color_fg,a.strokeStyle=s.color_fg;var d=[s.guideWidthx,s.guideWidthy,s.symbol_size,s.line_thickness,s.tick_len,s.minor_tick_len,s.title_font_size,s.tick_labels_font_size,s.axis_labels_font_size,s.title_spacing,s.tick_lables_font_padding,s.lable_spacing,s.graph_line_thickness],c=["scale width x","scale width y","symbol size","line thickness","tick length","minor tick length","title font size","ticks font size","axis font size","title spacing","tick padding","label spacing","graph line thickness"],x=.7*g,x=Math.min(i.height/32,i.width/25);e.ui.s=x,a.font=.8*x+"px "+s.font_name;for(var m=0;m<d.length;m++)a.rect(x,x+m*x*1.2-.75*x,x,x),a.rect(2*x,x+m*x*1.2-.75*x,x,x),a.textAlign="center",a.fillText("+",1.5*x,x+m*x*1.2),a.fillText("-",2.5*x,x+m*x*1.2),a.textAlign="left",a.fillText(c[m]+" = "+mjs_precision(d[m],3),3.5*x,x+m*x*1.2);a.stroke();var f=[s.font_name,s.title,s.subtitle,s.subtitle2,s.x_axis_title,s.y_axis_title,s.color_fg,s.color_bg,s.color_mg],p=["font","title","subtitle","subtitle2","x-axis","y-axis","fg color","bg color","mg color"];C=0;for(var m=d.length;m<d.length+f.length;m++)a.rect(x,x+m*x*1.2-.75*x,3*x,x),a.textAlign="center",a.fillText("edit",2.5*x,x+m*x*1.2),a.textAlign="left",a.fillText(p[C]+" = "+f[C],x+3.5*x,x+m*x*1.2),C++;return a.stroke(),m++,a.rect(x,x+m*x*1.2-.75*x,4*x,x),a.stroke(),a.textAlign="center",a.fillText("Reset",2.5*x,x+m*x*1.2),m++,a.rect(x,x+m*x*1.2-.75*x,4*x,x),a.stroke(),a.fillText("Exit",2.5*x,x+m*x*1.2),void(s.mouse_mode="options")}if(a.fillStyle=s.color_fg,a.strokeStyle=s.color_fg,o>g&&_>g&&i.height-_>g&&i.width-o>g){if("zoom"===s.mouse_mode&&(a.beginPath(),a.arc(o,_,h,0,2*Math.PI,!0),a.stroke()),"zoom"===s.mouse_mode||"drag"===s.mouse_mode||"measure"===s.mouse_mode){var u=e.get_axis_string(l,"x"),y=e.get_axis_string(r,"y");lw=y.length*s.scaling_factor*s.axis_labels_font_size,e.ui.touch&&e.ui.is_touching?(a.fillText(u,o+h,i.height-2*g),a.fillText(y,2*g,_-h)):(a.fillText(u,o+h,Math.min(_+2*h+2*g,i.height-2*g)),a.fillText(y,Math.max(o-2*h-lw-2*g,2*g),_-h)),a.beginPath(),a.moveTo(o,_+g),a.lineTo(o,i.height),a.moveTo(o,_-g),a.lineTo(o,0),a.moveTo(o-g,_),a.lineTo(0,_),a.moveTo(o+g,_),a.lineTo(i.width,_),a.stroke(),a.beginPath(),a.stroke()}if("trim"===s.mouse_mode&&(a.fillText("trim",o+2*h,_-2*h),a.beginPath(),a.moveTo(o,0),a.lineTo(o,i.height),a.moveTo(0,_),a.lineTo(i.width,_),a.stroke()),"cut"===s.mouse_mode&&(a.fillText("cut",o+2*h,_-2*h),a.beginPath(),a.moveTo(o,0),a.lineTo(o,i.height),a.moveTo(0,_),a.lineTo(i.width,_),a.stroke()),"sublin"===s.mouse_mode&&a.fillText("draw a line to subtract",o+2*h,_-2*h),"x-c"===s.mouse_mode&&(A=e.get_axis_string(l,"x"),a.fillText("x-"+A,o+2*h,_-2*h),a.beginPath(),a.moveTo(o,0),a.lineTo(o,i.height),a.stroke()),"y-c"===s.mouse_mode&&(A=e.get_axis_string(r,"y"),a.fillText("y-"+A,o+2*h,_-2*h),a.beginPath(),a.moveTo(0,_),a.lineTo(i.width,_),a.stroke()),"mouse"===s.mouse_mode){"none"===s.fits||(a.beginPath(),a.arc(s.fit_text_position.x*i.width,s.fit_text_position.y*i.height,2*h,0,2*Math.PI,!0),a.stroke()),a.beginPath();var v=(s.tick_len+s.title_spacing+s.title_font_size)*s.scaling_factor;if(a.arc(i.width/2,v,2*h,0,2*Math.PI,!0),a.stroke(),s.show_captions>0){var w=s.scaling_factor*s.caption_position.x;s.caption_position.x>0?w+=s.scaling_factor*s.tick_len:(w=i.width+w,w-=s.scaling_factor*s.tick_len),cap_y=s.scaling_factor*s.caption_position.y,s.caption_position.y>0?cap_y+=s.scaling_factor*s.tick_len:(cap_y=i.height+cap_y,cap_y-=s.scaling_factor*s.tick_len),a.beginPath(),a.arc(w,cap_y,2*h,0,2*Math.PI,!0),a.stroke()}}if(a.beginPath(),a.stroke(),"measure"===s.mouse_mode&&(a.beginPath(),a.moveTo(o-h,_-h),a.lineTo(o+h,_+h),a.moveTo(o-h,_+h),a.lineTo(o+h,_-h),a.stroke(),a.beginPath(),a.stroke()),"drag"===s.mouse_mode&&(drag_x=o-.5*g,drag_y=_-.5*g,a.beginPath(),a.moveTo(drag_x+.2*g,drag_y+.5*g),a.lineTo(drag_x+.8*g,drag_y+.5*g),a.moveTo(drag_x+.5*g,drag_y+.2*g),a.lineTo(drag_x+.5*g,drag_y+.8*g),a.moveTo(drag_x+.2*g,drag_y+.5*g),a.lineTo(drag_x+.3*g,drag_y+.6*g),a.moveTo(drag_x+.2*g,drag_y+.5*g),a.lineTo(drag_x+.3*g,drag_y+.4*g),a.moveTo(drag_x+.8*g,drag_y+.5*g),a.lineTo(drag_x+.7*g,drag_y+.6*g),a.moveTo(drag_x+.8*g,drag_y+.5*g),a.lineTo(drag_x+.7*g,drag_y+.4*g),a.moveTo(drag_x+.5*g,drag_y+.2*g),a.lineTo(drag_x+.4*g,drag_y+.3*g),a.moveTo(drag_x+.5*g,drag_y+.2*g),a.lineTo(drag_x+.6*g,drag_y+.3*g),a.moveTo(drag_x+.5*g,drag_y+.8*g),a.lineTo(drag_x+.4*g,drag_y+.7*g),a.moveTo(drag_x+.5*g,drag_y+.8*g),a.lineTo(drag_x+.6*g,drag_y+.7*g),a.stroke(),a.beginPath(),a.stroke()),"reader"===s.mouse_mode){var T=e.reader_index[0],b=e.reader_index[1],k=e.units_to_pixels(e.data[T][0][b],"x"),j=e.units_to_pixels(e.data[T][1][b],"y"),M=a.lineWidth;a.strokeStyle=s.color_bg,a.lineWidth=s.scaling_factor*s.axis_labels_font_size/3,("lin"===s.x_scale_mode||"log"===s.x_scale_mode)&&(A=mjs_precision(e.data[T][0][b],s.x_precision+5)),"time"===s.x_scale_mode&&(A=mjs_date_print(e.data[T][0][b],0,8)),a.strokeText(A,o+2*h,_+1.6*s.axis_labels_font_size),a.fillText(A,o+2*h,_+1.6*s.axis_labels_font_size),("lin"===s.y_scale_mode||"log"===s.y_scale_mode)&&(A=mjs_precision(e.data[T][1][b],s.y_precision+5)),"time"===s.y_scale_mode&&(A=mjs_date_print(e.data[T][1][b],0,8)),a.strokeText(A,o+2*h,_),a.fillText(A,o+2*h,_),A=e.captions[T],a.strokeText(A,o+2*h,_-1.6*s.axis_labels_font_size),a.fillText(A,o+2*h,_-1.6*s.axis_labels_font_size),A="i="+b,a.strokeText(A,o+2*h,_+1.6*s.axis_labels_font_size*2),a.fillText(A,o+2*h,_+1.6*s.axis_labels_font_size*2),a.lineWidth=M,a.strokeStyle=s.color_fg,a.beginPath(),a.moveTo(o,_),a.lineTo(k,j),a.stroke(),a.beginPath(),a.arc(o,_,.3*g*.8,0,2*Math.PI,!0),a.moveTo(o,_-.3*g),a.lineTo(o,_+.3*g),a.moveTo(o+.3*g,_),a.lineTo(o-.3*g,_),a.stroke()}}if(g>_&&(a.fillStyle=s.color_bg,a.beginPath(),a.rect(0,0,4*g,g),a.rect(4*g,0,4*g,g),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.fillText("symbol/line",.2*g,.8*g),a.fillText("Graph",4.2*g,.8*g),a.fillStyle=s.color_bg,a.rect(9*g,0,g,g),a.fill(),a.stroke(),a.beginPath(),a.moveTo(9.2*g,.5*g),a.lineTo(9.8*g,.5*g),a.moveTo(9.5*g,.2*g),a.lineTo(9.5*g,.8*g),a.moveTo(9.2*g,.5*g),a.lineTo(9.3*g,.6*g),a.moveTo(9.2*g,.5*g),a.lineTo(9.3*g,.4*g),a.moveTo(9.8*g,.5*g),a.lineTo(9.7*g,.6*g),a.moveTo(9.8*g,.5*g),a.lineTo(9.7*g,.4*g),a.moveTo(9.5*g,.2*g),a.lineTo(9.4*g,.3*g),a.moveTo(9.5*g,.2*g),a.lineTo(9.6*g,.3*g),a.moveTo(9.5*g,.8*g),a.lineTo(9.4*g,.7*g),a.moveTo(9.5*g,.8*g),a.lineTo(9.6*g,.7*g),a.stroke(),a.rect(10*g,0,g,g),a.fill(),a.stroke(),a.beginPath(),a.arc(10.5*g,.5*g,.3*g*.8,0,2*Math.PI,!0),a.moveTo(10.4*g,.5*g),a.lineTo(10.6*g,.5*g),a.moveTo(10.5*g,.4*g),a.lineTo(10.5*g,.6*g),a.moveTo(10.5*g+.3*g*.8*.707,.5*g+.3*g*.8*.707),a.lineTo(10.9*g,.9*g),a.stroke(),a.rect(11*g,0,g,g),a.fill(),a.stroke(),a.beginPath(),a.moveTo(11.2*g,.8*g),a.lineTo(11.8*g,.8*g),a.lineTo(11.8*g,.2*g),a.lineTo(11.2*g,.8*g),a.stroke(),a.rect(12*g,0,g,g),a.fill(),a.stroke(),a.beginPath(),a.arc(12.5*g,.5*g,.3*g*.8,0,2*Math.PI,!0),a.moveTo(12.5*g,.2*g),a.lineTo(12.5*g,.8*g),a.moveTo(12.2*g,.5*g),a.lineTo(12.8*g,.5*g),a.stroke(),a.rect(13*g,0,g,g),a.fill(),a.stroke(),a.beginPath(),a.moveTo(13.3*g,.2*g),a.lineTo(13.3*g,.8*g),a.lineTo(13.7*g,.6*g),a.lineTo(13.3*g,.2*g),a.fillStyle=s.color_bg,a.rect(i.width-g,0,g,g),a.rect(i.width-2*g,0,g,g),a.rect(i.width-3*g,0,g,g),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.fillText("c",i.width-.7*g,.7*g),a.fillStyle=s.color_fg,a.fillText("i",i.width-1.7*g,.7*g),a.beginPath(),a.arc(i.width-2.2*g,.7*g,.07*g,0,2*Math.PI,!0),a.arc(i.width-2.5*g,.7*g,.07*g,0,2*Math.PI,!0),a.arc(i.width-2.8*g,.7*g,.07*g,0,2*Math.PI,!0),a.fill(),a.fillStyle=s.color_fg,a.beginPath(),a.stroke()),_>i.height-g){a.fillStyle=s.color_bg,a.beginPath(),a.rect(0,i.height-g,g,g),a.fill(),a.stroke(),a.rect(g,i.height-g,g,g),a.fill(),a.stroke(),a.rect(2*g,i.height-g,g,g),a.fill(),a.stroke(),a.rect(3*g,i.height-g,g,g),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.moveTo(.5*g,i.height-.8*g),a.lineTo(.5*g,i.height-.2*g),a.moveTo(.2*g,i.height-.5*g),a.lineTo(.5*g,i.height-.2*g),a.moveTo(.8*g,i.height-.5*g),a.lineTo(.5*g,i.height-.2*g),a.moveTo(1.5*g,i.height-.8*g),a.lineTo(1.5*g,i.height-.2*g),a.moveTo(1.2*g,i.height-.5*g),a.lineTo(1.5*g,i.height-.8*g),a.moveTo(1.8*g,i.height-.5*g),a.lineTo(1.5*g,i.height-.8*g),a.moveTo(2.2*g,i.height-.5*g),a.lineTo(2.8*g,i.height-.5*g),a.moveTo(2.5*g,i.height-.2*g),a.lineTo(2.2*g,i.height-.5*g),a.moveTo(2.5*g,i.height-.8*g),a.lineTo(2.2*g,i.height-.5*g),a.moveTo(3.2*g,i.height-.5*g),a.lineTo(3.8*g,i.height-.5*g),a.moveTo(3.5*g,i.height-.2*g),a.lineTo(3.8*g,i.height-.5*g),a.moveTo(3.5*g,i.height-.8*g),a.lineTo(3.8*g,i.height-.5*g),0==s.x_scale_auto_max&&(a.moveTo(3.8*g,i.height-.8*g),a.lineTo(3.8*g,i.height-.2*g)),0==s.x_scale_auto_min&&(a.moveTo(2.2*g,i.height-.8*g),a.lineTo(2.2*g,i.height-.2*g)),0==s.y_scale_auto_max&&(a.moveTo(1.2*g,i.height-.8*g),a.lineTo(1.8*g,i.height-.8*g)),0==s.y_scale_auto_min&&(a.moveTo(.2*g,i.height-.2*g),a.lineTo(.8*g,i.height-.2*g)),a.stroke(),a.fillStyle=s.color_bg,a.rect(4*g,i.height-g,g,g),a.fill(),a.stroke(),a.beginPath();var S=4*g,P=i.height-g;a.moveTo(S+.2*g,P+.4*g),a.lineTo(S+.8*g,P+.4*g),a.moveTo(S+.2*g,P+.6*g),a.lineTo(S+.8*g,P+.6*g),a.moveTo(S+.4*g,P+.2*g),a.lineTo(S+.4*g,P+.8*g),a.moveTo(S+.6*g,P+.2*g),a.lineTo(S+.6*g,P+.8*g),a.stroke(),a.rect(5*g,i.height-g,g,g),a.fill(),a.stroke(),a.rect(6*g,i.height-g,g,g),a.fill(),a.stroke(),a.rect(7*g,i.height-g,g,g),a.fill(),a.stroke(),"log"==s.y_scale_mode?(a.moveTo(5*g,i.height-.2*g),a.lineTo(6*g,i.height-.2*g),a.moveTo(5*g,i.height-.4*g),a.lineTo(6*g,i.height-.4*g),a.moveTo(5*g,i.height-.6*g),a.lineTo(6*g,i.height-.6*g),a.moveTo(5*g,i.height-.8*g),a.lineTo(6*g,i.height-.8*g)):(a.moveTo(5*g,i.height-.4*g),a.lineTo(6*g,i.height-.4*g),a.moveTo(5*g,i.height-.65*g),a.lineTo(6*g,i.height-.65*g),a.moveTo(5*g,i.height-.8*g),a.lineTo(6*g,i.height-.8*g),a.moveTo(5*g,i.height-.9*g),a.lineTo(6*g,i.height-.9*g)),"log"===s.x_scale_mode?(a.moveTo(6.2*g,i.height),a.lineTo(6.2*g,i.height-g),a.moveTo(6.4*g,i.height),a.lineTo(6.4*g,i.height-g),a.moveTo(6.6*g,i.height),a.lineTo(6.6*g,i.height-g),a.moveTo(6.8*g,i.height),a.lineTo(6.8*g,i.height-g)):(a.moveTo(6.4*g,i.height),a.lineTo(6.4*g,i.height-g),a.moveTo(6.65*g,i.height),a.lineTo(6.65*g,i.height-g),a.moveTo(6.8*g,i.height),a.lineTo(6.8*g,i.height-g),a.moveTo(6.9*g,i.height),a.lineTo(6.9*g,i.height-g)),a.stroke();var S=7*g,P=i.height-g;a.beginPath(),a.moveTo(S+.1*g,P+.6*g),a.lineTo(S+.1*g,P+.9*g),a.lineTo(S+.9*g,P+.9*g),a.lineTo(S+.9*g,P+.6*g),a.moveTo(S+.5*g,P+.9*g),a.lineTo(S+.5*g,P+.8*g),a.stroke(),a.beginPath(),a.arc(S+.5*g,P+.4*g,.3*g,0,2*Math.PI,!0),a.moveTo(S+.5*g,P+.2*g),a.lineTo(S+.5*g,P+.4*g),a.lineTo(S+.6*g,P+.4*g),a.stroke(),a.fillStyle=s.color_bg,a.rect(8*g,i.height-g,3*g,g),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("f()",8.2*g,i.height-.3*g),a.stroke(),a.fillStyle=s.color_bg,a.rect(11*g,i.height-g,4*g,g),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("lines",11.2*g,i.height-.3*g),a.stroke(),a.fillStyle=s.color_bg,a.rect(15*g,i.height-g,4*g,g),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("fits",15.2*g,i.height-.3*g),a.stroke(),a.fillStyle=s.color_bg,a.rect(i.width-g,i.height-g,g,g),a.rect(i.width-3*g,i.height-g,g,g),a.rect(i.width-2.8*g,i.height-.8*g,.6*g,.6*g),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.fillText("e",i.width-.7*g,i.height-.3*g),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.rect(i.width-2*g,i.height-g,g,g),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_bg,a.moveTo(i.width-2*g,i.height),a.lineTo(i.width-g-1,i.height-g+1),a.lineTo(i.width-g-1,i.height),a.closePath(),a.fill(),a.beginPath(),a.fill(),a.stroke()}if(e.drawmodemenu)if(10*g>o&&3*g>_){a.fillStyle=s.color_bg,a.beginPath(),a.rect(0,0,10*g,3*g),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.fillText("symbol/line",.2*g,.8*g),a.beginPath(),a.moveTo(.2*g,1.5*g),a.lineTo(.8*g,1.5*g),a.moveTo(.5*g,1.2*g),a.lineTo(.5*g,1.8*g),a.moveTo(1.2*g,1.5*g),a.lineTo(1.8*g,1.5*g),a.stroke(),a.beginPath(),a.moveTo(.2*g,2.5*g),a.lineTo(.8*g,2.5*g),a.moveTo(.5*g,2.2*g),a.lineTo(.5*g,2.8*g),a.moveTo(1.2*g,2.5*g),a.lineTo(1.8*g,2.5*g),a.stroke(),a.beginPath(),a.moveTo(0,g),a.lineTo(10*g,g),a.moveTo(0,2*g),a.lineTo(10*g,2*g),a.moveTo(2*g,1*g),a.lineTo(2*g,3*g),a.stroke(),a.beginPath(),a.arc(2.5*g,1.5*g,.35*g,0,2*Math.PI,!0),a.stroke(),a.beginPath(),a.moveTo(2.2*g,1.2*g),a.lineTo(2.8*g,1.8*g),a.stroke(),a.beginPath(),a.arc(2.5*g,2.5*g,.35*g,0,2*Math.PI,!0),a.stroke(),a.beginPath(),a.moveTo(2.2*g,2.2*g),a.lineTo(2.8*g,2.8*g),a.stroke();var S=3*g,P=1*g;a.fillStyle=s.color_fg,a.rect(S+.3*g,P+.3*g,.4*g,.4*g),a.fill(),S+=g,a.arc(.5*g+S,P+.5*g,.3*g,0,2*Math.PI,!0),a.fill(),S+=g,a.fillStyle=s.color_bg,a.beginPath(),a.rect(S+.3*g,P+.3*g,.4*g,.4*g),a.stroke(),S+=g,a.beginPath(),a.arc(.5*g+S,P+.5*g,.3*g,0,2*Math.PI,!0),a.stroke(),S+=g,a.beginPath(),a.moveTo(S+.3*g,P+.3*g),a.lineTo(S+.7*g,P+.7*g),a.moveTo(S+.7*g,P+.3*g),a.lineTo(S+.3*g,P+.7*g),a.stroke(),S+=g,a.beginPath(),a.moveTo(S+.5*g,P+.3*g),a.lineTo(S+.5*g,P+.7*g),a.moveTo(S+.7*g,P+.5*g),a.lineTo(S+.3*g,P+.5*g),a.stroke(),P+=1.5*g,S=3.5*g;var z=.3;a.beginPath(),a.moveTo(S-z*g,P-z*g),a.lineTo(S+z*g,P+z*g),S+=g,a.moveTo(S-z*g,P+z*g),a.quadraticCurveTo(S-z*g,P-z*g,S+z*g,P-z*g),S+=g,a.moveTo(S-z*g,P+z*g),a.bezierCurveTo(S+z*g,P+z*g,S-z*g,P-z*g,S+z*g,P-z*g),S+=g,a.moveTo(S-z*g,P-z*g),a.lineTo(S-z*g,P+z*g),a.lineTo(S+z*g,P+z*g),S+=g,a.moveTo(S-z*g,P-z*g),a.lineTo(S+z*g,P-z*g),a.lineTo(S+z*g,P+z*g),S+=g,a.moveTo(S-z*g,P-z*g),a.lineTo(S,P-z*g),a.lineTo(S,P+z*g),a.lineTo(S+z*g,P+z*g),S+=g,a.moveTo(S-z*g,P-z*g),a.lineTo(S-z*g,P+z*g),a.moveTo(S-z*g,P),a.lineTo(S+z*g,P),a.lineTo(S+z*g,P+z*g),a.stroke()}else console.log("leaving menu"),e.drawmodemenu=!1;if(e.drawgraphmenu)if(12*g>o&&o>4*g&&10*g>_){a.fillStyle=s.color_bg,a.rect(4*g,0,8*g,10*g),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var P=.8*g,D=-g,S=4.2*g;a.fillText("Graph",S,P),P-=D,a.fillText("Set title",S,P),P-=D,a.fillText("Set subtitle",S,P),P-=D,a.fillText("Set subtitle2",S,P),P-=D,a.fillText("Toggle show transforms",S,P),P-=D,a.fillText("set x-axis title",S,P),P-=D,a.fillText("set y-axis title",S,P),P-=D,a.fillText("Scaling Factor down",S,P),P-=D,a.fillText("Scaling Factor up",S,P),P-=D,a.fillText("Reset Graph",S,P),P-=D}else e.drawgraphmenu=!1;if(e.drawexportmenu)if(o>i.width-8*g&&_>i.height-14*g){a.fillStyle=s.color_bg,a.rect(i.width-8*g,i.height-14*g,8*g,14*g),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var P=i.height-.1*g,D=g,S=i.width-7.8*g;a.fillText("export",S,P),P-=D,a.fillText("data (csv)",S,P),P-=D,a.fillText("data (code)",S,P),P-=D,a.fillText("data (code [matlab])",S,P),P-=D,a.fillText("data (code [JSON])",S,P),P-=D,a.fillText("data (tabbed)",S,P),P-=D,a.fillText("png (hi res)",S,P),P-=D,a.fillText("png (low res)",S,P),P-=D,a.fillText("png (small figure)",S,P),P-=D,a.fillText("png (large figure)",S,P),P-=D,a.fillText("svg",S,P),P-=D,a.fillText("svg (small figure)",S,P),P-=D,a.fillText("svg (large figure)",S,P),P-=D,a.fillText("HTML [Beta!]",S,P),P-=D}else e.drawexportmenu=!1;if(e.drawcaptionmenu&&(o>i.width-4*g&&8*g>_?(a.fillStyle=s.color_bg,a.beginPath(),a.rect(i.width-4*g,0,4*g,8*g),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("captions",i.width-3.8*g,.8*g),a.fillText("Show/Hide",i.width-3.8*g,1.8*g),a.fillText("x",i.width-3.8*g,2.8*g),a.fillText("y",i.width-1.8*g,2.8*g),a.fillText("First",i.width-3.8*g,3.8*g),a.fillText("Last",i.width-3.8*g,4.8*g),a.fillText("Min",i.width-3.8*g,5.8*g),a.fillText("Max",i.width-3.8*g,6.8*g),a.fillText("First",i.width-1.8*g,3.8*g),a.fillText("Last",i.width-1.8*g,4.8*g),a.fillText("Min",i.width-1.8*g,5.8*g),a.fillText("Max",i.width-1.8*g,6.8*g),a.fillText("None",i.width-2.8*g,7.8*g),a.beginPath(),a.moveTo(i.width-4*g,g),a.lineTo(i.width,g),a.moveTo(i.width-4*g,2*g),a.lineTo(i.width,2*g),a.moveTo(i.width-4*g,3*g),a.lineTo(i.width,3*g),a.moveTo(i.width-2*g,2*g),a.lineTo(i.width-2*g,7*g),a.stroke()):e.drawcaptionmenu=!1),e.drawfxmenu)if(o>8*g&&22*g>o&&_>i.height-14*g){a.fillStyle=s.color_bg,a.rect(8*g,i.height-14*g,14*g,14*g),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("functions",8.2*g,i.height-.3*g),a.stroke(),a.beginPath();for(var m=1;14>m;m++)a.moveTo(8*g,i.height-g*m),a.lineTo(22*g,i.height-g*m);a.moveTo(12*g,i.height),a.lineTo(12*g,i.height-14*g),a.moveTo(16*g,i.height),a.lineTo(16*g,i.height-14*g),a.moveTo(10*g,i.height-9*g),a.lineTo(10*g,i.height-13*g),a.moveTo(10*g,i.height-4*g),a.lineTo(10*g,i.height-5*g),a.moveTo(14*g,i.height-9*g),a.lineTo(14*g,i.height-13*g),a.moveTo(14*g,i.height-3*g),a.lineTo(14*g,i.height-5*g),a.stroke(),a.fillText("reset",8.2*g,i.height-1.3*g),a.fillText("cut",8.2*g,i.height-2.3*g),a.fillText("norm(y)",8.2*g,i.height-3.3*g),a.fillText("y-c",8.2*g,i.height-4.3*g),a.fillText("x-c",10.2*g,i.height-4.3*g),a.fillText("smooth",8.2*g,i.height-5.3*g),a.fillText("interpolate",8.2*g,i.height-6.3*g),a.fillText("-(mx+c)",8.2*g,i.height-7.3*g),a.fillText("dy/dx",8.2*g,i.height-8.3*g),a.fillText("ln x",8.2*g,i.height-9.3*g),a.fillText("e^x",10.2*g,i.height-9.3*g),a.fillText("log x",8.2*g,i.height-10.3*g),a.fillText("10^x",10.2*g,i.height-10.3*g),a.fillText("10x",8.2*g,i.height-11.3*g),a.fillText("x/10",10.2*g,i.height-11.3*g),a.fillText("-x",8.2*g,i.height-12.3*g),a.fillText("1/x",10.2*g,i.height-12.3*g),a.fillText("x<->y",12.2*g,i.height-1.3*g),a.fillText("trim",12.2*g,i.height-2.3*g),a.fillText("x^n",12.2*g,i.height-3.3*g),a.fillText("y^n",14.2*g,i.height-3.3*g),a.fillText("rt x",12.2*g,i.height-4.3*g),a.fillText("rt y",14.2*g,i.height-4.3*g),a.fillText("sum",12.2*g,i.height-5.3*g),a.fillText("jitter(y)",12.2*g,i.height-6.3*g),a.fillText("Hist",12.2*g,i.height-7.3*g),a.fillText("Intergrate",12.2*g,i.height-8.3*g),a.fillText("ln y",12.2*g,i.height-9.3*g),a.fillText("e^y",14.2*g,i.height-9.3*g),a.fillText("log y",12.2*g,i.height-10.3*g),a.fillText("10^y",14.2*g,i.height-10.3*g),a.fillText("10y",12.2*g,i.height-11.3*g),a.fillText("y/10",14.2*g,i.height-11.3*g),a.fillText("-y",12.2*g,i.height-12.3*g),a.fillText("1/y",14.2*g,i.height-12.3*g),a.fillText("pop",12.2*g,i.height-.3*g),a.fillText("y vs y",8.2*g,i.height-13.3*g),a.fillText("sub fit",16.2*g,i.height-13.3*g),a.fillText("rmv outliers",16.2*g,i.height-12.3*g),a.fillText("keep outliers",16.2*g,i.height-11.3*g),a.fillText("custom y=f(x,y)",16.2*g,i.height-10.3*g),a.fillText("(y - mean)/sigma",16.2*g,i.height-2.3*g),a.fillText("x spacing",16.2*g,i.height-1.3*g),a.fillText("time->number",16.2*g,i.height-.3*g)}else e.drawfxmenu=!1;if(e.drawtimemenu)if(e.drawfxmenu=!1,o>10*g&&20*g>o&&_>i.height-6*g){a.fillStyle=s.color_bg,a.beginPath(),a.rect(10*g,i.height-6*g,10*g,6*g),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("time->number",10.2*g,i.height-.3*g);for(var q=[["days","hours","mins","sec"],["now","ago","start","end"]],S=10.2*g,F=2*g,P=i.height-3.3*g,E=g,m=0;2>m;m++)for(var C=0;4>C;C++){var A=q[m][C];A=e.timemenuoptions[m]==C?"["+A+"]":" "+A+" ",a.fillText(A,S+C*F,P-m*E)}a.fillText("Pick reference and unit",S,P-2*E),a.fillText("apply on x",S,P+2*E),a.fillText("apply on y",S+3*F,P+2*E)}else e.drawtimemenu=!1;if(e.drawlinemenu){for(var L=e.data_backup.length,m=0;L>m;m++)s.hidden_lines[m]=s.hidden_lines[m]||!1;var N=s.function_lines.length;if(o>11*g&&21*g>o&&_>i.height-g*(L+N+2)){a.fillStyle=s.color_bg,a.rect(11*g,i.height-g*(L+N+2),10*g,g*(L+N+2)),a.fill(),a.stroke(),a.beginPath(),a.moveTo(11*g,i.height-g),a.lineTo(21*g,i.height-g),a.moveTo(11*g,i.height-g*(L+1)),a.lineTo(21*g,i.height-g*(L+1)),a.stroke(),a.fillStyle=s.color_fg,a.fillText("line menu",11.2*g+.2,i.height-.2*g);for(var P=i.height-L*g-.2*g,S=13.2*g+.2,m=0;N>m;m++)P-=g,a.fillText(s.function_lines[m],S,P),a.fillText("(-) ",11.2*g+.2,P);P-=g,a.fillText("new function line",S,P);for(var m=L-1;m+1>0;m--){var A=e.captions_backup[m]||"label";a.fillStyle=e.colors_backup[m],a.fillText(A,13.2*g+.2,i.height-L*g+g*(m-.2)),s.hidden_lines[m]?a.fillText("( )",11.2*g+.2,i.height-L*g+g*(m-.2)):a.fillText("(+)",11.2*g+.2,i.height-L*g+g*(m-.2))}a.fillStyle=s.color_fg,a.fillText("all",15.2*g+.2,i.height-.2*g),a.fillText("none",17.2*g+.2,i.height-.2*g)}else e.drawlinemenu=!1}if(e.drawfitsmenu)if(o>15*g&&21*g>o&&_>i.height-10*g){a.fillStyle=s.color_bg,a.rect(15*g,i.height-10*g,6*g,10*g),a.fill(),a.stroke(),a.beginPath(),a.stroke(),a.fillStyle=s.color_fg;var A="";A=s.extrapolate?"(+) extrapolate":"( ) extrapolate";var S=18.2*g,P=i.height-.3*g,I=g;a.fillText("none",S,P),P-=I,P-=I,a.fillText("stats",S,P),P-=I,a.fillText("ae^bx",S,P),P-=I,a.fillText("a+be^cx",S,P),P-=I,a.fillText("a+blnx",S,P),P-=I,a.fillText("ax^b",S,P),P-=I,a.fillText("a+bx^c",S,P),P-=I,a.fillText("gauss",S,P),P-=I,S=15.2*g,P=i.height-.3*g,a.fillText("fits",S,P),P-=I,a.fillText(A,S,P),P-=I,a.fillText("y=c",S,P),P-=I,a.fillText("linear",S,P),P-=I,a.fillText("quad",S,P),P-=I,a.fillText("cubic",S,P),P-=I,a.fillText("poly 4",S,P),P-=I,a.fillText("poly 5",S,P),P-=I,a.fillText("poly 6",S,P),P-=I,a.fillText("poly 7",S,P),P-=I}else e.drawfitsmenu=!1;if(e.ui.touch&&e.ui.is_touching&&("zoom"===s.mouse_mode||"drag"===s.mouse_mode)&&(a.fillStyle=s.color_bg,a.rect(0,i.height-2*g,4*g,g),a.fill(),a.stroke(),"zoom"===s.mouse_mode&&(a.rect(0,i.height-3*g,4*g,g),a.fill(),a.stroke()),a.fillStyle=s.color_fg,a.fillText("Auto Zoom",.2*g,i.height-1.3*g),"zoom"===s.mouse_mode&&a.fillText("Zoom out",.2*g,i.height-2.3*g)),e.ui.touch&&e.ui.is_touching){var O=a.getImageData(o-2*g,_-2*g,4*g,4*g);a.beginPath(),a.moveTo(o,_),a.lineTo(i.width/2,i.height/2),a.stroke(),a.rect(i.width/2-2*g-2,i.height/2-2*g-2,4*g+4,4*g+4),a.stroke(),a.putImageData(O,i.width/2-2*g,i.height/2-2*g),a.beginPath(),a.arc(i.width/2,i.height/2,g/2,0,2*Math.PI,!0),a.stroke()}}if(a.beginPath(),a.stroke(),mouse_down&&"zoom"===s.mouse_mode&&(end_x=o,end_y=_,a.beginPath(),a.rect(start_x+1,start_y+1,end_x-start_x-1,end_y-start_y-1),a.moveTo(start_x,0),a.lineTo(start_x,2*g),a.moveTo(start_x,i.height),a.lineTo(start_x,i.height-2*g),a.moveTo(end_x,i.height),a.lineTo(end_x,i.height-2*g),a.moveTo(end_x,0),a.lineTo(end_x,2*g),a.moveTo(0,start_y),a.lineTo(2*g,start_y),a.moveTo(i.width-2*g,start_y),a.lineTo(i.width,start_y),a.moveTo(0,end_y),a.lineTo(2*g,end_y),a.moveTo(i.width-2*g,end_y),a.lineTo(i.width,end_y),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"drag"===s.mouse_mode&&(e.ui.is_touching?(is_touch_dragging=!0,start_x=.5*(touch_start_x[0]+touch_start_x[1]),start_y=.5*(touch_start_y[0]+touch_start_y[1]),end_x=.5*(touch_x[0]+touch_x[1]),end_y=.5*(touch_y[0]+touch_y[1]),scale_x=(touch_x[0]-touch_x[1])/(touch_start_x[0]-touch_start_x[1]),scale_y=(touch_y[0]-touch_y[1])/(touch_start_y[0]-touch_start_y[1]),scale_x=trim(Math.abs(scale_x),.1,10),scale_y=trim(Math.abs(scale_y),.1,10),a.putImageData(e.graph_image_for_drag,0,0),a.save(),a.translate(start_x,start_y),a.scale(scale_x,scale_y),a.translate((end_x-start_x)/scale_x,(end_y-start_y)/scale_y),a.drawImage(i,-start_x,-start_y),a.restore()):(end_x=o,end_y=_,a.fillStyle=s.color_bg,a.fillRect(0,0,i.width,i.height),a.putImageData(e.graph_image_for_drag,end_x-start_x,end_y-start_y))),mouse_down&&"measure"===s.mouse_mode){if(a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(o,_),a.stroke(),dx=o-start_x,D=_-start_y,l=e.pixels_to_units(o,"x"),r=e.pixels_to_units(_,"y"),px_start=e.pixels_to_units(start_x,"x"),py_start=e.pixels_to_units(start_y,"y"),A=e.get_axis_string(l,"x"),a.fillText(A,o+h,i.height-1.5*g),A=e.get_axis_string(r,"y"),a.fillText(A,2*g,_-2*h),a.beginPath(),a.moveTo(o,i.height),a.lineTo(o,i.height-1.5*g),a.moveTo(o,0),a.lineTo(o,2*g),a.moveTo(0,_),a.lineTo(2*g,_),a.moveTo(i.width,_),a.lineTo(i.width-2*g,_),a.stroke(),a.beginPath(),a.stroke(),A=e.get_axis_string(px_start,"x"),a.fillText(A,start_x+h,i.height-2*g),A=e.get_axis_string(py_start,"y"),a.fillText(A,2*g,start_y-2*h),a.beginPath(),a.moveTo(start_x,i.height),a.lineTo(start_x,i.height-2*g),a.moveTo(start_x,0),a.lineTo(start_x,2*g),a.moveTo(0,start_y),a.lineTo(2*g,start_y),a.moveTo(i.width,start_y),a.lineTo(i.width-2*g,start_y),a.stroke(),a.beginPath(),a.stroke(),(dx>g/2||dx<-g/2)&&(x_meas=Math.min(_,start_y)-g,a.beginPath(),a.moveTo(o,x_meas-.3*g),a.lineTo(o,x_meas+.3*g),a.moveTo(start_x,x_meas-.3*g),a.lineTo(start_x,x_meas+.3*g),a.moveTo(o,x_meas),a.lineTo(start_x,x_meas),a.stroke(),A="time"===s.x_scale_mode?mjs_time_difference_print(l-px_start):e.get_axis_string(l-px_start,"x"),a.fillText(A,(o+start_x)/2-.3*s.scaling_factor*s.axis_labels_font_size*A.length,x_meas-.4*s.axis_labels_font_size)),(D>g/2||-g/2>D)&&(y_meas=Math.min(o,start_x)-g,A="time"===s.y_scale_mode?mjs_time_difference_print(r-py_start):e.get_axis_string(r-py_start,"y"),label_pos=y_meas-.7*s.axis_labels_font_size*s.scaling_factor*A.length,a.beginPath(),a.moveTo(y_meas-.3*g,_),a.lineTo(y_meas+.3*g,_),a.moveTo(y_meas-.3*g,start_y),a.lineTo(y_meas+.3*g,start_y),a.moveTo(y_meas,_),a.lineTo(y_meas,start_y),a.stroke(),a.fillText(A,label_pos,(_+start_y)/2)),(dx>g/2||dx<-g/2)&&(D>g/2||-g/2>D)){grad=(r-py_start)/(l-px_start);
var W="";if("lin"!==s.y_scale_mode&&"log"!==s.y_scale_mode||"time"!==s.x_scale_mode?grad=mjs_precision(grad,Math.min(s.y_precision,s.x_precision)):(W="/ms",Math.abs(grad)<1&&(grad*=1e3,W="/s"),Math.abs(grad)<1&&(grad*=60,W="/m"),Math.abs(grad)<1&&(grad*=60,W="/h"),Math.abs(grad)<1&&(grad*=24,W="/d"),grad=mjs_precision(grad,5)),a.fillText("g = "+grad+W,o+h,_-h),"log"===s.y_scale_mode&&("lin"===s.x_scale_mode||"time"===s.x_scale_mode)){var R=(Math.log10(r)-Math.log10(py_start))/(l-px_start);"time"===s.x_scale_mode?(W="/ms",Math.abs(R)<1&&(R*=1e3,W="/s"),Math.abs(R)<1&&(R*=60,W="/m"),Math.abs(R)<1&&(R*=60,W="/h"),Math.abs(R)<1&&(R*=24,W="/d"),R=mjs_precision(R,5)):(W="",R=mjs_precision(R,Math.min(s.y_precision,s.x_precision))),a.fillText("tau ="+R+W,o+h,_+h);var J=Math.ceil(Math.max(dx,D)/4);a.beginPath();for(var Y=0;J>Y;Y++){var j=e.units_to_pixels(py_start+Y*(r-py_start)/J,"y"),k=e.units_to_pixels(px_start+Y*(l-px_start)/J,"x");a.moveTo(k,j);var j=e.units_to_pixels(py_start+(Y+1)*(r-py_start)/J,"y"),k=e.units_to_pixels(px_start+(Y+1)*(l-px_start)/J,"x");a.lineTo(k,j)}a.stroke()}if("log"===s.y_scale_mode&&"log"===s.x_scale_mode){var G=(Math.log10(r)-Math.log10(py_start))/(Math.log10(l)-Math.log10(px_start));G=mjs_precision(G,Math.min(s.y_precision,s.x_precision)),a.fillText("p ="+G,o+h,_+h);var J=Math.ceil(Math.max(dx,D)/2);a.beginPath();for(var j=0,k=0,Y=0;J>Y;Y++)k=Math.exp(Math.log(px_start)+Y*(Math.log(l)-Math.log(px_start))/J),j=(k-px_start)*grad+py_start,k=e.units_to_pixels(k,"x"),j=e.units_to_pixels(j,"y"),a.moveTo(k,j),k=Math.exp(Math.log(px_start)+(Y+1)*(Math.log(l)-Math.log(px_start))/J),j=(k-px_start)*grad+py_start,k=e.units_to_pixels(k,"x"),j=e.units_to_pixels(j,"y"),a.lineTo(k,j);a.stroke()}}a.beginPath(),a.stroke()}if(mouse_down&&"trim"===s.mouse_mode&&(end_x=o,end_y=_,a.beginPath(),a.rect(start_x,start_y,end_x-start_x,end_y-start_y),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"cut"===s.mouse_mode&&(end_x=o,end_y=_,a.beginPath(),a.rect(start_x,start_y,end_x-start_x,end_y-start_y),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"x-c"===s.mouse_mode&&(A=mjs_precision(l,s.y_precision+1),a.fillText("x-"+A,o+2*h,_-2*h),a.beginPath(),a.moveTo(o,0),a.lineTo(o,i.height),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"y-c"===s.mouse_mode&&(A=mjs_precision(r,s.y_precision+1),a.fillText("y-"+A,o+2*h,_-2*h),a.beginPath(),a.moveTo(0,_),a.lineTo(i.width,_),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"sublin"===s.mouse_mode&&(a.fillText("draw line to subtract",o+2*h,_-2*h),a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(o,_),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"mouse"===s.mouse_mode){e.ui.mouse_is_dragging=!1;var B=Math.sqrt(Math.pow(start_x-s.fit_text_position.x*i.width,2)+Math.pow(start_y-s.fit_text_position.y*i.height,2));if(2*h>B)return a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(o,_),a.stroke(),e.ui.mouse_is_dragging=!0,void(e.ui.drag_object="fit_text");if(B=Math.sqrt(Math.pow(start_x-i.width/2,2)+Math.pow(start_y-(s.tick_len+s.title_spacing+s.title_font_size)*s.scaling_factor,2)),2*h>B)return a.beginPath(),a.moveTo(i.width/2,start_y),a.lineTo(i.width/2,_),a.stroke(),e.ui.mouse_is_dragging=!0,void(e.ui.drag_object="title_spacing");var w=s.scaling_factor*s.caption_position.x;if(s.caption_position.x>0?w+=s.scaling_factor*s.tick_len:(w=i.width+w,w-=s.scaling_factor*s.tick_len),cap_y=s.scaling_factor*s.caption_position.y,s.caption_position.y>0?cap_y+=s.scaling_factor*s.tick_len:(cap_y=i.height+cap_y,cap_y-=s.scaling_factor*s.tick_len),B=Math.sqrt(Math.pow(start_x-w,2)+Math.pow(start_y-cap_y,2)),2*h>B){a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(o,_),a.stroke();var H=2*h;return a.beginPath(),o>i.width/2&&_>i.height/2&&(a.moveTo(o-H,_),a.lineTo(o,_),a.lineTo(o,_-H)),o>i.width/2&&_<i.height/2&&(a.moveTo(o-H,_),a.lineTo(o,_),a.lineTo(o,_+H)),o<i.width/2&&_>i.height/2&&(a.moveTo(o+H,_),a.lineTo(o,_),a.lineTo(o,_-H)),o<i.width/2&&_<i.height/2&&(a.moveTo(o+H,_),a.lineTo(o,_),a.lineTo(o,_+H)),a.stroke(),e.ui.mouse_is_dragging=!0,void(e.ui.drag_object="caption_position")}}}function mouse_down_event(t,e){mouse_down=!0;var i=e.canvas,a=(i.getContext("2d"),i.getBoundingClientRect());start_x=t.clientX-a.left,start_y=t.clientY-a.top,drag_x_max=e.pixels_to_units(i.width,"x"),drag_x_min=e.pixels_to_units(0,"x"),drag_y_max=e.pixels_to_units(0,"y"),drag_y_min=e.pixels_to_units(i.height,"y")}function mouse_out_event(t,e){var i=e.canvas,a=i.getContext("2d");a.putImageData(e.graph_image,0,0)}function keypress_event(t){console.log("in keypress");var e=String.fromCharCode(t.keyCode||t.charCode);console.log(e),console.log("in keypress")}function mouse_up_event(event,graph){"use strict";var canvas=graph.canvas,gs=graph.graphics_style,ctx=canvas.getContext("2d");mouse_down=!1;var rect=canvas.getBoundingClientRect(),end_x=event.clientX-rect.left,end_y=event.clientY-rect.top,no_drag_size=gs.tick_len,edge=graph.ui.size;if(gs.o>=1){var s=graph.ui.s,names=["scale width x","scale width y","symbol size","line thickness","tick length","minor tick length","title font size","ticks font size","axis font size","title spacing","tick padding","label spacing","graph line thickness"],values=["guideWidthx","guideWidthy","symbol_size","line_thickness","tick_len","minor_tick_len","title_font_size","tick_labels_font_size","axis_labels_font_size","title_spacing","tick_lables_font_padding","lable_spacing","graph_line_thickness"],item=Math.ceil((end_y-s)/(1.2*s)),button=Math.ceil((end_x-s)/s)-1,speed=1.1;if(button>=1)var scale=1/speed;else var scale=speed;console.log(names[item]),item>=0&&item<values.length&&eval("graph.graphics_style."+values[item]+"*="+scale),item-=values.length;var strings=["font_name","title","subtitle","subtitle2","x_axis_title","y_axis_title","color_fg","color_bg","color_mg"],string_names=["font","title","subtitle","subtitle2","x-axis","y-axis","fg color","bg color","mg color"];if(item>=0&&item<strings.length){var name=string_names[item],old_item=eval("graph.graphics_style."+strings[item]);eval("graph.graphics_style."+strings[item]+'= prompt("new '+name+'", "'+old_item+'") || "'+old_item+'"; '),("y-axis"===name||"x-axis"===name)&&graph.transform_index--}if(item-=strings.length,1==item){var temp=gs.o;graph.graphics_style=JSON.parse(JSON.stringify(graph.default_graphics_style)),graph.graphics_style.modified=!1,graph.graphics_style.o=temp,console.log("doing reset"),graph.transform_index=-1}return item--,1==item&&(graph.graphics_style.o=0,console.log("menu exit")),graph.mjs_plot(),void mouse_move_event(event,graph)}if("zoom"===gs.mouse_mode&&Math.abs(start_x-end_x)>no_drag_size&&Math.abs(start_y-end_y)>no_drag_size)return console.log("mouse zoom"),start_x=graph.pixels_to_units(start_x,"x"),start_y=graph.pixels_to_units(start_y,"y"),end_x=graph.pixels_to_units(end_x,"x"),end_y=graph.pixels_to_units(end_y,"y"),gs.x_manual_min=Math.min(start_x,end_x),gs.x_manual_max=Math.max(start_x,end_x),gs.y_manual_min=Math.min(start_y,end_y),gs.y_manual_max=Math.max(start_y,end_y),gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!0,gs.x_scale_tight=!0,void graph.mjs_plot();if(graph.ui.touch&&("zoom"===gs.mouse_mode||"drag"===gs.mouse_mode)&&4*edge>end_x&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(gs.y_scale_auto_min=!0,gs.y_scale_tight=!1,gs.y_scale_auto_max=!0,gs.y_scale_tight=!1,gs.x_scale_auto_min=!0,gs.x_scale_tight=!1,gs.x_scale_auto_max=!0,gs.x_scale_tight=!1),graph.ui.touch&&"zoom"===gs.mouse_mode&&4*edge>end_x&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(event.button=2),graph.drawcaptionmenu){var lx=Math.floor((canvas.width-end_x)/2/edge),ly=Math.floor(end_y/edge);if(graph.drawcaptionmenu=!1,1==ly&&(gs.show_captions=!gs.show_captions),7==ly&&(gs.captions_display="none"),1==lx)switch(ly){case 3:gs.captions_display="xfirst";break;case 4:gs.captions_display="xlast";break;case 5:gs.captions_display="xmin";break;case 6:gs.captions_display="xmax"}if(0==lx)switch(ly){case 3:gs.captions_display="yfirst";break;case 4:gs.captions_display="ylast";break;case 5:gs.captions_display="ymin";break;case 6:gs.captions_display="ymax"}return ly>2&&7>ly&&(gs.show_captions=!0),graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(graph.drawmodemenu){var lx=Math.floor(end_x/edge),ly=Math.floor(end_y/edge);if(0==ly&&(graph.drawmodemenu=!1),1==ly)switch(lx){case 0:gs.symbol_size*=1.2;break;case 1:gs.symbol_size/=1.2;break;case 2:gs.symbol_mode="none";break;case 3:gs.symbol_mode="dot";break;case 4:gs.symbol_mode="cdot";break;case 5:gs.symbol_mode="box";break;case 6:gs.symbol_mode="circ";break;case 7:gs.symbol_mode="x";break;case 8:gs.symbol_mode="cross"}if(2==ly)switch(lx){case 0:gs.line_thickness*=1.2;break;case 1:gs.line_thickness/=1.2;break;case 2:gs.line_mode="none";break;case 3:gs.line_mode="line";break;case 4:gs.line_mode="approx";break;case 5:gs.line_mode="interp";break;case 6:gs.line_mode="zig";break;case 7:gs.line_mode="zag";break;case 8:gs.line_mode="mid";break;case 9:gs.line_mode="hist"}return graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(graph.drawgraphmenu){var ly=Math.floor(end_y/edge);switch(ly){case 0:graph.drawgraphmenu=!1;break;case 1:gs.title=prompt("new title",gs.title)||gs.title;break;case 2:gs.subtitle=prompt("new subtitle",gs.subtitle)||gs.subtitle;break;case 3:gs.subtitle2=prompt("new subtitle",gs.subtitle2)||gs.subtitle2;break;case 4:gs.showTransformTexts=!gs.showTransformTexts;break;case 5:gs.x_axis_title=prompt("new x axis title",gs.x_axis_title)||gs.x_axis_title,graph.transform_index--;break;case 6:gs.y_axis_title=prompt("new y axis title",gs.y_axis_title)||gs.y_axis_title,graph.transform_index--;break;case 7:gs.scaling_factor/=1.1;break;case 8:gs.scaling_factor*=1.1;break;case 9:graph.graphics_style=JSON.parse(JSON.stringify(graph.default_graphics_style)),graph.graphics_style.modified=!1,graph.transform_index=-1}return graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(edge>end_y)return 4*edge>end_x&&(graph.drawmodemenu=!0),end_x>4*edge&&8*edge>end_x&&(graph.drawgraphmenu=!0),10*edge>end_x&&end_x>9*edge?(gs.mouse_mode="drag",graph.needs_drag_image=!0,graph.mjs_plot(),void mouse_move_event(event,graph)):11*edge>end_x&&end_x>10*edge?(gs.mouse_mode="zoom",void mouse_move_event(event,graph)):12*edge>end_x&&end_x>11*edge?(gs.mouse_mode="measure",void mouse_move_event(event,graph)):13*edge>end_x&&end_x>12*edge?(gs.mouse_mode="reader",void mouse_move_event(event,graph)):14*edge>end_x&&end_x>13*edge?(gs.mouse_mode="mouse",void mouse_move_event(event,graph)):(end_x<canvas.width&&end_x>canvas.width-edge&&(graph.drawcaptionmenu=!0),end_x<canvas.width-edge&&end_x>canvas.width-2*edge&&(gs.i=(gs.i+1)%2,gs.o=0),end_x<canvas.width-2*edge&&end_x>canvas.width-3*edge&&(gs.o=(gs.o+1)%2,gs.mouse_mode="options",gs.i=0),graph.mjs_plot(),void mouse_move_event(event,graph));if(graph.drawtimemenu){for(var lx=10*edge,ldx=2*edge,ly=canvas.height-3*edge,ldy=edge,i=0;2>i;i++)if(end_y>ly-(i+1)*ldy&&ly-i*ldy>end_y&&end_x>lx&&lx+4*ldx>end_x)for(var j=0;4>j;j++){var selected=end_x>lx+j*ldx&&lx+(j+1)*ldx>end_x;selected&&(graph.timemenuoptions[i]=j)}if(ly+2*ldy>end_y&&end_y>ly+1*ldy&&end_x>lx&&lx+3*ldx>end_x){console.log("apply button");var n=gs.data_transforms.length;gs.data_transforms[n]="time_to_num",gs.x_scale_mode="lin";var now=new Date;gs.data_transforms_args[n]=[graph.timemenuoptions[1],graph.timemenuoptions[0],"x",now.getTime()],graph.drawtimemenu=!1,graph.mjs_plot()}if(ly+2*ldy>end_y&&end_y>ly+1*ldy&&end_x>lx+3*ldx&&lx+6*ldx>end_x){console.log("apply button");var n=gs.data_transforms.length;gs.data_transforms[n]="time_to_num",gs.y_scale_mode="lin";var now=new Date;gs.data_transforms_args[n]=[graph.timemenuoptions[1],graph.timemenuoptions[0],"y",now.getTime()],graph.drawtimemenu=!1,graph.mjs_plot()}return void mouse_move_event(event,graph)}if(graph.drawfxmenu){var n=gs.data_transforms.length;if(12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-edge)return graph.drawfxmenu=!1,void mouse_move_event(event,graph);if(12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(console.log("resetbutton"),graph.graphics_style.data_transforms=[],graph.graphics_style.data_transforms_args=[],"hist dot"===gs.mode&&(gs.mode="line dot")),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-1*edge&&(console.log("pop"),gs.data_transforms.pop(),gs.data_transforms_args.pop()),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-14*edge&&end_y<canvas.height-13*edge&&(console.log("y vs y"),"y_vs_y"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]+=1,graph.transform_index--):(gs.data_transforms[n]="y_vs_y",gs.data_transforms_args[n]=[1])),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(console.log("cut button"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="cut",graph.drawfxmenu=!1),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge&&(console.log("normalise"),"normalise"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="normalise",gs.data_transforms_args[n]=[0]),gs.y_scale_auto_min=!0,gs.y_scale_auto_max=!0),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&(console.log("y-c"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="y-c",graph.drawfxmenu=!1),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&(console.log("x-c"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="x-c",graph.drawfxmenu=!1),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&(console.log("smooth"),"smooth"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]=1.467799*gs.data_transforms_args[n-1][0],graph.transform_index--):(gs.data_transforms[n]="smooth",gs.data_transforms_args[n]=[2.1544339])),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&(console.log("interpolate"),"interpolate"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]*=2,graph.transform_index--):(gs.data_transforms[n]="interpolate",gs.data_transforms_args[n]=[20])),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&(console.log("-baseline"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="sublin",graph.drawfxmenu=!1),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&(console.log("dy/dx"),gs.data_transforms[n]="differentiate",gs.data_transforms_args[n]=[0],gs.y_scale_auto_min=!0,gs.y_scale_auto_max=!0),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("ex"),"ln_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="e_to_x",gs.data_transforms_args[n]=[0])),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("lnx"),"e_to_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="ln_x",gs.data_transforms_args[n]=[0])),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("10^x"),"log_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="ten_to_x",gs.data_transforms_args[n]=[0])),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("logx"),"ten_to_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="log_x",gs.data_transforms_args[n]=[0])),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("x/10"),"scale_x"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=.1,graph.transform_index--):(gs.data_transforms[n]="scale_x",gs.data_transforms_args[n]=[.1]),gs.x_manual_min*=.1,gs.x_manual_max*=.1),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("10x"),"scale_x"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=10,graph.transform_index--):(gs.data_transforms[n]="scale_x",gs.data_transforms_args[n]=[10]),gs.x_manual_min*=10,gs.x_manual_max*=10),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge&&(console.log("1/x"),"one_over_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="one_over_x",gs.data_transforms_args[n]=[])),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge){console.log("-x"),"scale_x"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=-1,graph.transform_index--):(gs.data_transforms[n]="scale_x",gs.data_transforms_args[n]=[-1]);var oldmin=-1*gs.x_manual_min,oldmax=-1*gs.x_manual_max;gs.x_manual_min=Math.min(oldmin,oldmax),gs.x_manual_max=Math.max(oldmin,oldmax)}if(16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge){console.log("x<->y"),"swap_x_y"==gs.data_transforms[n-1]?(console.log("undoing swap"),gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="swap_x_y",gs.data_transforms_args[n]=[]);var temp=gs.x_manual_min;gs.x_manual_min=gs.y_manual_min,gs.y_manual_min=temp,temp=gs.x_manual_max,gs.x_manual_max=gs.y_manual_max,gs.y_manual_max=temp,temp=gs.x_scale_mode,gs.x_scale_mode=gs.y_scale_mode,gs.y_scale_mode=temp}if(16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(console.log("trim"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="trim",graph.drawfxmenu=!1),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge)if(console.log("y^(n)"),"y_pow_n"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];gs.y_manual_min=Math.pow(gs.y_manual_min,pwr/(pwr-1)),gs.y_manual_max=Math.pow(gs.y_manual_max,pwr/(pwr-1)),graph.transform_index--}else gs.data_transforms[n]="y_pow_n",gs.data_transforms_args[n]=[2],gs.y_manual_min=Math.pow(gs.y_manual_min,2),gs.y_manual_max=Math.pow(gs.y_manual_max,2);if(14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge)if(console.log("x^(n)"),"x_pow_n"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];gs.x_manual_min=Math.pow(gs.x_manual_min,pwr/(pwr-1)),gs.x_manual_max=Math.pow(gs.x_manual_max,pwr/(pwr-1)),graph.transform_index--}else gs.data_transforms[n]="x_pow_n",gs.data_transforms_args[n]=[2],gs.x_manual_min=Math.pow(gs.x_manual_min,2),gs.x_manual_max=Math.pow(gs.x_manual_max,2);if(16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge){if(console.log("sqrty"),"y_nth_root"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];graph.transform_index--}else{gs.data_transforms[n]="y_nth_root",gs.data_transforms_args[n]=[2];var pwr=2}var rtmin=Math.pow(Math.abs(gs.y_manual_min),.5),rtmax=Math.pow(Math.abs(gs.y_manual_max),.5);if(gs.y_manual_min<0&&gs.y_manual_max>0)var make_zero=0;else make_zero=1;gs.y_manual_min=Math.min(rtmin,rtmax)*make_zero,gs.y_manual_max=Math.max(rtmin,rtmax)}if(14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge){if(console.log("sqrtx"),"x_nth_root"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];graph.transform_index--}else{gs.data_transforms[n]="x_nth_root",gs.data_transforms_args[n]=[2];var pwr=2}var rtmin=Math.pow(Math.abs(gs.x_manual_min),.5),rtmax=Math.pow(Math.abs(gs.x_manual_max),.5);if(gs.x_manual_min<0&&gs.x_manual_max>0)var make_zero=0;else make_zero=1;gs.x_manual_min=Math.min(rtmin,rtmax)*make_zero,gs.x_manual_max=Math.max(rtmin,rtmax)}if(16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&console.log("B-A"),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&(console.log("sum"),gs.data_transforms[n]="sum",gs.data_transforms_args[n]=[]),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&(console.log("Jitter"),"jitter"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]+=1,graph.transform_index--):(gs.data_transforms[n]="jitter",gs.data_transforms_args[n]=[1])),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&(console.log("Hist"),gs.data_transforms[n]="hist",gs.data_transforms_args[n]=[0],gs.x_scale_auto_max=!0,gs.x_scale_auto_min=!0,gs.y_scale_auto_max=!0,gs.y_scale_auto_min=!0,gs.x_scale_mode="lin",gs.y_scale_mode="lin",gs.mode="hist dot"),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&(console.log("Intergrate"),gs.data_transforms[n]="intergrate",gs.data_transforms_args[n]=[0],gs.y_scale_auto_min=!0,gs.y_scale_auto_max=!0),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("ey"),gs.data_transforms[n]="e_to_y",gs.data_transforms_args[n]=[0]),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("lny"),gs.data_transforms[n]="ln_y",gs.data_transforms_args[n]=[0]),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("10^y"),gs.data_transforms[n]="ten_to_y",gs.data_transforms_args[n]=[0]),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("logy"),gs.data_transforms[n]="log_y",gs.data_transforms_args[n]=[0]),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("y/10"),"scale_y"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=.1,graph.transform_index--):(gs.data_transforms[n]="scale_y",gs.data_transforms_args[n]=[.1])),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("10y"),"scale_y"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=10,graph.transform_index--):(gs.data_transforms[n]="scale_y",gs.data_transforms_args[n]=[10])),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge&&(console.log("1/y"),"one_over_y"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="one_over_y",gs.data_transforms_args[n]=[])),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge){console.log("-y"),"scale_y"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=-1,graph.transform_index--):(gs.data_transforms[n]="scale_y",gs.data_transforms_args[n]=[-1]);var oldmin=-1*gs.y_manual_min,oldmax=-1*gs.y_manual_max;gs.y_manual_min=Math.min(oldmin,oldmax),gs.y_manual_max=Math.max(oldmin,oldmax)}if(22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-14*edge&&end_y<canvas.height-13*edge&&(console.log("subtract trend"),fits.fit_strings.indexOf(gs.fits)>-1?(gs.data_transforms[n]="subtract_fit",gs.data_transforms_args[n]=[gs.fits],gs.fits="none"):graph.errors.push("No fit chosen")),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge&&(console.log("subtract trend"),"remove_outliers"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][1]-=1,graph.transform_index--):fits.fit_strings.indexOf(gs.fits)>-1?(gs.data_transforms[n]="remove_outliers",gs.data_transforms_args[n]=[gs.fits,5],gs.fits="old"):graph.errors.push("No fit chosen")),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("subtract trend"),"keep_outliers"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][1]+=1,graph.transform_index--):fits.fit_strings.indexOf(gs.fits)>-1?(gs.data_transforms[n]="keep_outliers",gs.data_transforms_args[n]=[gs.fits,0],gs.fits="old"):graph.errors.push("No fit chosen")),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge){console.log("custom button");var f=prompt("y = f(x,y) =","y");f&&(gs.data_transforms[n]="custom_y",gs.data_transforms_args[n]=[f])}return 22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(console.log("x spacing"),gs.data_transforms[n]="spacing",gs.data_transforms_args[n]=[]),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(console.log("mean_normalise"),gs.data_transforms[n]="mean_normalise",gs.data_transforms_args[n]=[]),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-1*edge&&end_y<canvas.height&&(console.log("time menu"),graph.drawtimemenu=!0,graph.drawfxmenu=!1),graph.mjs_plot(),void mouse_move_event(event,graph)}if(graph.drawlinemenu){if(15*edge>end_x&&end_x>11*edge&&end_y>canvas.height-edge)return graph.drawlinemenu=!1,void mouse_move_event(event,graph);if(20*edge>end_x&&end_x>11*edge&&end_y<canvas.height-edge){var no_of_lines=graph.data_backup.length,no_of_function_lines=gs.function_lines.length,item=Math.floor(no_of_lines+no_of_function_lines+1-((canvas.height-end_y)/edge-1));if(0==item){console.log("new function");var f;f="time"===gs.x_scale_mode?prompt("y = f(x)","cos(2*pi*x/1000/60/60/24)"):prompt("y = f(x)","x*x/2"),f&&gs.function_lines.push(f)}if(item-=1,no_of_function_lines>item&&item>=0&&13*edge>end_x&&(console.log("remove item "+item),gs.function_lines.splice(no_of_function_lines-item-1,1)),no_of_function_lines>item&&item>=0&&end_x>13*edge){console.log("edit item "+item);var f=prompt("y = f(x)",gs.function_lines[no_of_function_lines-item-1]);f&&(gs.function_lines[no_of_function_lines-item-1]=f)}item-=no_of_function_lines,item>=0&&(console.log("hideshow"+item),gs.hidden_lines[item]=!gs.hidden_lines[item])}if(17*edge>end_x&&end_x>15*edge&&end_y>canvas.height-edge){console.log("all");for(var k=0;k<gs.hidden_lines.length;k++)gs.hidden_lines[k]=!1}if(19*edge>end_x&&end_x>17*edge&&end_y>canvas.height-edge){console.log("non");for(var k=0;k<gs.hidden_lines.length;k++)gs.hidden_lines[k]=!0}return graph.transform_index--,graph.mjs_plot(),void mouse_move_event(event,graph)}if(graph.drawexportmenu){graph.drawexportmenu=!1,mouse_move_event(event,graph);var my=canvas.height,dy=edge;if(end_y>my-dy&&my>end_y)return;if(my-=dy,end_y>my-dy&&my>end_y){for(console.log("csv"),len=0,i=0;i<graph.data.length;i++)len=Math.max(len,graph.data[i][0].length);for(var text="",ii=0;len>ii;ii++){for(i=0;i<graph.data.length;i++)try{text+=graph.data[i][0][ii].toString()+","+graph.data[i][1][ii].toString()+","}catch(e){text+=",,"}text=text.substring(0,text.length-1),text+="\n"}download_text(text,"mjsplot_graph.csv")}if(my-=dy,end_y>my-dy&&my>end_y){console.log("code");var theBody=document.getElementsByTagName("body")[0],text="";for(i=0;i<graph.data.length;i++){for(text+=graph.captions[i].replace(/\W/g,"")+"_x = [",ii=0;ii<graph.data[i][0].length-1;ii++)text+=graph.data[i][0][ii]+",";for(text+=graph.data[i][0][ii]+"];\n",text+=graph.captions[i].replace(/\W/g,"")+"_y = [",ii=0;ii<graph.data[i][1].length-1;ii++)text+=graph.data[i][1][ii]+",";text+=graph.data[i][1][ii]+"];\n"}show_text_to_screen(text,graph)}if(my-=dy,end_y>my-dy&&my>end_y){console.log("code matlab");var theBody=document.getElementsByTagName("body")[0],text="";for(i=0;i<graph.data.length;i++){for(text+=graph.captions[i].replace(/\W/g,"")+"_x = [",ii=0;ii<graph.data[i][0].length-1;ii++)text+=graph.data[i][0][ii]+" ";for(text+=graph.data[i][0][ii]+"];\n",text+=graph.captions[i].replace(/\W/g,"")+"_y = [",ii=0;ii<graph.data[i][1].length-1;ii++)text+=graph.data[i][1][ii]+" ";text+=graph.data[i][1][ii]+"];\n"}show_text_to_screen(text,graph)}if(my-=dy,end_y>my-dy&&my>end_y){console.log("code JSON");var text="";text=JSON.stringify(graph.data),download_text(text,"mjsplot_graph.json")}if(my-=dy,end_y>my-dy&&my>end_y){console.log("tabbed");var len=0;for(i=0;i<graph.data.length;i++)len=Math.max(len,graph.data[i][0].length);for(var text="",ii=0;len>ii;ii++){for(i=0;i<graph.data.length;i++)try{text+=graph.data[i][0][ii].toString()+"	"+graph.data[i][1][ii].toString()+"	"}catch(e){text+="		"}text+="\n"}download_text(text,"mjsplot_graph.dat")}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png hi"),graph.canvas.width*=3,graph.canvas.height*=3,gs.scaling_factor*=3,graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=600, height=400"),graph.transparent=!1,gs.scaling_factor/=3,graph.canvas.width/=3,graph.canvas.height/=3,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png low"),graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=600, height=400"),graph.transparent=!1,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png (small figure)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=1e3,graph.canvas.height=750,gs.scaling_factor*=2.5,graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=1000, height=750"),graph.transparent=!1,gs.scaling_factor/=2.5,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png (large figure)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=2e3,graph.canvas.height=1500,gs.scaling_factor*=2.5,graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=1000, height=750"),graph.transparent=!1,gs.scaling_factor/=2.5,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("svg");var svgDiv=document.createElement("div");svgDiv.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+graph.canvas.width+'" height="'+graph.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(svgDiv),graph.isSVG=!0,graph.mjs_plot();var svg=document.getElementById("_mjsplotSVG").outerHTML,xmlheadder='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';download_text(xmlheadder+svg,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(svgDiv),graph.isSVG=!1,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("svg (small fig)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=400,graph.canvas.height=300;var svgDiv=document.createElement("div");svgDiv.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+graph.canvas.width+'" height="'+graph.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(svgDiv),graph.isSVG=!0,graph.mjs_plot();var svg=document.getElementById("_mjsplotSVG").outerHTML,xmlheadder='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';download_text(xmlheadder+svg,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(svgDiv),graph.isSVG=!1,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("svg (large fig)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=800,graph.canvas.height=600;var svgDiv=document.createElement("div");svgDiv.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+graph.canvas.width+'" height="'+graph.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(svgDiv),graph.isSVG=!0,graph.mjs_plot();var svg=document.getElementById("_mjsplotSVG").outerHTML,xmlheadder='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';
download_text(xmlheadder+svg,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(svgDiv),graph.isSVG=!1,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("html embedding");var text="",nl=" \n",graph_name=graph.graph_name,canvas_name=graph.canvas_name,mjsplot_embed='<script src="mjs_plot_0_3_3svg.js"></script>',canvas_embed='<canvas id="'+canvas_name+'" width="'+graph.canvas.width+'px" height="'+graph.canvas.height+'px"></canvas>',data_code=JSON.stringify(graph.data_backup),gs_code=JSON.stringify(graph.graphics_style),captions_code=JSON.stringify(graph.captions_backup);text+="put this in <head>"+nl,text+=mjsplot_embed+nl,text+="This links to a copy of mjs_plot. You will need to put mjs_plot_3_n.js in the same folder."+nl,text+="The plan is to get a CDN so you can skip this step."+nl,text+=nl+"put a canvas in the <body> where you want the graph:"+nl,text+=canvas_embed+nl,text+=nl+"Put this after the <body>:"+nl,text+="<script>"+nl,text+=graph_name+' = new mjs_plot.new_graph("'+graph_name+'","'+canvas_name+'") ;'+nl,text+=graph_name+".setData( "+data_code+" );"+nl,text+=graph_name+".setCaptions( "+captions_code+" ); "+nl,text+=graph_name+".default_graphics_style = "+gs_code+"; "+nl,text+=graph_name+".plot();\n"+nl,text+="</script>"+nl,show_text_to_screen(text,graph)}return void(my-=dy)}if(graph.drawfitsmenu)return 21*edge>end_x&&end_x>18*edge&&end_y>canvas.height-edge&&(gs.fits="none"),end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(gs.extrapolate=!gs.extrapolate),end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&end_x>18*edge&&(gs.fits="stats"),end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge&&end_x>18*edge&&(gs.fits="exp"),end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&end_x>18*edge&&(gs.fits="exp_c"),end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&end_x>18*edge&&(gs.fits="log"),end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&end_x>18*edge&&(gs.fits="power"),end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&end_x>18*edge&&(gs.fits="power_c"),end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&end_x>18*edge&&(gs.fits="gauss"),end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&18*edge>end_x&&(gs.fits="const"),end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge&&18*edge>end_x&&(gs.fits="linear"),end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&18*edge>end_x&&(gs.fits="quad"),end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&18*edge>end_x&&(gs.fits="cubic"),end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&18*edge>end_x&&(gs.fits="poly4"),end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&18*edge>end_x&&(gs.fits="poly5"),end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&18*edge>end_x&&(gs.fits="poly6"),end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&18*edge>end_x&&(gs.fits="poly5"),graph.mjs_plot(),18*edge>end_x&&end_x>15*edge&&end_y>canvas.height-edge&&(graph.drawfitsmenu=!1),21*edge>end_x&&end_x>18*edge&&end_y>canvas.height-edge&&(gs.fits="none",graph.drawfitsmenu=!1),console.log(gs.fits),void mouse_move_event(event,graph);if(end_y>canvas.height-edge){if(1*edge>end_x&&end_x>0*edge&&(gs.y_scale_auto_min=!0,gs.y_scale_tight=!1),2*edge>end_x&&end_x>1*edge&&(gs.y_scale_auto_max=!0,gs.y_scale_tight=!1),3*edge>end_x&&end_x>2*edge&&(gs.x_scale_auto_min=!0,gs.x_scale_tight=!1),4*edge>end_x&&end_x>3*edge&&(gs.x_scale_auto_max=!0,gs.x_scale_tight=!1),5*edge>end_x&&end_x>4*edge&&(gs.show_grid=!gs.show_grid),6*edge>end_x&&end_x>5*edge&&(gs.y_scale_mode="log"===gs.y_scale_mode?"lin":"log"),7*edge>end_x&&end_x>6*edge&&(gs.x_scale_mode="log"===gs.x_scale_mode?"lin":"log"),8*edge>end_x&&end_x>7*edge&&(gs.x_scale_mode="time"),11*edge>end_x&&end_x>8*edge)return graph.drawfxmenu=!0,void mouse_move_event(event,graph);if(15*edge>end_x&&end_x>11*edge)return console.log("line menu button"),graph.drawlinemenu=!0,void mouse_move_event(event,graph);if(19*edge>end_x&&end_x>15*edge)return console.log("fits menu button"),graph.drawfitsmenu=!0,void mouse_move_event(event,graph);if(end_x<canvas.width&&end_x>canvas.width-edge&&(graph.drawexportmenu=!0),end_x<canvas.width-edge&&end_x>canvas.width-2*edge){var temp=gs.color_fg;gs.color_fg=gs.color_bg,gs.color_bg=temp}return end_x<canvas.width-2*edge&&end_x>canvas.width-3*edge&&(graph.isFullscreen?graph.exit_full_screen():graph.make_full_screen(graph)),graph.mjs_plot(),void mouse_move_event(event,graph)}if("zoom"===gs.mouse_mode)if(ctx.rect(start_x-.5*no_drag_size,start_y-.5*no_drag_size,no_drag_size,no_drag_size),ctx.stroke(),0===event.button)gs.x_scale_auto_min=!0,gs.y_scale_auto_min=!0,gs.x_scale_auto_max=!0,gs.y_scale_auto_max=!0,gs.y_scale_tight=!1,gs.x_scale_tight=!1;else if(2===event.button){gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!1,gs.x_scale_tight=!1;var f=.8;gs.x_manual_min=graph.pixels_to_units(-f*gs.guideWidthx,"x"),gs.x_manual_max=graph.pixels_to_units(canvas.width+f*gs.guideWidthx,"x"),gs.y_manual_min=graph.pixels_to_units(canvas.height+f*gs.guideWidthy,"y"),gs.y_manual_max=graph.pixels_to_units(-f*gs.guideWidthy,"y")}if(graph.ui.touch&&"measure"===gs.mouse_mode&&graph.ui.is_touching)return void(graph.graph_image=ctx.getImageData(0,0,canvas.width,canvas.height));if(graph.ui.touch&&"measure"===gs.mouse_mode)return void graph.mjs_plot();if("drag"===gs.mouse_mode){if(graph.ui.touch&&graph.ui.is_touching){start_x=.5*(touch_start_x[0]+touch_start_x[1]),start_y=.5*(touch_start_y[0]+touch_start_y[1]),end_x=.5*(touch_x[0]+touch_x[1]),end_y=.5*(touch_y[0]+touch_y[1]);var scale_x=(touch_x[0]-touch_x[1])/(touch_start_x[0]-touch_start_x[1]),scale_y=(touch_y[0]-touch_y[1])/(touch_start_y[0]-touch_start_y[1]);scale_x=trim(Math.abs(scale_x),.1,10),scale_y=trim(Math.abs(scale_y),.1,10);var new_max_y=0+(1-1/scale_y)*(start_y-0)+(-end_y+start_y)/scale_y,new_min_y=canvas.height+(1-1/scale_y)*(start_y-canvas.height)+(-end_y+start_y)/scale_y,new_max_x=canvas.width+(1-1/scale_x)*(start_x-canvas.width)+(-end_x+start_x)/scale_x,new_min_x=0+(1-1/scale_x)*(start_x-0)+(-end_x+start_x)/scale_x;return gs.y_manual_max=Math.min(1e250,graph.pixels_to_units(new_max_y,"y")),gs.y_manual_min=Math.max(-1e250,graph.pixels_to_units(new_min_y,"y")),gs.x_manual_min=Math.max(-1e250,graph.pixels_to_units(new_min_x,"x")),gs.x_manual_max=Math.min(1e250,graph.pixels_to_units(new_max_x,"x")),gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!0,gs.x_scale_tight=!0,void graph.mjs_plot()}if(!graph.ui.touch)return gs.y_manual_max=graph.pixels_to_units(start_y-end_y+gs.guideWidthy+1,"y"),gs.y_manual_min=graph.pixels_to_units(canvas.height+start_y-end_y-gs.guideWidthy-1,"y"),gs.x_manual_min=graph.pixels_to_units(start_x-end_x+gs.guideWidthx-1,"x"),gs.x_manual_max=graph.pixels_to_units(canvas.width+start_x-end_x-gs.guideWidthx+1,"x"),gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!0,gs.x_scale_tight=!0,void graph.mjs_plot()}if("reader"===gs.mouse_mode){var pi=0,pj=0,best_dist=1e200,dist=1e200;for(i=0;i<graph.data.length;i++)for(j=0;j<graph.data[i][0].length;j++){var xi=graph.units_to_pixels(graph.data[i][0][j],"x"),yi=graph.units_to_pixels(graph.data[i][1][j],"y");dist=Math.sqrt(Math.pow(xi-end_x,2)+Math.pow(yi-end_y,2)),best_dist>dist&&(best_dist=dist,pi=i,pj=j)}return graph.reader_index=[pi,pj],void mouse_move_event(event,graph)}if("trim"===gs.mouse_mode){console.log("mouse trim");var start_px=graph.pixels_to_units(start_x,"x"),start_py=graph.pixels_to_units(start_y,"y"),end_px=graph.pixels_to_units(end_x,"x"),end_py=graph.pixels_to_units(end_y,"y"),xlow=Math.min(start_px,end_px),ylow=Math.min(start_py,end_py),xhigh=Math.max(start_px,end_px),yhigh=Math.max(start_py,end_py),n=gs.data_transforms.length;return gs.data_transforms[n]="trim",gs.data_transforms_args[n]=[xlow,xhigh,ylow,yhigh],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}if("sublin"===gs.mouse_mode){console.log("sublin");var start_px=graph.pixels_to_units(start_x,"x"),start_py=graph.pixels_to_units(start_y,"y"),end_px=graph.pixels_to_units(end_x,"x"),end_py=graph.pixels_to_units(end_y,"y"),grad=(end_py-start_py)/(end_px-start_px),intercept=start_py-grad*start_px;if(isFinite(grad)&&isFinite(intercept)){var n=gs.data_transforms.length;gs.data_transforms[n]="sublin",gs.data_transforms_args[n]=[grad,intercept],gs.mouse_mode=graph.pre_mouse_mode,graph.mjs_plot()}return void(gs.mouse_mode=graph.pre_mouse_mode)}if("cut"===gs.mouse_mode){console.log("mouse cut");var start_px=graph.pixels_to_units(start_x,"x"),start_py=graph.pixels_to_units(start_y,"y"),end_px=graph.pixels_to_units(end_x,"x"),end_py=graph.pixels_to_units(end_y,"y"),xlow=Math.min(start_px,end_px),ylow=Math.min(start_py,end_py),xhigh=Math.max(start_px,end_px),yhigh=Math.max(start_py,end_py),n=gs.data_transforms.length;return gs.data_transforms[n]="cut",gs.data_transforms_args[n]=[xlow,xhigh,ylow,yhigh],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}if("y-c"===graph.graphics_style.mouse_mode){console.log("y-c");var c=graph.pixels_to_units(end_y,"y"),n=gs.data_transforms.length;return gs.data_transforms[n]="y_c",gs.data_transforms_args[n]=[c],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}if("x-c"===gs.mouse_mode){console.log("y-c");var c=graph.pixels_to_units(end_x,"x"),n=gs.data_transforms.length;return gs.data_transforms[n]="x_c",gs.data_transforms_args[n]=[c],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}return"mouse"===gs.mouse_mode?(graph.ui.mouse_is_dragging&&"fit_text"===graph.ui.drag_object&&(gs.fit_text_position.x=end_x/canvas.width,gs.fit_text_position.y=end_y/canvas.height),graph.ui.mouse_is_dragging&&"title_spacing"===graph.ui.drag_object&&(gs.title_spacing=(end_y-(gs.tick_len+gs.title_font_size)*gs.scaling_factor)/gs.scaling_factor),graph.ui.mouse_is_dragging&&"caption_position"===graph.ui.drag_object&&(gs.caption_position.x=end_x>canvas.width/2?-1*(canvas.width-end_x-gs.tick_len*gs.scaling_factor)/gs.scaling_factor:(end_x-gs.tick_len*gs.scaling_factor)/gs.scaling_factor,gs.caption_position.y=end_y>canvas.height/2?-1*(canvas.height-end_y-gs.tick_len*gs.scaling_factor)/gs.scaling_factor:(end_y-gs.tick_len*gs.scaling_factor)/gs.scaling_factor),graph.mjs_plot(),mouse_move_event(event,graph),void(graph.ui.mouse_is_dragging=!1)):("i"===gs.mouse_mode&&(gs.mouse_mode=graph.pre_mouse_mode,gs.i=0,"i"===gs.mouse_mode&&(gs.mouse_mode="zoom")),void graph.mjs_plot())}function touch_start_event(t,e){t.preventDefault(),e.ui.is_touching=!0,touch_start_x[0]=t.targetTouches[0].clientX-rect.left,touch_start_y[0]=t.targetTouches[0].clientY-rect.top,t.targetTouches.length>=2&&(touch_start_x[1]=t.targetTouches[1].clientX-rect.left,touch_start_y[1]=t.targetTouches[1].clientY-rect.top),touch_move_event(t,e)}function touch_move_event(t,e){my_touches=t.targetTouches,t.preventDefault(),e.ui.is_touching=!0,mouse_down=my_touches.length>=2,rect=e.canvas.getBoundingClientRect(),start_x=t.targetTouches[0].clientX-rect.left,start_y=t.targetTouches[0].clientY-rect.top,touch_x[0]=t.targetTouches[0].clientX-rect.left,touch_y[0]=t.targetTouches[0].clientY-rect.top,t.targetTouches.length>1&&(touch_x[1]=t.targetTouches[1].clientX-rect.left,touch_y[1]=t.targetTouches[1].clientY-rect.top),t.clientX=my_touches[my_touches.length-1].clientX,t.clientY=my_touches[my_touches.length-1].clientY,mouse_move_event(t,e)}function touch_cancel_event(t,e){e.ui.is_touching=0!=t.targetTouches.length,t.preventDefault(),touch_end_event(t,e)}function touch_leave_event(t,e){touch_end_event(t,e)}function touch_click_event(t,e){rect=e.canvas.getBoundingClientRect(),start_x=t.clientX-rect.left,start_y=t.clientY-rect.top,mouse_up_event(t,e)}function touch_end_event(t,e){e.ui.is_touching=0!=t.targetTouches.length,rect=e.canvas.getBoundingClientRect(),start_x=my_touches[0].clientX-rect.left,start_y=my_touches[0].clientY-rect.top,t.clientX=my_touches[my_touches.length-1].clientX,t.clientY=my_touches[my_touches.length-1].clientY,mouse_up_event(t,e)}function keep_parent_sized(t,e){e.canvas.style.width="100%",e.canvas.style.height="100%",e.canvas.width=canvas.offsetWidth,e.canvas.height=canvas.offsetHeight,e.mjs_plot()}function make_interactive(t){t.ui.touch?(t.canvas.addEventListener("touchstart",function(e){touch_start_event(e,t)},!1),t.canvas.addEventListener("touchend",function(e){touch_end_event(e,t)},!1),t.canvas.addEventListener("touchmove",function(e){touch_move_event(e,t)},!1),t.canvas.addEventListener("touchcancel",function(e){touch_cancel_event(e,t)},!1),t.canvas.addEventListener("touchleave",function(e){touch_leave_event(e,t)},!1),t.canvas.addEventListener("click",function(e){touch_click_event(e,t)},!1)):(t.canvas.addEventListener("mousemove",function(e){mouse_move_event(e,t)},!1),t.canvas.addEventListener("mousedown",function(e){mouse_down_event(e,t)},!1),t.canvas.addEventListener("mouseup",function(e){mouse_up_event(e,t)},!1),t.canvas.addEventListener("mouseout",function(e){mouse_out_event(e,t)},!1)),t.canvas.oncontextmenu=function(t){t.preventDefault()}}function SVGContext(t){this.target=document.getElementById("_mjsplotSVG"),this._ctx=t,this.x=0,this.y=0,this.strokeStyle="#000",this.lineWidth=2,this.lineCap,this.lineJoin,this.miterLimit=10,this.font,this.textAlign="left",this.textBaseline="alphabetic",this.direction="inherit",this._pixel_precision=2,this._shape_type="path",this.fillStyle="#000",this._path="",this._isdrawn=!1,this.clearAll=function(){for(;this.target.lastChild;)this.target.removeChild(this.target.lastChild)},this.arc=function(t,e,i){this._shape_type="arc",this._shape=document.createElementNS(svgNS,"circle"),this._shape.setAttributeNS(null,"stroke-width",this.lineWidth),this._shape.setAttributeNS(null,"stroke",this.strokeStyle),this._shape.setAttributeNS(null,"r",i),this._shape.setAttributeNS(null,"cx",t),this._shape.setAttributeNS(null,"cy",e)},this.moveTo=function(t,e){this._path+=" M"+t.toFixed(this._pixel_precision)+" "+e.toFixed(this._pixel_precision)},this.lineTo=function(t,e){this._path+=" L"+t.toFixed(this._pixel_precision)+" "+e.toFixed(this._pixel_precision)},this.beginPath=function(){this._shape_type="path",this._shape=document.createElementNS(svgNS,"path"),this._path="",this._isdrawn=!1},this.closePath=function(){this._path+="Z"},this.quadraticCurveTo=function(t,e,i,a){this._path+=" Q"+t.toFixed(this._pixel_precision)+" "+e.toFixed(this._pixel_precision)+" "+i.toFixed(this._pixel_precision)+" "+a.toFixed(this._pixel_precision)},this.bezierCurveTo=function(t,e,i,a,s,n){console.log("bezierCurveTo is not implemented yet"),this._path+=" Q"+(t+i)/2+" "+(e+a)/2+" "+s.toFixed(this._pixel_precision)+" "+n.toFixed(this._pixel_precision)},this.stroke=function(){this._shape.setAttributeNS(null,"fill","none"),this._shape.setAttributeNS(null,"stroke-width",this.lineWidth.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"stroke",this.strokeStyle),this._isdrawn||("path"===this._shape_type&&this._shape.setAttributeNS(null,"d",this._path),this.globalAlpha<1&&this._shape.setAttributeNS(null,"opacity",this.globalAlpha.toFixed(2)),this.target.appendChild(this._shape),this._isdrawn=!0)},this.fill=function(){this._shape.setAttributeNS(null,"fill",this.fillStyle),this._isdrawn||("path"===this._shape_type&&this._shape.setAttributeNS(null,"d",this._path),this.target.appendChild(this._shape),this._isdrawn=!0)},this.fillText=function(t,e,i){var a=document.createElementNS(svgNS,"text"),s="start";switch(this.textAlign){case"left":s="start";break;case"right":s="end";break;case"center":s="middle";break;case"middle":s="middle"}a.setAttributeNS(null,"text-anchor",s),a.setAttributeNS(null,"fill",this.fillStyle),a.setAttributeNS(null,"x",e.toFixed(this._pixel_precision)),a.setAttributeNS(null,"x",e.toFixed(this._pixel_precision)),a.setAttributeNS(null,"font-family",this.font_name),a.setAttributeNS(null,"y",i.toFixed(this._pixel_precision)),a.setAttributeNS(null,"font-size",parseFloat(this.font.split(" ")[0].slice(0,-2)).toFixed(this._pixel_precision)),a.textContent=t,this.target.appendChild(a)},this.rect=function(t,e,i,a){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+a),this.lineTo(t,e+a),this.lineTo(t,e)},this.fillRect=function(t,e,i,a){this.beginPath(),this.rect(t,e,i,a),this.fill()},this.strokeText=function(){},this.getImageData=this._ctx.getImageData,this.measureText=function(t){return{width:this._ctx.measureText(t).width}}}var MJS_PLOT_VERSION="0_3_4",MJS_PLOT_AUTOR="MJS",MJS_PLOT_DATE="2015",MJS_PLOT_WEBSITE="http://generalsarsby.github.io/mjs_plot/",DEBUGG_FORCE_TOUCH=!1,DEBUGG_FPS=!1,svgNS="http://www.w3.org/2000/svg",vals=[1,2,5],few_minor_ticks=[2,2,5],many_minor_ticks=[5,4,5],color_table=[["#aa3939"],["#aa3939","#383276"],["#aa3939","#236467","#7b9f35"],["#aa3939","#aa6d39","#236467","#2d882d"],["#aa3939","#aa6d39","#236467","#2d882d","#304473"],["#aa3939","#aa6d39","#236467","#2d882d","#304473","#ac873c"]],mouse_down=!1,start_x=0,end_x=0;try{Math.log10(100)}catch(e){Math.log10=function(t){return Math.log(t)/Math.LN10}}var log_vals=[[1],[1,3],[1,2,4],[1,2,3,6],[1,2,3,4,6],[1,2,3,4,6,8],[1,1.5,2,3,4,6,8],[1,1.5,2,2.5,3,4,6,8],[1,1.5,2,2.5,3,4,6,7,8],[1,1.2,1.5,2,2.5,3,4,5,6,7,9],[1,1.2,1.5,2,2.5,3,4,5,6,7,8,9],[1,1.2,1.4,1.6,1.8,2,2.5,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.1,1.2,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.35,1.4,1.45,1.5,1.55,1.6,1.65,1.7,1.75,1.8,1.85,1.9,1.95,2,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5]],log_vals_ticks=[[1,3],[1,2,3,4,5,6,7,8,9],[1,2,3,4,5,6,7,8,9],[1,2,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.5,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.25,2.75,3,3.5,4,4.5,5,5.5,6,6.5,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.25,2.75,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9]],allowed_intervals=[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,3e4,6e4,12e4,3e5,6e5,9e5,12e5,18e5,36e5,72e5,108e5,216e5,432e5,864e5,1728e5,432e6,6048e5,12096e5,2592e6,5184e6,15552e6,31536e6,63072e6,15768e7,31536e7,63072e7,15768e8,31536e8,63072e8,15768e9,31536e9],time_ticks=[.2,.5,1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,3e4,6e4,12e4,3e5,3e5,6e5,12e5,18e5,36e5,72e5,108e5,216e5,432e5,864e5,864e5,1728e5,864e6,1728e6,2592e6,7884e6,31536e6,31536e6,63072e6,15768e7,31536e7,63072e7,15768e8,31536e8,63072e8],string_precisions=[8,8,8,7,7,7,6,6,6,5,5,5,5,5,5,4,4,4,4,4,4,4,3,3,3,3,3,2,2,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0],fits={exponential_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]*Math.pow(Math.E,e[1]*t[a]));return i},exponential:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)e[s]>0&&(i.push(t[s]),a.push(e[s]));for(var n=[0,0,0,0,0,0],o=0;o<i.length;o++)n[0]+=i[o],n[1]+=a[o],n[2]+=i[o]*i[o]*a[o],n[3]+=a[o]*Math.log(a[o]),n[4]+=i[o]*a[o]*Math.log(a[o]),n[5]+=i[o]*a[o];var _=n[1]*n[2]-n[5]*n[5],l=Math.pow(Math.E,(n[2]*n[3]-n[5]*n[4])/_),r=(n[1]*n[4]-n[5]*n[3])/_,g="y = "+mjs_precision(l,5)+"e^("+mjs_precision(r,5)+"x)";return{parameters:[l,r],strings:[g,"",""],fun:fits.exponential_fun}},exponential_plus_c_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]+e[1]*Math.exp(e[2]*t[a]));return i},exponential_plus_c:function(t,e){var i=t.length,s=0,n=0,o=0,_=0,l=0,r=[];r[0]=0;for(var g=1;i>g;g++)r[g]=r[g-1]+.5*(e[g]+e[g-1])*(t[g]-t[g-1]);for(var g=0;i>g;g++)s+=(t[g]-t[0])*(t[g]-t[0]),n+=(t[g]-t[0])*r[g],o+=r[g]*r[g],_+=(e[g]-e[0])*(t[g]-t[0]),l+=(e[g]-e[0])*r[g];var h=1/(s*o-n*n),d=h*(o*_-n*l),c=h*(s*l-n*_);a=-1*d/c;for(var x=0,m=0,f=0,p=0,u=0,g=0;i>g;g++)u=Math.exp(c*t[g]),x+=u,m+=u*u,f+=e[g],p+=e[g]*u;h=1/(m*i-x*x);var y=h*(m*f-x*p),v=h*(i*p-x*f);a=y;var w="y = "+mjs_precision(a,5)+"+"+mjs_precision(v,5)+"e^("+mjs_precision(c,5)+"x)";return{parameters:[a,v,c],strings:[w,"",""],fun:fits.exponential_plus_c_fun}},gauss_fun:function(t,e){for(var i=[],a=e[0],s=e[1],n=Math.sqrt(2*Math.PI),o=0;o<t.length;o++)i.push(e[2]/n/s*Math.exp(-.5*Math.pow((t[o]-a)/s,2)));return i},gauss:function(t,e){var i=t.length,a=[];a[0]=0;for(var s=0,n=1;i>n;n++)a[n]=a[n-1]+.5*(e[n]+e[n-1])*(t[n]-t[n-1]);s=Math.abs(a[n-1]);var o=[];o[0]=0;for(var n=1;i>n;n++)o[n]=o[n-1]+.5*(t[n]*e[n]+t[n-1]*e[n-1])*(t[n]-t[n-1]);for(var _=0,l=0,r=0,g=0,h=0,n=0;i>n;n++)_+=a[n]*a[n],l+=a[n]*o[n],r+=o[n]*o[n],g+=(e[n]-e[0])*a[n],h+=(e[n]-e[0])*o[n];var d=1/(_*r-l*l),c=d*(r*g-l*h),x=d*(_*h-l*g),m=-1/x*Math.sqrt(2/Math.PI),m=Math.sqrt(-1/x),f=-c/x,p="A/(sig * sqrt(2pi)) exp(-0.5*((x-mu)/sig)^2)",u="sig = "+mjs_precision(m,5)+",  A = "+ +mjs_precision(s,5),y="mu = "+mjs_precision(f,5);return{parameters:[f,m,s],strings:[p,u,y],fun:fits.gauss_fun}},linear_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(t[a]*e[0]+e[1]);return i},linear:function(t,e){for(var i=0,a=0,s=0,n=0,o=0,_=0;_<t.length;_++)i+=t[_],s+=t[_]*t[_],a+=e[_],n+=t[_]*e[_],o+=e[_]*e[_];var l=t.length;n-=i*a/l,s-=i*i/l,o-=a*a/l;var r=i/l,g=n*n/s/o,h=n/s,d=a/l-h*i/l,c=Math.sqrt((o-n*n/s)/(l-2)),x=c/Math.sqrt(s),m=c*Math.sqrt(1/l+r*r/s),f=String.fromCharCode(178);return string1="r"+f+" = "+number_quote(g,1-g),string2="intecept a = "+number_quote(d,m)+",   S(a) = "+mjs_precision(m,2),string3="slope b = "+number_quote(h,x)+",   S(b) = "+mjs_precision(x,2),{parameters:[h,d],strings:[string1,string2,string3],fun:fits.linear_fun}},constant_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]);return i},constant:function(t,e){for(var i=0,a=0,s=0;s<t.length;s++)i+=e[s],a+=e[s]*e[s];var n=t.length;a-=i*i/n;var o=i/n,_=Math.sqrt(a/n);return string1="y="+number_quote(o,_)+String.fromCharCode(177)+mjs_precision(_,2),{parameters:[o],strings:[string1,"",""],fun:fits.constant_fun}},poly2:function(t,e){return fits.polyn_fit(t,e,2)},poly3:function(t,e){return fits.polyn_fit(t,e,3)},poly4:function(t,e){return fits.polyn_fit(t,e,4)},poly5:function(t,e){return fits.polyn_fit(t,e,5)},poly6:function(t,e){return fits.polyn_fit(t,e,6)},poly7:function(t,e){return fits.polyn_fit(t,e,7)},poly8:function(t,e){return fits.polyn_fit(t,e,8)},polyn_fun:function(t,e){for(var i=[],a=0;a<t.length;a++){i[a]=0;for(var s=0;s<e.length;s++)i[a]+=e[s]*Math.pow(t[a],s)}return i},polyn_fit:function(t,e,i){for(var a=[],s=[],n=0,o=0,_=0,l=i+1,_=0;l>_;_++){for(var r=0,g=t.length;g>r;r++)n+=Math.pow(t[r],_)*e[r];a.push(n),n=0;for(var h=[],d=0;l>d;d++){for(var r=0,g=t.length;g>r;r++)o+=Math.pow(t[r],_+d);h.push(o),o=0}s.push(h)}s.push(a);var d=0,l=0,c=0,x=0,m=s.length-1;for(_=0;m>_;_++){for(c=_,d=_+1;m>d;d++)Math.abs(s[_][d])>Math.abs(s[_][c])&&(c=d);for(l=_;m+1>l;l++)x=s[l][_],s[l][_]=s[l][c],s[l][c]=x;for(d=_+1;m>d;d++)for(l=m;l>=_;l--)s[l][d]-=s[l][_]*s[_][d]/s[_][_]}var f=[];for(d=m-1;d>=0;d--){for(x=0,l=d+1;m>l;l++)x+=s[l][d]*f[l];f[d]=(s[m][d]-x)/s[d][d]}fit=[];for(var _=0;_<t.length;_++){fit[_]=0;for(var p=0;p<f.length;p++)fit[_]+=f[p]*Math.pow(t[_],p)}for(var u=0,y=0,v=0,w=0,T=0,_=0;_<t.length;_++)u+=t[_],v+=t[_]*t[_],y+=e[_],w+=e[_]*e[_];for(var b=y/t.length,k=0,j=0,_=0;_<t.length;_++)k+=(fit[_]-b)*(fit[_]-b),j+=(fit[_]-e[_])*(fit[_]-e[_]);var m=t.length,M=w-y*y/m,k=T,S=1-j/M,P=String.fromCharCode(178),z="y = ",D="";if(f.length>4){for(var _=f.length-1;_>=4;_--)z+=_>1?mjs_precision(f[_],5)+"x^"+_+" + ":1==_?mjs_precision(f[_],5)+"x + ":mjs_precision(f[_],5);for(;_>=0;_--)D+=_>1?mjs_precision(f[_],5)+"x^"+_+" + ":1==_?mjs_precision(f[_],5)+"x + ":mjs_precision(f[_],5)}else for(var _=f.length-1;_>=0;_--)z+=_>1?mjs_precision(f[_],5)+"x^"+_+" + ":1==_?mjs_precision(f[_],5)+"x + ":mjs_precision(f[_],5);return string1="r"+P+" = "+number_quote(S,1-S),{parameters:f,strings:[string1,z,D],fun:fits.polyn_fun}},log_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]+e[1]*Math.log(t[a]));return i},log:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)t[s]>0&&(i.push(t[s]),a.push(e[s]));var o=0,_=0,l=0,r=0,g=i.length;for(n=0;n<g;n++)o+=Math.log(i[n]),_+=a[n]*Math.log(i[n]),l+=a[n],r+=Math.pow(Math.log(i[n]),2);var h=(n*_-l*o)/(n*r-o*o),d=(l-h*o)/n,c="y="+mjs_precision(d,4)+" + "+mjs_precision(h,4)+" ln(x)";return{parameters:[d,h],strings:[c,"",""],fun:fits.log_fun}},power_plus_c_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]+e[1]*Math.pow(t[a],e[2]));return i},power_plus_c:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)xi=Math.log(t[s]),isFinite(xi)&&(i.push(xi),a.push(e[s]));var n=fits.exponential_plus_c(i,a),o="y = "+mjs_precision(n.parameters[0],5)+"+"+mjs_precision(n.parameters[1],5)+"x^"+mjs_precision(n.parameters[2],5);return n.strings=[o,"",""],n.fun=fits.power_plus_c_fun,n},power_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]*Math.pow(t[a],e[1]));return i},power:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)t[s]>0&&e[s]>0&&(i.push(t[s]),a.push(e[s]));for(var n=i.length,o=0,_=0,l=0,r=0,s=0;n>s;s++)o+=Math.log(i[s]),_+=Math.log(a[s])*Math.log(i[s]),l+=Math.log(a[s]),r+=Math.pow(Math.log(i[s]),2);var g=(n*_-l*o)/(n*r-o*o),h=Math.pow(Math.E,(l-g*o)/n),d="y="+mjs_precision(h,4)+"x^"+mjs_precision(g,4);return{parameters:[h,g],strings:[d,"",""],fun:fits.power_fun}},pre_fit_normalizing:function(t){for(var e=series_stats(t,t),i=clone(t),a=0;a<t.length;a++)i[a]=(t[a]-e.x_mean)/e.sigma_x;var s="normalized (x-"+e.x_mean+")/"+e.sigma_x;return{x:i,s:s,x_mean:e.x_mean,sigma_x:e.sigma_x}},post_fit_normalizing:function(t,e){for(var i=clone(t),a=0;a<t.length;a++)i[a]=(t[a]-e.x_mean)/e.sigma_x;return i}};fits.fit_strings=["exp","exp_c","linear","quad","cubic","poly4","poly5","poly6","poly7","const","log","power","power_c","gauss"],fits.fit_funs=[fits.exponential,fits.exponential_plus_c,fits.linear,fits.poly2,fits.poly3,fits.poly4,fits.poly5,fits.poly6,fits.poly7,fits.constant,fits.log,fits.power,fits.power_plus_c,fits.gauss];var dotcount=0,touch_start_x=[],touch_start_y=[],touch_x=[],touch_y=[],transforms={scale_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=t[i][0][j]*e[0];a.transform_text_x=a.transform_text_x+"*"+mjs_precision(e[0],1)},log_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.log10(t[i][0][j]);transforms.clean(t,a),a.transform_text_x="log("+a.transform_text_x+")"},x_c:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=t[i][0][j]-e[0];a.transform_text_x=a.transform_text_x+"-"+mjs_precision(e[0],a.graphics_style.x_precision+1)},y_c:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=t[i][1][j]-e[0];a.transform_text_y=a.transform_text_y+"-"+mjs_precision(e[0],a.graphics_style.y_precision+1)},remove_lines:function(t,e,i){for(var a=t.length-1;a>=0;a--)e[a]&&(t.splice(a,1),i.captions.splice(a,1),i.colors.splice(a,1))},y_vs_y:function(t,e,i){var a=e[0]%t.length;console.log(a);for(var s=t[a][0].length,n=0;n<t.length;n++){var s=Math.min(t[n][0].length,t[a][0].length);if(n!=a){for(var o=[],_=[],l=0;s>l;l++)o[l]=t[a][1][l],_[l]=t[n][1][l];t[n]=[clone(o),clone(_)],i.captions[n]=i.captions[a]+" vs "+i.captions[n]}}i.transform_text_x=i.captions[a]+"("+i.transform_text_y+")",i.captions.splice(a,1),t.splice(a,1),i.colors.splice(a,1)},sum:function(t,e,a){var s=(Math.min(t[0][0].length),[]),n=[];for(j=0;j<t[0][0].length;j++)for(s[j]=t[0][0][j],n[j]=0,i=0;i<t.length;i++)n[j]+=t[i][1][j];var o="sum(";for(i=0;i<t.length;i++)o+=", "+a.captions[i];o+=")",t[0]=[s,n],t.splice(1,t.length-1),a.captions[0]=o,a.captions.splice(1,t.length-1),a.transform_text_y="sum("+a.transform_text_y+")",transforms.clean(t,a)},ln_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.log(t[i][0][j]);transforms.clean(t,a),console.log(t),a.transform_text_x="ln("+a.transform_text_x+")"},e_to_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(Math.E,t[i][0][j]);a.transform_text_x="e^("+a.transform_text_x+")"},ten_to_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(10,t[i][0][j]);a.transform_text_x="10^("+a.transform_text_x+")"},scale_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][1][j]=t[i][1][j]*e[0];a.transform_text_y=a.transform_text_y+"*"+mjs_precision(e[0],1)},log_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.log10(t[i][1][j]);transforms.clean(t,a),a.transform_text_y="log("+a.transform_text_y+")"},ln_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.log(t[i][1][j]);transforms.clean(t,a),a.transform_text_y="ln("+a.transform_text_y+")"},e_to_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(Math.E,t[i][1][j]);a.transform_text_y="e^("+a.transform_text_y+")"},ten_to_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(10,t[i][1][j]);a.transform_text_y="10^("+a.transform_text_y+")"},one_over_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][1][j]=1/t[i][1][j];transforms.clean(t,a),a.transform_text_y="1/("+a.transform_text_y+")"},custom_y:function(t,e,a){for(i=0;i<t.length;i++)t[i][1]=parseExpression(e[0],t[i][0],t[i][1]);transforms.clean(t,a),a.transform_text_y="f("+a.transform_text_y+")"},one_over_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=1/t[i][0][j];transforms.clean(t,a),a.transform_text_x="1/("+a.transform_text_x+")"},x_pow_n:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(t[i][0][j],e[0]);a.transform_text_x="("+a.transform_text_x+")^"+e[0]},y_pow_n:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(t[i][1][j],e[0]);a.transform_text_y="("+a.transform_text_y+")^"+e[0]},add_me:function(t,e,i){i.data=[[[2,2,3,4,4],[2,5,4,5,2]],[[5,7,6,6,5],[5,5,5,2,2]],[[8,10,10,8,8,10],[2,2,4,4,5,5]],[[1,1,11,11,1],[1,6,6,1,1]]],i.captions=["m","j","s"," "]},y_nth_root:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(Math.abs(t[i][1][j]),1/e[0]);a.transform_text_y="("+a.transform_text_y+")^1/"+e[0]},x_nth_root:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(Math.abs(t[i][0][j]),1/e[0]);a.transform_text_x="("+a.transform_text_x+")^1/"+e[0]},trim:function(t,e,a){var s=e[0],n=e[1],o=e[2],_=e[3];for(i=0;i<t.length;i++)for(var l=t[i][0].length-1;l>=0;l--)(t[i][0][l]<s||t[i][0][l]>n||t[i][1][l]<o||t[i][1][l]>_)&&(t[i][0][l]=0/0);transforms.clean(t,a),a.transform_text_x="trim("+a.transform_text_x+")",a.transform_text_y="trim("+a.transform_text_y+")"},cut:function(t,e,a){var s=e[0],n=e[1],o=e[2],_=e[3];for(i=0;i<t.length;i++)for(var l=t[i][0].length-1;l>=0;l--)t[i][0][l]<s||t[i][0][l]>n||t[i][1][l]<o||t[i][1][l]>_||(t[i][0][l]=0/0);transforms.clean(t,a),a.transform_text_x="cut("+a.transform_text_x+")",a.transform_text_y="cut("+a.transform_text_y+")"},remove_linear:function(t,e,a){for(i=0;i<t.length;i++)for(slope=linear_regression(t[i][0],t[i][1]),j=0;j<t[i][0].length;j++)t[i][1][j]=t[i][1][j]-slope.a-slope.b*t[i][0][j];a.transform_text_y="sub_linear("+a.transform_text_y+")"},sublin:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][1][j]=t[i][1][j]-e[1]-e[0]*t[i][0][j];var s=Math.max(a.graphics_style.x_precision,a.graphics_style.y_precision)+1;a.transform_text_y=a.transform_text_y+"-"+mjs_precision(e[1],s)+"-"+mjs_precision(e[0],s)+"x"
},swap_x_y:function(t,e,a){for(i=0;i<t.length;i++)s=t[i][0],t[i][0]=t[i][1],t[i][1]=s;var s=a.transform_text_x;a.transform_text_x=a.transform_text_y,a.transform_text_y=s},normalise:function(t,e,a){for(i=0;i<t.length;i++)for(ymin=Math.min.apply(null,t[i][1]),ymax=Math.max.apply(null,t[i][1]),j=0;j<t[i][1].length;j++)t[i][1][j]=(t[i][1][j]-ymin)/(ymax-ymin);a.transform_text_y="norm("+a.transform_text_y+")"},mean_normalise:function(t,e,a){for(i=0;i<t.length;i++){var s=series_stats(t[i][0],t[i][1]);for(j=0;j<t[i][1].length;j++)t[i][1][j]=(t[i][1][j]-s.y_mean)/s.sigma_y}a.transform_text_y="norm("+a.transform_text_y+")"},clean:function(t,e){for(i=0;i<t.length;i++){if(2==t[i].length)for(var a=t[i][0].length-1;a>=0;a--)isFinite(t[i][1][a])&&isFinite(t[i][0][a])||(t[i][0].splice(a,1),t[i][1].splice(a,1));if(3==t[i].length)for(var a=t[i][0].length-1;a>=0;a--)isFinite(t[i][1][a])&&isFinite(t[i][0][a])||(t[i][0].splice(a,1),t[i][1].splice(a,1),t[i][2].splice(a,1));if(4==t[i].length)for(var a=t[i][0].length-1;a>=0;a--)isFinite(t[i][1][a])&&isFinite(t[i][0][a])||(t[i][0].splice(a,1),t[i][1].splice(a,1),t[i][2].splice(a,1),t[i][3].splice(a,1))}for(var a=t.length-1;a>=0;a--)0==t[a][0].length&&(t.splice(a,1),e.captions.splice(a,1),e.colors.splice(a,1))},intergrate:function(t,e,a){var s=0;for(i=0;i<t.length;i++){for(s=0,tallys=[],tallys[0]=0,j=0;j<t[i][0].length-1;j++)s+=(t[i][0][j+1]-t[i][0][j])*(t[i][1][j+1]+t[i][1][j])/2,console.log(s),tallys[j+1]=s;for(j=0;j<t[i][0].length;j++)t[i][1][j]=tallys[j]}a.transform_text_y="int("+a.transform_text_y+")"},smooth:function(t,e,a){var s=0,n=0,o=0,_=0;for(i=0;i<t.length;i++){var l=Math.round(Math.min(t[i][0].length/3,e[0]/2)),r=[],g=[],h=[],c=t[i][0].length;for(h[0]=Math.sqrt(Math.pow(2*(t[i][0][1]-t[i][0][0]),2)+Math.pow(2*(t[i][1][1]-t[i][1][0]),2)),h[c-1]=Math.sqrt(Math.pow(2*(t[i][0][c-1]-t[i][0][c-2]),2)+Math.pow(2*(t[i][0][c-1]-t[i][1][c-2]),2)),j=1;j<t[i][0].length-1;j++)h[j]=Math.sqrt(Math.pow(t[i][0][j+1]-t[i][0][j-1],2)+Math.pow(t[i][1][j+1]-t[i][1][j-1],2));for(j=0;j<t[i][0].length;j++){s=Math.max(j-l,0),n=Math.min(j+l,t[i][0].length-1),d=n-s,o=0,_=0,sumw=0;for(var x=s;n>x;x++)_+=t[i][0][x]*h[x],o+=t[i][1][x]*h[x],sumw+=h[x];g[j]=o/sumw,r[j]=_/sumw}t[i]=[r,g]}a.transform_text_y="smooth("+a.transform_text_y+","+Math.round(e[0])+")"},hist:function(t,e,a){for(i=0;i<t.length;i++){for(var s=Math.min.apply(null,t[i][1]),n=Math.max.apply(null,t[i][1]),o=0,_=-13,l=0,r=2,g=2*Math.floor(Math.pow(t[i][1].length,.5)),l=vals[o]*Math.pow(10,_),h=Math.ceil(n/l)-Math.floor(s/l)+r;h>g;)o+=1,3==o&&(o=0,_+=1),l=vals[o]*Math.pow(10,_),h=Math.ceil(n/l)-Math.floor(s/l)+r;var d=Math.floor(s/l-1)*l,c=Math.ceil(n/l+1)*l,x=[],m=[],f=0;for(bin_start=d;bin_start<c;bin_start+=l){var p=bin_start+l;for(m[f]=0,j=0;j<t[i][1].length-1;j++)bin_start<t[i][1][j]&&t[i][1][j]<p&&(m[f]+=1);x[f]=(bin_start+p)/2,f++}t[i][0]=x,t[i][1]=m}a.transform_text_y="hist("+a.transform_text_y+")",a.transform_text_x="bin_centers("+a.transform_text_x+")"},interpolate:function(t,e,a){var s=Math.min.apply(null,t[0][0]),n=Math.max.apply(null,t[0][0]);for(i=0;i<t.length;i++){var o=Math.min.apply(null,t[i][0]),_=Math.max.apply(null,t[i][0]);s=Math.min(s,o),n=Math.max(n,_)}var l=(n-s)/e[0];for(i=0;i<t.length;i++){var r=[],g=[];for(j=0;j<e[0];j++){r[j]=s+j*l;var h=1e200,d=1,c=1e200,x=t[i][0].length-2;for(k=0;k<t[i][0].length;k++){var m=r[j]-t[i][0][k];m>=0&&h>m&&(h=m,d=k),0>m&&c>-1*m&&(c=-1*m,x=k)}g[j]=t[i][1][d]+(t[i][1][x]-t[i][1][d])/(t[i][0][x]-t[i][0][d])*(r[j]-t[i][0][d])}t[i][0]=r,t[i][1]=g}transforms.clean(t,a),a.transform_text_y="interpolate("+a.transform_text_y+","+e[0]+")",a.transform_text_x="interpolate("+a.transform_text_x+","+e[0]+")"},differentiate:function(t,e,a){for(i=0;i<t.length;i++){for(j=0;j<t[i][0].length-1;j++)t[i][1][j]=(t[i][1][j+1]-t[i][1][j])/(t[i][0][j+1]-t[i][0][j]),t[i][0][j]=(t[i][0][j]+t[i][0][j+1])/2;t[i][1].pop(),t[i][0].pop()}transforms.clean(t,a),a.transform_text_y="d/dx("+a.transform_text_y+")"},subtract_fit:function(t,e,a){var s=e[0];for(i=0;i<t.length;i++){var n=fits.fit_funs[fits.fit_strings.indexOf(s)](t[i][0],t[i][1]),o=n.fun(t[i][0],n.parameters);for(j=0;j<t[i][0].length;j++)t[i][1][j]-=o[j]}transforms.clean(t,a),a.transform_text_y=a.transform_text_y+"-"+n.strings[0]},keep_outliers:function(t,e,i){transforms.outliers_generic(t,e,i,!1)},remove_outliers:function(t,e,i){transforms.outliers_generic(t,e,i,!0)},outliers_generic:function(t,e,i,a){var s=e[0],n=[.5,1,1.5,2,2.5,3],o=e[1]%n.length;0>o&&(o+=n.length);var _=n[o];for(o=0;o<t.length;o++){var l=fits.fit_funs[fits.fit_strings.indexOf(s)](t[o][0],t[o][1]),r=l.fun(t[o][0],l.parameters),g=[],h=0;for(x=0;x<t[o][0].length;x++)h=t[o][1][x]-r[x],isFinite(h)&&g.push(h);for(var d=0,c=0,x=0;x<g.length;x++)d+=g[x],c+=g[x]*g[x];var m=g.length;c-=d*d/m;var f=Math.sqrt(c/m);if(a)for(x=0;x<t[o][0].length;x++)t[o][1][x]-r[x]>_*f&&(t[o][1][x]=0/0);else for(x=0;x<t[o][0].length;x++)t[o][1][x]-r[x]<_*f&&(t[o][1][x]=0/0)}transforms.clean(t,i),i.transform_text_y=a?"remove_outliers("+i.transform_text_y+","+s+","+_+")":"keep_outliers("+i.transform_text_y+","+s+","+_+")"},jitter:function(t,e,a){var s=e[0];for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=t[i][1][j]+(2*Math.random()-1)*s*t[i][1][j]/100;a.transform_text_y="jitter("+a.transform_text_y+","+s+"%)"},spacing:function(t,e,a){for(i=0;i<t.length;i++){for(j=0;j<t[i][1].length-1;j++)t[i][1][j]=t[i][0][j+1]-t[i][0][j];for(j=0;j<t[i][1].length-1;j++)t[i][0][j]=(t[i][0][j+1]+t[i][0][j])/2;t[i][0][j]=1/0}transforms.clean(t,a),a.transform_text_y="spacing("+a.transform_text_y+")"},time_to_num:function(t,e,a){var s=e[2],n=e[0],o="x"===s?0:1,_=[864e5,36e5,6e4,1e3],l=_[e[1]],r=0;if(0==n&&(r=e[3]),1==n){var g=new Date;r=g.getTime()}if(2==n){var h=1e307,d=1e307;for(i=0;i<t.length;i++){var h=Math.min.apply(null,t[i][o]);d=Math.min(h,d)}r=d}if(3==n){var c=1e-307,x=1e-307;for(i=0;i<t.length;i++){var c=Math.max.apply(null,t[i][o]);x=Math.max(c,x)}r=x}for(console.log(r),console.log(l),i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][o][j]=(t[i][o][j]-r)/l;transforms.clean(t,a)}};return mjs_plot={new_graph:function(graphname,canvasname){var canvas=document.getElementById(canvasname),gs=load_gs(graphname);gs.v===MJS_PLOT_VERSION?console.log("version is same"):(gs=mjs_plot.get_graph_style(),console.log("version changed, get new style"));var graph={graphics_style:gs,default_graphics_style:mjs_plot.get_graph_style(),graph_name:graphname,canvas_name:canvasname,drawfxmenu:!1,drawlinemenu:!1,drawmodemenu:!1,drawfitsmenu:!1,drawtimemenu:!1,drawgraphmenu:!1,drawcaptionmenu:!1,timemenuoptions:[0,0],plot_failed:!1,transparent:!1,needs_drag_image:!0,points_drawn:0,orignal_canvas_width:600,orignal_canvas_height:400,isFullscreen:!1,isSVG:!1,svg:"",errors:[],data:[],data_backup:[],colors:[],colors_backup:[],captions_backup:[],captions:[],onPlotFunctions:[],fit_data:[],reader_index:[0,0],transform_index:-1,transform_text_x:"x",ui:{size:20,touch:is_touch_device(),mouse_is_dragging:!1,is_touching:!1,draw_time:1e200,copy_time:1e200,ticking:!1,latestEvent:!1},transform_text_y:"y",drawing_methods:{draw_y_errors:function(t,e,i,a,s,n){for(e.beginPath(),n/=2,t.points_drawn+=s-a,e.beginPath(),j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),top_ei=t.units_to_pixels(t.data[i][1][j]+t.data[i][2][j],"y"),bot_ei=t.units_to_pixels(t.data[i][1][j]-t.data[i][2][j],"y"),e.moveTo(xi,bot_ei),e.lineTo(xi,top_ei),e.moveTo(xi-n,bot_ei),e.lineTo(xi+n,bot_ei),e.moveTo(xi-n,top_ei),e.lineTo(xi+n,top_ei);e.stroke()},draw_x_errors:function(t,e,i,a,s,n){for(e.beginPath(),n/=2,t.points_drawn+=s-a,e.beginPath(),j=a;j<s;j++)yi=t.units_to_pixels(t.data[i][1][j],"y"),right_ei=t.units_to_pixels(t.data[i][0][j]+t.data[i][3][j],"x"),left_ei=t.units_to_pixels(t.data[i][0][j]-t.data[i][3][j],"x"),e.moveTo(right_ei,yi),e.lineTo(left_ei,yi),e.moveTo(right_ei,yi+n),e.lineTo(right_ei,yi-n),e.moveTo(left_ei,yi+n),e.lineTo(left_ei,yi-n);e.stroke()},draw_line:function(t,e,i,a,s){for(xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y"),e.beginPath(),e.moveTo(xi,yi),t.points_drawn+=s-a,j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.lineTo(xi,yi),old_xi3=xi,old_yi3=yi;e.stroke()},draw_dot:function(t,e,i,a,s,n){for(e.beginPath(),t.points_drawn+=s-a,j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.fillRect(xi-n/2,yi-n/2,n,n)},draw_cdot:function(t,e,i,a,s,n){for(n/=2,t.points_drawn+=s-a,j=a;j<s;j++)e.beginPath(),xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.arc(xi,yi,n,0,2*Math.PI,!0),e.fill()},draw_circ:function(t,e,i,a,s,n){for(n/=2,e.beginPath(),t.points_drawn+=s-a,j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.beginPath(),e.arc(xi,yi,n,0,2*Math.PI,!0),e.stroke()},draw_cross:function(t,e,i,a,s,n){for(n/=2,e.beginPath(),t.points_drawn+=s-a,j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.moveTo(xi,yi-n),e.lineTo(xi,yi+n),e.moveTo(xi-n,yi),e.lineTo(xi+n,yi);e.stroke()},draw_x:function(t,e,i,a,s,n){for(n/=2,e.beginPath(),t.points_drawn+=s-a,j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.moveTo(xi-n,yi-n),e.lineTo(xi+n,yi+n),e.moveTo(xi-n,yi+n),e.lineTo(xi+n,yi-n);e.stroke()},draw_box:function(t,e,i,a,s,n){for(e.beginPath(),t.points_drawn+=s-a,j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.beginPath(),e.rect(xi-n/2,yi-n/2,n,n),e.stroke()},draw_zig:function(t,e,i,a,s){for(xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y"),old_xi3=xi,old_yi3=yi,t.points_drawn+=s-a,e.beginPath(),e.moveTo(xi,yi),j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.lineTo(old_xi3,yi),e.lineTo(xi,yi),old_xi3=xi,old_yi3=yi;e.stroke()},draw_zag:function(t,e,i,a,s){for(xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y"),old_xi3=xi,old_yi3=yi,t.points_drawn+=s-a,e.beginPath(),e.moveTo(xi,yi),j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.lineTo(xi,old_yi3),e.lineTo(xi,yi),old_xi3=xi,old_yi3=yi;e.stroke()},draw_mid:function(t,e,i,a,s){xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y");var n=xi,o=yi,_=xi,l=yi;for(t.points_drawn+=s-a,e.beginPath(),e.moveTo(xi,yi),j=a;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.lineTo((_+xi)/2,l),e.lineTo((_+xi)/2,yi),n=_,o=l,_=xi,l=yi;xi=t.units_to_pixels(t.data[i][0][s-1],"x"),yi=t.units_to_pixels(t.data[i][1][s-1],"y"),e.lineTo(xi,yi),e.stroke()},draw_hist:function(t,e,i,a,s){var n=Math.min(t.units_to_pixels(0,"y"),canvas.height);xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y");var o=xi,_=yi,l=xi,r=yi;for(t.points_drawn+=s-a,xi=t.units_to_pixels(t.data[i][0][a+1],"x"),yi=t.units_to_pixels(t.data[i][1][a+1],"y"),e.beginPath(),e.moveTo(l-(xi-l)/2,n),e.lineTo(l-(xi-l)/2,r),e.lineTo((xi+l)/2,r),j=a+1;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.lineTo((l+o)/2,r),e.lineTo((l+xi)/2,r),e.lineTo((l+xi)/2,n),o=l,_=r,l=xi,r=yi;xi=t.units_to_pixels(t.data[i][0][s-1],"x"),yi=t.units_to_pixels(t.data[i][1][s-1],"y"),e.moveTo((o+xi)/2,n),e.lineTo((o+xi)/2,yi),e.lineTo(xi+(xi-o)/2,yi),e.lineTo(xi+(xi-o)/2,n),e.stroke()},draw_approx:function(t,e,i,a,s){for(t.points_drawn+=s-a,xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y"),old_xi1=xi,old_yi1=yi,old_xi2=xi,old_yi2=yi,old_xi3=xi,old_yi3=yi,e.beginPath(),e.moveTo(old_xi1,old_yi1),e.lineTo((old_xi1+xi)/2,(old_yi1+yi)/2),j=a+1;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.quadraticCurveTo(old_xi3,old_yi3,(old_xi3+xi)/2,(old_yi3+yi)/2),old_xi1=old_xi2,old_yi1=old_yi2,old_xi2=old_xi3,old_yi2=old_yi3,old_xi3=xi,old_yi3=yi;xi=t.units_to_pixels(t.data[i][0][s-1],"x"),yi=t.units_to_pixels(t.data[i][1][s-1],"y"),e.lineTo(xi,yi),e.stroke()},draw_interp:function(t,e,i,a,s){3>s-a&&this.draw_line(t,e,i,a,s),t.points_drawn+=s-a,xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y"),old_xi1=xi,old_yi1=yi,old_xi2=xi,old_yi2=yi,old_xi3=t.units_to_pixels(t.data[i][0][a+1],"x"),old_yi3=t.units_to_pixels(t.data[i][1][a+1],"y"),xi=t.units_to_pixels(t.data[i][0][a+2],"x"),yi=t.units_to_pixels(t.data[i][1][a+2],"y"),e.beginPath();var n=5;for(e.moveTo(old_xi1,old_yi1),e.bezierCurveTo((old_xi3-old_xi1)/n+old_xi1,(old_yi3-old_yi1)/n+old_yi1,old_xi3-(xi-old_xi1)/n,old_yi3-(yi-old_yi1)/n,old_xi3,old_yi3),e.moveTo(old_xi2,old_yi2),j=a+2;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.bezierCurveTo((old_xi3-old_xi1)/n+old_xi2,(old_yi3-old_yi1)/n+old_yi2,old_xi3-(xi-old_xi2)/n,old_yi3-(yi-old_yi2)/n,old_xi3,old_yi3),old_xi1=old_xi2,old_yi1=old_yi2,old_xi2=old_xi3,old_yi2=old_yi3,old_xi3=xi,old_yi3=yi;xi=t.units_to_pixels(t.data[i][0][s-1],"x"),yi=t.units_to_pixels(t.data[i][1][s-1],"y"),e.bezierCurveTo((xi-old_xi1)/n+old_xi2,(yi-old_yi1)/n+old_yi2,xi-(xi-old_xi2)/n,yi-(yi-old_yi2)/n,xi,yi),e.stroke()},draw_scribble:function(t,e,i,a,s){3>s-a&&this.draw_line(t,e,i,a,s),t.points_drawn+=s-a,xi=t.units_to_pixels(t.data[i][0][a],"x"),yi=t.units_to_pixels(t.data[i][1][a],"y"),old_xi1=xi,old_yi1=yi,old_xi2=xi,old_yi2=yi,old_xi3=t.units_to_pixels(t.data[i][0][a+1],"x"),old_yi3=t.units_to_pixels(t.data[i][1][a+1],"y"),xi=t.units_to_pixels(t.data[i][0][a+2],"x"),yi=t.units_to_pixels(t.data[i][1][a+2],"y"),e.beginPath();var n=.2;for(e.moveTo(old_xi1,old_yi1),e.bezierCurveTo((old_xi3-old_xi1)/n+old_xi1,(old_yi3-old_yi1)/n+old_yi1,old_xi3-(xi-old_xi1)/n,old_yi3-(yi-old_yi1)/n,old_xi3,old_yi3),e.moveTo(old_xi2,old_yi2),j=a+2;j<s;j++)xi=t.units_to_pixels(t.data[i][0][j],"x"),yi=t.units_to_pixels(t.data[i][1][j],"y"),e.bezierCurveTo((old_xi3-old_xi1)/n+old_xi2,(old_yi3-old_yi1)/n+old_yi2,old_xi3-(xi-old_xi2)/n,old_yi3-(yi-old_yi2)/n,old_xi3,old_yi3),old_xi1=old_xi2,old_yi1=old_yi2,old_xi2=old_xi3,old_yi2=old_yi3,old_xi3=xi,old_yi3=yi;xi=t.units_to_pixels(t.data[i][0][s-1],"x"),yi=t.units_to_pixels(t.data[i][1][s-1],"y"),e.bezierCurveTo((xi-old_xi1)/n+old_xi2,(yi-old_yi1)/n+old_yi2,xi-(xi-old_xi2)/n,yi-(yi-old_yi2)/n,xi,yi),e.stroke()}},set_data:function(t){"use strict";this.transform_index=-1;for(var e=0;e<t.length;e++)t[e][0].length!=t[e][1].length&&this.errors.push("series "+e+"had different legnth x and y arrays");if(this.data_backup=clone(t),transforms.clean(this.data_backup,this),this.data=clone(this.data_backup),this.data.length!=t.length)this.errors.push("A series was cleaned away in set_data");else for(var e=0;e<t.length;e++)this.data[e][0].length!=t[e][0].length&&this.errors.push("series "+e+" had non finite values");for(var e=0;e<this.data.length;e++)this.graphics_style.hidden_lines[e]=this.graphics_style.hidden_lines[e]||!1;this.colors=[];for(var e=0;e<this.data.length;e++)if(this.graphics_style.caption_colors)try{this.colors[e]=color_from_string(this.captions[e]||"label")}catch(i){this.colors[e]=color_from_string("label")}else this.colors[e]=get_color(e,this.data.length-1);this.colors_backup=clone(this.colors)},set_captions:function(t){"use strict";this.captions_backup=clone(t),this.captions=clone(t),this.captions.length!=this.data_backup.length&&this.errors.push("number of captions and number of series don't match"),this.colors=[];for(var e=0;e<this.data.length;e++)this.graphics_style.caption_colors?(this.colors[e]=color_from_string(this.captions[e]||"label"),console.log("using cap colours")):this.colors[e]=get_color(e,this.data.length-1);this.colors_backup=clone(this.colors)},find_scale:function(t,e,i,a,s,n){"use strict";if("lin"===s){var o=0;if(Math.abs(t)>1e-250)var _=Math.floor(Math.log10(Math.abs(t)))-10;else _=-250;var l,r=0,g=0;g=n?0:2;for(var h=Math.floor(i/a)+g,r=vals[o]*Math.pow(10,_),d=Math.ceil(e/r)-Math.floor(t/r)+g;d>h;)o+=1,3==o&&(o=0,_+=1),r=vals[o]*Math.pow(10,_),d=Math.ceil(e/r)-Math.floor(t/r)+g;if(l=0==d?i:i/d,n)var c=Math.floor(t/r)*r,x=Math.ceil(e/r)*r;else var c=Math.floor(t/r-1)*r,x=Math.ceil(e/r+1)*r;return z={lowpoint:c,highpoint:x,scale:r,width:l,val_i:o,val_i_low:1,power_low:1,val_i_high:1,power_high:1,scalemode:s}}if("log"===s){var o=0,_=100,m=-1,f=!1,p=Math.floor(i/a/2);for(d=0;p>d;){for(m+=1,_=Math.ceil(Math.log10(t))+1,o=0;log_vals[m][o]*Math.pow(10,_)>=t;)o-=1,0>o&&(_-=1,o=log_vals[m].length-1);n===!1&&(o-=1,0>o&&(_-=1,o=log_vals[m].length-1));var u=o,y=_;for(d=0;log_vals[m][o]*Math.pow(10,_)<=e;)o+=1,d+=1,o>=log_vals[m].length&&(_+=1,o=0);n===!1&&(o+=1,d+=1,o>=log_vals[m].length&&(_+=1,o=0));var v=o,w=_;(m>=log_vals.length||Math.log10(e)-Math.log10(t)<.6)&&0==f?(d=p,z=this.find_scale(t,e,i,a,"lin",n),z.lowpoint<=0&&(f=!0,d=0),c=Math.log10(z.lowpoint),x=Math.log10(z.highpoint),r=z.scale,l=z.width,m=z.val_i):(c=Math.log10(log_vals[m][u]*Math.pow(10,y)),x=Math.log10(log_vals[m][v]*Math.pow(10,w)),r=-1,l=-1,m=m)}return 0==m&&d>2*p&&(z=this.find_scale(Math.max(-249,Math.log10(t)),Math.min(249,Math.log10(e)),i,a,"lin",n),c=z.lowpoint,x=z.highpoint,r=z.scale,s="log",l=z.width,m=-1),z={lowpoint:c,highpoint:x,scale:r,width:l,val_i:m,val_i_low:u,power_low:y,val_i_high:v,power_high:w,scalemode:s}}if("time"===s){if(n)var g=0;else var g=2;for(var T=Math.floor(i/a)+g,b=(e-t)/T,k=0;allowed_intervals[k]<b;)k++;k=Math.min(k,allowed_intervals.length-1),g/=2;var j=t-t%allowed_intervals[k]-g*allowed_intervals[k],M=e-e%allowed_intervals[k]+g*allowed_intervals[k];if(allowed_intervals[k]>=31536e6){var S=new Date(j);S=new Date(S.getFullYear(),0,0),j=S.getTime();var S=new Date(M);S=new Date(S.getFullYear()+Math.round(allowed_intervals[k]/1e3/60/60/24/365)+Math.round(S.getMonth()/12),0,0),M=S.getTime()}if(allowed_intervals[k]>=2592e6&&allowed_intervals[k]<31536e6){var S=new Date(j);S=new Date(S.getFullYear(),S.getMonth(),1),j=S.getTime();var S=new Date(M);S=S.getDate()<15?new Date(S.getFullYear(),S.getMonth(),1):new Date(S.getFullYear(),S.getMonth()+1,1),M=S.getTime()+allowed_intervals[k]}if(allowed_intervals[k]>=432e5&&allowed_intervals[k]<2592e6){var S=new Date(j),P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),0,0,0,0);j=P.getTime();var S=new Date(M);S=new Date(S.getFullYear(),S.getMonth(),S.getDate(),0,0,0,0),M=S.getTime()+allowed_intervals[k]}if(allowed_intervals[k]>=18e5&&allowed_intervals[k]<=216e5){var S=new Date(j),P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),S.getHours(),0,0,0);j=P.getTime();var S=new Date(M);S=new Date(S.getFullYear(),S.getMonth(),S.getDate(),S.getHours()+1,0,0,0),M=S.getTime()}if(72e5==allowed_intervals[k]){var S=new Date(j),P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),2*Math.floor(S.getHours()/2),0,0,0);j=P.getTime();var S=new Date(M);S=new Date(S.getFullYear(),S.getMonth(),S.getDate(),2*Math.floor(1+S.getHours()/2),0,0,0),M=S.getTime()}if(108e5==allowed_intervals[k]){console.log("every three horus");var S=new Date(j),P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),3*Math.floor(S.getHours()/3),0,0,0);j=P.getTime();var S=new Date(M);S=new Date(S.getFullYear(),S.getMonth(),S.getDate(),3*Math.floor(1+S.getHours()/3),0,0,0),M=S.getTime()}if(216e5==allowed_intervals[k]){console.log("every six horus");var S=new Date(j),P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),6*Math.floor(S.getHours()/6),0,0,0);j=P.getTime();var S=new Date(M);S=new Date(S.getFullYear(),S.getMonth(),S.getDate(),6*Math.floor(1+S.getHours()/6),0,0,0),M=S.getTime()}allowed_intervals[k]<18e5&&(M+=allowed_intervals[k]);var z,D=Math.floor((M-j)/allowed_intervals[k]),r=i/D,q=Math.floor((M-j)/time_ticks[k]),F=i/q;return z={lowpoint:j,highpoint:M,scale:r,width:F,val_i:k,val_i_low:0,power_low:0,val_i_high:0,power_high:0,scalemode:"time"}}},find_limits:function(t,e,i,a,s,n,o){"use strict";if(s=Math.min(s,1e250),a=Math.max(a,-1e250),"log"===n&&(s=Math.max(s,2e-250),a=Math.max(a,2e-250)),"time"===n&&(s=Math.min(s,1e14),a=Math.max(a,-1e14)),this.no_data=!1,0==t.length)return e||i?(r=1,g=10,e=!0,i=!0):(r=a,g=s),"log"===n&&(0>=r&&(r=1),(0>=g||r>g)&&(g=10)),this.no_data=!0,{low:r,high:g,automax:i,automin:e,scale:n};if("log"===n&&(0>=a&&0==e&&(e=!0,this.errors.push(o+" minimum was negative - using auto")),0>=s&&0==i&&(e=!0,i=!0,this.errors.push(o+" maximum was negative - using auto"))),1==e||1==i||r>=g){var _=1e307,l=-1e307,r=1e307,g=-1e307;for(h=0;h<t.length;h++){var _=Math.min.apply(null,t[h]),l=Math.max.apply(null,t[h]);r=Math.min(_,r),g=Math.max(l,g)}}if(r==g&&(r=.6*Math.min(r,g),g=1.6*Math.max(r,g)),1==this.data.length&&1==this.data[0][0].length&&(r=.6*Math.min(r,g),g=1.6*Math.max(r,g)),a>g&&i&&!e&&(e=!0,i=!0,this.errors.push(o+" can't have inverted scale - using auto")),r>s&&e&&!i&&(e=!0,i=!0,this.errors.push(o+" can't have inverted scale - using auto")),0==e&&(r=a),0==i&&(g=s),"log"===n&&0>=g&&(n="lin",this.errors.push("all "+o+" data is negative, cant plot that log"+o)),"log"===n&&0>r){r=1e200;for(var h=0;h<t.length;h++)for(var d=0;d<this.data[h][1].length;d++)t[h][d]>0&&t[h][d]<r&&(r=t[h][d]);1e200==r&&(r=1e-13)}return{low:r,high:g,automax:i,automin:e,scale:n}},use_scale:function(t,e,i){"use strict";var a,s,n,o=t.lowpoint,_=t.highpoint,l=t.scale,r=t.width,g=t.val_i,h=t.val_i_low,d=t.power_low,c=t.val_i_high,x=t.power_high,m=t.scalemode,f=1,p=[],u=[],y=[];if("lin"===m){for(var v=0,w=" ",T=1,b="",k=(0-o)*e/(_-o);e>=v;)z=v/r*l+o,b=z.toPrecision(T),b===w&&(T+=1,b=z.toPrecision(T)),w=b,v+=r;v=r;for(var j=1;e-1>v;)z=j*l+o,p.push(v),b=Math.abs(v-k)<2?0..toFixed(Math.max(1,T-1)):mjs_precision(z,T),u.push(b),v+=r,j+=1;var M=.7*b.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>r;v=0;var S=1;for(S=r>i*f?many_minor_ticks[g]:few_minor_ticks[g];e>=v;)y.push(v),v+=r/S}if("log"===m&&-1==g){for(var v=0,w=" ",T=1,b="";e>=v;)z=Math.pow(10,v/r*l+o),b=z.toPrecision(T),b===w&&(T+=1,b=z.toPrecision(T)),w=b,v+=r;v=r;for(var j=1;e-1>v;)z=Math.pow(10,j*l+o),p.push(v),b=mjs_precision(z,T),u.push(b),v+=r,j+=1;var M=.7*b.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>r;v=0;var S=1;for(S=r>i*f?many_minor_ticks[g]:few_minor_ticks[g];e>=v;)y.push(v),v+=r/S}if("log"===m&&-1!=g)if(0>l){for(a=h,s=d,z=log_vals[g][h]*Math.pow(10,d),n=z,T=2;z<log_vals[g][c]*Math.pow(10,x);){if(a+=1,a>=log_vals[g].length&&(s+=1,a=0),z=log_vals[g][a]*Math.pow(10,s),v=(Math.log10(z)-o)*e/(_-o),e-10>v&&(u.push(mjs_precision(z,2)),p.push(v)),g>8){var P=(Math.log10((n+z)/2)-o)*e/(_-o);y.push(P)}n=z}if(8>=g)for(z=log_vals[g][h]*Math.pow(10,d),a=h,s=d;z<log_vals[g][c]*Math.pow(10,x);)z=log_vals_ticks[g][a]*Math.pow(10,s),v=(Math.log10(z)-o)*e/(_-o),y.push(v),a+=1,a>=log_vals_ticks[g].length&&(s+=1,a=0)}else{var v=0,w=" ",T=1,b="";for(z=Math.pow(10,o);z<=Math.pow(10,_);)b=z.toPrecision(T),b===w&&(T+=1,b=z.toPrecision(T)),w=b,z+=l;var M=.7*b.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>=r;for(z=Math.pow(10,o)+l;z<Math.pow(10,_)-l/2;)b=mjs_precision(z,T),v=(Math.log10(z)-o)*e/(_-o),p.push(v),u.push(b),z+=l;var S=1;for(S=r>i*f?many_minor_ticks[g]:few_minor_ticks[g],z=Math.pow(10,o);z<Math.pow(10,_);)v=(Math.log10(z)-o)*e/(_-o),y.push(v),z+=l/S}if("time"===m){var z=t.val_i,D=_-o;for(j=0;allowed_intervals[j]<D;)j++;j--;for(var q=string_precisions[z],F=string_precisions[j],E=o,C=mjs_date_print(E,F,F),v=0,A="",b="";_>E;)E+=allowed_intervals[z],allowed_intervals[z]>=2592e6&&(E=round_to_month(E)),v=(E-o)/D*e,b=mjs_date_print(E,F,q),b===A&&q++,A=b;var L=mjs_date_print(E,F,F);L===C&&F++;for(var E=o,v=0,N=0;E<_-allowed_intervals[z]&&e-2>v+l;){for(E+=allowed_intervals[z],allowed_intervals[z]>=2592e6&&(E=round_to_month(E)),v=(E-o)/D*e,p.push(v),b=mjs_date_print(E,F,q),u.push(b);v>N;)N+=r,y.push(N);var N=v;y.pop()}for(;e>N;)N+=r,y.push(N);M=!1;var M=.7*b.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>l;T=q}return{pos:p,strings:u,minor_pos:y,stepping:M,precision:T}},fit_points_drawn:0,drawSimpleLine:function(t,e,i){var a=this.units_to_pixels(e[0],"x"),s=this.units_to_pixels(i[0],"y"),n=a,o=s;t.beginPath(),t.moveTo(a,s);for(var _=!0,l=!0,r=0;r<e.length;r++){this.fit_points_drawn++;var s=this.units_to_pixels(i[r],"y"),a=this.units_to_pixels(e[r],"x");_=s>0&&s<this.canvas.height,_&&l&&t.lineTo(a,s),!_&&l&&(t.lineTo(a,s),t.stroke()),_&&!l&&(t.beginPath(),t.moveTo(n,o),t.lineTo(a,s)),l=_,n=a,o=s}t.stroke()},mjs_plot:function(){"use strict";var start_time=new Date;this.plot_failed&&(this.errors.push("failed for unknown reason"),this.graphics_style=JSON.parse(JSON.stringify(this.default_graphics_style))),this.plot_failed=!0,0==this.graphics_style.modified&&(console.log("getting defautts"),this.graphics_style=JSON.parse(JSON.stringify(this.default_graphics_style)));var gs=this.graphics_style,ctx=this.canvas.getContext("2d");if(this.isSVG)var ctx=new SVGContext(ctx);ctx.lineJoin="round";var canvas=this.canvas,graph_line_thickness=gs.graph_line_thickness,symbol_size=gs.symbol_size,line_thickness=gs.line_thickness,tick_len=gs.tick_len,mode=gs.mode,font_name=gs.font_name,title_font_size=gs.title_font_size,title=gs.title,subtitle=gs.subtitle,title_spacing=gs.title_spacing,tick_labels_font_size=gs.tick_labels_font_size,tick_lables_font_padding=gs.tick_lables_font_padding,axis_labels_font_size=gs.axis_labels_font_size,lable_spacing=gs.lable_spacing,x_axis_title=gs.x_axis_title,y_axis_title=gs.y_axis_title,minor_tick_len=gs.minor_tick_len,guideWidthx=gs.guideWidthx,guideWidthy=gs.guideWidthy,scaling_factor=gs.scaling_factor;guideWidthx*=scaling_factor,guideWidthy*=scaling_factor,lable_spacing*=scaling_factor,axis_labels_font_size*=scaling_factor,tick_lables_font_padding*=scaling_factor,tick_labels_font_size*=scaling_factor,title_spacing*=scaling_factor,title_font_size*=scaling_factor,tick_len*=scaling_factor,line_thickness*=scaling_factor,symbol_size*=scaling_factor,graph_line_thickness*=scaling_factor,minor_tick_len*=scaling_factor;try{ctx.font=tick_labels_font_size+"px "+font_name,ctx.fillText("font test",10,10)}catch(e){console.log("font faliure"),this.errors.push("font faliure"),font_name="Courier New",gs.font_name="Courier New"}for(ctx.fillStyle=gs.color_bg,ctx.strokeStyle=gs.color_fg,this.transparent?ctx.clearRect(0,0,canvas.width,canvas.height):ctx.fillRect(0,0,canvas.width,canvas.height),this.isSVG&&(ctx.clearAll(),ctx.font_name=font_name),this.transform_index!=gs.data_transforms.length&&(this.data=clone(this.data_backup),this.captions=clone(this.captions_backup),this.colors=clone(this.colors_backup),this.transform_index=0,this.transform_text_x=x_axis_title,this.transform_text_y=y_axis_title,transforms.remove_lines(this.data,gs.hidden_lines,this));this.transform_index<gs.data_transforms.length;){var fun=eval("transforms."+gs.data_transforms[this.transform_index]);console.log("running "+gs.data_transforms[this.transform_index]),fun(this.data,gs.data_transforms_args[this.transform_index],this),this.transform_index++}for(var xdata=[],ydata=[],i=0;i<this.data.length;i++)xdata.push(this.data[i][0]),ydata.push(this.data[i][1]);var xlimits=this.find_limits(xdata,gs.x_scale_auto_min,gs.x_scale_auto_max,gs.x_manual_min,gs.x_manual_max,gs.x_scale_mode,"x"),xlow=xlimits.low,xhigh=xlimits.high;gs.x_scale_auto_min=xlimits.automin,gs.x_scale_auto_max=xlimits.automax,gs.x_scale_mode=xlimits.scale;var ylimits=this.find_limits(ydata,gs.y_scale_auto_min,gs.y_scale_auto_max,gs.y_manual_min,gs.y_manual_max,gs.y_scale_mode,"y"),ylow=ylimits.low,yhigh=ylimits.high;gs.y_scale_auto_min=ylimits.automin,gs.y_scale_auto_max=ylimits.automax,gs.y_scale_mode=ylimits.scale;var the_scalex=this.find_scale(xlow,xhigh,this.canvas.width,guideWidthx,gs.x_scale_mode,gs.x_scale_tight),lowpointx=the_scalex.lowpoint,highpointx=the_scalex.highpoint,scalex=the_scalex.scale,widthx=the_scalex.width,val_ix=the_scalex.val_i,val_i_lowx=the_scalex.val_i_low,power_lowx=the_scalex.power_low,val_i_highx=the_scalex.val_i_high,power_highx=the_scalex.power_high,the_scaley=this.find_scale(ylow,yhigh,this.canvas.height,guideWidthy,gs.y_scale_mode,gs.y_scale_tight),lowpointy=the_scaley.lowpoint,highpointy=the_scaley.highpoint,scaley=the_scaley.scale,widthy=the_scaley.width,val_iy=the_scaley.val_i,val_i_lowy=the_scaley.val_i_low,power_lowy=the_scaley.power_low,val_i_highy=the_scaley.val_i_high,power_highy=the_scaley.power_high;gs.x_auto_min=lowpointx,gs.x_auto_max=highpointx,gs.y_auto_min=lowpointy,gs.y_auto_max=highpointy;var positionsx=this.use_scale(the_scalex,canvas.width,guideWidthx),positionsy=this.use_scale(the_scaley,canvas.height,guideWidthy);if(gs.y_scale_auto_min&&(gs.y_manual_min=this.pixels_to_units(this.canvas.height,"y")),gs.y_scale_auto_max&&(gs.y_manual_max=this.pixels_to_units(0,"y")),gs.x_scale_auto_min&&(gs.x_manual_min=this.pixels_to_units(0,"x")),gs.x_scale_auto_max&&(gs.x_manual_max=this.pixels_to_units(this.canvas.width,"x")),gs.scalex=scalex,gs.scaley=scaley,gs.widthx=widthx,gs.widthy=widthy,gs.show_grid){ctx.strokeStyle=gs.color_fg,ctx.globalAlpha=.2,ctx.beginPath();for(var i=0;i<positionsy.pos.length;i++){var y=canvas.height-positionsy.pos[i];ctx.moveTo(0,y),ctx.lineTo(canvas.width,y)}for(var i=0;i<positionsx.pos.length;i++){var x=positionsx.pos[i];ctx.moveTo(x,0),ctx.lineTo(x,canvas.height)}ctx.stroke(),ctx.globalAlpha=1}for(var lines_start=0,lines_end=canvas.width,fit_x=[],j=lines_start;lines_end>j;j+=2)fit_x.push(this.pixels_to_units(j,"x"));for(var fit_y=[],i=0;i<gs.function_lines.length;i++)try{fit_y=parseExpression(gs.function_lines[i],fit_x,fit_x),this.drawSimpleLine(ctx,fit_x,fit_y)}catch(e){this.errors.push("function line:y="+gs.function_lines[i]+" fails")}ctx.font=tick_labels_font_size+"px "+font_name,ctx.lineWidth=line_thickness;var drawn_something=!1,drawn_caps=!1,points_drawn=0,hist_zero=Math.min(this.units_to_pixels(0,"y"),canvas.height),full_auto_zoom=gs.y_scale_auto_min&&gs.y_scale_auto_max&&gs.x_scale_auto_min&&gs.x_scale_auto_max;for(i=0;i<this.data.length;i++){if(ctx.strokeStyle=this.colors[i],ctx.fillStyle=ctx.strokeStyle,"none"===gs.symbol_mode&&"none"==gs.line_mode&&this.errors.push("no symbols or lines to draw"),full_auto_zoom)seq_start=[0],seq_end=[this.data[i][0].length];else{for(var ongraph=!1,wasOngraph=!1,graph_top=this.pixels_to_units(0,"y"),graph_bottom=this.pixels_to_units(canvas.height,"y"),graph_left=this.pixels_to_units(0,"x"),graph_right=this.pixels_to_units(canvas.width,"x"),seq_start=[],seq_end=[],k=0;k<this.data[i][0].length;k++)ongraph=this.data[i][0][k]>graph_left&&this.data[i][0][k]<graph_right&&this.data[i][1][k]>graph_bottom&&this.data[i][1][k]<graph_top,!ongraph&&wasOngraph&&seq_end.push(Math.min(k+2,this.data[i][0].length)),ongraph&&!wasOngraph&&seq_start.push(Math.max(k-2,0)),wasOngraph=ongraph;for(seq_start.length>seq_end.length&&seq_end.push(k),k=seq_start.length-1;k>=0;k--)seq_start[k]<=seq_end[k-1]+2&&(seq_end[k-1]=seq_end[k],seq_end.splice(k,1),seq_start.splice(k,1))}for(drawn_something=drawn_something||seq_start.length>0,k=0;k<seq_start.length;k++)gs.line_mode.indexOf("line")>-1&&this.drawing_methods.draw_line(this,ctx,i,seq_start[k],seq_end[k]),"dot"===gs.symbol_mode&&this.drawing_methods.draw_dot(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"cdot"===gs.symbol_mode&&this.drawing_methods.draw_cdot(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"circ"===gs.symbol_mode&&this.drawing_methods.draw_circ(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"box"===gs.symbol_mode&&this.drawing_methods.draw_box(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"x"===gs.symbol_mode&&this.drawing_methods.draw_x(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"cross"===gs.symbol_mode&&this.drawing_methods.draw_cross(this,ctx,i,seq_start[k],seq_end[k],symbol_size),gs.line_mode.indexOf("zig")>-1&&this.drawing_methods.draw_zig(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("zag")>-1&&this.drawing_methods.draw_zag(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("mid")>-1&&this.drawing_methods.draw_mid(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("approx")>-1&&this.drawing_methods.draw_approx(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("interp")>-1&&this.drawing_methods.draw_interp(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("hist")>-1&&this.drawing_methods.draw_hist(this,ctx,i,seq_start[k],seq_end[k]),this.data[i].length>=3&&this.drawing_methods.draw_y_errors(this,ctx,i,seq_start[k],seq_end[k],symbol_size),this.data[i].length>=4&&this.drawing_methods.draw_x_errors(this,ctx,i,seq_start[k],seq_end[k],symbol_size)
}ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=gs.color_fg,ctx.fillStyle=gs.color_fg,drawn_something||0!=this.no_data||0!=gs.function_lines.length||this.errors.push("there might be data around, just not where you're looking"),this.isSVG||(graph.needs_drag_image||"drag"===gs.mouse_mode)&&(this.graph_image_for_drag=ctx.getImageData(0,0,canvas.width,canvas.height),graph.needs_drag_image=!1);var l=positionsx.strings.length,stepping=ctx.measureText(positionsx.strings[1]+" ").width>positionsx.pos[1]-positionsx.pos[0]||ctx.measureText(positionsx.strings[l-1]+" ").width>positionsx.pos[l-1]-positionsx.pos[l-2];if(stepping)var j=-1*tick_labels_font_size/2,o=tick_labels_font_size/2;else var j=0,o=0;ctx.textAlign="center",ctx.beginPath();for(var i=0;i<positionsx.pos.length;i++){var x=positionsx.pos[i],label=positionsx.strings[i];ctx.fillText(label,x,canvas.height-1.2*tick_len-tick_lables_font_padding-o-j),j*=-1,ctx.moveTo(x,0),ctx.lineTo(x,tick_len),ctx.moveTo(x,canvas.height),ctx.lineTo(x,canvas.height-tick_len)}ctx.stroke(),ctx.beginPath();for(var i=0;i<positionsx.minor_pos.length;i++)x=positionsx.minor_pos[i],ctx.moveTo(x,0),ctx.lineTo(x,minor_tick_len),ctx.moveTo(x,canvas.height),ctx.lineTo(x,canvas.height-minor_tick_len);ctx.stroke(),gs.x_precision=positionsx.precision,ctx.textAlign="left",ctx.beginPath();for(var i=0;i<positionsy.pos.length;i++){var y=canvas.height-positionsy.pos[i],label=positionsy.strings[i];y>tick_len+lable_spacing+axis_labels_font_size/2&&ctx.fillText(label,1.2*tick_len+2,y+3),ctx.moveTo(0,y),ctx.lineTo(tick_len,y),ctx.moveTo(canvas.width,y),ctx.lineTo(canvas.width-tick_len,y)}ctx.stroke(),ctx.beginPath();for(var i=0;i<positionsy.minor_pos.length;i++)y=canvas.height-positionsy.minor_pos[i],ctx.moveTo(0,y),ctx.lineTo(minor_tick_len,y),ctx.moveTo(canvas.width,y),ctx.lineTo(canvas.width-minor_tick_len,y);if(ctx.stroke(),gs.y_precision=positionsy.precision,gs.show_captions){for(ctx.font=tick_labels_font_size+"px "+font_name,x=gs.scaling_factor*gs.caption_position.x,y=gs.scaling_factor*gs.caption_position.y,gs.caption_position.y>0?(y+=tick_labels_font_size,dy=tick_labels_font_size,y+=tick_len):(dy=tick_labels_font_size,y=canvas.height+y,y+=tick_labels_font_size-this.data.length*dy,y-=tick_len),gs.caption_position.x>0?(ctx.textAlign="left",x+=tick_len):(ctx.textAlign="right",x=canvas.width+x,x-=tick_len),i=0;i<this.data.length;i++){ctx.fillStyle=this.colors[i],label=this.captions[i]||"label";var splitter=" : ";switch(gs.captions_display){case"ylast":label+=splitter+this.get_axis_string(this.data[i][1][this.data[i][1].length-1],"y");break;case"xlast":label+=splitter+this.get_axis_string(this.data[i][0][this.data[i][0].length-1],"x");break;case"xfirst":label+=splitter+this.get_axis_string(this.data[i][0][0],"x");break;case"yfirst":label+=splitter+this.get_axis_string(this.data[i][1][0],"y");break;case"xmin":label+=splitter+this.get_axis_string(Math.min.apply(null,this.data[i][0]),"x");break;case"ymin":label+=splitter+this.get_axis_string(Math.min.apply(null,this.data[i][1]),"y");break;case"ymax":label+=splitter+this.get_axis_string(Math.max.apply(null,this.data[i][1]),"y");break;case"xmax":label+=splitter+this.get_axis_string(Math.max.apply(null,this.data[i][0]),"x")}this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(label,x,y)),ctx.fillText(label,x,y),y+=dy}this.data.length!=this.data_backup.length&&(label="other lines hidden",this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(label,x,y)),ctx.fillStyle="#808080",ctx.fillText(label,x,y))}if(ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=graph.graphics_style.color_fg,ctx.fillStyle=graph.graphics_style.color_fg,(this.transform_text_x.length>1||this.transform_text_y.length>1)&&gs.showTransformTexts)var x_label=this.transform_text_x,y_label=this.transform_text_y;else var x_label=x_axis_title,y_label=y_axis_title;ctx.font=axis_labels_font_size+"px "+font_name,ctx.textAlign="right";var label=x_label;"time"===gs.x_scale_mode&&this.graphics_style.x_precision>1&&(label+=" "+mjs_date_print(this.pixels_to_units(canvas.width,"x"),0,Math.max(this.graphics_style.x_precision-1,0))),stepping?ctx.fillText(label,canvas.width-lable_spacing-tick_len,canvas.height-tick_len-lable_spacing-2*tick_labels_font_size):ctx.fillText(label,canvas.width-lable_spacing-tick_len,canvas.height-tick_len-lable_spacing-tick_labels_font_size),ctx.textAlign="left";var label=y_label;"time"===gs.y_scale_mode&&this.graphics_style.y_precision>1&&(label+=" "+mjs_date_print(this.pixels_to_units(0,"y"),0,Math.max(this.graphics_style.y_precision-1,0))),ctx.fillText(label,tick_len+lable_spacing,tick_len+lable_spacing),ctx.beginPath(),ctx.stroke();var sigma=String.fromCharCode(963),squared=String.fromCharCode(178),bar=String.fromCharCode(773),edge=2.6*tick_len;ctx.font=axis_labels_font_size+"px "+font_name;var fit_points_drawn=0;if("none"===gs.fits);else{ctx.textAlign="left";var x=gs.fit_text_position.x*canvas.width,y=gs.fit_text_position.y*canvas.height,dy=1.2*axis_labels_font_size;for(i=0;i<this.data.length;i++){var label=this.captions[i]||"label";ctx.fillStyle=this.colors[i];var string1="",string2="",string3="";if(this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/2,ctx.strokeText(label,x,y)),ctx.fillText(label,x,y),ctx.fillStyle=gs.color_fg,ctx.lineWidth=line_thickness,ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,"stats"===gs.fits){var stats=series_stats(this.data[i][0],this.data[i][1]);ctx.fillStyle=gs.color_fg,string1=" n = "+stats.n+",    cov(x,y) = "+mjs_precision(stats.cov,Math.min(gs.x_precision,gs.y_precision)+3),string2=bar+"x = "+number_quote(stats.x_mean,stats.sigma_x)+",   "+sigma+"(x) = "+mjs_precision(stats.sigma_x,2),string3=bar+"y = "+number_quote(stats.y_mean,stats.sigma_y)+",   "+sigma+"(y) = "+mjs_precision(stats.sigma_y,2),ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,ctx.beginPath();for(var k=-1;2>k;k++){var yi=graph.units_to_pixels(stats.y_mean+k*stats.sigma_y,"y");ctx.moveTo(graph.units_to_pixels(stats.xmin,"x"),yi),ctx.lineTo(graph.units_to_pixels(stats.xmax,"x"),yi)}ctx.stroke(),ctx.beginPath();for(var k=-1;2>k;k++){var xi=graph.units_to_pixels(stats.x_mean+k*stats.sigma_x,"x");ctx.moveTo(xi,graph.units_to_pixels(stats.ymax,"y")),ctx.lineTo(xi,graph.units_to_pixels(stats.ymin,"y"))}ctx.stroke(),drawEllipse(ctx,stats.x_mean,stats.y_mean,stats.sigma_x,stats.sigma_y),drawEllipse(ctx,stats.x_mean,stats.y_mean,2*stats.sigma_x,2*stats.sigma_y)}if("old"===gs.fits&&0==this.fit_data.length&&(gs.fits="none"),"old"===gs.fits&&(string1="previous fit shown",string2="pick new fit",fit_x=this.fit_data[i][0],fit_y=this.fit_data[i][1],ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,this.drawSimpleLine(ctx,fit_x,fit_y)),fits.fit_strings.indexOf(gs.fits)>-1){var fit,string1,string2,string3;if("time"===gs.x_scale_mode){var normed=fits.pre_fit_normalizing(this.data[i][0]);fit=fits.fit_funs[fits.fit_strings.indexOf(gs.fits)](normed.x,this.data[i][1]),string1=fit.strings[0]+"  "+normed.s}else fit=fits.fit_funs[fits.fit_strings.indexOf(gs.fits)](this.data[i][0],this.data[i][1]),string1=fit.strings[0];if(string2=fit.strings[1],string3=fit.strings[2],gs.extrapolate)var fit_start=0,fit_end=canvas.width;else var fit_start=Math.max(0,this.units_to_pixels(Math.min.apply(null,this.data[i][0]),"x")),fit_end=Math.min(canvas.width,this.units_to_pixels(Math.max.apply(null,this.data[i][0]),"x"));for(var fit_x=[],j=fit_start;fit_end>j;j+=5)fit_x.push(this.pixels_to_units(j,"x"));if("time"===gs.x_scale_mode)var fit_y=fit.fun(fits.post_fit_normalizing(fit_x,normed),fit.parameters);else var fit_y=fit.fun(fit_x,fit.parameters);this.fit_data[i]=[],this.fit_data[i][0]=fit_x,this.fit_data[i][1]=fit_y,ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,this.fit_points_drawn=0,this.drawSimpleLine(ctx,fit_x,fit_y)}this.transparent?(ctx.fillText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),y+=dy,ctx.fillText(string2,x,y),y+=dy,ctx.fillText(string3,x,y),y+=dy):(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),ctx.fillText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),y+=dy,ctx.strokeText(string2,x,y),ctx.fillText(string2,x,y),y+=dy,ctx.strokeText(string3,x,y),ctx.fillText(string3,x,y),y+=dy)}}if(ctx.lineWidth=graph_line_thickness,ctx.textAlign="center",ctx.strokeStyle=gs.color_fg,ctx.fillStyle=gs.color_fg,ctx.font=title_font_size+"px "+font_name,ctx.fillText(title,canvas.width/2,tick_len+title_spacing+title_font_size),ctx.font=axis_labels_font_size+"px "+font_name,ctx.fillText(gs.subtitle,canvas.width/2,tick_len+title_spacing+axis_labels_font_size+title_font_size),ctx.fillText(gs.subtitle2,canvas.width/2,tick_len+title_spacing+2*axis_labels_font_size+title_font_size),gs.data_transforms.length>0&&gs.showTransformTexts){ctx.font=axis_labels_font_size+"px "+font_name;var label="["+gs.data_transforms.join("|")+"]",labely=title_spacing+title_font_size+tick_len+axis_labels_font_size;gs.subtitle.length>0&&(labely+=axis_labels_font_size),gs.subtitle2.length>0&&(labely+=axis_labels_font_size),ctx.fillText(label,canvas.width/2,labely)}if(ctx.beginPath(),ctx.stroke(),gs.i>=1){ctx.strokeStyle=gs.color_fg,ctx.lineWidth=graph_line_thickness,ctx.fillStyle=gs.color_bg,ctx.rect(2*edge,2*edge,canvas.width-4*edge,canvas.height-4*edge),ctx.fill(),ctx.stroke(),ctx.fillStyle=gs.color_fg,ctx.textAlign="left";var y=3*edge,dy=1.5*axis_labels_font_size;ctx.fillText("canvas width : "+canvas.width,3*edge,y),y+=dy,ctx.fillText("canvas height : "+canvas.height,3*edge,y),y+=dy,ctx.fillText("canvas ID : "+this.canvas_name,3*edge,y),y+=dy,ctx.fillText("graph name : "+this.graph_name,3*edge,y),y+=dy,ctx.fillText("No. series : "+this.data.length+" of "+this.data_backup.length,3*edge,y),y+=dy,ctx.fillText("Points drawn : "+this.points_drawn,3*edge,y),y+=dy,ctx.fillText("Drawn points for fits : "+fit_points_drawn,3*edge,y),y+=dy,ctx.fillText("Touch : "+is_touch_device(),3*edge,y),y+=dy;var end_time=new Date;graph.ui.draw_time=end_time.getTime()-start_time.getTime(),ctx.fillText("Draw Time : "+graph.ui.draw_time+"ms",3*edge,y),y+=dy,ctx.fillText("Copy Time : "+graph.ui.copy_time+"ms",3*edge,y),y+=dy,ctx.textAlign="right";var label="MJS2015";ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-axis_labels_font_size-2*edge);var label="version: "+MJS_PLOT_VERSION;ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-2.5*axis_labels_font_size-2*edge);var label="web:"+MJS_PLOT_WEBSITE;ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-3.5*axis_labels_font_size-2*edge)}if(this.points_drawn=0,this.errors.length>0){ctx.font=axis_labels_font_size+"px "+font_name;var oldfill=ctx.fillStyle;ctx.fillStyle="#FF0000",ctx.textAlign="center";for(var i=0;i<this.errors.length;i++){var s="error > "+this.errors[i],x=canvas.width/2,y=2*tick_len+title_spacing+axis_labels_font_size+canvas.height/2-axis_labels_font_size*this.errors.length/2+axis_labels_font_size*i;ctx.fillText(s,x,y)}ctx.fillStyle=oldfill}this.errors=[],ctx.textAlign="left",ctx.beginPath(),ctx.stroke(),ctx.beginPath(),ctx.rect(graph_line_thickness/2,graph_line_thickness/2,canvas.width-graph_line_thickness,canvas.height-graph_line_thickness),ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=gs.color_fg,ctx.stroke(),gs.modified=!0,save_gs(this.graph_name,gs),this.isSVG||(this.graph_image=ctx.getImageData(0,0,canvas.width,canvas.height)),this.plot_failed=!1;for(var i=0;i<this.onPlotFunctions.length;i++)this.onPlotFunctions[i]()},units_to_pixels:function(t,e){if("x"===e){if("lin"===this.graphics_style.x_scale_mode||"time"===this.graphics_style.x_scale_mode)return(t-this.graphics_style.x_auto_min)*this.canvas.width/(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min);if("log"===this.graphics_style.x_scale_mode)return(Math.log10(t)-this.graphics_style.x_auto_min)*this.canvas.width/(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)||0}if("y"===e){if("lin"===this.graphics_style.y_scale_mode||"time"===this.graphics_style.y_scale_mode)return this.canvas.height-(t-this.graphics_style.y_auto_min)*this.canvas.height/(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min);if("log"===this.graphics_style.y_scale_mode)return this.canvas.height-(Math.log10(t)-this.graphics_style.y_auto_min)*this.canvas.height/(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)||canvas.height}},pixels_to_units:function(t,e){if("x"===e){if("lin"===this.graphics_style.x_scale_mode||"time"===this.graphics_style.x_scale_mode)return t/this.canvas.width*(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)+this.graphics_style.x_auto_min;if("log"===this.graphics_style.x_scale_mode)return Math.pow(10,t/this.canvas.width*(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)+this.graphics_style.x_auto_min)}if("y"===e){if("lin"===this.graphics_style.y_scale_mode||"time"===this.graphics_style.y_scale_mode)return(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)*(this.canvas.height-t)/this.canvas.height+this.graphics_style.y_auto_min;if("log"===this.graphics_style.y_scale_mode)return Math.pow(10,(this.canvas.height-t)/this.canvas.height*(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)+this.graphics_style.y_auto_min)}},get_axis_string:function(t,e){if("x"==e){if("lin"===this.graphics_style.x_scale_mode||"log"===this.graphics_style.x_scale_mode)return mjs_precision(t,this.graphics_style.x_precision+1);if("time"===this.graphics_style.x_scale_mode)return mjs_date_print(t,0,this.graphics_style.x_precision+1)}if("y"==e){if("lin"===this.graphics_style.y_scale_mode||"log"===this.graphics_style.y_scale_mode)return mjs_precision(t,this.graphics_style.y_precision+1);if("time"===this.graphics_style.y_scale_mode)return mjs_date_print(t,0,this.graphics_style.y_precision+1)}},make_full_screen:function(t){var e=window.document;full_screen_graph=t;var i=full_screen_graph.canvas;full_screen_graph.orignal_canvas_width=full_screen_graph.canvas.width,full_screen_graph.orignal_canvas_height=full_screen_graph.canvas.height;var a=i.requestFullscreen||i.mozRequestFullScreen||i.webkitRequestFullScreen||i.msRequestFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?(full_screen_graph.errors.push("can't go fullscreen"),full_screen_graph.isFullscreen=!1):(a.call(i),full_screen_graph.isFullscreen=!0,full_screen_graph.canvas.width=window.innerWidth,full_screen_graph.canvas.height=window.innerHeight,document.addEventListener("fullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("webkitfullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("mozfullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("MSFullscreenChange",full_screen_graph.full_screen_handler),window.addEventListener("resize",full_screen_graph.keep_full_screen,!0))},full_screen_handler:function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||full_screen_graph.exit_full_screen()},exit_full_screen:function(){full_screen_graph.isFullscreen=!1,document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),window.removeEventListener("resize",full_screen_graph.keep_full_screen,!0),full_screen_graph.canvas.width=full_screen_graph.orignal_canvas_width,full_screen_graph.canvas.height=full_screen_graph.orignal_canvas_height,full_screen_graph.mjs_plot()},keep_full_screen:function(){full_screen_graph.canvas.width=window.innerWidth,full_screen_graph.canvas.height=window.innerHeight,full_screen_graph.mjs_plot()}};return graph.canvas=canvas,make_interactive(graph),graph},get_graph_style:function(){if(is_touch_device())var t="drag";else var t="zoom";return{graph_line_thickness:1,symbol_size:5,line_thickness:2,tick_len:7,mode:"dot line",symbol_mode:"dot",line_mode:"line",font_name:"serif",title_font_size:20,title:"Title",subtitle:"",subtitle2:"",title_spacing:2,tick_labels_font_size:10,tick_lables_font_padding:2,axis_labels_font_size:10,lable_spacing:8,x_axis_title:"x axis (units)",y_axis_title:"y axis (units)",minor_tick_len:5,guideWidthx:35,guideWidthy:30,scaling_factor:1,mouse_mode:t,fits:"none",extrapolate:!1,color_fits:!1,x_scale_auto_max:!0,x_scale_auto_min:!0,y_scale_auto_max:!0,y_scale_auto_min:!0,x_manual_min:0,x_manual_max:1,y_manual_min:0,y_manual_max:1,x_scale_mode:"lin",y_scale_mode:"lin",x_scale_tight:!1,y_scale_tight:!1,show_captions:!0,showTransformTexts:!0,captions_display:"none",color_fg:"#111111",color_bg:"#eeeeee",color_mg:"#555555",show_grid:!1,v:MJS_PLOT_VERSION,caption_colors:!1,hidden_lines:[],data_transforms:[],data_transforms_args:[],i:0,o:0,modified:!1,x_precision:2,y_precision:2,fit_text_position:{x:.1,y:.2},caption_position:{x:-10,y:10},function_lines:[]}},convert_time_strings:function(t){for(var e=[],i=0;i<t.length;i++)e.push(Date.parse(t[i]));return e}},mjs_plot}();