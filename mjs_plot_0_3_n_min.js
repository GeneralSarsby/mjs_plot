mjs_plot=function(){function hslToRgb(e,t,a){function i(e,t,a){return 0>a&&(a+=1),a>1&&(a-=1),1/6>a?e+6*(t-e)*a:.5>a?t:2/3>a?e+(t-e)*(2/3-a)*6:e}var s,n,o;if(0==t)s=n=o=a;else{var r=.5>a?a*(1+t):a+t-a*t,_=2*a-r;s=i(_,r,e+1/3),n=i(_,r,e),o=i(_,r,e-1/3)}return"rgb("+Math.round(255*s)+","+Math.round(255*n)+","+Math.round(255*o)+")"}function get_color(e,t){if(t<color_table.length)return color_table[t][e];var a=1-Math.exp(-1.1*t),i=.5+(1-Math.exp(-1.1*t))*Math.cos(e*Math.PI)*.15;return hslToRgb(e/(t+1),a,i)}function parseExpression(text,ax,ay){for(var sin=Math.sin,cos=Math.cos,tan=Math.tan,ln=Math.log,pi=Math.PI,e=Math.E,pow=Math.pow,sqrt=Math.sqrt,log=function(e){return Math.log(e)/Math.log(10)},now=(new Date).getTime(),returny=[],i=0;i<ax.length;i++){var x=ax[i],y=ay[i];returny.push(eval(text))}return returny}function color_from_string(e){for(var t=321,a=0;a<50*e.length;a++)t=e.charCodeAt(a%e.length)+((t<<5)-t);return t&=t,hue=Math.abs(t%256/256),sat=.9,lightness=.3+.2*(Math.abs(t)%3),hslToRgb(hue,sat,lightness)}function clone(e){var t=e instanceof Array?[]:{};for(i in e)"clone"!=i&&(t[i]=e[i]&&"object"==typeof e[i]?clone(e[i]):e[i]);return t}function hasLocalStorage(){try{return localStorage.setItem("MJSplot","Stored"),localStorage.removeItem("MJSplot"),!0}catch(e){return!1}}function isMobile(){var e={Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},Windows:function(){return/IEMobile/i.test(navigator.userAgent)},any:function(){return e.Android()||e.BlackBerry()||e.iOS()||e.Windows()}};return e.any()}function is_touch_device(){var e="ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0;return e&&isMobile()||DEBUGG_FORCE_TOUCH}function eng_form_infix(e,t){if(isFinite(t)||(t=5),1>t&&(t=1),t>21&&(t=21),Math.abs(e)<1e-24||Math.abs(e)>=1e27)return mjs_precision(e,t);var a="";0>e&&(a="-"),e=Math.abs(e);var i=Math.floor(Math.log10(e)/3),s=e*Math.pow(1e3,-i),n=(s.toFixed(Math.max(t-3,0))+".").split("."),o=(s.toFixed(Math.max(0,t-n[0].length))+".").split("."),r=o[0]+si_prefixes[i+8]+o[1];return 0==o[1].length&&0==i&&(r=o[0]),a+r}function eng_form_postfix(e,t){if(isFinite(t)||(t=5),1>t&&(t=1),t>21&&(t=21),Math.abs(e)<1e-24||Math.abs(e)>=1e27)return mjs_precision(e,t);var a="";0>e&&(a="-"),e=Math.abs(e);var i=Math.floor(Math.log10(e)/3),s=e*Math.pow(1e3,-i),n=(s.toFixed(Math.max(t-3,0))+".").split("."),o=(s.toFixed(Math.max(0,t-n[0].length))+".").split("."),r=o[0]+"."+o[1]+si_prefixes[i+8];return 0!=o[1].length&&0==i&&(r=o[0]+"."+o[1]),0==o[1].length&&0!=i&&(r=o[0]+si_prefixes[i+8]),0==o[1].length&&0==i&&(r=o[0]),a+r}function download_text(e,t,a){var i=a||"data:text/plain;charset=utf-8",s=document.createElement("a");s.setAttribute("href",i+","+encodeURIComponent(e)),s.setAttribute("download",t),s.style.display="none",document.body.appendChild(s),console.log("downloading "+t),s.click(),document.body.removeChild(s)}function show_text_to_screen(e,t){var a=document.createElement("button"),i=document.createElement("div");a.setAttribute("onclick","location.reload()"),a.innerHTML="back",a.style.display="block";var s=document.createElement("textarea");s.style.width=.8*t.canvas.width+"px",s.style.height=.8*t.canvas.height+"px",i.appendChild(a),i.appendChild(s),s.value=e,t.canvas.parentNode.appendChild(i),t.canvas.parentNode.removeChild(t.canvas)}function save_gs(e,t){if(hasLocalStorage()){var a=JSON.stringify(t);localStorage.setItem(e,a)}else console.log("No local storage!")}function load_gs(e){var t=mjs_plot.get_graph_style();if(hasLocalStorage()){var a=localStorage.getItem(e);a&&(a=JSON.parse(a)),a&&(t=a)}else console.log("No local storage!");return t}function linear_regression(e,t){for(var a=0,i=0,s=0,n=0,o=0;o<e.length;o++)a+=e[o],s+=e[o]*e[o],i+=t[o],n+=e[o]*t[o];var r=e.length;n-=a*i/r,s-=a*a/r;var _=n/s,l=i/r-_*a/r;return slope={a:l,b:_}}function series_stats(e,t){for(var a=0,i=0,s=0,n=0,o=0,r=0;r<e.length;r++)a+=e[r],s+=e[r]*e[r],i+=t[r],n+=e[r]*t[r],o+=t[r]*t[r];var _=e.length;n-=a*i/_,s-=a*a/_,o-=i*i/_;var l=n*n/s/o,g=a/_,h=i/_,c=Math.sqrt(s/_),d=Math.sqrt(o/_),m=n/_,x=n/s,f=i/_-x*a/_,p=Math.sqrt((o-n*n/s)/(_-2)),u=p/Math.sqrt(s),y=p*Math.sqrt(1/_+g*g/s),v=Math.min.apply(null,t),w=Math.max.apply(null,t),T=Math.min.apply(null,e),b=Math.max.apply(null,e);return stats={x_mean:g,y_mean:h,sigma_x:c,sigma_y:d,cov:m,b:x,a:f,s_b:u,s_a:y,n:_,r_2:l,ymin:v,ymax:w,xmin:T,xmax:b}}function padLeft(e,t,a){return Array(t-String(e).length+1).join(a||"0")+e}function trim(e,t,a){return e=Math.max(e,t),e=Math.min(e,a)}function mjs_time_difference_print(e){var t=e/1e3;e%=1e3;var a=Math.floor(t%60),i=Math.floor(t/60%60),s=Math.floor(t/60/60%24),n=Math.floor(t/60/60/24),o="";return a>0&&(o=a+"seconds "+e.toFixed(0)+"ms"),i>0&&(o=i+"min "+a+"seconds"),s>0&&(o=s+"hours "+i+"min "+a+"seconds"),n>0&&(o=n+"days "+s+"hours "+i+"min"),o}function mjs_date_print(e,t,a){t=isFinite(t)?t:0,a=isFinite(a)?a:8,t=trim(t,0,8),a=trim(a,0,8),t=Math.min(t,a);var i=new Date(e),s="",n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return 2==t&&2==a&&(s+=i.getMonth()+1+"-"),1==t&&a>1&&(s+=n[i.getMonth()]+"-",t++),3!=t||4!=a&&3!=a?4==t&&4==a?(s+=padLeft(i.getHours(),2,"0"),s+=":"+padLeft(i.getMinutes(),2,"0")):4==t&&5==a?(s+=padLeft(i.getMinutes(),2,"0"),s+="m"+padLeft(i.getSeconds(),2,"0")+"s"):1==t&&1==a?s=n[i.getMonth()]:(0>=t&&(s+=i.getFullYear()),0>=t&&a>=1&&(s+="-"),1>=t&&a>=1&&(s+=i.getMonth()+1),1>=t&&a>=2&&(s+="-"),2>=t&&a>=2&&(s+=i.getDate()),2>=t&&a>=3&&(s+=" "),3>=t&&a>=3&&(s+=padLeft(i.getHours(),2,"0")),3>=t&&a>=4&&(s+=":"),4>=t&&a>=4&&(s+=padLeft(i.getMinutes(),2,"0")),4>=t&&a>=5&&(s+=":"),5>=t&&a>=5&&(s+=padLeft(i.getSeconds(),2,"0")),5>=t&&a>=6&&(s+="."),6>=t&&a>=6&&(s+=padLeft(i.getMilliseconds(),3,"0")[0]),7>=t&&a>=7&&(s+=padLeft(i.getMilliseconds(),3,"0")[1]),8>=t&&a>=8&&(s+=padLeft(i.getMilliseconds(),3,"0")[2]),3==a&&3>=t&&(s+="h"),4==a&&4==t&&(s+="m"),5!=a||5!=t&&4!=t||(s+="s"),s):(s+=padLeft(i.getHours(),2,"0"),s+=":"+padLeft(i.getMinutes(),2,"0"))}function round_to_month(e){var t=new Date(e),a=t.getDate(),i=new Date(t.getFullYear(),t.getMonth()+1,0),s=i.getDate()-a;return s>a?e-24*(a-1)*60*60*1e3:e+24*(s+1)*60*60*1e3}function round_to_year(e){var t=new Date(e),a=new Date(t.getFullYear(),0,1),i=new Date(t.getFullYear()+1,0,1);return t.getTime()-a.getTime()<i.getTime()-t.getTime()?a.getTime():i.getTime()}function mjs_precision(e,t){var t=Math.max(1,t);if(1>t&&(t=1),t>21&&(t=21),Math.abs(e)<.001)return a=e.toExponential(t);var a=e.toPrecision(t);return a.length>e.toPrecision(t+2).length&&(a=e.toPrecision(t+2)),a.length>e.toPrecision(t+1).length&&(a=e.toPrecision(t+1)),a.length>e.toPrecision(t+3).length&&(a=e.toPrecision(t+3)),a}function number_quote(e,t){return isFinite(t)||(t=1e-20),isFinite(e)||(e=0),mjs_precision(e,Math.max(2,Math.floor(Math.log10(Math.abs(e)))-Math.floor(Math.log10(Math.abs(t)))+2))}function drawEllipse(e,t,a,i,s,n){t.beginPath();for(var o=.5,r=0*Math.PI;r<2*Math.PI;r+=.01){var _=a-s*Math.sin(r)*Math.sin(o*Math.PI)+n*Math.cos(r)*Math.cos(o*Math.PI),l=i+n*Math.cos(r)*Math.sin(o*Math.PI)+s*Math.sin(r)*Math.cos(o*Math.PI);0==r?t.moveTo(e.units_to_pixels(_,"x"),e.units_to_pixels(l,"y")):t.lineTo(e.units_to_pixels(_,"x"),e.units_to_pixels(l,"y"))}t.stroke()}function mouse_move_event(e,t){t.ui.latestEvent=e,t.ui.ticking||(t.ui.ticking=!0,requestAnimationFrame(function(){mouse_move_event_shim(t.ui.latestEvent,t)}))}function mouse_move_event_shim(e,t){var a=new Date;mouse_move_event_actual(e,t);var i=new Date;t.ui.copy_time=i.getTime()-a.getTime(),t.ui.ticking=!1}function mouse_move_event_actual(e,t){var a=t.canvas,i=a.getContext("2d"),s=t.graphics_style,n=a.getBoundingClientRect(),o=e.clientX-n.left,r=e.clientY-n.top,_=t.pixels_to_units(o,"x"),l=t.pixels_to_units(r,"y");if(i.putImageData(t.graph_image,0,0),t.ui.touch)var g=Math.min(Math.min(a.width/22,a.height/15));else var g=Math.min(s.tick_labels_font_size/.55*s.scaling_factor,Math.min(a.width/22,a.height/15));t.ui.size=g;var h=g/4;if(i.font=.55*g+"px "+s.font_name,DEBUGG_FPS&&i.fillText("fps: "+1/t.ui.copy_time*1e3,30,30),0==mouse_down){if(s.o>=1){i.fillStyle=s.color_bg,i.globalAlpha=.5,i.beginPath(),i.fillRect(0,0,a.width,a.height),i.fill(),i.stroke(),i.globalAlpha=1,i.fillStyle=s.color_fg,i.strokeStyle=s.color_fg;var c=[s.guideWidthx,s.guideWidthy,s.symbol_size,s.line_thickness,s.tick_len,s.minor_tick_len,s.title_font_size,s.tick_labels_font_size,s.axis_labels_font_size,s.title_spacing,s.tick_lables_font_padding,s.lable_spacing,s.graph_line_thickness],d=["scale width x","scale width y","symbol size","line thickness","tick length","minor tick length","title font size","ticks font size","axis font size","title spacing","tick padding","label spacing","graph line thickness"],m=.7*g,m=Math.min(a.height/32,a.width/25);t.ui.s=m,i.font=.8*m+"px "+s.font_name;for(var x=0;x<c.length;x++)i.rect(m,m+x*m*1.2-.75*m,m,m),i.rect(2*m,m+x*m*1.2-.75*m,m,m),i.textAlign="center",i.fillText("+",1.5*m,m+x*m*1.2),i.fillText("-",2.5*m,m+x*m*1.2),i.textAlign="left",i.fillText(d[x]+" = "+mjs_precision(c[x],3),3.5*m,m+x*m*1.2);i.stroke();var f=[s.font_name,s.title,s.subtitle,s.subtitle2,s.x_axis_title,s.y_axis_title,s.color_fg,s.color_bg,s.color_mg],p=["font","title","subtitle","subtitle2","x-axis","y-axis","fg color","bg color","mg color"];C=0;for(var x=c.length;x<c.length+f.length;x++)i.rect(m,m+x*m*1.2-.75*m,3*m,m),i.textAlign="center",i.fillText("edit",2.5*m,m+x*m*1.2),i.textAlign="left",i.fillText(p[C]+" = "+f[C],m+3.5*m,m+x*m*1.2),C++;return i.stroke(),x++,i.rect(m,m+x*m*1.2-.75*m,4*m,m),i.stroke(),i.textAlign="center",i.fillText("Reset",2.5*m,m+x*m*1.2),x++,i.rect(m,m+x*m*1.2-.75*m,4*m,m),i.stroke(),i.fillText("Exit",2.5*m,m+x*m*1.2),void(s.mouse_mode="options")}if(i.fillStyle=s.color_fg,i.strokeStyle=s.color_fg,o>g&&r>g&&a.height-r>g&&a.width-o>g){if("zoom"===s.mouse_mode&&(i.beginPath(),i.arc(o,r,h,0,2*Math.PI,!0),i.stroke()),"zoom"===s.mouse_mode||"drag"===s.mouse_mode||"measure"===s.mouse_mode){var u=t.get_axis_string(_,"x"),y=t.get_axis_string(l,"y");lw=y.length*s.scaling_factor*s.axis_labels_font_size,t.ui.touch&&t.ui.is_touching?(i.fillText(u,o+h,a.height-2*g),i.fillText(y,2*g,r-h)):(i.fillText(u,o+h,Math.min(r+2*h+2*g,a.height-2*g)),i.fillText(y,Math.max(o-2*h-lw-2*g,2*g),r-h)),i.beginPath(),i.moveTo(o,r+g),i.lineTo(o,a.height),i.moveTo(o,r-g),i.lineTo(o,0),i.moveTo(o-g,r),i.lineTo(0,r),i.moveTo(o+g,r),i.lineTo(a.width,r),i.stroke(),i.beginPath(),i.stroke()}if("trim"===s.mouse_mode&&(i.fillText("trim",o+2*h,r-2*h),i.beginPath(),i.moveTo(o,0),i.lineTo(o,a.height),i.moveTo(0,r),i.lineTo(a.width,r),i.stroke()),"cut"===s.mouse_mode&&(i.fillText("cut",o+2*h,r-2*h),i.beginPath(),i.moveTo(o,0),i.lineTo(o,a.height),i.moveTo(0,r),i.lineTo(a.width,r),i.stroke()),"sublin"===s.mouse_mode&&i.fillText("draw a line to subtract",o+2*h,r-2*h),"x-c"===s.mouse_mode&&(E=t.get_axis_string(_,"x"),i.fillText("x-"+E,o+2*h,r-2*h),i.beginPath(),i.moveTo(o,0),i.lineTo(o,a.height),i.stroke()),"y-c"===s.mouse_mode&&(E=t.get_axis_string(l,"y"),i.fillText("y-"+E,o+2*h,r-2*h),i.beginPath(),i.moveTo(0,r),i.lineTo(a.width,r),i.stroke()),"mouse"===s.mouse_mode){"none"===s.fits||(i.beginPath(),i.arc(s.fit_text_position.x*a.width,s.fit_text_position.y*a.height,2*h,0,2*Math.PI,!0),i.stroke()),i.beginPath();var v=(s.tick_len+s.title_spacing+s.title_font_size)*s.scaling_factor;if(i.arc(a.width/2,v,2*h,0,2*Math.PI,!0),i.stroke(),s.show_captions>0){var w=s.scaling_factor*s.caption_position.x;s.caption_position.x>0?w+=s.scaling_factor*s.tick_len:(w=a.width+w,w-=s.scaling_factor*s.tick_len),cap_y=s.scaling_factor*s.caption_position.y,s.caption_position.y>0?cap_y+=s.scaling_factor*s.tick_len:(cap_y=a.height+cap_y,cap_y-=s.scaling_factor*s.tick_len),i.beginPath(),i.arc(w,cap_y,2*h,0,2*Math.PI,!0),i.stroke()}}if(i.beginPath(),i.stroke(),"measure"===s.mouse_mode&&(i.beginPath(),i.moveTo(o-h,r-h),i.lineTo(o+h,r+h),i.moveTo(o-h,r+h),i.lineTo(o+h,r-h),i.stroke(),i.beginPath(),i.stroke()),"drag"===s.mouse_mode&&(drag_x=o-.5*g,drag_y=r-.5*g,i.beginPath(),i.moveTo(drag_x+.2*g,drag_y+.5*g),i.lineTo(drag_x+.8*g,drag_y+.5*g),i.moveTo(drag_x+.5*g,drag_y+.2*g),i.lineTo(drag_x+.5*g,drag_y+.8*g),i.moveTo(drag_x+.2*g,drag_y+.5*g),i.lineTo(drag_x+.3*g,drag_y+.6*g),i.moveTo(drag_x+.2*g,drag_y+.5*g),i.lineTo(drag_x+.3*g,drag_y+.4*g),i.moveTo(drag_x+.8*g,drag_y+.5*g),i.lineTo(drag_x+.7*g,drag_y+.6*g),i.moveTo(drag_x+.8*g,drag_y+.5*g),i.lineTo(drag_x+.7*g,drag_y+.4*g),i.moveTo(drag_x+.5*g,drag_y+.2*g),i.lineTo(drag_x+.4*g,drag_y+.3*g),i.moveTo(drag_x+.5*g,drag_y+.2*g),i.lineTo(drag_x+.6*g,drag_y+.3*g),i.moveTo(drag_x+.5*g,drag_y+.8*g),i.lineTo(drag_x+.4*g,drag_y+.7*g),i.moveTo(drag_x+.5*g,drag_y+.8*g),i.lineTo(drag_x+.6*g,drag_y+.7*g),i.stroke(),i.beginPath(),i.stroke()),"reader"===s.mouse_mode){var T=t.reader_index[0],b=t.reader_index[1],k=t.units_to_pixels(t.data[T][0][b],"x"),M=t.units_to_pixels(t.data[T][1][b],"y"),j=i.lineWidth;i.strokeStyle=s.color_bg,i.lineWidth=s.scaling_factor*s.axis_labels_font_size/3,("lin"===s.x_scale_mode||"log"===s.x_scale_mode)&&(E=mjs_precision(t.data[T][0][b],s.x_precision+5)),"time"===s.x_scale_mode&&(E=mjs_date_print(t.data[T][0][b],0,8)),i.strokeText(E,o+2*h,r+1.6*s.axis_labels_font_size),i.fillText(E,o+2*h,r+1.6*s.axis_labels_font_size),("lin"===s.y_scale_mode||"log"===s.y_scale_mode)&&(E=mjs_precision(t.data[T][1][b],s.y_precision+5)),"time"===s.y_scale_mode&&(E=mjs_date_print(t.data[T][1][b],0,8)),i.strokeText(E,o+2*h,r),i.fillText(E,o+2*h,r),E=t.captions[T],i.strokeText(E,o+2*h,r-1.6*s.axis_labels_font_size),i.fillText(E,o+2*h,r-1.6*s.axis_labels_font_size),E="i="+b,i.strokeText(E,o+2*h,r+1.6*s.axis_labels_font_size*2),i.fillText(E,o+2*h,r+1.6*s.axis_labels_font_size*2),i.lineWidth=j,i.strokeStyle=s.color_fg,i.beginPath(),i.moveTo(o,r),i.lineTo(k,M),i.stroke(),i.beginPath(),i.arc(o,r,.3*g*.8,0,2*Math.PI,!0),i.moveTo(o,r-.3*g),i.lineTo(o,r+.3*g),i.moveTo(o+.3*g,r),i.lineTo(o-.3*g,r),i.stroke()}}if(g>r&&(i.fillStyle=s.color_bg,i.beginPath(),i.rect(0,0,4*g,g),i.rect(4*g,0,4*g,g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.beginPath(),i.fillText("symbol/line",.2*g,.8*g),i.fillText("Graph",4.2*g,.8*g),i.fillStyle=s.color_bg,i.rect(9*g,0,g,g),i.fill(),i.stroke(),i.beginPath(),i.moveTo(9.2*g,.5*g),i.lineTo(9.8*g,.5*g),i.moveTo(9.5*g,.2*g),i.lineTo(9.5*g,.8*g),i.moveTo(9.2*g,.5*g),i.lineTo(9.3*g,.6*g),i.moveTo(9.2*g,.5*g),i.lineTo(9.3*g,.4*g),i.moveTo(9.8*g,.5*g),i.lineTo(9.7*g,.6*g),i.moveTo(9.8*g,.5*g),i.lineTo(9.7*g,.4*g),i.moveTo(9.5*g,.2*g),i.lineTo(9.4*g,.3*g),i.moveTo(9.5*g,.2*g),i.lineTo(9.6*g,.3*g),i.moveTo(9.5*g,.8*g),i.lineTo(9.4*g,.7*g),i.moveTo(9.5*g,.8*g),i.lineTo(9.6*g,.7*g),i.stroke(),i.rect(10*g,0,g,g),i.fill(),i.stroke(),i.beginPath(),i.arc(10.5*g,.5*g,.3*g*.8,0,2*Math.PI,!0),i.moveTo(10.4*g,.5*g),i.lineTo(10.6*g,.5*g),i.moveTo(10.5*g,.4*g),i.lineTo(10.5*g,.6*g),i.moveTo(10.5*g+.3*g*.8*.707,.5*g+.3*g*.8*.707),i.lineTo(10.9*g,.9*g),i.stroke(),i.rect(11*g,0,g,g),i.fill(),i.stroke(),i.beginPath(),i.moveTo(11.2*g,.8*g),i.lineTo(11.8*g,.8*g),i.lineTo(11.8*g,.2*g),i.lineTo(11.2*g,.8*g),i.stroke(),i.rect(12*g,0,g,g),i.fill(),i.stroke(),i.beginPath(),i.arc(12.5*g,.5*g,.3*g*.8,0,2*Math.PI,!0),i.moveTo(12.5*g,.2*g),i.lineTo(12.5*g,.8*g),i.moveTo(12.2*g,.5*g),i.lineTo(12.8*g,.5*g),i.stroke(),i.rect(13*g,0,g,g),i.fill(),i.stroke(),i.beginPath(),i.moveTo(13.3*g,.2*g),i.lineTo(13.3*g,.8*g),i.lineTo(13.7*g,.6*g),i.lineTo(13.3*g,.2*g),i.fillStyle=s.color_bg,i.rect(a.width-g,0,g,g),i.rect(a.width-2*g,0,g,g),i.rect(a.width-3*g,0,g,g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.fillText("c",a.width-.7*g,.7*g),i.fillStyle=s.color_fg,i.fillText("i",a.width-1.7*g,.7*g),i.beginPath(),i.arc(a.width-2.2*g,.7*g,.07*g,0,2*Math.PI,!0),i.arc(a.width-2.5*g,.7*g,.07*g,0,2*Math.PI,!0),i.arc(a.width-2.8*g,.7*g,.07*g,0,2*Math.PI,!0),i.fill(),i.fillStyle=s.color_fg,i.beginPath(),i.stroke()),r>a.height-g){i.fillStyle=s.color_bg,i.beginPath(),i.rect(0,a.height-g,2*g,g),i.rect(2*g,a.height-g,2*g,g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.beginPath(),i.fillText("x",.2*g,a.height-.3*g),i.fillText("y",2.2*g,a.height-.3*g),i.fillStyle=s.color_bg,i.rect(4*g,a.height-g,g,g),i.fill(),i.stroke(),i.beginPath();var S=4*g,P=a.height-g;i.moveTo(S+.2*g,P+.4*g),i.lineTo(S+.8*g,P+.4*g),i.moveTo(S+.2*g,P+.6*g),i.lineTo(S+.8*g,P+.6*g),i.moveTo(S+.4*g,P+.2*g),i.lineTo(S+.4*g,P+.8*g),i.moveTo(S+.6*g,P+.2*g),i.lineTo(S+.6*g,P+.8*g),i.stroke(),i.rect(5*g,a.height-g,g,g),i.fill(),i.stroke(),i.rect(6*g,a.height-g,g,g),i.fill(),i.stroke(),i.rect(7*g,a.height-g,g,g),i.fill(),i.stroke(),"log"==s.y_scale_mode?(i.moveTo(5*g,a.height-.2*g),i.lineTo(6*g,a.height-.2*g),i.moveTo(5*g,a.height-.4*g),i.lineTo(6*g,a.height-.4*g),i.moveTo(5*g,a.height-.6*g),i.lineTo(6*g,a.height-.6*g),i.moveTo(5*g,a.height-.8*g),i.lineTo(6*g,a.height-.8*g)):(i.moveTo(5*g,a.height-.4*g),i.lineTo(6*g,a.height-.4*g),i.moveTo(5*g,a.height-.65*g),i.lineTo(6*g,a.height-.65*g),i.moveTo(5*g,a.height-.8*g),i.lineTo(6*g,a.height-.8*g),i.moveTo(5*g,a.height-.9*g),i.lineTo(6*g,a.height-.9*g)),"log"===s.x_scale_mode?(i.moveTo(6.2*g,a.height),i.lineTo(6.2*g,a.height-g),i.moveTo(6.4*g,a.height),i.lineTo(6.4*g,a.height-g),i.moveTo(6.6*g,a.height),i.lineTo(6.6*g,a.height-g),i.moveTo(6.8*g,a.height),i.lineTo(6.8*g,a.height-g)):(i.moveTo(6.4*g,a.height),i.lineTo(6.4*g,a.height-g),i.moveTo(6.65*g,a.height),i.lineTo(6.65*g,a.height-g),i.moveTo(6.8*g,a.height),i.lineTo(6.8*g,a.height-g),i.moveTo(6.9*g,a.height),i.lineTo(6.9*g,a.height-g)),i.stroke();var S=7*g,P=a.height-g;i.beginPath(),i.moveTo(S+.1*g,P+.6*g),i.lineTo(S+.1*g,P+.9*g),i.lineTo(S+.9*g,P+.9*g),i.lineTo(S+.9*g,P+.6*g),i.moveTo(S+.5*g,P+.9*g),i.lineTo(S+.5*g,P+.8*g),i.stroke(),i.beginPath(),i.arc(S+.5*g,P+.4*g,.3*g,0,2*Math.PI,!0),i.moveTo(S+.5*g,P+.2*g),i.lineTo(S+.5*g,P+.4*g),i.lineTo(S+.6*g,P+.4*g),i.stroke(),i.fillStyle=s.color_bg,i.rect(8*g,a.height-g,3*g,g),i.fill(),i.stroke(),i.beginPath(),i.fillStyle=s.color_fg,i.fillText("f()",8.2*g,a.height-.3*g),i.stroke(),i.fillStyle=s.color_bg,i.rect(11*g,a.height-g,4*g,g),i.fill(),i.stroke(),i.beginPath(),i.fillStyle=s.color_fg,i.fillText("lines",11.2*g,a.height-.3*g),i.stroke(),i.fillStyle=s.color_bg,i.rect(15*g,a.height-g,4*g,g),i.fill(),i.stroke(),i.beginPath(),i.fillStyle=s.color_fg,i.fillText("fits",15.2*g,a.height-.3*g),i.stroke(),i.fillStyle=s.color_bg,i.rect(a.width-g,a.height-g,g,g),i.rect(a.width-3*g,a.height-g,g,g),i.rect(a.width-2.8*g,a.height-.8*g,.6*g,.6*g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.fillText("e",a.width-.7*g,a.height-.3*g),i.stroke(),i.fillStyle=s.color_fg,i.beginPath(),i.rect(a.width-2*g,a.height-g,g,g),i.fill(),i.stroke(),i.beginPath(),i.fillStyle=s.color_bg,i.moveTo(a.width-2*g,a.height),i.lineTo(a.width-g-1,a.height-g+1),i.lineTo(a.width-g-1,a.height),i.closePath(),i.fill(),i.beginPath(),i.fill(),i.stroke()}if(t.drawxmenu)if(12*g>o&&r>a.height-9*g){i.fillStyle=s.color_bg,i.rect(0,a.height-9*g,12*g,9*g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.beginPath();var P=a.height-.2*g,z=g,S=.2*g;i.textAlign="left",i.fillText("x:",S,P),P-=z,i.fillText("Min:"+t.get_axis_string(s.x_manual_min,"x"),S,P),P-=z,i.fillText("Max:"+t.get_axis_string(s.x_manual_max,"x"),S,P),P-=z,i.fillText("Mode:",S,P),P-=z,i.fillText("Spacing: "+mjs_precision(s.guideWidthx,2),S,P),P-=z,i.fillText("Style:",S,P),P-=z,i.fillText("Set Prefix:",S,P),P-=z,i.fillText("Set Postfix:",S,P),P-=z,i.fillText("Set Label:",S,P),P-=z,P=a.height-1.2*g,i.textAlign="center",i.fillText("[auto]",6*g,P),i.fillText("[manual]",10*g,P),P-=z,i.fillText("[auto]",6*g,P),i.fillText("[manual]",10*g,P),P-=z,i.fillText("[lin]",4.5*g,P),i.fillText("[log]",7.5*g,P),i.fillText("[time]",10.5*g,P),P-=z,i.fillText("[-]",6*g,P),i.fillText("[+]",10*g,P),P-=z,i.fillText("[1200]",5*g,P),i.fillText("[1k2]",7*g,P),i.fillText("[1.2k]",9*g,P),i.fillText("[1.2e3]",11*g,P),P-=z,i.fillText('"'+s.x_axis_prefix+'"',8*g,P),P-=z,i.fillText('"'+s.x_axis_postfix+'"',8*g,P),P-=z,i.fillText('"'+s.x_axis_title+'"',8*g,P),i.textAlign="left"}else t.drawxmenu=!1;if(t.drawymenu)if(14*g>o&&o>2*g&&r>a.height-9*g){i.fillStyle=s.color_bg,i.rect(2*g,a.height-9*g,12*g,9*g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.beginPath();var P=a.height-.2*g,z=g,S=2.2*g;i.textAlign="left",i.fillText("y:",S,P),P-=z,i.fillText("Min:"+t.get_axis_string(s.y_manual_min,"y"),S,P),P-=z,i.fillText("Max:"+t.get_axis_string(s.y_manual_max,"y"),S,P),P-=z,i.fillText("Mode:",S,P),P-=z,i.fillText("Spacing: "+mjs_precision(s.guideWidthy,2),S,P),P-=z,i.fillText("Style:",S,P),P-=z,i.fillText("Set Prefix:",S,P),P-=z,i.fillText("Set Postfix:",S,P),P-=z,i.fillText("Set Label:",S,P),P-=z,P=a.height-1.2*g,i.textAlign="center";var S=2*g;i.fillText("[auto]",S+6*g,P),i.fillText("[manual]",S+10*g,P),P-=z,i.fillText("[auto]",S+6*g,P),i.fillText("[manual]",S+10*g,P),P-=z,i.fillText("[lin]",S+4.5*g,P),i.fillText("[log]",S+7.5*g,P),i.fillText("[time]",S+10.5*g,P),P-=z,i.fillText("[-]",S+6*g,P),i.fillText("[+]",S+10*g,P),P-=z,i.fillText("[1200]",S+5*g,P),i.fillText("[1k2]",S+7*g,P),i.fillText("[1.2k]",S+9*g,P),i.fillText("[1.2e3]",S+11*g,P),P-=z,i.fillText('"'+s.y_axis_prefix+'"',S+8*g,P),P-=z,i.fillText('"'+s.y_axis_postfix+'"',S+8*g,P),P-=z,i.fillText('"'+s.y_axis_title+'"',S+8*g,P),i.textAlign="left"}else t.drawymenu=!1;if(t.drawmodemenu)if(10*g>o&&3*g>r){i.fillStyle=s.color_bg,i.beginPath(),i.rect(0,0,10*g,3*g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.beginPath(),i.fillText("symbol/line",.2*g,.8*g),i.beginPath(),i.moveTo(.2*g,1.5*g),i.lineTo(.8*g,1.5*g),i.moveTo(.5*g,1.2*g),i.lineTo(.5*g,1.8*g),i.moveTo(1.2*g,1.5*g),i.lineTo(1.8*g,1.5*g),i.stroke(),i.beginPath(),i.moveTo(.2*g,2.5*g),i.lineTo(.8*g,2.5*g),i.moveTo(.5*g,2.2*g),i.lineTo(.5*g,2.8*g),i.moveTo(1.2*g,2.5*g),i.lineTo(1.8*g,2.5*g),i.stroke(),i.beginPath(),i.moveTo(0,g),i.lineTo(10*g,g),i.moveTo(0,2*g),i.lineTo(10*g,2*g),i.moveTo(2*g,1*g),i.lineTo(2*g,3*g),i.stroke(),i.beginPath(),i.arc(2.5*g,1.5*g,.35*g,0,2*Math.PI,!0),i.stroke(),i.beginPath(),i.moveTo(2.2*g,1.2*g),i.lineTo(2.8*g,1.8*g),i.stroke(),i.beginPath(),i.arc(2.5*g,2.5*g,.35*g,0,2*Math.PI,!0),i.stroke(),i.beginPath(),i.moveTo(2.2*g,2.2*g),i.lineTo(2.8*g,2.8*g),i.stroke();var S=3*g,P=1*g;i.fillStyle=s.color_fg,i.rect(S+.3*g,P+.3*g,.4*g,.4*g),i.fill(),S+=g,i.arc(.5*g+S,P+.5*g,.3*g,0,2*Math.PI,!0),i.fill(),S+=g,i.fillStyle=s.color_bg,i.beginPath(),i.rect(S+.3*g,P+.3*g,.4*g,.4*g),i.stroke(),S+=g,i.beginPath(),i.arc(.5*g+S,P+.5*g,.3*g,0,2*Math.PI,!0),i.stroke(),S+=g,i.beginPath(),i.moveTo(S+.3*g,P+.3*g),i.lineTo(S+.7*g,P+.7*g),i.moveTo(S+.7*g,P+.3*g),i.lineTo(S+.3*g,P+.7*g),i.stroke(),S+=g,i.beginPath(),i.moveTo(S+.5*g,P+.3*g),i.lineTo(S+.5*g,P+.7*g),i.moveTo(S+.7*g,P+.5*g),i.lineTo(S+.3*g,P+.5*g),i.stroke(),P+=1.5*g,S=3.5*g;var D=.3;i.beginPath(),i.moveTo(S-D*g,P-D*g),i.lineTo(S+D*g,P+D*g),S+=g,i.moveTo(S-D*g,P+D*g),i.quadraticCurveTo(S-D*g,P-D*g,S+D*g,P-D*g),S+=g,i.moveTo(S-D*g,P+D*g),i.bezierCurveTo(S+D*g,P+D*g,S-D*g,P-D*g,S+D*g,P-D*g),S+=g,i.moveTo(S-D*g,P-D*g),i.lineTo(S-D*g,P+D*g),i.lineTo(S+D*g,P+D*g),S+=g,i.moveTo(S-D*g,P-D*g),i.lineTo(S+D*g,P-D*g),i.lineTo(S+D*g,P+D*g),S+=g,i.moveTo(S-D*g,P-D*g),i.lineTo(S,P-D*g),i.lineTo(S,P+D*g),i.lineTo(S+D*g,P+D*g),S+=g,i.moveTo(S-D*g,P-D*g),i.lineTo(S-D*g,P+D*g),i.moveTo(S-D*g,P),i.lineTo(S+D*g,P),i.lineTo(S+D*g,P+D*g),i.stroke()}else console.log("leaving menu"),t.drawmodemenu=!1;if(t.drawgraphmenu)if(12*g>o&&o>4*g&&10*g>r){i.fillStyle=s.color_bg,i.rect(4*g,0,8*g,10*g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.beginPath();var P=.8*g,z=-g,S=4.2*g;i.fillText("Graph",S,P),P-=z,i.fillText("Set title",S,P),P-=z,i.fillText("Set subtitle",S,P),P-=z,i.fillText("Set subtitle2",S,P),P-=z,i.fillText("Toggle show transforms",S,P),P-=z,i.fillText("set x-axis title",S,P),P-=z,i.fillText("set y-axis title",S,P),P-=z,i.fillText("Scaling Factor down",S,P),P-=z,i.fillText("Scaling Factor up",S,P),P-=z,i.fillText("Reset Graph",S,P),P-=z}else t.drawgraphmenu=!1;if(t.drawexportmenu)if(o>a.width-8*g&&r>a.height-14*g){i.fillStyle=s.color_bg,i.rect(a.width-8*g,a.height-14*g,8*g,14*g),i.fill(),i.stroke(),i.fillStyle=s.color_fg,i.beginPath();var P=a.height-.1*g,z=g,S=a.width-7.8*g;i.fillText("export",S,P),P-=z,i.fillText("data (csv)",S,P),P-=z,i.fillText("data (code)",S,P),P-=z,i.fillText("data (code [matlab])",S,P),P-=z,i.fillText("data (code [JSON])",S,P),P-=z,i.fillText("data (tabbed)",S,P),P-=z,i.fillText("png (hi res)",S,P),P-=z,i.fillText("png (low res)",S,P),P-=z,i.fillText("png (small figure)",S,P),P-=z,i.fillText("png (large figure)",S,P),P-=z,i.fillText("svg",S,P),P-=z,i.fillText("svg (small figure)",S,P),P-=z,i.fillText("svg (large figure)",S,P),P-=z,i.fillText("HTML [link]",S,P),P-=z}else t.drawexportmenu=!1;if(t.drawcaptionmenu&&(o>a.width-4*g&&8*g>r?(i.fillStyle=s.color_bg,i.beginPath(),i.rect(a.width-4*g,0,4*g,8*g),i.fill(),i.stroke(),i.beginPath(),i.fillStyle=s.color_fg,i.fillText("captions",a.width-3.8*g,.8*g),i.fillText("Show/Hide",a.width-3.8*g,1.8*g),i.fillText("x",a.width-3.8*g,2.8*g),i.fillText("y",a.width-1.8*g,2.8*g),i.fillText("First",a.width-3.8*g,3.8*g),i.fillText("Last",a.width-3.8*g,4.8*g),i.fillText("Min",a.width-3.8*g,5.8*g),i.fillText("Max",a.width-3.8*g,6.8*g),i.fillText("First",a.width-1.8*g,3.8*g),i.fillText("Last",a.width-1.8*g,4.8*g),i.fillText("Min",a.width-1.8*g,5.8*g),i.fillText("Max",a.width-1.8*g,6.8*g),i.fillText("None",a.width-2.8*g,7.8*g),i.beginPath(),i.moveTo(a.width-4*g,g),i.lineTo(a.width,g),i.moveTo(a.width-4*g,2*g),i.lineTo(a.width,2*g),i.moveTo(a.width-4*g,3*g),i.lineTo(a.width,3*g),i.moveTo(a.width-2*g,2*g),i.lineTo(a.width-2*g,7*g),i.stroke()):t.drawcaptionmenu=!1),t.drawfxmenu)if(o>8*g&&22*g>o&&r>a.height-14*g){i.fillStyle=s.color_bg,i.rect(8*g,a.height-14*g,14*g,14*g),i.fill(),i.stroke(),i.beginPath(),i.fillStyle=s.color_fg,i.fillText("functions",8.2*g,a.height-.3*g),i.stroke(),i.beginPath();for(var x=1;14>x;x++)i.moveTo(8*g,a.height-g*x),i.lineTo(22*g,a.height-g*x);i.moveTo(12*g,a.height),i.lineTo(12*g,a.height-14*g),i.moveTo(16*g,a.height),i.lineTo(16*g,a.height-14*g),i.moveTo(10*g,a.height-9*g),i.lineTo(10*g,a.height-13*g),i.moveTo(10*g,a.height-4*g),i.lineTo(10*g,a.height-5*g),i.moveTo(14*g,a.height-9*g),i.lineTo(14*g,a.height-13*g),i.moveTo(14*g,a.height-3*g),i.lineTo(14*g,a.height-5*g),i.stroke(),i.fillText("reset",8.2*g,a.height-1.3*g),i.fillText("cut",8.2*g,a.height-2.3*g),i.fillText("norm(y)",8.2*g,a.height-3.3*g),i.fillText("y-c",8.2*g,a.height-4.3*g),i.fillText("x-c",10.2*g,a.height-4.3*g),i.fillText("smooth",8.2*g,a.height-5.3*g),i.fillText("interpolate",8.2*g,a.height-6.3*g),i.fillText("-(mx+c)",8.2*g,a.height-7.3*g),i.fillText("dy/dx",8.2*g,a.height-8.3*g),i.fillText("ln x",8.2*g,a.height-9.3*g),i.fillText("e^x",10.2*g,a.height-9.3*g),i.fillText("log x",8.2*g,a.height-10.3*g),i.fillText("10^x",10.2*g,a.height-10.3*g),i.fillText("10x",8.2*g,a.height-11.3*g),i.fillText("x/10",10.2*g,a.height-11.3*g),i.fillText("-x",8.2*g,a.height-12.3*g),i.fillText("1/x",10.2*g,a.height-12.3*g),i.fillText("x<->y",12.2*g,a.height-1.3*g),i.fillText("trim",12.2*g,a.height-2.3*g),i.fillText("x^n",12.2*g,a.height-3.3*g),i.fillText("y^n",14.2*g,a.height-3.3*g),i.fillText("rt x",12.2*g,a.height-4.3*g),i.fillText("rt y",14.2*g,a.height-4.3*g),i.fillText("sum",12.2*g,a.height-5.3*g),i.fillText("jitter(y)",12.2*g,a.height-6.3*g),i.fillText("Hist",12.2*g,a.height-7.3*g),i.fillText("Intergrate",12.2*g,a.height-8.3*g),i.fillText("ln y",12.2*g,a.height-9.3*g),i.fillText("e^y",14.2*g,a.height-9.3*g),i.fillText("log y",12.2*g,a.height-10.3*g),i.fillText("10^y",14.2*g,a.height-10.3*g),i.fillText("10y",12.2*g,a.height-11.3*g),i.fillText("y/10",14.2*g,a.height-11.3*g),i.fillText("-y",12.2*g,a.height-12.3*g),i.fillText("1/y",14.2*g,a.height-12.3*g),i.fillText("pop",12.2*g,a.height-.3*g),i.fillText("y vs y",8.2*g,a.height-13.3*g),i.fillText("sub fit",16.2*g,a.height-13.3*g),i.fillText("rmv outliers",16.2*g,a.height-12.3*g),i.fillText("keep outliers",16.2*g,a.height-11.3*g),i.fillText("custom y=f(x,y)",16.2*g,a.height-10.3*g),i.fillText("(y - mean)/sigma",16.2*g,a.height-2.3*g),i.fillText("x spacing",16.2*g,a.height-1.3*g),i.fillText("time->number",16.2*g,a.height-.3*g)}else t.drawfxmenu=!1;if(t.drawtimemenu)if(t.drawfxmenu=!1,o>10*g&&20*g>o&&r>a.height-6*g){i.fillStyle=s.color_bg,i.beginPath(),i.rect(10*g,a.height-6*g,10*g,6*g),i.fill(),i.stroke(),i.beginPath(),i.fillStyle=s.color_fg,i.fillText("time->number",10.2*g,a.height-.3*g);for(var F=[["days","hours","mins","sec"],["now","ago","start","end"]],S=10.2*g,A=2*g,P=a.height-3.3*g,q=g,x=0;2>x;x++)for(var C=0;4>C;C++){var E=F[x][C];E=t.timemenuoptions[x]==C?"["+E+"]":" "+E+" ",i.fillText(E,S+C*A,P-x*q)}i.fillText("Pick reference and unit",S,P-2*q),i.fillText("apply on x",S,P+2*q),i.fillText("apply on y",S+3*A,P+2*q)}else t.drawtimemenu=!1;if(t.drawlinemenu){for(var L=t.data_backup.length,x=0;L>x;x++)s.hidden_lines[x]=s.hidden_lines[x]||!1;var O=s.function_lines.length;if(o>11*g&&21*g>o&&r>a.height-g*(L+O+2)){i.fillStyle=s.color_bg,i.rect(11*g,a.height-g*(L+O+2),10*g,g*(L+O+2)),i.fill(),i.stroke(),i.beginPath(),i.moveTo(11*g,a.height-g),i.lineTo(21*g,a.height-g),i.moveTo(11*g,a.height-g*(L+1)),i.lineTo(21*g,a.height-g*(L+1)),i.stroke(),i.fillStyle=s.color_fg,i.fillText("line menu",11.2*g+.2,a.height-.2*g);for(var P=a.height-L*g-.2*g,S=13.2*g+.2,x=0;O>x;x++)P-=g,i.fillText(s.function_lines[x],S,P),i.fillText("(-) ",11.2*g+.2,P);P-=g,i.fillText("new function line",S,P);for(var x=L-1;x+1>0;x--){var E=t.captions_backup[x]||"label";i.fillStyle=t.colors_backup[x],i.fillText(E,13.2*g+.2,a.height-L*g+g*(x-.2)),s.hidden_lines[x]?i.fillText("( )",11.2*g+.2,a.height-L*g+g*(x-.2)):i.fillText("(+)",11.2*g+.2,a.height-L*g+g*(x-.2))}i.fillStyle=s.color_fg,i.fillText("all",15.2*g+.2,a.height-.2*g),i.fillText("none",17.2*g+.2,a.height-.2*g)}else t.drawlinemenu=!1}if(t.drawfitsmenu)if(o>15*g&&21*g>o&&r>a.height-10*g){i.fillStyle=s.color_bg,i.rect(15*g,a.height-10*g,6*g,10*g),i.fill(),i.stroke(),i.beginPath(),i.stroke(),i.fillStyle=s.color_fg;var E="";E=s.extrapolate?"(+) extrapolate":"( ) extrapolate";var S=18.2*g,P=a.height-.3*g,I=g;i.fillText("none",S,P),P-=I,P-=I,i.fillText("stats",S,P),P-=I,i.fillText("ae^bx",S,P),P-=I,i.fillText("a+be^cx",S,P),P-=I,i.fillText("a+blnx",S,P),P-=I,i.fillText("ax^b",S,P),P-=I,i.fillText("a+bx^c",S,P),P-=I,i.fillText("gauss",S,P),P-=I,S=15.2*g,P=a.height-.3*g,i.fillText("fits",S,P),P-=I,i.fillText(E,S,P),P-=I,i.fillText("y=c",S,P),P-=I,i.fillText("linear",S,P),P-=I,i.fillText("quad",S,P),P-=I,i.fillText("cubic",S,P),P-=I,i.fillText("poly 4",S,P),P-=I,i.fillText("poly 5",S,P),P-=I,i.fillText("poly 6",S,P),P-=I,i.fillText("poly 7",S,P),P-=I}else t.drawfitsmenu=!1;if(!t.ui.touch||!t.ui.is_touching||"zoom"!==s.mouse_mode&&"drag"!==s.mouse_mode||t.drawxmenu||t.drawymenu||(i.fillStyle=s.color_bg,i.rect(0,a.height-2*g,4*g,g),i.fill(),i.stroke(),"zoom"===s.mouse_mode&&(i.rect(0,a.height-3*g,4*g,g),i.fill(),i.stroke()),i.fillStyle=s.color_fg,i.fillText("Auto Zoom",.2*g,a.height-1.3*g),"zoom"===s.mouse_mode&&i.fillText("Zoom out",.2*g,a.height-2.3*g)),t.ui.touch&&t.ui.is_touching){var N=i.getImageData(o-2*g,r-2*g,4*g,4*g);i.beginPath(),i.moveTo(o,r),i.lineTo(a.width/2,a.height/2),i.stroke(),i.rect(a.width/2-2*g-2,a.height/2-2*g-2,4*g+4,4*g+4),i.stroke(),i.putImageData(N,a.width/2-2*g,a.height/2-2*g),i.beginPath(),i.arc(a.width/2,a.height/2,g/2,0,2*Math.PI,!0),i.stroke()}}if(i.beginPath(),i.stroke(),mouse_down&&"zoom"===s.mouse_mode&&(end_x=o,end_y=r,i.beginPath(),i.rect(start_x+1,start_y+1,end_x-start_x-1,end_y-start_y-1),i.moveTo(start_x,0),i.lineTo(start_x,2*g),i.moveTo(start_x,a.height),i.lineTo(start_x,a.height-2*g),i.moveTo(end_x,a.height),i.lineTo(end_x,a.height-2*g),i.moveTo(end_x,0),i.lineTo(end_x,2*g),i.moveTo(0,start_y),i.lineTo(2*g,start_y),i.moveTo(a.width-2*g,start_y),i.lineTo(a.width,start_y),i.moveTo(0,end_y),i.lineTo(2*g,end_y),i.moveTo(a.width-2*g,end_y),i.lineTo(a.width,end_y),i.stroke(),i.beginPath(),i.stroke()),mouse_down&&"drag"===s.mouse_mode&&(t.ui.is_touching?(is_touch_dragging=!0,start_x=.5*(touch_start_x[0]+touch_start_x[1]),start_y=.5*(touch_start_y[0]+touch_start_y[1]),end_x=.5*(touch_x[0]+touch_x[1]),end_y=.5*(touch_y[0]+touch_y[1]),scale_x=(touch_x[0]-touch_x[1])/(touch_start_x[0]-touch_start_x[1]),scale_y=(touch_y[0]-touch_y[1])/(touch_start_y[0]-touch_start_y[1]),scale_x=trim(Math.abs(scale_x),.1,10),scale_y=trim(Math.abs(scale_y),.1,10),i.putImageData(t.graph_image_for_drag,0,0),i.save(),i.translate(start_x,start_y),i.scale(scale_x,scale_y),i.translate((end_x-start_x)/scale_x,(end_y-start_y)/scale_y),i.drawImage(a,-start_x,-start_y),i.restore()):(end_x=o,end_y=r,i.fillStyle=s.color_bg,i.fillRect(0,0,a.width,a.height),i.putImageData(t.graph_image_for_drag,end_x-start_x,end_y-start_y))),mouse_down&&"measure"===s.mouse_mode){if(i.beginPath(),i.moveTo(start_x,start_y),i.lineTo(o,r),i.stroke(),dx=o-start_x,z=r-start_y,_=t.pixels_to_units(o,"x"),l=t.pixels_to_units(r,"y"),px_start=t.pixels_to_units(start_x,"x"),py_start=t.pixels_to_units(start_y,"y"),E=t.get_axis_string(_,"x"),i.fillText(E,o+h,a.height-1.5*g),E=t.get_axis_string(l,"y"),i.fillText(E,2*g,r-2*h),i.beginPath(),i.moveTo(o,a.height),i.lineTo(o,a.height-1.5*g),i.moveTo(o,0),i.lineTo(o,2*g),i.moveTo(0,r),i.lineTo(2*g,r),i.moveTo(a.width,r),i.lineTo(a.width-2*g,r),i.stroke(),i.beginPath(),i.stroke(),E=t.get_axis_string(px_start,"x"),i.fillText(E,start_x+h,a.height-2*g),E=t.get_axis_string(py_start,"y"),i.fillText(E,2*g,start_y-2*h),i.beginPath(),i.moveTo(start_x,a.height),i.lineTo(start_x,a.height-2*g),i.moveTo(start_x,0),i.lineTo(start_x,2*g),i.moveTo(0,start_y),i.lineTo(2*g,start_y),i.moveTo(a.width,start_y),i.lineTo(a.width-2*g,start_y),i.stroke(),i.beginPath(),i.stroke(),(dx>g/2||dx<-g/2)&&(x_meas=Math.min(r,start_y)-g,i.beginPath(),i.moveTo(o,x_meas-.3*g),i.lineTo(o,x_meas+.3*g),i.moveTo(start_x,x_meas-.3*g),i.lineTo(start_x,x_meas+.3*g),i.moveTo(o,x_meas),i.lineTo(start_x,x_meas),i.stroke(),E="time"===s.x_scale_mode?mjs_time_difference_print(_-px_start):t.get_axis_string(_-px_start,"x"),i.fillText(E,(o+start_x)/2-.3*s.scaling_factor*s.axis_labels_font_size*E.length,x_meas-.4*s.axis_labels_font_size)),(z>g/2||-g/2>z)&&(y_meas=Math.min(o,start_x)-g,E="time"===s.y_scale_mode?mjs_time_difference_print(l-py_start):t.get_axis_string(l-py_start,"y"),label_pos=y_meas-.7*s.axis_labels_font_size*s.scaling_factor*E.length,i.beginPath(),i.moveTo(y_meas-.3*g,r),i.lineTo(y_meas+.3*g,r),i.moveTo(y_meas-.3*g,start_y),i.lineTo(y_meas+.3*g,start_y),i.moveTo(y_meas,r),i.lineTo(y_meas,start_y),i.stroke(),i.fillText(E,label_pos,(r+start_y)/2)),(dx>g/2||dx<-g/2)&&(z>g/2||-g/2>z)){grad=(l-py_start)/(_-px_start);
var W="";if("lin"!==s.y_scale_mode&&"log"!==s.y_scale_mode||"time"!==s.x_scale_mode?grad=mjs_precision(grad,Math.min(s.y_precision,s.x_precision)):(W="/ms",Math.abs(grad)<1&&(grad*=1e3,W="/s"),Math.abs(grad)<1&&(grad*=60,W="/m"),Math.abs(grad)<1&&(grad*=60,W="/h"),Math.abs(grad)<1&&(grad*=24,W="/d"),grad=mjs_precision(grad,5)),i.fillText("g = "+grad+W,o+h,r-h),"log"===s.y_scale_mode&&("lin"===s.x_scale_mode||"time"===s.x_scale_mode)){var R=(Math.log10(l)-Math.log10(py_start))/(_-px_start);"time"===s.x_scale_mode?(W="/ms",Math.abs(R)<1&&(R*=1e3,W="/s"),Math.abs(R)<1&&(R*=60,W="/m"),Math.abs(R)<1&&(R*=60,W="/h"),Math.abs(R)<1&&(R*=24,W="/d"),R=mjs_precision(R,5)):(W="",R=mjs_precision(R,Math.min(s.y_precision,s.x_precision))),i.fillText("tau ="+R+W,o+h,r+h);var J=Math.ceil(Math.max(dx,z)/4);i.beginPath();for(var U=0;J>U;U++){var M=t.units_to_pixels(py_start+U*(l-py_start)/J,"y"),k=t.units_to_pixels(px_start+U*(_-px_start)/J,"x");i.moveTo(k,M);var M=t.units_to_pixels(py_start+(U+1)*(l-py_start)/J,"y"),k=t.units_to_pixels(px_start+(U+1)*(_-px_start)/J,"x");i.lineTo(k,M)}i.stroke()}if("log"===s.y_scale_mode&&"log"===s.x_scale_mode){var Y=(Math.log10(l)-Math.log10(py_start))/(Math.log10(_)-Math.log10(px_start));Y=mjs_precision(Y,Math.min(s.y_precision,s.x_precision)),i.fillText("p ="+Y,o+h,r+h);var J=Math.ceil(Math.max(dx,z)/2);i.beginPath();for(var M=0,k=0,U=0;J>U;U++)k=Math.exp(Math.log(px_start)+U*(Math.log(_)-Math.log(px_start))/J),M=(k-px_start)*grad+py_start,k=t.units_to_pixels(k,"x"),M=t.units_to_pixels(M,"y"),i.moveTo(k,M),k=Math.exp(Math.log(px_start)+(U+1)*(Math.log(_)-Math.log(px_start))/J),M=(k-px_start)*grad+py_start,k=t.units_to_pixels(k,"x"),M=t.units_to_pixels(M,"y"),i.lineTo(k,M);i.stroke()}}i.beginPath(),i.stroke()}if(mouse_down&&"trim"===s.mouse_mode&&(end_x=o,end_y=r,i.beginPath(),i.rect(start_x,start_y,end_x-start_x,end_y-start_y),i.stroke(),i.beginPath(),i.stroke()),mouse_down&&"cut"===s.mouse_mode&&(end_x=o,end_y=r,i.beginPath(),i.rect(start_x,start_y,end_x-start_x,end_y-start_y),i.stroke(),i.beginPath(),i.stroke()),mouse_down&&"x-c"===s.mouse_mode&&(E=mjs_precision(_,s.y_precision+1),i.fillText("x-"+E,o+2*h,r-2*h),i.beginPath(),i.moveTo(o,0),i.lineTo(o,a.height),i.stroke(),i.beginPath(),i.stroke()),mouse_down&&"y-c"===s.mouse_mode&&(E=mjs_precision(l,s.y_precision+1),i.fillText("y-"+E,o+2*h,r-2*h),i.beginPath(),i.moveTo(0,r),i.lineTo(a.width,r),i.stroke(),i.beginPath(),i.stroke()),mouse_down&&"sublin"===s.mouse_mode&&(i.fillText("draw line to subtract",o+2*h,r-2*h),i.beginPath(),i.moveTo(start_x,start_y),i.lineTo(o,r),i.stroke(),i.beginPath(),i.stroke()),mouse_down&&"mouse"===s.mouse_mode){t.ui.mouse_is_dragging=!1;var B=Math.sqrt(Math.pow(start_x-s.fit_text_position.x*a.width,2)+Math.pow(start_y-s.fit_text_position.y*a.height,2));if(2*h>B)return i.beginPath(),i.moveTo(start_x,start_y),i.lineTo(o,r),i.stroke(),t.ui.mouse_is_dragging=!0,void(t.ui.drag_object="fit_text");if(B=Math.sqrt(Math.pow(start_x-a.width/2,2)+Math.pow(start_y-(s.tick_len+s.title_spacing+s.title_font_size)*s.scaling_factor,2)),2*h>B)return i.beginPath(),i.moveTo(a.width/2,start_y),i.lineTo(a.width/2,r),i.stroke(),t.ui.mouse_is_dragging=!0,void(t.ui.drag_object="title_spacing");var w=s.scaling_factor*s.caption_position.x;if(s.caption_position.x>0?w+=s.scaling_factor*s.tick_len:(w=a.width+w,w-=s.scaling_factor*s.tick_len),cap_y=s.scaling_factor*s.caption_position.y,s.caption_position.y>0?cap_y+=s.scaling_factor*s.tick_len:(cap_y=a.height+cap_y,cap_y-=s.scaling_factor*s.tick_len),B=Math.sqrt(Math.pow(start_x-w,2)+Math.pow(start_y-cap_y,2)),2*h>B){i.beginPath(),i.moveTo(start_x,start_y),i.lineTo(o,r),i.stroke();var G=2*h;return i.beginPath(),o>a.width/2&&r>a.height/2&&(i.moveTo(o-G,r),i.lineTo(o,r),i.lineTo(o,r-G)),o>a.width/2&&r<a.height/2&&(i.moveTo(o-G,r),i.lineTo(o,r),i.lineTo(o,r+G)),o<a.width/2&&r>a.height/2&&(i.moveTo(o+G,r),i.lineTo(o,r),i.lineTo(o,r-G)),o<a.width/2&&r<a.height/2&&(i.moveTo(o+G,r),i.lineTo(o,r),i.lineTo(o,r+G)),i.stroke(),t.ui.mouse_is_dragging=!0,void(t.ui.drag_object="caption_position")}}}function mouse_down_event(e,t){mouse_down=!0;var a=t.canvas,i=(a.getContext("2d"),a.getBoundingClientRect());start_x=e.clientX-i.left,start_y=e.clientY-i.top,drag_x_max=t.pixels_to_units(a.width,"x"),drag_x_min=t.pixels_to_units(0,"x"),drag_y_max=t.pixels_to_units(0,"y"),drag_y_min=t.pixels_to_units(a.height,"y")}function mouse_out_event(e,t){var a=t.canvas,i=a.getContext("2d");i.putImageData(t.graph_image,0,0),t.drawfxmenu=!1,t.drawlinemenu=!1,t.drawmodemenu=!1,t.drawfitsmenu=!1,t.drawtimemenu=!1,t.drawgraphmenu=!1,t.drawcaptionmenu=!1,t.drawxmenu=!1,t.drawymenu=!1,1==t.graphics_style.o&&(t.graphics_style.mouse_mode=t.pre_mouse_mode,t.graphics_style.o=0)}function keypress_event(e){console.log("in keypress");var t=String.fromCharCode(e.keyCode||e.charCode);console.log(t),console.log("in keypress")}function mouse_up_event(event,graph){"use strict";var canvas=graph.canvas,gs=graph.graphics_style,ctx=canvas.getContext("2d");mouse_down=!1;var rect=canvas.getBoundingClientRect(),end_x=event.clientX-rect.left,end_y=event.clientY-rect.top,no_drag_size=gs.tick_len,edge=graph.ui.size;if(gs.o>=1){var s=graph.ui.s,names=["scale width x","scale width y","symbol size","line thickness","tick length","minor tick length","title font size","ticks font size","axis font size","title spacing","tick padding","label spacing","graph line thickness"],values=["guideWidthx","guideWidthy","symbol_size","line_thickness","tick_len","minor_tick_len","title_font_size","tick_labels_font_size","axis_labels_font_size","title_spacing","tick_lables_font_padding","lable_spacing","graph_line_thickness"],item=Math.ceil((end_y-s)/(1.2*s)),button=Math.ceil((end_x-s)/s)-1,speed=1.1;if(button>=1)var scale=1/speed;else var scale=speed;console.log(names[item]),item>=0&&item<values.length&&eval("graph.graphics_style."+values[item]+"*="+scale),item-=values.length;var strings=["font_name","title","subtitle","subtitle2","x_axis_title","y_axis_title","color_fg","color_bg","color_mg"],string_names=["font","title","subtitle","subtitle2","x-axis","y-axis","fg color","bg color","mg color"];if(item>=0&&item<strings.length){var name=string_names[item],old_item=eval("graph.graphics_style."+strings[item]);eval("graph.graphics_style."+strings[item]+'= prompt("new '+name+'", "'+old_item+'") || "'+old_item+'"; '),("y-axis"===name||"x-axis"===name)&&graph.transform_index--}if(item-=strings.length,1==item){var temp=gs.o;graph.graphics_style=JSON.parse(JSON.stringify(graph.default_graphics_style)),graph.graphics_style.modified=!1,graph.graphics_style.o=temp,console.log("doing reset"),graph.transform_index=-1}return item--,1==item&&(graph.graphics_style.o=0,console.log("menu exit")),graph.mjs_plot(),void mouse_move_event(event,graph)}if("zoom"===gs.mouse_mode&&Math.abs(start_x-end_x)>no_drag_size&&Math.abs(start_y-end_y)>no_drag_size)return console.log("mouse zoom"),start_x=graph.pixels_to_units(start_x,"x"),start_y=graph.pixels_to_units(start_y,"y"),end_x=graph.pixels_to_units(end_x,"x"),end_y=graph.pixels_to_units(end_y,"y"),gs.x_manual_min=Math.min(start_x,end_x),gs.x_manual_max=Math.max(start_x,end_x),gs.y_manual_min=Math.min(start_y,end_y),gs.y_manual_max=Math.max(start_y,end_y),gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!0,gs.x_scale_tight=!0,void graph.mjs_plot();if(graph.ui.touch&&("zoom"===gs.mouse_mode||"drag"===gs.mouse_mode)&&4*edge>end_x&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(gs.y_scale_auto_min=!0,gs.y_scale_tight=!1,gs.y_scale_auto_max=!0,gs.y_scale_tight=!1,gs.x_scale_auto_min=!0,gs.x_scale_tight=!1,gs.x_scale_auto_max=!0,gs.x_scale_tight=!1),graph.ui.touch&&"zoom"===gs.mouse_mode&&4*edge>end_x&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(event.button=2),graph.drawcaptionmenu){var lx=Math.floor((canvas.width-end_x)/2/edge),ly=Math.floor(end_y/edge);if(graph.drawcaptionmenu=!1,1==ly&&(gs.show_captions=!gs.show_captions),7==ly&&(gs.captions_display="none"),1==lx)switch(ly){case 3:gs.captions_display="xfirst";break;case 4:gs.captions_display="xlast";break;case 5:gs.captions_display="xmin";break;case 6:gs.captions_display="xmax"}if(0==lx)switch(ly){case 3:gs.captions_display="yfirst";break;case 4:gs.captions_display="ylast";break;case 5:gs.captions_display="ymin";break;case 6:gs.captions_display="ymax"}return ly>2&&7>ly&&(gs.show_captions=!0),graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(graph.drawxmenu){var lx=Math.floor(end_x/edge),ly=Math.floor((canvas.height-end_y)/edge);switch(console.log(lx),console.log(ly),ly){case 0:graph.drawxmenu=!1;break;case 1:if(8>lx)gs.x_scale_auto_min=!0,gs.x_scale_tight=!1;else if(gs.x_scale_auto_min=!1,"time"===gs.x_scale_mode){var d=new Date(gs.x_manual_min),r=Date.parse(prompt("new lowlimit",d.toISOString()));gs.x_manual_min=r||gs.x_manual_min}else gs.x_manual_min=parseFloat(prompt("new lowlimit",gs.x_manual_min))||gs.x_manual_min;break;case 2:if(8>lx)gs.x_scale_auto_max=!0,gs.x_scale_tight=!1;else if(gs.x_scale_auto_max=!1,"time"===gs.x_scale_mode){var d=new Date(gs.x_manual_max),r=Date.parse(prompt("new lowlimit",d.toISOString()));gs.x_manual_max=r||gs.x_manual_max}else gs.x_manual_max=parseFloat(prompt("new lowlimit",gs.x_manual_max))||gs.x_manual_max;break;case 3:gs.x_scale_mode=6>lx?"lin":lx>9?"time":"log";break;case 4:8>lx?gs.guideWidthx/=1.5:gs.guideWidthx*=1.5;break;case 5:gs.x_label_mode=6>lx?"norm":lx>=10?"sci":lx>=8?"postfix":"infix",console.log(gs.x_label_mode);break;case 6:gs.x_axis_prefix=prompt("new prefix",gs.x_axis_prefix)||"";break;case 7:gs.x_axis_postfix=prompt("new postfix",gs.x_axis_postfix)||"";break;case 8:gs.x_axis_title=prompt("new title",gs.x_axis_title)||"",graph.transform_index--}return graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(graph.drawymenu){var lx=Math.floor(end_x/edge)-2,ly=Math.floor((canvas.height-end_y)/edge);switch(console.log(lx),console.log(ly),ly){case 0:graph.drawymenu=!1;break;case 1:if(8>lx)gs.y_scale_auto_min=!0,gs.y_scale_tight=!1;else if(gs.y_scale_auto_min=!1,"time"===gs.y_scale_mode){var d=new Date(gs.y_manual_min),r=Date.parse(prompt("new lowlimit",d.toISOString()));gs.y_manual_min=r||gs.y_manual_min}else gs.y_manual_min=parseFloat(prompt("new lowlimit",gs.y_manual_min))||gs.y_manual_min;break;case 2:if(8>lx)gs.y_scale_auto_max=!0,gs.y_scale_tight=!1;else if(gs.y_scale_auto_max=!1,"time"===gs.y_scale_mode){var d=new Date(gs.y_manual_max),r=Date.parse(prompt("new lowlimit",d.toISOString()));gs.y_manual_max=r||gs.y_manual_max}else gs.y_manual_max=parseFloat(prompt("new lowlimit",gs.y_manual_max))||gs.y_manual_max;break;case 3:gs.y_scale_mode=6>lx?"lin":lx>9?"time":"log";break;case 4:8>lx?gs.guideWidthy/=1.5:gs.guideWidthy*=1.5;break;case 5:gs.y_label_mode=6>lx?"norm":lx>=10?"sci":lx>=8?"postfix":"infix",console.log(gs.y_label_mode);break;case 6:gs.y_axis_prefix=prompt("new prefix",gs.y_axis_prefix)||"";break;case 7:gs.y_axis_postfix=prompt("new postfix",gs.y_axis_postfix)||"";break;case 8:gs.y_axis_title=prompt("new title",gs.y_axis_title)||"",graph.transform_index--}return graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(graph.drawmodemenu){var lx=Math.floor(end_x/edge),ly=Math.floor(end_y/edge);if(0==ly&&(graph.drawmodemenu=!1),1==ly)switch(lx){case 0:gs.symbol_size*=1.2;break;case 1:gs.symbol_size/=1.2;break;case 2:gs.symbol_mode="none";break;case 3:gs.symbol_mode="dot";break;case 4:gs.symbol_mode="cdot";break;case 5:gs.symbol_mode="box";break;case 6:gs.symbol_mode="circ";break;case 7:gs.symbol_mode="x";break;case 8:gs.symbol_mode="cross"}if(2==ly)switch(lx){case 0:gs.line_thickness*=1.2;break;case 1:gs.line_thickness/=1.2;break;case 2:gs.line_mode="none";break;case 3:gs.line_mode="line";break;case 4:gs.line_mode="approx";break;case 5:gs.line_mode="interp";break;case 6:gs.line_mode="zig";break;case 7:gs.line_mode="zag";break;case 8:gs.line_mode="mid";break;case 9:gs.line_mode="hist"}return graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(graph.drawgraphmenu){var ly=Math.floor(end_y/edge);switch(ly){case 0:graph.drawgraphmenu=!1;break;case 1:gs.title=prompt("new title",gs.title)||gs.title;break;case 2:gs.subtitle=prompt("new subtitle",gs.subtitle)||gs.subtitle;break;case 3:gs.subtitle2=prompt("new subtitle",gs.subtitle2)||gs.subtitle2;break;case 4:gs.showTransformTexts=!gs.showTransformTexts;break;case 5:gs.x_axis_title=prompt("new x axis title",gs.x_axis_title)||gs.x_axis_title,graph.transform_index--;break;case 6:gs.y_axis_title=prompt("new y axis title",gs.y_axis_title)||gs.y_axis_title,graph.transform_index--;break;case 7:gs.scaling_factor/=1.1;break;case 8:gs.scaling_factor*=1.1;break;case 9:graph.graphics_style=JSON.parse(JSON.stringify(graph.default_graphics_style)),graph.graphics_style.modified=!1,graph.transform_index=-1}return graph.mjs_plot(),void setTimeout(function(){mouse_move_event(event,graph)},0)}if(edge>end_y)return 4*edge>end_x&&(graph.drawmodemenu=!0),end_x>4*edge&&8*edge>end_x&&(graph.drawgraphmenu=!0),10*edge>end_x&&end_x>9*edge?(gs.mouse_mode="drag",graph.needs_drag_image=!0,graph.mjs_plot(),void mouse_move_event(event,graph)):11*edge>end_x&&end_x>10*edge?(gs.mouse_mode="zoom",void mouse_move_event(event,graph)):12*edge>end_x&&end_x>11*edge?(gs.mouse_mode="measure",void mouse_move_event(event,graph)):13*edge>end_x&&end_x>12*edge?(gs.mouse_mode="reader",void mouse_move_event(event,graph)):14*edge>end_x&&end_x>13*edge?(gs.mouse_mode="mouse",void mouse_move_event(event,graph)):(end_x<canvas.width&&end_x>canvas.width-edge&&(graph.drawcaptionmenu=!0),end_x<canvas.width-edge&&end_x>canvas.width-2*edge&&(gs.i=(gs.i+1)%2,gs.o=0),end_x<canvas.width-2*edge&&end_x>canvas.width-3*edge&&(gs.o=(gs.o+1)%2,graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="options",gs.i=0),graph.mjs_plot(),void mouse_move_event(event,graph));if(graph.drawtimemenu){for(var lx=10*edge,ldx=2*edge,ly=canvas.height-3*edge,ldy=edge,i=0;2>i;i++)if(end_y>ly-(i+1)*ldy&&ly-i*ldy>end_y&&end_x>lx&&lx+4*ldx>end_x)for(var j=0;4>j;j++){var selected=end_x>lx+j*ldx&&lx+(j+1)*ldx>end_x;selected&&(graph.timemenuoptions[i]=j)}if(ly+2*ldy>end_y&&end_y>ly+1*ldy&&end_x>lx&&lx+3*ldx>end_x){console.log("apply button");var n=gs.data_transforms.length;gs.data_transforms[n]="time_to_num",gs.x_scale_mode="lin";var now=new Date;gs.data_transforms_args[n]=[graph.timemenuoptions[1],graph.timemenuoptions[0],"x",now.getTime()],graph.drawtimemenu=!1,graph.mjs_plot()}if(ly+2*ldy>end_y&&end_y>ly+1*ldy&&end_x>lx+3*ldx&&lx+6*ldx>end_x){console.log("apply button");var n=gs.data_transforms.length;gs.data_transforms[n]="time_to_num",gs.y_scale_mode="lin";var now=new Date;gs.data_transforms_args[n]=[graph.timemenuoptions[1],graph.timemenuoptions[0],"y",now.getTime()],graph.drawtimemenu=!1,graph.mjs_plot()}return void mouse_move_event(event,graph)}if(graph.drawfxmenu){var n=gs.data_transforms.length;if(12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-edge)return graph.drawfxmenu=!1,void mouse_move_event(event,graph);if(12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(console.log("resetbutton"),graph.graphics_style.data_transforms=[],graph.graphics_style.data_transforms_args=[],"hist dot"===gs.mode&&(gs.mode="line dot")),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-1*edge&&(console.log("pop"),gs.data_transforms.pop(),gs.data_transforms_args.pop()),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-14*edge&&end_y<canvas.height-13*edge&&(console.log("y vs y"),"y_vs_y"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]+=1,graph.transform_index--):(gs.data_transforms[n]="y_vs_y",gs.data_transforms_args[n]=[1])),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(console.log("cut button"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="cut",graph.drawfxmenu=!1),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge&&(console.log("normalise"),"normalise"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="normalise",gs.data_transforms_args[n]=[0]),gs.y_scale_auto_min=!0,gs.y_scale_auto_max=!0),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&(console.log("y-c"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="y-c",graph.drawfxmenu=!1),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&(console.log("x-c"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="x-c",graph.drawfxmenu=!1),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&(console.log("smooth"),"smooth"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]=1.467799*gs.data_transforms_args[n-1][0],graph.transform_index--):(gs.data_transforms[n]="smooth",gs.data_transforms_args[n]=[2.1544339])),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&(console.log("interpolate"),"interpolate"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]*=2,graph.transform_index--):(gs.data_transforms[n]="interpolate",gs.data_transforms_args[n]=[20])),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&(console.log("-baseline"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="sublin",graph.drawfxmenu=!1),12*edge>end_x&&end_x>8*edge&&end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&(console.log("dy/dx"),gs.data_transforms[n]="differentiate",gs.data_transforms_args[n]=[0],gs.y_scale_auto_min=!0,gs.y_scale_auto_max=!0),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("ex"),"ln_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="e_to_x",gs.data_transforms_args[n]=[0])),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("lnx"),"e_to_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="ln_x",gs.data_transforms_args[n]=[0])),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("10^x"),"log_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="ten_to_x",gs.data_transforms_args[n]=[0])),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("logx"),"ten_to_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="log_x",gs.data_transforms_args[n]=[0])),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("x/10"),"scale_x"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=.1,graph.transform_index--):(gs.data_transforms[n]="scale_x",gs.data_transforms_args[n]=[.1]),gs.x_manual_min*=.1,gs.x_manual_max*=.1),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("10x"),"scale_x"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=10,graph.transform_index--):(gs.data_transforms[n]="scale_x",gs.data_transforms_args[n]=[10]),gs.x_manual_min*=10,gs.x_manual_max*=10),12*edge>end_x&&end_x>10*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge&&(console.log("1/x"),"one_over_x"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="one_over_x",gs.data_transforms_args[n]=[])),10*edge>end_x&&end_x>8*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge){console.log("-x"),"scale_x"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=-1,graph.transform_index--):(gs.data_transforms[n]="scale_x",gs.data_transforms_args[n]=[-1]);var oldmin=-1*gs.x_manual_min,oldmax=-1*gs.x_manual_max;gs.x_manual_min=Math.min(oldmin,oldmax),gs.x_manual_max=Math.max(oldmin,oldmax)}if(16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge){console.log("x<->y"),"swap_x_y"==gs.data_transforms[n-1]?(console.log("undoing swap"),gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="swap_x_y",gs.data_transforms_args[n]=[]);var temp=gs.x_manual_min;gs.x_manual_min=gs.y_manual_min,gs.y_manual_min=temp,temp=gs.x_manual_max,gs.x_manual_max=gs.y_manual_max,gs.y_manual_max=temp,temp=gs.x_scale_mode,gs.x_scale_mode=gs.y_scale_mode,gs.y_scale_mode=temp,temp=gs.x_axis_prefix,gs.x_axis_prefix=gs.y_axis_prefix,gs.y_axis_prefix=temp,temp=gs.x_axis_postfix,gs.x_axis_postfix=gs.y_axis_postfix,gs.y_axis_postfix=temp,temp=gs.x_label_mode,gs.x_label_mode=gs.y_label_mode,gs.y_label_mode=temp}if(16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(console.log("trim"),graph.pre_mouse_mode=gs.mouse_mode,gs.mouse_mode="trim",graph.drawfxmenu=!1),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge)if(console.log("y^(n)"),"y_pow_n"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];gs.y_manual_min=Math.pow(gs.y_manual_min,pwr/(pwr-1)),gs.y_manual_max=Math.pow(gs.y_manual_max,pwr/(pwr-1)),graph.transform_index--}else gs.data_transforms[n]="y_pow_n",gs.data_transforms_args[n]=[2],gs.y_manual_min=Math.pow(gs.y_manual_min,2),gs.y_manual_max=Math.pow(gs.y_manual_max,2);if(14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge)if(console.log("x^(n)"),"x_pow_n"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];gs.x_manual_min=Math.pow(gs.x_manual_min,pwr/(pwr-1)),gs.x_manual_max=Math.pow(gs.x_manual_max,pwr/(pwr-1)),graph.transform_index--}else gs.data_transforms[n]="x_pow_n",gs.data_transforms_args[n]=[2],gs.x_manual_min=Math.pow(gs.x_manual_min,2),gs.x_manual_max=Math.pow(gs.x_manual_max,2);if(16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge){if(console.log("sqrty"),"y_nth_root"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];graph.transform_index--}else{gs.data_transforms[n]="y_nth_root",gs.data_transforms_args[n]=[2];var pwr=2}var rtmin=Math.pow(Math.abs(gs.y_manual_min),.5),rtmax=Math.pow(Math.abs(gs.y_manual_max),.5);if(gs.y_manual_min<0&&gs.y_manual_max>0)var make_zero=0;else make_zero=1;gs.y_manual_min=Math.min(rtmin,rtmax)*make_zero,gs.y_manual_max=Math.max(rtmin,rtmax)}if(14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge){if(console.log("sqrtx"),"x_nth_root"==gs.data_transforms[n-1]){console.log("incresing power"),gs.data_transforms_args[n-1][0]+=1;var pwr=gs.data_transforms_args[n-1][0];graph.transform_index--}else{gs.data_transforms[n]="x_nth_root",gs.data_transforms_args[n]=[2];var pwr=2}var rtmin=Math.pow(Math.abs(gs.x_manual_min),.5),rtmax=Math.pow(Math.abs(gs.x_manual_max),.5);if(gs.x_manual_min<0&&gs.x_manual_max>0)var make_zero=0;else make_zero=1;gs.x_manual_min=Math.min(rtmin,rtmax)*make_zero,gs.x_manual_max=Math.max(rtmin,rtmax)}if(16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&console.log("B-A"),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&(console.log("sum"),gs.data_transforms[n]="sum",gs.data_transforms_args[n]=[]),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&(console.log("Jitter"),"jitter"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][0]+=1,graph.transform_index--):(gs.data_transforms[n]="jitter",gs.data_transforms_args[n]=[1])),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&(console.log("Hist"),gs.data_transforms[n]="hist",gs.data_transforms_args[n]=[0],gs.x_scale_auto_max=!0,gs.x_scale_auto_min=!0,gs.y_scale_auto_max=!0,gs.y_scale_auto_min=!0,gs.x_scale_mode="lin",gs.y_scale_mode="lin",gs.mode="hist dot"),16*edge>end_x&&end_x>12*edge&&end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&(console.log("Intergrate"),gs.data_transforms[n]="intergrate",gs.data_transforms_args[n]=[0],gs.y_scale_auto_min=!0,gs.y_scale_auto_max=!0),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("ey"),gs.data_transforms[n]="e_to_y",gs.data_transforms_args[n]=[0]),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&(console.log("lny"),gs.data_transforms[n]="ln_y",gs.data_transforms_args[n]=[0]),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("10^y"),gs.data_transforms[n]="ten_to_y",gs.data_transforms_args[n]=[0]),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge&&(console.log("logy"),gs.data_transforms[n]="log_y",gs.data_transforms_args[n]=[0]),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("y/10"),"scale_y"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=.1,graph.transform_index--):(gs.data_transforms[n]="scale_y",gs.data_transforms_args[n]=[.1])),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("10y"),"scale_y"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=10,graph.transform_index--):(gs.data_transforms[n]="scale_y",gs.data_transforms_args[n]=[10])),16*edge>end_x&&end_x>14*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge&&(console.log("1/y"),"one_over_y"==gs.data_transforms[n-1]?(gs.data_transforms.pop(),gs.data_transforms_args.pop()):(gs.data_transforms[n]="one_over_y",gs.data_transforms_args[n]=[])),14*edge>end_x&&end_x>12*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge){console.log("-y"),"scale_y"==gs.data_transforms[n-1]?(console.log("incresing scaling"),gs.data_transforms_args[n-1][0]*=-1,graph.transform_index--):(gs.data_transforms[n]="scale_y",gs.data_transforms_args[n]=[-1]);var oldmin=-1*gs.y_manual_min,oldmax=-1*gs.y_manual_max;gs.y_manual_min=Math.min(oldmin,oldmax),gs.y_manual_max=Math.max(oldmin,oldmax)}if(22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-14*edge&&end_y<canvas.height-13*edge&&(console.log("subtract trend"),fits.fit_strings.indexOf(gs.fits)>-1?(gs.data_transforms[n]="subtract_fit",gs.data_transforms_args[n]=[gs.fits],gs.fits="none"):graph.errors.push("No fit chosen")),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-13*edge&&end_y<canvas.height-12*edge&&(console.log("subtract trend"),"remove_outliers"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][1]-=1,graph.transform_index--):fits.fit_strings.indexOf(gs.fits)>-1?(gs.data_transforms[n]="remove_outliers",gs.data_transforms_args[n]=[gs.fits,5],gs.fits="old"):graph.errors.push("No fit chosen")),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-12*edge&&end_y<canvas.height-11*edge&&(console.log("subtract trend"),"keep_outliers"==gs.data_transforms[n-1]?(gs.data_transforms_args[n-1][1]+=1,graph.transform_index--):fits.fit_strings.indexOf(gs.fits)>-1?(gs.data_transforms[n]="keep_outliers",gs.data_transforms_args[n]=[gs.fits,0],gs.fits="old"):graph.errors.push("No fit chosen")),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-11*edge&&end_y<canvas.height-10*edge){console.log("custom button");var f=prompt("y = f(x,y) =","y");f&&(gs.data_transforms[n]="custom_y",gs.data_transforms_args[n]=[f])}return 22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(console.log("x spacing"),gs.data_transforms[n]="spacing",gs.data_transforms_args[n]=[]),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&(console.log("mean_normalise"),gs.data_transforms[n]="mean_normalise",gs.data_transforms_args[n]=[]),22*edge>end_x&&end_x>16*edge&&end_y>canvas.height-1*edge&&end_y<canvas.height&&(console.log("time menu"),graph.drawtimemenu=!0,graph.drawfxmenu=!1),graph.mjs_plot(),void mouse_move_event(event,graph)}if(graph.drawlinemenu){if(15*edge>end_x&&end_x>11*edge&&end_y>canvas.height-edge)return graph.drawlinemenu=!1,void mouse_move_event(event,graph);if(20*edge>end_x&&end_x>11*edge&&end_y<canvas.height-edge){var no_of_lines=graph.data_backup.length,no_of_function_lines=gs.function_lines.length,item=Math.floor(no_of_lines+no_of_function_lines+1-((canvas.height-end_y)/edge-1));if(0==item){console.log("new function");var f;f="time"===gs.x_scale_mode?prompt("y = f(x)","cos(2*pi*x/1000/60/60/24)"):prompt("y = f(x)","x*x/2"),f&&gs.function_lines.push(f)}if(item-=1,no_of_function_lines>item&&item>=0&&13*edge>end_x&&(console.log("remove item "+item),gs.function_lines.splice(no_of_function_lines-item-1,1)),no_of_function_lines>item&&item>=0&&end_x>13*edge){console.log("edit item "+item);var f=prompt("y = f(x)",gs.function_lines[no_of_function_lines-item-1]);f&&(gs.function_lines[no_of_function_lines-item-1]=f)}item-=no_of_function_lines,item>=0&&(console.log("hideshow"+item),gs.hidden_lines[item]=!gs.hidden_lines[item])}if(17*edge>end_x&&end_x>15*edge&&end_y>canvas.height-edge){console.log("all");for(var k=0;k<gs.hidden_lines.length;k++)gs.hidden_lines[k]=!1}if(19*edge>end_x&&end_x>17*edge&&end_y>canvas.height-edge){console.log("non");for(var k=0;k<gs.hidden_lines.length;k++)gs.hidden_lines[k]=!0}return graph.transform_index--,graph.mjs_plot(),void mouse_move_event(event,graph)}if(graph.drawexportmenu){graph.drawexportmenu=!1,mouse_move_event(event,graph);var my=canvas.height,dy=edge;if(end_y>my-dy&&my>end_y)return;if(my-=dy,end_y>my-dy&&my>end_y){for(console.log("csv"),len=0,i=0;i<graph.data.length;i++)len=Math.max(len,graph.data[i][0].length);for(var text="",ii=0;len>ii;ii++){for(i=0;i<graph.data.length;i++)try{text+=graph.data[i][0][ii].toString()+","+graph.data[i][1][ii].toString()+","}catch(e){text+=",,"}text=text.substring(0,text.length-1),text+="\n"}download_text(text,"mjsplot_graph.csv")}if(my-=dy,end_y>my-dy&&my>end_y){console.log("code");var theBody=document.getElementsByTagName("body")[0],text="";for(i=0;i<graph.data.length;i++){for(text+=graph.captions[i].replace(/\W/g,"")+"_x = [",ii=0;ii<graph.data[i][0].length-1;ii++)text+=graph.data[i][0][ii]+",";for(text+=graph.data[i][0][ii]+"];\n",text+=graph.captions[i].replace(/\W/g,"")+"_y = [",ii=0;ii<graph.data[i][1].length-1;ii++)text+=graph.data[i][1][ii]+",";text+=graph.data[i][1][ii]+"];\n"}show_text_to_screen(text,graph)}if(my-=dy,end_y>my-dy&&my>end_y){console.log("code matlab");var theBody=document.getElementsByTagName("body")[0],text="";for(i=0;i<graph.data.length;i++){for(text+=graph.captions[i].replace(/\W/g,"")+"_x = [",ii=0;ii<graph.data[i][0].length-1;ii++)text+=graph.data[i][0][ii]+" ";for(text+=graph.data[i][0][ii]+"];\n",text+=graph.captions[i].replace(/\W/g,"")+"_y = [",ii=0;ii<graph.data[i][1].length-1;ii++)text+=graph.data[i][1][ii]+" ";text+=graph.data[i][1][ii]+"];\n"}show_text_to_screen(text,graph)}if(my-=dy,end_y>my-dy&&my>end_y){console.log("code JSON");var text="";text=JSON.stringify(graph.data),download_text(text,"mjsplot_graph.json")}if(my-=dy,end_y>my-dy&&my>end_y){console.log("tabbed");var len=0;for(i=0;i<graph.data.length;i++)len=Math.max(len,graph.data[i][0].length);for(var text="",ii=0;len>ii;ii++){for(i=0;i<graph.data.length;i++)try{text+=graph.data[i][0][ii].toString()+"	"+graph.data[i][1][ii].toString()+"	"}catch(e){text+="		"}text+="\n"}download_text(text,"mjsplot_graph.dat")}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png hi"),graph.canvas.width*=3,graph.canvas.height*=3,gs.scaling_factor*=3,graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=600, height=400"),graph.transparent=!1,gs.scaling_factor/=3,graph.canvas.width/=3,graph.canvas.height/=3,graph.mjs_plot()
}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png low"),graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=600, height=400"),graph.transparent=!1,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png (small figure)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=1e3,graph.canvas.height=750,gs.scaling_factor*=2.5,graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=1000, height=750"),graph.transparent=!1,gs.scaling_factor/=2.5,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("png (large figure)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=2e3,graph.canvas.height=1500,gs.scaling_factor*=2.5,graph.transparent=!0,graph.mjs_plot();var dataUrl=graph.canvas.toDataURL();window.open(dataUrl,"toDataURL() image","width=1000, height=750"),graph.transparent=!1,gs.scaling_factor/=2.5,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("svg");var svgDiv=document.createElement("div");svgDiv.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+graph.canvas.width+'" height="'+graph.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(svgDiv),graph.isSVG=!0,graph.mjs_plot();var svg=document.getElementById("_mjsplotSVG").outerHTML,xmlheadder='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';download_text(xmlheadder+svg,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(svgDiv),graph.isSVG=!1,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("svg (small fig)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=400,graph.canvas.height=300;var svgDiv=document.createElement("div");svgDiv.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+graph.canvas.width+'" height="'+graph.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(svgDiv),graph.isSVG=!0,graph.mjs_plot();var svg=document.getElementById("_mjsplotSVG").outerHTML,xmlheadder='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';download_text(xmlheadder+svg,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(svgDiv),graph.isSVG=!1,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("svg (large fig)");var temp_width=graph.canvas.width,temp_height=graph.canvas.height;graph.canvas.width=800,graph.canvas.height=600;var svgDiv=document.createElement("div");svgDiv.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+graph.canvas.width+'" height="'+graph.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(svgDiv),graph.isSVG=!0,graph.mjs_plot();var svg=document.getElementById("_mjsplotSVG").outerHTML,xmlheadder='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';download_text(xmlheadder+svg,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(svgDiv),graph.isSVG=!1,graph.canvas.width=temp_width,graph.canvas.height=temp_height,graph.mjs_plot()}if(my-=dy,end_y>my-dy&&my>end_y){console.log("html (link)");var text="",nl=" \n",graph_name="egraph",graph_name=window.btoa(Math.random().toString()).slice(6,10),canvas_name=graph.canvas_name,mjsplot_embed='<script src="mjs_plot_0_3_3svg.js"></script>',canvas_embed='<canvas id="'+canvas_name+'" width="'+graph.canvas.width+'px" height="'+graph.canvas.height+'px"></canvas>',data_code=JSON.stringify(graph.data_backup),gs_code=JSON.stringify(graph.graphics_style),captions_code=JSON.stringify(graph.captions_backup);text+=graph_name+".set_data( "+data_code+" );"+nl,text+=graph_name+".set_captions( "+captions_code+" ); "+nl,text+=graph_name+".default_graphics_style = "+gs_code+"; "+nl;var shower=MJS_PLOT_LINK_LOADER;show_text_to_screen(shower+graph_name+LZString.compressToEncodedURIComponent(text),graph)}return void(my-=dy)}if(graph.drawfitsmenu)return 21*edge>end_x&&end_x>18*edge&&end_y>canvas.height-edge&&(gs.fits="none"),end_y>canvas.height-2*edge&&end_y<canvas.height-1*edge&&(gs.extrapolate=!gs.extrapolate),end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&end_x>18*edge&&(gs.fits="stats"),end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge&&end_x>18*edge&&(gs.fits="exp"),end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&end_x>18*edge&&(gs.fits="exp_c"),end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&end_x>18*edge&&(gs.fits="log"),end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&end_x>18*edge&&(gs.fits="power"),end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&end_x>18*edge&&(gs.fits="power_c"),end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&end_x>18*edge&&(gs.fits="gauss"),end_y>canvas.height-3*edge&&end_y<canvas.height-2*edge&&18*edge>end_x&&(gs.fits="const"),end_y>canvas.height-4*edge&&end_y<canvas.height-3*edge&&18*edge>end_x&&(gs.fits="linear"),end_y>canvas.height-5*edge&&end_y<canvas.height-4*edge&&18*edge>end_x&&(gs.fits="quad"),end_y>canvas.height-6*edge&&end_y<canvas.height-5*edge&&18*edge>end_x&&(gs.fits="cubic"),end_y>canvas.height-7*edge&&end_y<canvas.height-6*edge&&18*edge>end_x&&(gs.fits="poly4"),end_y>canvas.height-8*edge&&end_y<canvas.height-7*edge&&18*edge>end_x&&(gs.fits="poly5"),end_y>canvas.height-9*edge&&end_y<canvas.height-8*edge&&18*edge>end_x&&(gs.fits="poly6"),end_y>canvas.height-10*edge&&end_y<canvas.height-9*edge&&18*edge>end_x&&(gs.fits="poly5"),graph.mjs_plot(),18*edge>end_x&&end_x>15*edge&&end_y>canvas.height-edge&&(graph.drawfitsmenu=!1),21*edge>end_x&&end_x>18*edge&&end_y>canvas.height-edge&&(gs.fits="none",graph.drawfitsmenu=!1),console.log(gs.fits),void mouse_move_event(event,graph);if(end_y>canvas.height-edge){if(2*edge>end_x&&end_x>0*edge&&(graph.drawxmenu=!0),4*edge>end_x&&end_x>2*edge&&(graph.drawymenu=!0),5*edge>end_x&&end_x>4*edge&&(gs.show_grid=!gs.show_grid),6*edge>end_x&&end_x>5*edge&&(gs.y_scale_mode="log"===gs.y_scale_mode?"lin":"log"),7*edge>end_x&&end_x>6*edge&&(gs.x_scale_mode="log"===gs.x_scale_mode?"lin":"log"),8*edge>end_x&&end_x>7*edge&&(gs.x_scale_mode="time"),11*edge>end_x&&end_x>8*edge)return graph.drawfxmenu=!0,void mouse_move_event(event,graph);if(15*edge>end_x&&end_x>11*edge)return console.log("line menu button"),graph.drawlinemenu=!0,void mouse_move_event(event,graph);if(19*edge>end_x&&end_x>15*edge)return console.log("fits menu button"),graph.drawfitsmenu=!0,void mouse_move_event(event,graph);if(end_x<canvas.width&&end_x>canvas.width-edge&&(graph.drawexportmenu=!0),end_x<canvas.width-edge&&end_x>canvas.width-2*edge){var temp=gs.color_fg;gs.color_fg=gs.color_bg,gs.color_bg=temp}return end_x<canvas.width-2*edge&&end_x>canvas.width-3*edge&&(graph.isFullscreen?graph.exit_full_screen():graph.make_full_screen(graph)),graph.mjs_plot(),void mouse_move_event(event,graph)}if("zoom"===gs.mouse_mode)if(ctx.rect(start_x-.5*no_drag_size,start_y-.5*no_drag_size,no_drag_size,no_drag_size),ctx.stroke(),0===event.button)gs.x_scale_auto_min=!0,gs.y_scale_auto_min=!0,gs.x_scale_auto_max=!0,gs.y_scale_auto_max=!0,gs.y_scale_tight=!1,gs.x_scale_tight=!1;else if(2===event.button){gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!1,gs.x_scale_tight=!1;var f=.8;gs.x_manual_min=graph.pixels_to_units(-f*gs.guideWidthx,"x"),gs.x_manual_max=graph.pixels_to_units(canvas.width+f*gs.guideWidthx,"x"),gs.y_manual_min=graph.pixels_to_units(canvas.height+f*gs.guideWidthy,"y"),gs.y_manual_max=graph.pixels_to_units(-f*gs.guideWidthy,"y")}if(graph.ui.touch&&"measure"===gs.mouse_mode&&graph.ui.is_touching)return void(graph.graph_image=ctx.getImageData(0,0,canvas.width,canvas.height));if(graph.ui.touch&&"measure"===gs.mouse_mode)return void graph.mjs_plot();if("drag"===gs.mouse_mode){if(graph.ui.touch&&graph.ui.is_touching){start_x=.5*(touch_start_x[0]+touch_start_x[1]),start_y=.5*(touch_start_y[0]+touch_start_y[1]),end_x=.5*(touch_x[0]+touch_x[1]),end_y=.5*(touch_y[0]+touch_y[1]);var scale_x=(touch_x[0]-touch_x[1])/(touch_start_x[0]-touch_start_x[1]),scale_y=(touch_y[0]-touch_y[1])/(touch_start_y[0]-touch_start_y[1]);scale_x=trim(Math.abs(scale_x),.1,10),scale_y=trim(Math.abs(scale_y),.1,10);var new_max_y=0+(1-1/scale_y)*(start_y-0)+(-end_y+start_y)/scale_y,new_min_y=canvas.height+(1-1/scale_y)*(start_y-canvas.height)+(-end_y+start_y)/scale_y,new_max_x=canvas.width+(1-1/scale_x)*(start_x-canvas.width)+(-end_x+start_x)/scale_x,new_min_x=0+(1-1/scale_x)*(start_x-0)+(-end_x+start_x)/scale_x;return gs.y_manual_max=Math.min(1e250,graph.pixels_to_units(new_max_y,"y")),gs.y_manual_min=Math.max(-1e250,graph.pixels_to_units(new_min_y,"y")),gs.x_manual_min=Math.max(-1e250,graph.pixels_to_units(new_min_x,"x")),gs.x_manual_max=Math.min(1e250,graph.pixels_to_units(new_max_x,"x")),gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!0,gs.x_scale_tight=!0,void graph.mjs_plot()}if(!graph.ui.touch)return gs.y_manual_max=graph.pixels_to_units(start_y-end_y+gs.guideWidthy+1,"y"),gs.y_manual_min=graph.pixels_to_units(canvas.height+start_y-end_y-gs.guideWidthy-1,"y"),gs.x_manual_min=graph.pixels_to_units(start_x-end_x+gs.guideWidthx-1,"x"),gs.x_manual_max=graph.pixels_to_units(canvas.width+start_x-end_x-gs.guideWidthx+1,"x"),gs.x_scale_auto_min=!1,gs.y_scale_auto_min=!1,gs.x_scale_auto_max=!1,gs.y_scale_auto_max=!1,gs.y_scale_tight=!0,gs.x_scale_tight=!0,void graph.mjs_plot()}if("reader"===gs.mouse_mode){var pi=0,pj=0,best_dist=1e200,dist=1e200;for(i=0;i<graph.data.length;i++)for(j=0;j<graph.data[i][0].length;j++){var xi=graph.units_to_pixels(graph.data[i][0][j],"x"),yi=graph.units_to_pixels(graph.data[i][1][j],"y");dist=Math.sqrt(Math.pow(xi-end_x,2)+Math.pow(yi-end_y,2)),best_dist>dist&&(best_dist=dist,pi=i,pj=j)}return graph.reader_index=[pi,pj],void mouse_move_event(event,graph)}if("trim"===gs.mouse_mode){console.log("mouse trim");var start_px=graph.pixels_to_units(start_x,"x"),start_py=graph.pixels_to_units(start_y,"y"),end_px=graph.pixels_to_units(end_x,"x"),end_py=graph.pixels_to_units(end_y,"y"),xlow=Math.min(start_px,end_px),ylow=Math.min(start_py,end_py),xhigh=Math.max(start_px,end_px),yhigh=Math.max(start_py,end_py),n=gs.data_transforms.length;return gs.data_transforms[n]="trim",gs.data_transforms_args[n]=[xlow,xhigh,ylow,yhigh],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}if("sublin"===gs.mouse_mode){console.log("sublin");var start_px=graph.pixels_to_units(start_x,"x"),start_py=graph.pixels_to_units(start_y,"y"),end_px=graph.pixels_to_units(end_x,"x"),end_py=graph.pixels_to_units(end_y,"y"),grad=(end_py-start_py)/(end_px-start_px),intercept=start_py-grad*start_px;if(isFinite(grad)&&isFinite(intercept)){var n=gs.data_transforms.length;gs.data_transforms[n]="sublin",gs.data_transforms_args[n]=[grad,intercept],gs.mouse_mode=graph.pre_mouse_mode,graph.mjs_plot()}return void(gs.mouse_mode=graph.pre_mouse_mode)}if("cut"===gs.mouse_mode){console.log("mouse cut");var start_px=graph.pixels_to_units(start_x,"x"),start_py=graph.pixels_to_units(start_y,"y"),end_px=graph.pixels_to_units(end_x,"x"),end_py=graph.pixels_to_units(end_y,"y"),xlow=Math.min(start_px,end_px),ylow=Math.min(start_py,end_py),xhigh=Math.max(start_px,end_px),yhigh=Math.max(start_py,end_py),n=gs.data_transforms.length;return gs.data_transforms[n]="cut",gs.data_transforms_args[n]=[xlow,xhigh,ylow,yhigh],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}if("y-c"===graph.graphics_style.mouse_mode){console.log("y-c");var c=graph.pixels_to_units(end_y,"y"),n=gs.data_transforms.length;return gs.data_transforms[n]="y_c",gs.data_transforms_args[n]=[c],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}if("x-c"===gs.mouse_mode){console.log("y-c");var c=graph.pixels_to_units(end_x,"x"),n=gs.data_transforms.length;return gs.data_transforms[n]="x_c",gs.data_transforms_args[n]=[c],gs.mouse_mode=graph.pre_mouse_mode,void graph.mjs_plot()}return"mouse"===gs.mouse_mode?(graph.ui.mouse_is_dragging&&"fit_text"===graph.ui.drag_object&&(gs.fit_text_position.x=end_x/canvas.width,gs.fit_text_position.y=end_y/canvas.height),graph.ui.mouse_is_dragging&&"title_spacing"===graph.ui.drag_object&&(gs.title_spacing=(end_y-(gs.tick_len+gs.title_font_size)*gs.scaling_factor)/gs.scaling_factor),graph.ui.mouse_is_dragging&&"caption_position"===graph.ui.drag_object&&(gs.caption_position.x=end_x>canvas.width/2?-1*(canvas.width-end_x-gs.tick_len*gs.scaling_factor)/gs.scaling_factor:(end_x-gs.tick_len*gs.scaling_factor)/gs.scaling_factor,gs.caption_position.y=end_y>canvas.height/2?-1*(canvas.height-end_y-gs.tick_len*gs.scaling_factor)/gs.scaling_factor:(end_y-gs.tick_len*gs.scaling_factor)/gs.scaling_factor),graph.mjs_plot(),mouse_move_event(event,graph),void(graph.ui.mouse_is_dragging=!1)):("i"===gs.mouse_mode&&(gs.mouse_mode=graph.pre_mouse_mode,gs.i=0,"i"===gs.mouse_mode&&(gs.mouse_mode="zoom")),void graph.mjs_plot())}function touch_start_event(e,t){e.preventDefault(),t.ui.is_touching=!0;var a=t.canvas.getBoundingClientRect();touch_start_x[0]=e.targetTouches[0].clientX-a.left,touch_start_y[0]=e.targetTouches[0].clientY-a.top,e.targetTouches.length>=2&&(touch_start_x[1]=e.targetTouches[1].clientX-a.left,touch_start_y[1]=e.targetTouches[1].clientY-a.top),touch_move_event(e,t)}function touch_move_event(e,t){my_touches=e.targetTouches,e.preventDefault(),t.ui.is_touching=!0,mouse_down=my_touches.length>=2;var a=t.canvas.getBoundingClientRect();start_x=e.targetTouches[0].clientX-a.left,start_y=e.targetTouches[0].clientY-a.top,touch_x[0]=e.targetTouches[0].clientX-a.left,touch_y[0]=e.targetTouches[0].clientY-a.top,e.targetTouches.length>1&&(touch_x[1]=e.targetTouches[1].clientX-a.left,touch_y[1]=e.targetTouches[1].clientY-a.top),e.clientX=my_touches[my_touches.length-1].clientX,e.clientY=my_touches[my_touches.length-1].clientY,mouse_move_event(e,t)}function touch_cancel_event(e,t){t.ui.is_touching=0!=e.targetTouches.length,e.preventDefault(),touch_end_event(e,t)}function touch_leave_event(e,t){touch_end_event(e,t)}function touch_click_event(e,t){rect=t.canvas.getBoundingClientRect(),start_x=e.clientX-rect.left,start_y=e.clientY-rect.top,mouse_up_event(e,t)}function touch_end_event(e,t){t.ui.is_touching=0!=e.targetTouches.length,rect=t.canvas.getBoundingClientRect(),start_x=my_touches[0].clientX-rect.left,start_y=my_touches[0].clientY-rect.top,e.clientX=my_touches[my_touches.length-1].clientX,e.clientY=my_touches[my_touches.length-1].clientY,mouse_up_event(e,t)}function keep_parent_sized(e,t){t.canvas.style.width="100%",t.canvas.style.height="100%",t.canvas.width=canvas.offsetWidth,t.canvas.height=canvas.offsetHeight,t.mjs_plot()}function make_interactive(e){e.ui.touch?(e.canvas.addEventListener("touchstart",function(t){touch_start_event(t,e)},!1),e.canvas.addEventListener("touchend",function(t){touch_end_event(t,e)},!1),e.canvas.addEventListener("touchmove",function(t){touch_move_event(t,e)},!1),e.canvas.addEventListener("touchcancel",function(t){touch_cancel_event(t,e)},!1),e.canvas.addEventListener("touchleave",function(t){touch_leave_event(t,e)},!1),e.canvas.addEventListener("click",function(t){touch_click_event(t,e)},!1)):(e.canvas.addEventListener("mousemove",function(t){mouse_move_event(t,e)},!1),e.canvas.addEventListener("mousedown",function(t){mouse_down_event(t,e)},!1),e.canvas.addEventListener("mouseup",function(t){mouse_up_event(t,e)},!1),e.canvas.addEventListener("mouseout",function(t){mouse_out_event(t,e)},!1)),e.canvas.oncontextmenu=function(e){e.preventDefault()}}function SVGContext(e){this.target=document.getElementById("_mjsplotSVG"),this._ctx=e,this.x=0,this.y=0,this.strokeStyle="#000",this.lineWidth=2,this.lineCap,this.lineJoin,this.miterLimit=10,this.font,this.textAlign="left",this.textBaseline="alphabetic",this.direction="inherit",this._pixel_precision=2,this._shape_type="path",this.fillStyle="#000",this._path="",this._isdrawn=!1,this.clearAll=function(){for(;this.target.lastChild;)this.target.removeChild(this.target.lastChild)},this.arc=function(e,t,a){this._shape_type="arc",this._shape=document.createElementNS(svgNS,"circle"),this._shape.setAttributeNS(null,"stroke-width",this.lineWidth),this._shape.setAttributeNS(null,"stroke",this.strokeStyle),this._shape.setAttributeNS(null,"r",a),this._shape.setAttributeNS(null,"cx",e),this._shape.setAttributeNS(null,"cy",t)},this.moveTo=function(e,t){this._path+=" M"+e.toFixed(this._pixel_precision)+" "+t.toFixed(this._pixel_precision)},this.lineTo=function(e,t){this._path+=" L"+e.toFixed(this._pixel_precision)+" "+t.toFixed(this._pixel_precision)},this.beginPath=function(){this._shape_type="path",this._shape=document.createElementNS(svgNS,"path"),this._path="",this._isdrawn=!1},this.closePath=function(){this._path+="Z"},this.quadraticCurveTo=function(e,t,a,i){this._path+=" Q"+e.toFixed(this._pixel_precision)+" "+t.toFixed(this._pixel_precision)+" "+a.toFixed(this._pixel_precision)+" "+i.toFixed(this._pixel_precision)},this.bezierCurveTo=function(e,t,a,i,s,n){console.log("bezierCurveTo is not implemented yet"),this._path+=" Q"+(e+a)/2+" "+(t+i)/2+" "+s.toFixed(this._pixel_precision)+" "+n.toFixed(this._pixel_precision)},this.stroke=function(){this._shape.setAttributeNS(null,"fill","none"),this._shape.setAttributeNS(null,"stroke-width",this.lineWidth.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"stroke",this.strokeStyle),this._isdrawn||("path"===this._shape_type&&this._shape.setAttributeNS(null,"d",this._path),this.globalAlpha<1&&this._shape.setAttributeNS(null,"opacity",this.globalAlpha.toFixed(2)),this.target.appendChild(this._shape),this._isdrawn=!0)},this.fill=function(){this._shape.setAttributeNS(null,"fill",this.fillStyle),this._isdrawn||("path"===this._shape_type&&this._shape.setAttributeNS(null,"d",this._path),this.target.appendChild(this._shape),this._isdrawn=!0)},this.fillText=function(e,t,a){var i=document.createElementNS(svgNS,"text"),s="start";switch(this.textAlign){case"left":s="start";break;case"right":s="end";break;case"center":s="middle";break;case"middle":s="middle"}i.setAttributeNS(null,"text-anchor",s),i.setAttributeNS(null,"fill",this.fillStyle),i.setAttributeNS(null,"x",t.toFixed(this._pixel_precision)),i.setAttributeNS(null,"x",t.toFixed(this._pixel_precision)),i.setAttributeNS(null,"font-family",this.font_name),i.setAttributeNS(null,"y",a.toFixed(this._pixel_precision)),i.setAttributeNS(null,"font-size",parseFloat(this.font.split(" ")[0].slice(0,-2)).toFixed(this._pixel_precision)),i.textContent=e,this.target.appendChild(i)},this.rect=function(e,t,a,i){this.moveTo(e,t),this.lineTo(e+a,t),this.lineTo(e+a,t+i),this.lineTo(e,t+i),this.lineTo(e,t)},this.fillRect=function(e,t,a,i){this.beginPath(),this.rect(e,t,a,i),this.fill()},this.strokeText=function(){},this.getImageData=this._ctx.getImageData,this.measureText=function(e){return{width:this._ctx.measureText(e).width}}}function drawSplash(e,t){t.textAlign="center",t.beginPath(),t.font='20 px "Monaco","Menlo","Ubuntu Mono","Consolas","source-code-pro",monospace"',t.fillText("MJS Plot",e.width/2,e.height/2-20),t.font='10 px "Monaco","Menlo","Ubuntu Mono","Consolas","source-code-pro",monospace"',t.fillText("Setting Up",e.width/2,e.height/2+20),t.rect(10,10,e.width-20,e.height-20),t.stroke()}var MJS_PLOT_VERSION="0_3_5",MJS_PLOT_AUTOR="MJS",MJS_PLOT_DATE="2015",MJS_PLOT_WEBSITE="http://generalsarsby.github.io/mjs_plot/",MJS_PLOT_LINK_LOADER="http://generalsarsby.github.io/mjs_plot/load.html#",DEBUGG_FORCE_TOUCH=!1,DEBUGG_FPS=!1,svgNS="http://www.w3.org/2000/svg",vals=[1,2,5],few_minor_ticks=[2,2,5],many_minor_ticks=[5,4,5],color_table=[["#aa3939"],["#aa3939","#383276"],["#aa3939","#236467","#7b9f35"],["#aa3939","#aa6d39","#236467","#2d882d"],["#aa3939","#aa6d39","#236467","#2d882d","#304473"],["#aa3939","#aa6d39","#236467","#2d882d","#304473","#ac873c"]],mouse_down=!1,start_x=0,end_x=0;try{Math.log10(100)}catch(e){Math.log10=function(e){return Math.log(e)/Math.LN10}}var log_vals=[[1],[1,3],[1,2,4],[1,2,3,6],[1,2,3,4,6],[1,2,3,4,6,8],[1,1.5,2,3,4,6,8],[1,1.5,2,2.5,3,4,6,8],[1,1.5,2,2.5,3,4,6,7,8],[1,1.2,1.5,2,2.5,3,4,5,6,7,9],[1,1.2,1.5,2,2.5,3,4,5,6,7,8,9],[1,1.2,1.4,1.6,1.8,2,2.5,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.1,1.2,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.35,1.4,1.45,1.5,1.55,1.6,1.65,1.7,1.75,1.8,1.85,1.9,1.95,2,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5]],log_vals_ticks=[[1,3],[1,2,3,4,5,6,7,8,9],[1,2,3,4,5,6,7,8,9],[1,2,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.5,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.25,2.75,3,3.5,4,4.5,5,5.5,6,6.5,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.25,2.75,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9]],allowed_intervals=[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,3e4,6e4,12e4,3e5,6e5,9e5,12e5,18e5,36e5,72e5,108e5,216e5,432e5,864e5,1728e5,432e6,6048e5,12096e5,2592e6,5184e6,15552e6,31536e6,63072e6,15768e7,31536e7,63072e7,15768e8,31536e8,63072e8,15768e9,31536e9],time_ticks=[.2,.5,1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,3e4,6e4,12e4,3e5,3e5,6e5,12e5,18e5,36e5,72e5,108e5,216e5,432e5,864e5,864e5,1728e5,864e6,1728e6,2592e6,7884e6,31536e6,31536e6,63072e6,15768e7,31536e7,63072e7,15768e8,31536e8,63072e8],string_precisions=[8,8,8,7,7,7,6,6,6,5,5,5,5,5,5,4,4,4,4,4,4,4,3,3,3,3,3,2,2,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0];si_prefixes=["y","z","a","f","p","n",String.fromCharCode(181),"m",".","k","M","G","T","P","E","Z","Y"];var fits={exponential_fun:function(e,t){for(var a=[],i=0;i<e.length;i++)a.push(t[0]*Math.pow(Math.E,t[1]*e[i]));return a},exponential:function(e,t){for(var a=[],i=[],s=0;s<e.length;s++)t[s]>0&&(a.push(e[s]),i.push(t[s]));for(var n=[0,0,0,0,0,0],o=0;o<a.length;o++)n[0]+=a[o],n[1]+=i[o],n[2]+=a[o]*a[o]*i[o],n[3]+=i[o]*Math.log(i[o]),n[4]+=a[o]*i[o]*Math.log(i[o]),n[5]+=a[o]*i[o];var r=n[1]*n[2]-n[5]*n[5],_=Math.pow(Math.E,(n[2]*n[3]-n[5]*n[4])/r),l=(n[1]*n[4]-n[5]*n[3])/r,g="y = "+mjs_precision(_,5)+"e^("+mjs_precision(l,5)+"x)";return{parameters:[_,l],strings:[g,"",""],fun:fits.exponential_fun}},exponential_plus_c_fun:function(e,t){for(var a=[],i=0;i<e.length;i++)a.push(t[0]+t[1]*Math.exp(t[2]*e[i]));return a},exponential_plus_c:function(e,t){var i=e.length,s=0,n=0,o=0,r=0,_=0,l=[];l[0]=0;for(var g=1;i>g;g++)l[g]=l[g-1]+.5*(t[g]+t[g-1])*(e[g]-e[g-1]);for(var g=0;i>g;g++)s+=(e[g]-e[0])*(e[g]-e[0]),n+=(e[g]-e[0])*l[g],o+=l[g]*l[g],r+=(t[g]-t[0])*(e[g]-e[0]),_+=(t[g]-t[0])*l[g];var h=1/(s*o-n*n),c=h*(o*r-n*_),d=h*(s*_-n*r);a=-1*c/d;for(var m=0,x=0,f=0,p=0,u=0,g=0;i>g;g++)u=Math.exp(d*e[g]),m+=u,x+=u*u,f+=t[g],p+=t[g]*u;h=1/(x*i-m*m);var y=h*(x*f-m*p),v=h*(i*p-m*f);a=y;var w="y = "+mjs_precision(a,5)+"+"+mjs_precision(v,5)+"e^("+mjs_precision(d,5)+"x)";return{parameters:[a,v,d],strings:[w,"",""],fun:fits.exponential_plus_c_fun}},gauss_fun:function(e,t){for(var a=[],i=t[0],s=t[1],n=Math.sqrt(2*Math.PI),o=0;o<e.length;o++)a.push(t[2]/n/s*Math.exp(-.5*Math.pow((e[o]-i)/s,2)));return a},gauss:function(e,t){var a=e.length,i=[];i[0]=0;for(var s=0,n=1;a>n;n++)i[n]=i[n-1]+.5*(t[n]+t[n-1])*(e[n]-e[n-1]);s=Math.abs(i[n-1]);var o=[];o[0]=0;for(var n=1;a>n;n++)o[n]=o[n-1]+.5*(e[n]*t[n]+e[n-1]*t[n-1])*(e[n]-e[n-1]);for(var r=0,_=0,l=0,g=0,h=0,n=0;a>n;n++)r+=i[n]*i[n],_+=i[n]*o[n],l+=o[n]*o[n],g+=(t[n]-t[0])*i[n],h+=(t[n]-t[0])*o[n];var c=1/(r*l-_*_),d=c*(l*g-_*h),m=c*(r*h-_*g),x=-1/m*Math.sqrt(2/Math.PI),x=Math.sqrt(-1/m),f=-d/m,p="A/(sig * sqrt(2pi)) exp(-0.5*((x-mu)/sig)^2)",u="sig = "+mjs_precision(x,5)+",  A = "+ +mjs_precision(s,5),y="mu = "+mjs_precision(f,5);return{parameters:[f,x,s],strings:[p,u,y],fun:fits.gauss_fun}},linear_fun:function(e,t){for(var a=[],i=0;i<e.length;i++)a.push(e[i]*t[0]+t[1]);return a},linear:function(e,t){for(var a=0,i=0,s=0,n=0,o=0,r=0;r<e.length;r++)a+=e[r],s+=e[r]*e[r],i+=t[r],n+=e[r]*t[r],o+=t[r]*t[r];var _=e.length;n-=a*i/_,s-=a*a/_,o-=i*i/_;var l=a/_,g=n*n/s/o,h=n/s,c=i/_-h*a/_,d=Math.sqrt((o-n*n/s)/(_-2)),m=d/Math.sqrt(s),x=d*Math.sqrt(1/_+l*l/s),f=String.fromCharCode(178);return string1="r"+f+" = "+number_quote(g,1-g),string2="intecept a = "+number_quote(c,x)+",   S(a) = "+mjs_precision(x,2),string3="slope b = "+number_quote(h,m)+",   S(b) = "+mjs_precision(m,2),{parameters:[h,c],strings:[string1,string2,string3],fun:fits.linear_fun}},constant_fun:function(e,t){for(var a=[],i=0;i<e.length;i++)a.push(t[0]);return a},constant:function(e,t){for(var a=0,i=0,s=0;s<e.length;s++)a+=t[s],i+=t[s]*t[s];var n=e.length;i-=a*a/n;var o=a/n,r=Math.sqrt(i/n);return string1="y="+number_quote(o,r)+String.fromCharCode(177)+mjs_precision(r,2),{parameters:[o],strings:[string1,"",""],fun:fits.constant_fun}},poly2:function(e,t){return fits.polyn_fit(e,t,2)},poly3:function(e,t){return fits.polyn_fit(e,t,3)},poly4:function(e,t){return fits.polyn_fit(e,t,4)},poly5:function(e,t){return fits.polyn_fit(e,t,5)},poly6:function(e,t){return fits.polyn_fit(e,t,6)},poly7:function(e,t){return fits.polyn_fit(e,t,7)},poly8:function(e,t){return fits.polyn_fit(e,t,8)},polyn_fun:function(e,t){for(var a=[],i=0;i<e.length;i++){a[i]=0;for(var s=0;s<t.length;s++)a[i]+=t[s]*Math.pow(e[i],s)}return a},polyn_fit:function(e,t,a){for(var i=[],s=[],n=0,o=0,r=0,_=a+1,r=0;_>r;r++){for(var l=0,g=e.length;g>l;l++)n+=Math.pow(e[l],r)*t[l];i.push(n),n=0;for(var h=[],c=0;_>c;c++){for(var l=0,g=e.length;g>l;l++)o+=Math.pow(e[l],r+c);h.push(o),o=0}s.push(h)}s.push(i);var c=0,_=0,d=0,m=0,x=s.length-1;for(r=0;x>r;r++){for(d=r,c=r+1;x>c;c++)Math.abs(s[r][c])>Math.abs(s[r][d])&&(d=c);for(_=r;x+1>_;_++)m=s[_][r],s[_][r]=s[_][d],s[_][d]=m;for(c=r+1;x>c;c++)for(_=x;_>=r;_--)s[_][c]-=s[_][r]*s[r][c]/s[r][r]}var f=[];for(c=x-1;c>=0;c--){for(m=0,_=c+1;x>_;_++)m+=s[_][c]*f[_];f[c]=(s[x][c]-m)/s[c][c]}fit=[];for(var r=0;r<e.length;r++){fit[r]=0;for(var p=0;p<f.length;p++)fit[r]+=f[p]*Math.pow(e[r],p)}for(var u=0,y=0,v=0,w=0,T=0,r=0;r<e.length;r++)u+=e[r],v+=e[r]*e[r],y+=t[r],w+=t[r]*t[r];for(var b=y/e.length,k=0,M=0,r=0;r<e.length;r++)k+=(fit[r]-b)*(fit[r]-b),M+=(fit[r]-t[r])*(fit[r]-t[r]);var x=e.length,j=w-y*y/x,k=T,S=1-M/j,P=String.fromCharCode(178),z="y = ",D="";if(f.length>4){for(var r=f.length-1;r>=4;r--)z+=r>1?mjs_precision(f[r],5)+"x^"+r+" + ":1==r?mjs_precision(f[r],5)+"x + ":mjs_precision(f[r],5);for(;r>=0;r--)D+=r>1?mjs_precision(f[r],5)+"x^"+r+" + ":1==r?mjs_precision(f[r],5)+"x + ":mjs_precision(f[r],5)}else for(var r=f.length-1;r>=0;r--)z+=r>1?mjs_precision(f[r],5)+"x^"+r+" + ":1==r?mjs_precision(f[r],5)+"x + ":mjs_precision(f[r],5);return string1="r"+P+" = "+number_quote(S,1-S),{parameters:f,strings:[string1,z,D],fun:fits.polyn_fun}},log_fun:function(e,t){for(var a=[],i=0;i<e.length;i++)a.push(t[0]+t[1]*Math.log(e[i]));return a},log:function(e,t){for(var a=[],i=[],s=0;s<e.length;s++)e[s]>0&&(a.push(e[s]),i.push(t[s]));var o=0,r=0,_=0,l=0,g=a.length;for(n=0;n<g;n++)o+=Math.log(a[n]),r+=i[n]*Math.log(a[n]),_+=i[n],l+=Math.pow(Math.log(a[n]),2);var h=(n*r-_*o)/(n*l-o*o),c=(_-h*o)/n,d="y="+mjs_precision(c,4)+" + "+mjs_precision(h,4)+" ln(x)";return{parameters:[c,h],strings:[d,"",""],fun:fits.log_fun}},power_plus_c_fun:function(e,t){for(var a=[],i=0;i<e.length;i++)a.push(t[0]+t[1]*Math.pow(e[i],t[2]));return a},power_plus_c:function(e,t){for(var a=[],i=[],s=0;s<e.length;s++)xi=Math.log(e[s]),isFinite(xi)&&(a.push(xi),i.push(t[s]));var n=fits.exponential_plus_c(a,i),o="y = "+mjs_precision(n.parameters[0],5)+"+"+mjs_precision(n.parameters[1],5)+"x^"+mjs_precision(n.parameters[2],5);return n.strings=[o,"",""],n.fun=fits.power_plus_c_fun,n},power_fun:function(e,t){for(var a=[],i=0;i<e.length;i++)a.push(t[0]*Math.pow(e[i],t[1]));return a},power:function(e,t){for(var a=[],i=[],s=0;s<e.length;s++)e[s]>0&&t[s]>0&&(a.push(e[s]),i.push(t[s]));for(var n=a.length,o=0,r=0,_=0,l=0,s=0;n>s;s++)o+=Math.log(a[s]),r+=Math.log(i[s])*Math.log(a[s]),_+=Math.log(i[s]),l+=Math.pow(Math.log(a[s]),2);var g=(n*r-_*o)/(n*l-o*o),h=Math.pow(Math.E,(_-g*o)/n),c="y="+mjs_precision(h,4)+"x^"+mjs_precision(g,4);return{parameters:[h,g],strings:[c,"",""],fun:fits.power_fun}},pre_fit_normalizing:function(e){for(var t=series_stats(e,e),a=clone(e),i=0;i<e.length;i++)a[i]=(e[i]-t.x_mean)/t.sigma_x;var s="normalized (x-"+t.x_mean+")/"+t.sigma_x;return{x:a,s:s,x_mean:t.x_mean,sigma_x:t.sigma_x}},post_fit_normalizing:function(e,t){for(var a=clone(e),i=0;i<e.length;i++)a[i]=(e[i]-t.x_mean)/t.sigma_x;return a}};fits.fit_strings=["exp","exp_c","linear","quad","cubic","poly4","poly5","poly6","poly7","const","log","power","power_c","gauss"],fits.fit_funs=[fits.exponential,fits.exponential_plus_c,fits.linear,fits.poly2,fits.poly3,fits.poly4,fits.poly5,fits.poly6,fits.poly7,fits.constant,fits.log,fits.power,fits.power_plus_c,fits.gauss];var dotcount=0,touch_start_x=[],touch_start_y=[],touch_x=[],touch_y=[],transforms={scale_x:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=e[i][0][j]*t[0];a.transform_text_x=a.transform_text_x+"*"+mjs_precision(t[0],1)},log_x:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=Math.log10(e[i][0][j]);transforms.clean(e,a),a.transform_text_x="log("+a.transform_text_x+")"},x_c:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=e[i][0][j]-t[0];a.transform_text_x=a.transform_text_x+"-"+mjs_precision(t[0],a.graphics_style.x_precision+1)},y_c:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=e[i][1][j]-t[0];a.transform_text_y=a.transform_text_y+"-"+mjs_precision(t[0],a.graphics_style.y_precision+1)},remove_lines:function(e,t,a){for(var i=e.length-1;i>=0;i--)t[i]&&(e.splice(i,1),a.captions.splice(i,1),a.colors.splice(i,1))},y_vs_y:function(e,t,a){var i=t[0]%e.length;console.log(i);for(var s=e[i][0].length,n=0;n<e.length;n++){var s=Math.min(e[n][0].length,e[i][0].length);if(n!=i){for(var o=[],r=[],_=0;s>_;_++)o[_]=e[i][1][_],r[_]=e[n][1][_];e[n]=[clone(o),clone(r)],a.captions[n]=a.captions[i]+" vs "+a.captions[n]}}a.transform_text_x=a.captions[i]+"("+a.transform_text_y+")",a.captions.splice(i,1),e.splice(i,1),a.colors.splice(i,1)},sum:function(e,t,a){var s=(Math.min(e[0][0].length),[]),n=[];for(j=0;j<e[0][0].length;j++)for(s[j]=e[0][0][j],n[j]=0,i=0;i<e.length;i++)n[j]+=e[i][1][j];var o="sum(";for(i=0;i<e.length;i++)o+=", "+a.captions[i];o+=")",e[0]=[s,n],e.splice(1,e.length-1),a.captions[0]=o,a.captions.splice(1,e.length-1),a.transform_text_y="sum("+a.transform_text_y+")",transforms.clean(e,a)},ln_x:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=Math.log(e[i][0][j]);transforms.clean(e,a),console.log(e),a.transform_text_x="ln("+a.transform_text_x+")"},e_to_x:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=Math.pow(Math.E,e[i][0][j]);a.transform_text_x="e^("+a.transform_text_x+")"},ten_to_x:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=Math.pow(10,e[i][0][j]);a.transform_text_x="10^("+a.transform_text_x+")"},scale_y:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][1][j]=e[i][1][j]*t[0];
a.transform_text_y=a.transform_text_y+"*"+mjs_precision(t[0],1)},log_y:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=Math.log10(e[i][1][j]);transforms.clean(e,a),a.transform_text_y="log("+a.transform_text_y+")"},ln_y:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=Math.log(e[i][1][j]);transforms.clean(e,a),a.transform_text_y="ln("+a.transform_text_y+")"},e_to_y:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=Math.pow(Math.E,e[i][1][j]);a.transform_text_y="e^("+a.transform_text_y+")"},ten_to_y:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=Math.pow(10,e[i][1][j]);a.transform_text_y="10^("+a.transform_text_y+")"},one_over_y:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][1][j]=1/e[i][1][j];transforms.clean(e,a),a.transform_text_y="1/("+a.transform_text_y+")"},custom_y:function(e,t,a){for(i=0;i<e.length;i++)e[i][1]=parseExpression(t[0],e[i][0],e[i][1]);transforms.clean(e,a),a.transform_text_y="f("+a.transform_text_y+")"},one_over_x:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=1/e[i][0][j];transforms.clean(e,a),a.transform_text_x="1/("+a.transform_text_x+")"},x_pow_n:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=Math.pow(e[i][0][j],t[0]);a.transform_text_x="("+a.transform_text_x+")^"+t[0]},y_pow_n:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=Math.pow(e[i][1][j],t[0]);a.transform_text_y="("+a.transform_text_y+")^"+t[0]},add_me:function(e,t,a){a.data=[[[2,2,3,4,4],[2,5,4,5,2]],[[5,7,6,6,5],[5,5,5,2,2]],[[8,10,10,8,8,10],[2,2,4,4,5,5]],[[1,1,11,11,1],[1,6,6,1,1]]],a.captions=["m","j","s"," "]},y_nth_root:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=Math.pow(Math.abs(e[i][1][j]),1/t[0]);a.transform_text_y="("+a.transform_text_y+")^1/"+t[0]},x_nth_root:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][0][j]=Math.pow(Math.abs(e[i][0][j]),1/t[0]);a.transform_text_x="("+a.transform_text_x+")^1/"+t[0]},trim:function(e,t,a){var s=t[0],n=t[1],o=t[2],r=t[3];for(i=0;i<e.length;i++)for(var _=e[i][0].length-1;_>=0;_--)(e[i][0][_]<s||e[i][0][_]>n||e[i][1][_]<o||e[i][1][_]>r)&&(e[i][0][_]=0/0);transforms.clean(e,a),a.transform_text_x="trim("+a.transform_text_x+")",a.transform_text_y="trim("+a.transform_text_y+")"},cut:function(e,t,a){var s=t[0],n=t[1],o=t[2],r=t[3];for(i=0;i<e.length;i++)for(var _=e[i][0].length-1;_>=0;_--)e[i][0][_]<s||e[i][0][_]>n||e[i][1][_]<o||e[i][1][_]>r||(e[i][0][_]=0/0);transforms.clean(e,a),a.transform_text_x="cut("+a.transform_text_x+")",a.transform_text_y="cut("+a.transform_text_y+")"},remove_linear:function(e,t,a){for(i=0;i<e.length;i++)for(slope=linear_regression(e[i][0],e[i][1]),j=0;j<e[i][0].length;j++)e[i][1][j]=e[i][1][j]-slope.a-slope.b*e[i][0][j];a.transform_text_y="sub_linear("+a.transform_text_y+")"},sublin:function(e,t,a){for(i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][1][j]=e[i][1][j]-t[1]-t[0]*e[i][0][j];var s=Math.max(a.graphics_style.x_precision,a.graphics_style.y_precision)+1;a.transform_text_y=a.transform_text_y+"-"+mjs_precision(t[1],s)+"-"+mjs_precision(t[0],s)+"x"},swap_x_y:function(e,t,a){for(i=0;i<e.length;i++)s=e[i][0],e[i][0]=e[i][1],e[i][1]=s;var s=a.transform_text_x;a.transform_text_x=a.transform_text_y,a.transform_text_y=s},normalise:function(e,t,a){for(i=0;i<e.length;i++)for(ymin=Math.min.apply(null,e[i][1]),ymax=Math.max.apply(null,e[i][1]),j=0;j<e[i][1].length;j++)e[i][1][j]=(e[i][1][j]-ymin)/(ymax-ymin);a.transform_text_y="norm("+a.transform_text_y+")"},mean_normalise:function(e,t,a){for(i=0;i<e.length;i++){var s=series_stats(e[i][0],e[i][1]);for(j=0;j<e[i][1].length;j++)e[i][1][j]=(e[i][1][j]-s.y_mean)/s.sigma_y}a.transform_text_y="norm("+a.transform_text_y+")"},clean:function(e,t){for(i=0;i<e.length;i++){if(2==e[i].length)for(var a=e[i][0].length-1;a>=0;a--)isFinite(e[i][1][a])&&isFinite(e[i][0][a])||(e[i][0].splice(a,1),e[i][1].splice(a,1));if(3==e[i].length)for(var a=e[i][0].length-1;a>=0;a--)isFinite(e[i][1][a])&&isFinite(e[i][0][a])||(e[i][0].splice(a,1),e[i][1].splice(a,1),e[i][2].splice(a,1));if(4==e[i].length)for(var a=e[i][0].length-1;a>=0;a--)isFinite(e[i][1][a])&&isFinite(e[i][0][a])||(e[i][0].splice(a,1),e[i][1].splice(a,1),e[i][2].splice(a,1),e[i][3].splice(a,1))}for(var a=e.length-1;a>=0;a--)0==e[a][0].length&&(e.splice(a,1),t.captions.splice(a,1),t.colors.splice(a,1))},intergrate:function(e,t,a){var s=0;for(i=0;i<e.length;i++){for(s=0,tallys=[],tallys[0]=0,j=0;j<e[i][0].length-1;j++)s+=(e[i][0][j+1]-e[i][0][j])*(e[i][1][j+1]+e[i][1][j])/2,console.log(s),tallys[j+1]=s;for(j=0;j<e[i][0].length;j++)e[i][1][j]=tallys[j]}a.transform_text_y="int("+a.transform_text_y+")"},smooth:function(e,t,a){var s=0,n=0,o=0,r=0;for(i=0;i<e.length;i++){var _=Math.round(Math.min(e[i][0].length/3,t[0]/2)),l=[],g=[],h=[],c=e[i][0].length;for(h[0]=Math.sqrt(Math.pow(2*(e[i][0][1]-e[i][0][0]),2)+Math.pow(2*(e[i][1][1]-e[i][1][0]),2)),h[c-1]=Math.sqrt(Math.pow(2*(e[i][0][c-1]-e[i][0][c-2]),2)+Math.pow(2*(e[i][0][c-1]-e[i][1][c-2]),2)),j=1;j<e[i][0].length-1;j++)h[j]=Math.sqrt(Math.pow(e[i][0][j+1]-e[i][0][j-1],2)+Math.pow(e[i][1][j+1]-e[i][1][j-1],2));for(j=0;j<e[i][0].length;j++){s=Math.max(j-_,0),n=Math.min(j+_,e[i][0].length-1),d=n-s,o=0,r=0,sumw=0;for(var m=s;n>m;m++)r+=e[i][0][m]*h[m],o+=e[i][1][m]*h[m],sumw+=h[m];g[j]=o/sumw,l[j]=r/sumw}e[i]=[l,g]}a.transform_text_y="smooth("+a.transform_text_y+","+Math.round(t[0])+")"},hist:function(e,t,a){for(i=0;i<e.length;i++){for(var s=Math.min.apply(null,e[i][1]),n=Math.max.apply(null,e[i][1]),o=0,r=-13,_=0,l=2,g=2*Math.floor(Math.pow(e[i][1].length,.5)),_=vals[o]*Math.pow(10,r),h=Math.ceil(n/_)-Math.floor(s/_)+l;h>g;)o+=1,3==o&&(o=0,r+=1),_=vals[o]*Math.pow(10,r),h=Math.ceil(n/_)-Math.floor(s/_)+l;var c=Math.floor(s/_-1)*_,d=Math.ceil(n/_+1)*_,m=[],x=[],f=0;for(bin_start=c;bin_start<d;bin_start+=_){var p=bin_start+_;for(x[f]=0,j=0;j<e[i][1].length-1;j++)bin_start<e[i][1][j]&&e[i][1][j]<p&&(x[f]+=1);m[f]=(bin_start+p)/2,f++}e[i][0]=m,e[i][1]=x}a.transform_text_y="hist("+a.transform_text_y+")",a.transform_text_x="bin_centers("+a.transform_text_x+")"},interpolate:function(e,t,a){var s=Math.min.apply(null,e[0][0]),n=Math.max.apply(null,e[0][0]);for(i=0;i<e.length;i++){var o=Math.min.apply(null,e[i][0]),r=Math.max.apply(null,e[i][0]);s=Math.min(s,o),n=Math.max(n,r)}var _=(n-s)/t[0];for(i=0;i<e.length;i++){var l=[],g=[];for(j=0;j<t[0];j++){l[j]=s+j*_;var h=1e200,c=1,d=1e200,m=e[i][0].length-2;for(k=0;k<e[i][0].length;k++){var x=l[j]-e[i][0][k];x>=0&&h>x&&(h=x,c=k),0>x&&d>-1*x&&(d=-1*x,m=k)}g[j]=e[i][1][c]+(e[i][1][m]-e[i][1][c])/(e[i][0][m]-e[i][0][c])*(l[j]-e[i][0][c])}e[i][0]=l,e[i][1]=g}transforms.clean(e,a),a.transform_text_y="interpolate("+a.transform_text_y+","+t[0]+")",a.transform_text_x="interpolate("+a.transform_text_x+","+t[0]+")"},differentiate:function(e,t,a){for(i=0;i<e.length;i++){for(j=0;j<e[i][0].length-1;j++)e[i][1][j]=(e[i][1][j+1]-e[i][1][j])/(e[i][0][j+1]-e[i][0][j]),e[i][0][j]=(e[i][0][j]+e[i][0][j+1])/2;e[i][1].pop(),e[i][0].pop()}transforms.clean(e,a),a.transform_text_y="d/dx("+a.transform_text_y+")"},subtract_fit:function(e,t,a){var s=t[0];for(i=0;i<e.length;i++){var n=fits.fit_funs[fits.fit_strings.indexOf(s)](e[i][0],e[i][1]),o=n.fun(e[i][0],n.parameters);for(j=0;j<e[i][0].length;j++)e[i][1][j]-=o[j]}transforms.clean(e,a),a.transform_text_y=a.transform_text_y+"-"+n.strings[0]},keep_outliers:function(e,t,a){transforms.outliers_generic(e,t,a,!1)},remove_outliers:function(e,t,a){transforms.outliers_generic(e,t,a,!0)},outliers_generic:function(e,t,a,i){var s=t[0],n=[.5,1,1.5,2,2.5,3],o=t[1]%n.length;0>o&&(o+=n.length);var r=n[o];for(o=0;o<e.length;o++){var _=fits.fit_funs[fits.fit_strings.indexOf(s)](e[o][0],e[o][1]),l=_.fun(e[o][0],_.parameters),g=[],h=0;for(m=0;m<e[o][0].length;m++)h=e[o][1][m]-l[m],isFinite(h)&&g.push(h);for(var c=0,d=0,m=0;m<g.length;m++)c+=g[m],d+=g[m]*g[m];var x=g.length;d-=c*c/x;var f=Math.sqrt(d/x);if(i)for(m=0;m<e[o][0].length;m++)e[o][1][m]-l[m]>r*f&&(e[o][1][m]=0/0);else for(m=0;m<e[o][0].length;m++)e[o][1][m]-l[m]<r*f&&(e[o][1][m]=0/0)}transforms.clean(e,a),a.transform_text_y=i?"remove_outliers("+a.transform_text_y+","+s+","+r+")":"keep_outliers("+a.transform_text_y+","+s+","+r+")"},jitter:function(e,t,a){var s=t[0];for(i=0;i<e.length;i++)for(j=0;j<e[i][1].length;j++)e[i][1][j]=e[i][1][j]+(2*Math.random()-1)*s*e[i][1][j]/100;a.transform_text_y="jitter("+a.transform_text_y+","+s+"%)"},spacing:function(e,t,a){for(i=0;i<e.length;i++){for(j=0;j<e[i][1].length-1;j++)e[i][1][j]=e[i][0][j+1]-e[i][0][j];for(j=0;j<e[i][1].length-1;j++)e[i][0][j]=(e[i][0][j+1]+e[i][0][j])/2;e[i][0][j]=1/0}transforms.clean(e,a),a.transform_text_y="spacing("+a.transform_text_y+")"},time_to_num:function(e,t,a){var s=t[2],n=t[0],o="x"===s?0:1,r=[864e5,36e5,6e4,1e3],_=r[t[1]],l=0;if(0==n&&(l=t[3]),1==n){var g=new Date;l=g.getTime()}if(2==n){var h=1e307,c=1e307;for(i=0;i<e.length;i++){var h=Math.min.apply(null,e[i][o]);c=Math.min(h,c)}l=c}if(3==n){var d=1e-307,m=1e-307;for(i=0;i<e.length;i++){var d=Math.max.apply(null,e[i][o]);m=Math.max(d,m)}l=m}for(console.log(l),console.log(_),i=0;i<e.length;i++)for(j=0;j<e[i][0].length;j++)e[i][o][j]=(e[i][o][j]-l)/_;transforms.clean(e,a)}};return mjs_plot={new_graph:function(graphname,canvasname){"use strict";var canvas=document.getElementById(canvasname),ctx=canvas.getContext("2d");drawSplash(canvas,ctx);var gs=load_gs(graphname);gs.v===MJS_PLOT_VERSION?console.log("version is same"):(gs=mjs_plot.get_graph_style(),console.log("version changed, get new style"));var graph={graphics_style:gs,default_graphics_style:mjs_plot.get_graph_style(),graph_name:graphname,canvas_name:canvasname,drawfxmenu:!1,drawlinemenu:!1,drawmodemenu:!1,drawfitsmenu:!1,drawtimemenu:!1,drawgraphmenu:!1,drawcaptionmenu:!1,drawxmenu:!1,drawymenu:!1,timemenuoptions:[0,0],plot_failed:!1,transparent:!1,needs_drag_image:!0,points_drawn:0,orignal_canvas_width:600,orignal_canvas_height:400,isFullscreen:!1,isSVG:!1,svg:"",errors:[],data:[],data_backup:[],colors:[],colors_backup:[],captions_backup:[],captions:[],onPlotFunctions:[],fit_data:[],reader_index:[0,0],transform_index:-1,transform_text_x:"x",ui:{size:20,touch:is_touch_device(),mouse_is_dragging:!1,is_touching:!1,draw_time:1e200,copy_time:1e200,ticking:!1,latestEvent:!1},transform_text_y:"y",drawing_methods:{draw_y_errors:function(e,t,a,i,s,n){t.beginPath(),n/=2,e.points_drawn+=s-i,t.beginPath();for(var o=i;s>o;o++){var r=e.units_to_pixels(e.data[a][0][o],"x"),_=e.units_to_pixels(e.data[a][1][o]+e.data[a][2][o],"y"),l=e.units_to_pixels(e.data[a][1][o]-e.data[a][2][o],"y");t.moveTo(r,l),t.lineTo(r,_),t.moveTo(r-n,l),t.lineTo(r+n,l),t.moveTo(r-n,_),t.lineTo(r+n,_)}t.stroke()},draw_x_errors:function(e,t,a,i,s,n){t.beginPath(),n/=2,e.points_drawn+=s-i,t.beginPath();for(var o=i;s>o;o++){var r=e.units_to_pixels(e.data[a][1][o],"y"),_=e.units_to_pixels(e.data[a][0][o]+e.data[a][3][o],"x"),l=e.units_to_pixels(e.data[a][0][o]-e.data[a][3][o],"x");t.moveTo(_,r),t.lineTo(l,r),t.moveTo(_,r+n),t.lineTo(_,r-n),t.moveTo(l,r+n),t.lineTo(l,r-n)}t.stroke()},draw_line:function(e,t,a,i,s){var n=e.units_to_pixels(e.data[a][0][i],"x"),o=e.units_to_pixels(e.data[a][1][i],"y");t.beginPath(),t.moveTo(n,o),e.points_drawn+=s-i;for(var r=i;s>r;r++){n=e.units_to_pixels(e.data[a][0][r],"x"),o=e.units_to_pixels(e.data[a][1][r],"y"),t.lineTo(n,o)}t.stroke()},draw_dot:function(e,t,a,i,s,n){t.beginPath(),e.points_drawn+=s-i;for(var o=i;s>o;o++){var r=e.units_to_pixels(e.data[a][0][o],"x"),_=e.units_to_pixels(e.data[a][1][o],"y");t.fillRect(r-n/2,_-n/2,n,n)}},draw_cdot:function(e,t,a,i,s,n){n/=2,e.points_drawn+=s-i;for(var o=i;s>o;o++){t.beginPath();var r=e.units_to_pixels(e.data[a][0][o],"x"),_=e.units_to_pixels(e.data[a][1][o],"y");t.arc(r,_,n,0,2*Math.PI,!0),t.fill()}},draw_circ:function(e,t,a,i,s,n){n/=2,t.beginPath(),e.points_drawn+=s-i;for(var o=i;s>o;o++){var r=e.units_to_pixels(e.data[a][0][o],"x"),_=e.units_to_pixels(e.data[a][1][o],"y");t.beginPath(),t.arc(r,_,n,0,2*Math.PI,!0),t.stroke()}},draw_cross:function(e,t,a,i,s,n){n/=2,t.beginPath(),e.points_drawn+=s-i;for(var o=i;s>o;o++){var r=e.units_to_pixels(e.data[a][0][o],"x"),_=e.units_to_pixels(e.data[a][1][o],"y");t.moveTo(r,_-n),t.lineTo(r,_+n),t.moveTo(r-n,_),t.lineTo(r+n,_)}t.stroke()},draw_x:function(e,t,a,i,s,n){n/=2,t.beginPath(),e.points_drawn+=s-i;for(var o=i;s>o;o++){var r=e.units_to_pixels(e.data[a][0][o],"x"),_=e.units_to_pixels(e.data[a][1][o],"y");t.moveTo(r-n,_-n),t.lineTo(r+n,_+n),t.moveTo(r-n,_+n),t.lineTo(r+n,_-n)}t.stroke()},draw_box:function(e,t,a,i,s,n){t.beginPath(),e.points_drawn+=s-i;for(var o=i;s>o;o++){var r=e.units_to_pixels(e.data[a][0][o],"x"),_=e.units_to_pixels(e.data[a][1][o],"y");t.beginPath(),t.rect(r-n/2,_-n/2,n,n),t.stroke()}},draw_zig:function(e,t,a,i,s){var n=e.units_to_pixels(e.data[a][0][i],"x"),o=e.units_to_pixels(e.data[a][1][i],"y"),r=n,_=o;e.points_drawn+=s-i,t.beginPath(),t.moveTo(n,o);for(var l=i;s>l;l++)n=e.units_to_pixels(e.data[a][0][l],"x"),o=e.units_to_pixels(e.data[a][1][l],"y"),t.lineTo(r,o),t.lineTo(n,o),r=n,_=o;t.stroke()},draw_zag:function(e,t,a,i,s){var n=e.units_to_pixels(e.data[a][0][i],"x"),o=e.units_to_pixels(e.data[a][1][i],"y"),r=n,_=o;e.points_drawn+=s-i,t.beginPath(),t.moveTo(n,o);for(var l=i;s>l;l++)n=e.units_to_pixels(e.data[a][0][l],"x"),o=e.units_to_pixels(e.data[a][1][l],"y"),t.lineTo(n,_),t.lineTo(n,o),r=n,_=o;t.stroke()},draw_mid:function(e,t,a,i,s){var n=e.units_to_pixels(e.data[a][0][i],"x"),o=e.units_to_pixels(e.data[a][1][i],"y"),r=n,_=o,l=n,g=o;e.points_drawn+=s-i,t.beginPath(),t.moveTo(n,o);for(var h=i;s>h;h++)n=e.units_to_pixels(e.data[a][0][h],"x"),o=e.units_to_pixels(e.data[a][1][h],"y"),t.lineTo((l+n)/2,g),t.lineTo((l+n)/2,o),r=l,_=g,l=n,g=o;n=e.units_to_pixels(e.data[a][0][s-1],"x"),o=e.units_to_pixels(e.data[a][1][s-1],"y"),t.lineTo(n,o),t.stroke()},draw_hist:function(e,t,a,i,s){var n=Math.min(e.units_to_pixels(0,"y"),canvas.height),o=e.units_to_pixels(e.data[a][0][i],"x"),r=e.units_to_pixels(e.data[a][1][i],"y"),_=o,l=r,g=o,h=r;e.points_drawn+=s-i,o=e.units_to_pixels(e.data[a][0][i+1],"x"),r=e.units_to_pixels(e.data[a][1][i+1],"y"),t.beginPath(),t.moveTo(g-(o-g)/2,n),t.lineTo(g-(o-g)/2,h),t.lineTo((o+g)/2,h);for(var c=i+1;s>c;c++)o=e.units_to_pixels(e.data[a][0][c],"x"),r=e.units_to_pixels(e.data[a][1][c],"y"),t.lineTo((g+_)/2,h),t.lineTo((g+o)/2,h),t.lineTo((g+o)/2,n),_=g,l=h,g=o,h=r;o=e.units_to_pixels(e.data[a][0][s-1],"x"),r=e.units_to_pixels(e.data[a][1][s-1],"y"),t.moveTo((_+o)/2,n),t.lineTo((_+o)/2,r),t.lineTo(o+(o-_)/2,r),t.lineTo(o+(o-_)/2,n),t.stroke()},draw_approx:function(e,t,a,i,s){e.points_drawn+=s-i;var n=e.units_to_pixels(e.data[a][0][i],"x"),o=e.units_to_pixels(e.data[a][1][i],"y"),r=n,_=o,l=n,g=o,h=n,c=o;t.beginPath(),t.moveTo(r,_),t.lineTo((r+n)/2,(_+o)/2);for(var d=i+1;s>d;d++)n=e.units_to_pixels(e.data[a][0][d],"x"),o=e.units_to_pixels(e.data[a][1][d],"y"),t.quadraticCurveTo(h,c,(h+n)/2,(c+o)/2),r=l,_=g,l=h,g=c,h=n,c=o;n=e.units_to_pixels(e.data[a][0][s-1],"x"),o=e.units_to_pixels(e.data[a][1][s-1],"y"),t.lineTo(n,o),t.stroke()},draw_interp:function(e,t,a,i,s){3>s-i&&this.draw_line(e,t,a,i,s),e.points_drawn+=s-i;var n=e.units_to_pixels(e.data[a][0][i],"x"),o=e.units_to_pixels(e.data[a][1][i],"y"),r=n,_=o,l=n,g=o,h=e.units_to_pixels(e.data[a][0][i+1],"x"),c=e.units_to_pixels(e.data[a][1][i+1],"y"),n=e.units_to_pixels(e.data[a][0][i+2],"x"),o=e.units_to_pixels(e.data[a][1][i+2],"y");t.beginPath();var d=5;t.moveTo(r,_),t.bezierCurveTo((h-r)/d+r,(c-_)/d+_,h-(n-r)/d,c-(o-_)/d,h,c),t.moveTo(l,g);for(var m=i+2;s>m;m++)n=e.units_to_pixels(e.data[a][0][m],"x"),o=e.units_to_pixels(e.data[a][1][m],"y"),t.bezierCurveTo((h-r)/d+l,(c-_)/d+g,h-(n-l)/d,c-(o-g)/d,h,c),r=l,_=g,l=h,g=c,h=n,c=o;n=e.units_to_pixels(e.data[a][0][s-1],"x"),o=e.units_to_pixels(e.data[a][1][s-1],"y"),t.bezierCurveTo((n-r)/d+l,(o-_)/d+g,n-(n-l)/d,o-(o-g)/d,n,o),t.stroke()},draw_scribble:function(e,t,a,i,s){3>s-i&&this.draw_line(e,t,a,i,s),e.points_drawn+=s-i;var n=e.units_to_pixels(e.data[a][0][i],"x"),o=e.units_to_pixels(e.data[a][1][i],"y"),r=n,_=o,l=n,g=o,h=e.units_to_pixels(e.data[a][0][i+1],"x"),c=e.units_to_pixels(e.data[a][1][i+1],"y"),n=e.units_to_pixels(e.data[a][0][i+2],"x"),o=e.units_to_pixels(e.data[a][1][i+2],"y");t.beginPath();var d=.2;for(t.moveTo(r,_),t.bezierCurveTo((h-r)/d+r,(c-_)/d+_,h-(n-r)/d,c-(o-_)/d,h,c),t.moveTo(l,g),j=i+2;j<s;j++)n=e.units_to_pixels(e.data[a][0][j],"x"),o=e.units_to_pixels(e.data[a][1][j],"y"),t.bezierCurveTo((h-r)/d+l,(c-_)/d+g,h-(n-l)/d,c-(o-g)/d,h,c),r=l,_=g,l=h,g=c,h=n,c=o;n=e.units_to_pixels(e.data[a][0][s-1],"x"),o=e.units_to_pixels(e.data[a][1][s-1],"y"),t.bezierCurveTo((n-r)/d+l,(o-_)/d+g,n-(n-l)/d,o-(o-g)/d,n,o),t.stroke()}},set_data:function(e){this.transform_index=-1;for(var t=0;t<e.length;t++)e[t][0].length!=e[t][1].length&&this.errors.push("series "+t+"had different legnth x and y arrays");if(this.data_backup=clone(e),transforms.clean(this.data_backup,this),this.data=clone(this.data_backup),this.data.length!=e.length)this.errors.push("A series was cleaned away in set_data");else for(var t=0;t<e.length;t++)this.data[t][0].length!=e[t][0].length&&this.errors.push("series "+t+" had non finite values");for(var t=0;t<this.data.length;t++)this.graphics_style.hidden_lines[t]=this.graphics_style.hidden_lines[t]||!1;this.colors=[];for(var t=0;t<this.data.length;t++)if(this.graphics_style.caption_colors)try{this.colors[t]=color_from_string(this.captions[t]||"label")}catch(a){this.colors[t]=color_from_string("label")}else this.colors[t]=get_color(t,this.data.length-1);this.colors_backup=clone(this.colors)},set_captions:function(e){this.captions_backup=clone(e),this.captions=clone(e),this.captions.length!=this.data_backup.length&&this.errors.push("number of captions and number of series don't match"),this.colors=[];for(var t=0;t<this.data.length;t++)this.graphics_style.caption_colors?(this.colors[t]=color_from_string(this.captions[t]||"label"),console.log("using cap colours")):this.colors[t]=get_color(t,this.data.length-1);this.colors_backup=clone(this.colors)},find_scale:function(e,t,a,i,s,n,o){if("lin"===s){var r=0;if(Math.abs(e)>1e-250)var _=Math.floor(Math.log10(Math.abs(e)))-10;else _=-250;var l,g=0,h=0;h=n?0:2;for(var c=Math.floor(a/i)+h,g=vals[r]*Math.pow(10,_),d=Math.ceil(t/g)-Math.floor(e/g)+h;d>c;)r+=1,3==r&&(r=0,_+=1),g=vals[r]*Math.pow(10,_),d=Math.ceil(t/g)-Math.floor(e/g)+h;if(l=0==d?a:a/d,n)var m=Math.floor(e/g)*g,x=Math.ceil(t/g)*g;else var m=Math.floor(e/g-1)*g,x=Math.ceil(t/g+1)*g;return D={lowpoint:m,highpoint:x,scale:g,width:l,val_i:r,val_i_low:1,power_low:1,val_i_high:1,power_high:1,scalemode:s}}if("log"===s){var r=0,_=100,f=-1,p=!1,u=Math.floor(a/i/2);for(d=0;u>d;){for(f+=1,_=Math.ceil(Math.log10(e))+1,r=0;log_vals[f][r]*Math.pow(10,_)>=e;)r-=1,0>r&&(_-=1,r=log_vals[f].length-1);n===!1&&(r-=1,0>r&&(_-=1,r=log_vals[f].length-1));var y=r,v=_;for(d=0;log_vals[f][r]*Math.pow(10,_)<=t;)r+=1,d+=1,r>=log_vals[f].length&&(_+=1,r=0);n===!1&&(r+=1,d+=1,r>=log_vals[f].length&&(_+=1,r=0));var w=r,T=_;(f>=log_vals.length||Math.log10(t)-Math.log10(e)<.6)&&0==p?(d=u,D=this.find_scale(e,t,a,i,"lin",n),D.lowpoint<=0&&(p=!0,d=0),m=Math.log10(D.lowpoint),x=Math.log10(D.highpoint),g=D.scale,l=D.width,f=D.val_i):(m=Math.log10(log_vals[f][y]*Math.pow(10,v)),x=Math.log10(log_vals[f][w]*Math.pow(10,T)),g=-1,l=-1,f=f)}if(0==f&&d>2*u){var b="y"===o&&("infix"===this.graphics_style.y_label_mode||"postfix"===this.graphics_style.y_label_mode);b=b||"x"===o&&("infix"===this.graphics_style.x_label_mode||"postfix"===this.graphics_style.x_label_mode),b&&(vals=[1,3,6,9]),D=this.find_scale(Math.max(-249,Math.log10(e)),Math.min(249,Math.log10(t)),a,i,"lin",n),b&&(vals=[1,2,5]),m=D.lowpoint,x=D.highpoint,g=D.scale,s="log",l=D.width,f=-1}return D={lowpoint:m,highpoint:x,scale:g,width:l,val_i:f,val_i_low:y,power_low:v,val_i_high:w,power_high:T,scalemode:s}}if("time"===s){if(n)var h=0;else var h=2;for(var k=Math.floor(a/i)+h,M=(t-e)/k,j=0;allowed_intervals[j]<M;)j++;j=Math.min(j,allowed_intervals.length-1),h/=2;var S=e-e%allowed_intervals[j]-h*allowed_intervals[j],P=t-t%allowed_intervals[j]+h*allowed_intervals[j];if(allowed_intervals[j]>=31536e6){var z=new Date(S);z=new Date(z.getFullYear(),0,0),S=z.getTime();var z=new Date(P);z=new Date(z.getFullYear()+Math.round(allowed_intervals[j]/1e3/60/60/24/365)+Math.round(z.getMonth()/12),0,0),P=z.getTime()}if(allowed_intervals[j]>=2592e6&&allowed_intervals[j]<31536e6){var z=new Date(S);z=new Date(z.getFullYear(),z.getMonth(),1),S=z.getTime();var z=new Date(P);z=z.getDate()<15?new Date(z.getFullYear(),z.getMonth(),1):new Date(z.getFullYear(),z.getMonth()+1,1),P=z.getTime()+allowed_intervals[j]}if(allowed_intervals[j]>=432e5&&allowed_intervals[j]<2592e6){var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),0,0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),0,0,0,0),P=z.getTime()+allowed_intervals[j]}if(allowed_intervals[j]>=18e5&&allowed_intervals[j]<=216e5){var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),z.getHours(),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),z.getHours()+1,0,0,0),P=z.getTime()}if(72e5==allowed_intervals[j]){var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),2*Math.floor(z.getHours()/2),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),2*Math.floor(1+z.getHours()/2),0,0,0),P=z.getTime()}if(108e5==allowed_intervals[j]){console.log("every three horus");var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),3*Math.floor(z.getHours()/3),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),3*Math.floor(1+z.getHours()/3),0,0,0),P=z.getTime()}if(216e5==allowed_intervals[j]){console.log("every six horus");var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),6*Math.floor(z.getHours()/6),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),6*Math.floor(1+z.getHours()/6),0,0,0),P=z.getTime()}allowed_intervals[j]<18e5&&(P+=allowed_intervals[j]);var D,F=Math.floor((P-S)/allowed_intervals[j]),g=a/F,A=Math.floor((P-S)/time_ticks[j]),q=a/A;return D={lowpoint:S,highpoint:P,scale:g,width:q,val_i:j,val_i_low:0,power_low:0,val_i_high:0,power_high:0,scalemode:"time"}}},find_limits:function(e,t,a,i,s,n,o){if(s=Math.min(s,1e250),i=Math.max(i,-1e250),"time"===n&&(s=Math.min(s,1e14),i=Math.max(i,-1e14)),this.no_data=!1,0==e.length)return t||a?(l=1,g=10,t=!0,a=!0):(l=i,g=s),"log"===n&&(0>=l&&(l=1),(0>=g||l>g)&&(g=10)),this.no_data=!0,{low:l,high:g,automax:a,automin:t,scale:n};if("log"===n&&(0>=i&&0==t&&(t=!0,this.errors.push(o+" minimum was negative - using auto")),0>=s&&0==a&&(t=!0,a=!0,this.errors.push(o+" maximum was negative - using auto"))),1==t||1==a||l>=g){var r=1e307,_=-1e307,l=1e307,g=-1e307;for(h=0;h<e.length;h++){var r=Math.min.apply(null,e[h]),_=Math.max.apply(null,e[h]);l=Math.min(r,l),g=Math.max(_,g)}}if(l==g&&(l=.6*Math.min(l,g),g=1.6*Math.max(l,g)),1==this.data.length&&1==this.data[0][0].length&&(l=.6*Math.min(l,g),g=1.6*Math.max(l,g)),i>g&&a&&!t&&(t=!0,a=!0,this.errors.push(o+" can't have inverted scale - using auto")),l>s&&t&&!a&&(t=!0,a=!0,this.errors.push(o+" can't have inverted scale - using auto")),0==t&&(l=i),0==a&&(g=s),"log"===n&&0>=g&&(n="lin",this.errors.push("all "+o+" data is negative, cant plot that log"+o)),"log"===n&&2e-250>=l){l=2e250;for(var h=0;h<e.length;h++)for(var c=0;c<this.data[h][1].length;c++)e[h][c]>0&&e[h][c]<l&&(l=e[h][c])}return"log"===n&&(s=Math.max(s,2e-250),i=Math.max(i,2e-250)),{low:l,high:g,automax:a,automin:t,scale:n}},use_scale:function(e,t,a,i){var s,n,o,r=e.lowpoint,_=e.highpoint,l=e.scale,g=e.width,h=e.val_i,c=e.val_i_low,d=e.power_low,m=e.val_i_high,x=e.power_high,f=e.scalemode,p=1,u=[],y=[],v=[];if("lin"===f){for(var w=0,T=" ",b=1,k="",M=(0-r)*t/(_-r);t>=w;)D=w/g*l+r,k=D.toPrecision(b),k===T&&(b+=1,k=D.toPrecision(b)),T=k,w+=g;w=g;for(var j=1;t-1>w;)D=j*l+r,u.push(w),k=Math.abs(w-M)<2?0..toFixed(Math.max(1,b-1)):this.get_axis_string(D,i,b),y.push(k),w+=g,j+=1;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>g;w=0;var P=1;for(P=g>a*p?many_minor_ticks[h]:few_minor_ticks[h];t>=w;)v.push(w),w+=g/P}if("log"===f&&-1==h){for(var w=0,T=" ",b=1,k="";t>=w;)D=Math.pow(10,w/g*l+r),k=D.toPrecision(b),k===T&&(b+=1,k=D.toPrecision(b)),T=k,w+=g;w=g;for(var j=1;t-1>w;)D=Math.pow(10,j*l+r),u.push(w),k=this.get_axis_string(D,i,b),y.push(k),w+=g,j+=1;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>g;w=0;var P=1;for(P=g>a*p?many_minor_ticks[h]:few_minor_ticks[h];t>=w;)v.push(w),w+=g/P}if("log"===f&&-1!=h)if(0>l){for(s=c,n=d,D=log_vals[h][c]*Math.pow(10,d),o=D,b=2;D<log_vals[h][m]*Math.pow(10,x);){if(s+=1,s>=log_vals[h].length&&(n+=1,s=0),D=log_vals[h][s]*Math.pow(10,n),w=(Math.log10(D)-r)*t/(_-r),t-10>w&&(y.push(this.get_axis_string(D,i,2)),u.push(w)),h>8){var z=(Math.log10((o+D)/2)-r)*t/(_-r);v.push(z)}o=D}if(8>=h)for(D=log_vals[h][c]*Math.pow(10,d),s=c,n=d;D<log_vals[h][m]*Math.pow(10,x);)D=log_vals_ticks[h][s]*Math.pow(10,n),w=(Math.log10(D)-r)*t/(_-r),v.push(w),s+=1,s>=log_vals_ticks[h].length&&(n+=1,s=0)}else{var w=0,T=" ",b=1,k="";for(D=Math.pow(10,r);D<=Math.pow(10,_);)k=D.toPrecision(b),k===T&&(b+=1,k=D.toPrecision(b)),T=k,D+=l;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>=g;for(D=Math.pow(10,r)+l;D<Math.pow(10,_)-l/2;)k=this.get_axis_string(D,i,b),w=(Math.log10(D)-r)*t/(_-r),u.push(w),y.push(k),D+=l;var P=1;for(P=g>a*p?many_minor_ticks[h]:few_minor_ticks[h],D=Math.pow(10,r);D<Math.pow(10,_);)w=(Math.log10(D)-r)*t/(_-r),v.push(w),D+=l/P}if("time"===f){var D=e.val_i,F=_-r;for(j=0;allowed_intervals[j]<F;)j++;j--;for(var A=string_precisions[D],q=string_precisions[j],C=r,E=mjs_date_print(C,q,q),w=0,L="",k="";_>C;)C+=allowed_intervals[D],allowed_intervals[D]>=2592e6&&(C=round_to_month(C)),w=(C-r)/F*t,k=mjs_date_print(C,q,A),k===L&&A++,L=k;var O=mjs_date_print(C,q,q);O===E&&q++;for(var C=r,w=0,I=0;C<_-allowed_intervals[D]&&t-2>w+l;){for(C+=allowed_intervals[D],allowed_intervals[D]>=2592e6&&(C=round_to_month(C)),w=(C-r)/F*t,u.push(w),k=mjs_date_print(C,q,A),y.push(k);w>I;)I+=g,v.push(I);var I=w;v.pop()}for(;t>I;)I+=g,v.push(I);S=!1;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>l;b=A}return{pos:u,strings:y,minor_pos:v,stepping:S,precision:b}},fit_points_drawn:0,drawSimpleLine:function(e,t,a){var i=this.units_to_pixels(t[0],"x"),s=this.units_to_pixels(a[0],"y"),n=i,o=s;e.beginPath(),e.moveTo(i,s);for(var r=!0,_=!0,l=0;l<t.length;l++){this.fit_points_drawn++;var s=this.units_to_pixels(a[l],"y"),i=this.units_to_pixels(t[l],"x");r=s>0&&s<this.canvas.height,r&&_&&e.lineTo(i,s),!r&&_&&(e.lineTo(i,s),e.stroke()),r&&!_&&(e.beginPath(),e.moveTo(n,o),e.lineTo(i,s)),_=r,n=i,o=s}e.stroke()},mjs_plot:function(){var start_time=new Date;this.plot_failed&&(this.errors.push("failed for unknown reason"),this.graphics_style=JSON.parse(JSON.stringify(this.default_graphics_style))),this.plot_failed=!0,0==this.graphics_style.modified&&(console.log("getting defautts"),this.graphics_style=JSON.parse(JSON.stringify(this.default_graphics_style)));var gs=this.graphics_style,ctx=this.canvas.getContext("2d");if(this.isSVG)var ctx=new SVGContext(ctx);ctx.lineJoin="round";var canvas=this.canvas,graph_line_thickness=gs.graph_line_thickness,symbol_size=gs.symbol_size,line_thickness=gs.line_thickness,tick_len=gs.tick_len,mode=gs.mode,font_name=gs.font_name,title_font_size=gs.title_font_size,title=gs.title,subtitle=gs.subtitle,title_spacing=gs.title_spacing,tick_labels_font_size=gs.tick_labels_font_size,tick_lables_font_padding=gs.tick_lables_font_padding,axis_labels_font_size=gs.axis_labels_font_size,lable_spacing=gs.lable_spacing,x_axis_title=gs.x_axis_title,y_axis_title=gs.y_axis_title,minor_tick_len=gs.minor_tick_len,guideWidthx=gs.guideWidthx,guideWidthy=gs.guideWidthy,scaling_factor=gs.scaling_factor;guideWidthx*=scaling_factor,guideWidthy*=scaling_factor,lable_spacing*=scaling_factor,axis_labels_font_size*=scaling_factor,tick_lables_font_padding*=scaling_factor,tick_labels_font_size*=scaling_factor,title_spacing*=scaling_factor,title_font_size*=scaling_factor,tick_len*=scaling_factor,line_thickness*=scaling_factor,symbol_size*=scaling_factor,graph_line_thickness*=scaling_factor,minor_tick_len*=scaling_factor;try{ctx.font=tick_labels_font_size+"px "+font_name,ctx.fillText("font test",10,10)}catch(e){console.log("font faliure"),this.errors.push("font faliure"),font_name="Courier New",gs.font_name="Courier New"}for(ctx.fillStyle=gs.color_bg,ctx.strokeStyle=gs.color_fg,this.transparent?ctx.clearRect(0,0,canvas.width,canvas.height):ctx.fillRect(0,0,canvas.width,canvas.height),this.isSVG&&(ctx.clearAll(),ctx.font_name=font_name),this.transform_index!=gs.data_transforms.length&&(this.data=clone(this.data_backup),this.captions=clone(this.captions_backup),this.colors=clone(this.colors_backup),this.transform_index=0,this.transform_text_x=x_axis_title,this.transform_text_y=y_axis_title,transforms.remove_lines(this.data,gs.hidden_lines,this));this.transform_index<gs.data_transforms.length;){var fun=eval("transforms."+gs.data_transforms[this.transform_index]);console.log("running "+gs.data_transforms[this.transform_index]),fun(this.data,gs.data_transforms_args[this.transform_index],this),this.transform_index++}for(var xdata=[],ydata=[],i=0;i<this.data.length;i++)xdata.push(this.data[i][0]),ydata.push(this.data[i][1]);var xlimits=this.find_limits(xdata,gs.x_scale_auto_min,gs.x_scale_auto_max,gs.x_manual_min,gs.x_manual_max,gs.x_scale_mode,"x"),xlow=xlimits.low,xhigh=xlimits.high;gs.x_scale_auto_min=xlimits.automin,gs.x_scale_auto_max=xlimits.automax,gs.x_scale_mode=xlimits.scale;var ylimits=this.find_limits(ydata,gs.y_scale_auto_min,gs.y_scale_auto_max,gs.y_manual_min,gs.y_manual_max,gs.y_scale_mode,"y"),ylow=ylimits.low,yhigh=ylimits.high;gs.y_scale_auto_min=ylimits.automin,gs.y_scale_auto_max=ylimits.automax,gs.y_scale_mode=ylimits.scale;var the_scalex=this.find_scale(xlow,xhigh,this.canvas.width,guideWidthx,gs.x_scale_mode,gs.x_scale_tight,"x"),lowpointx=the_scalex.lowpoint,highpointx=the_scalex.highpoint,scalex=the_scalex.scale,widthx=the_scalex.width,val_ix=the_scalex.val_i,val_i_lowx=the_scalex.val_i_low,power_lowx=the_scalex.power_low,val_i_highx=the_scalex.val_i_high,power_highx=the_scalex.power_high,the_scaley=this.find_scale(ylow,yhigh,this.canvas.height,guideWidthy,gs.y_scale_mode,gs.y_scale_tight,"y"),lowpointy=the_scaley.lowpoint,highpointy=the_scaley.highpoint,scaley=the_scaley.scale,widthy=the_scaley.width,val_iy=the_scaley.val_i,val_i_lowy=the_scaley.val_i_low,power_lowy=the_scaley.power_low,val_i_highy=the_scaley.val_i_high,power_highy=the_scaley.power_high;gs.x_auto_min=lowpointx,gs.x_auto_max=highpointx,gs.y_auto_min=lowpointy,gs.y_auto_max=highpointy;var positionsx=this.use_scale(the_scalex,canvas.width,guideWidthx,"x"),positionsy=this.use_scale(the_scaley,canvas.height,guideWidthy,"y");if(gs.y_scale_auto_min&&(gs.y_manual_min=this.pixels_to_units(this.canvas.height,"y")),gs.y_scale_auto_max&&(gs.y_manual_max=this.pixels_to_units(0,"y")),gs.x_scale_auto_min&&(gs.x_manual_min=this.pixels_to_units(0,"x")),gs.x_scale_auto_max&&(gs.x_manual_max=this.pixels_to_units(this.canvas.width,"x")),gs.scalex=scalex,gs.scaley=scaley,gs.widthx=widthx,gs.widthy=widthy,gs.show_grid){ctx.strokeStyle=gs.color_fg,ctx.globalAlpha=.2,ctx.beginPath();for(var i=0;i<positionsy.pos.length;i++){var y=canvas.height-positionsy.pos[i];ctx.moveTo(0,y),ctx.lineTo(canvas.width,y)}for(var i=0;i<positionsx.pos.length;i++){var x=positionsx.pos[i];ctx.moveTo(x,0),ctx.lineTo(x,canvas.height)}ctx.stroke(),ctx.globalAlpha=1}for(var lines_start=0,lines_end=canvas.width,fit_x=[],j=lines_start;lines_end>j;j+=2)fit_x.push(this.pixels_to_units(j,"x"));
for(var fit_y=[],i=0;i<gs.function_lines.length;i++)try{fit_y=parseExpression(gs.function_lines[i],fit_x,fit_x),this.drawSimpleLine(ctx,fit_x,fit_y)}catch(e){this.errors.push("function line:y="+gs.function_lines[i]+" fails")}ctx.font=tick_labels_font_size+"px "+font_name,ctx.lineWidth=line_thickness;var drawn_something=!1,drawn_caps=!1,points_drawn=0,hist_zero=Math.min(this.units_to_pixels(0,"y"),canvas.height),full_auto_zoom=gs.y_scale_auto_min&&gs.y_scale_auto_max&&gs.x_scale_auto_min&&gs.x_scale_auto_max;for(i=0;i<this.data.length;i++){if(ctx.strokeStyle=this.colors[i],ctx.fillStyle=ctx.strokeStyle,"none"===gs.symbol_mode&&"none"==gs.line_mode&&this.errors.push("no symbols or lines to draw"),full_auto_zoom)seq_start=[0],seq_end=[this.data[i][0].length];else{for(var ongraph=!1,wasOngraph=!1,graph_top=this.pixels_to_units(0,"y"),graph_bottom=this.pixels_to_units(canvas.height,"y"),graph_left=this.pixels_to_units(0,"x"),graph_right=this.pixels_to_units(canvas.width,"x"),seq_start=[],seq_end=[],k=0;k<this.data[i][0].length;k++)ongraph=this.data[i][0][k]>graph_left&&this.data[i][0][k]<graph_right&&this.data[i][1][k]>graph_bottom&&this.data[i][1][k]<graph_top,!ongraph&&wasOngraph&&seq_end.push(Math.min(k+2,this.data[i][0].length)),ongraph&&!wasOngraph&&seq_start.push(Math.max(k-2,0)),wasOngraph=ongraph;for(seq_start.length>seq_end.length&&seq_end.push(k),k=seq_start.length-1;k>=0;k--)seq_start[k]<=seq_end[k-1]+2&&(seq_end[k-1]=seq_end[k],seq_end.splice(k,1),seq_start.splice(k,1))}for(drawn_something=drawn_something||seq_start.length>0,k=0;k<seq_start.length;k++)gs.line_mode.indexOf("line")>-1&&this.drawing_methods.draw_line(this,ctx,i,seq_start[k],seq_end[k]),"dot"===gs.symbol_mode&&this.drawing_methods.draw_dot(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"cdot"===gs.symbol_mode&&this.drawing_methods.draw_cdot(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"circ"===gs.symbol_mode&&this.drawing_methods.draw_circ(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"box"===gs.symbol_mode&&this.drawing_methods.draw_box(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"x"===gs.symbol_mode&&this.drawing_methods.draw_x(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"cross"===gs.symbol_mode&&this.drawing_methods.draw_cross(this,ctx,i,seq_start[k],seq_end[k],symbol_size),gs.line_mode.indexOf("zig")>-1&&this.drawing_methods.draw_zig(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("zag")>-1&&this.drawing_methods.draw_zag(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("mid")>-1&&this.drawing_methods.draw_mid(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("approx")>-1&&this.drawing_methods.draw_approx(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("interp")>-1&&this.drawing_methods.draw_interp(this,ctx,i,seq_start[k],seq_end[k]),gs.line_mode.indexOf("hist")>-1&&this.drawing_methods.draw_hist(this,ctx,i,seq_start[k],seq_end[k]),this.data[i].length>=3&&this.drawing_methods.draw_y_errors(this,ctx,i,seq_start[k],seq_end[k],symbol_size),this.data[i].length>=4&&this.drawing_methods.draw_x_errors(this,ctx,i,seq_start[k],seq_end[k],symbol_size)}ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=gs.color_fg,ctx.fillStyle=gs.color_fg,drawn_something||0!=this.no_data||0!=gs.function_lines.length||this.errors.push("there might be data around, just not where you're looking"),this.isSVG||(graph.needs_drag_image||"drag"===gs.mouse_mode)&&(this.graph_image_for_drag=ctx.getImageData(0,0,canvas.width,canvas.height),graph.needs_drag_image=!1);var l=positionsx.strings.length,stepping=ctx.measureText(positionsx.strings[1]+" ").width>positionsx.pos[1]-positionsx.pos[0]||ctx.measureText(positionsx.strings[l-1]+" ").width>positionsx.pos[l-1]-positionsx.pos[l-2];if(stepping)var j=-1*tick_labels_font_size/2,o=tick_labels_font_size/2;else var j=0,o=0;ctx.textAlign="center",ctx.beginPath();for(var i=0;i<positionsx.pos.length;i++){var x=positionsx.pos[i],label=positionsx.strings[i];ctx.fillText(label,x,canvas.height-1.2*tick_len-tick_lables_font_padding-o-j),j*=-1,ctx.moveTo(x,0),ctx.lineTo(x,tick_len),ctx.moveTo(x,canvas.height),ctx.lineTo(x,canvas.height-tick_len)}ctx.stroke(),ctx.beginPath();for(var i=0;i<positionsx.minor_pos.length;i++)x=positionsx.minor_pos[i],ctx.moveTo(x,0),ctx.lineTo(x,minor_tick_len),ctx.moveTo(x,canvas.height),ctx.lineTo(x,canvas.height-minor_tick_len);ctx.stroke(),gs.x_precision=positionsx.precision,ctx.textAlign="left",ctx.beginPath();for(var i=0;i<positionsy.pos.length;i++){var y=canvas.height-positionsy.pos[i],label=positionsy.strings[i];y>tick_len+lable_spacing+axis_labels_font_size/2&&y<canvas.height-tick_labels_font_size-tick_lables_font_padding-tick_len&&ctx.fillText(label,1.2*tick_len+2,y+3),ctx.moveTo(0,y),ctx.lineTo(tick_len,y),ctx.moveTo(canvas.width,y),ctx.lineTo(canvas.width-tick_len,y)}ctx.stroke(),ctx.beginPath();for(var i=0;i<positionsy.minor_pos.length;i++)y=canvas.height-positionsy.minor_pos[i],ctx.moveTo(0,y),ctx.lineTo(minor_tick_len,y),ctx.moveTo(canvas.width,y),ctx.lineTo(canvas.width-minor_tick_len,y);if(ctx.stroke(),gs.y_precision=positionsy.precision,gs.show_captions){for(ctx.font=tick_labels_font_size+"px "+font_name,x=gs.scaling_factor*gs.caption_position.x,y=gs.scaling_factor*gs.caption_position.y,gs.caption_position.y>0?(y+=tick_labels_font_size,dy=tick_labels_font_size,y+=tick_len):(dy=tick_labels_font_size,y=canvas.height+y,y+=tick_labels_font_size-this.data.length*dy,y-=tick_len),gs.caption_position.x>0?(ctx.textAlign="left",x+=tick_len):(ctx.textAlign="right",x=canvas.width+x,x-=tick_len),i=0;i<this.data.length;i++){ctx.fillStyle=this.colors[i],label=this.captions[i]||"label";var splitter=" : ";switch(gs.captions_display){case"ylast":label+=splitter+this.get_axis_string(this.data[i][1][this.data[i][1].length-1],"y");break;case"xlast":label+=splitter+this.get_axis_string(this.data[i][0][this.data[i][0].length-1],"x");break;case"xfirst":label+=splitter+this.get_axis_string(this.data[i][0][0],"x");break;case"yfirst":label+=splitter+this.get_axis_string(this.data[i][1][0],"y");break;case"xmin":label+=splitter+this.get_axis_string(Math.min.apply(null,this.data[i][0]),"x");break;case"ymin":label+=splitter+this.get_axis_string(Math.min.apply(null,this.data[i][1]),"y");break;case"ymax":label+=splitter+this.get_axis_string(Math.max.apply(null,this.data[i][1]),"y");break;case"xmax":label+=splitter+this.get_axis_string(Math.max.apply(null,this.data[i][0]),"x")}this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(label,x,y)),ctx.fillText(label,x,y),y+=dy}this.data.length!=this.data_backup.length&&(label="other lines hidden",this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(label,x,y)),ctx.fillStyle="#808080",ctx.fillText(label,x,y))}if(ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=graph.graphics_style.color_fg,ctx.fillStyle=graph.graphics_style.color_fg,(this.transform_text_x.length>1||this.transform_text_y.length>1)&&gs.showTransformTexts)var x_label=this.transform_text_x,y_label=this.transform_text_y;else var x_label=x_axis_title,y_label=y_axis_title;ctx.font=axis_labels_font_size+"px "+font_name,ctx.textAlign="right";var label=x_label;"time"===gs.x_scale_mode&&this.graphics_style.x_precision>1&&(label+=" "+mjs_date_print(this.pixels_to_units(canvas.width,"x"),0,Math.max(this.graphics_style.x_precision-1,0))),stepping?ctx.fillText(label,canvas.width-lable_spacing-tick_len,canvas.height-tick_len-lable_spacing-2*tick_labels_font_size):ctx.fillText(label,canvas.width-lable_spacing-tick_len,canvas.height-tick_len-lable_spacing-tick_labels_font_size),ctx.textAlign="left";var label=y_label;"time"===gs.y_scale_mode&&this.graphics_style.y_precision>1&&(label+=" "+mjs_date_print(this.pixels_to_units(0,"y"),0,Math.max(this.graphics_style.y_precision-1,0))),ctx.fillText(label,tick_len+lable_spacing,tick_len+lable_spacing),ctx.beginPath(),ctx.stroke();var sigma=String.fromCharCode(963),squared=String.fromCharCode(178),bar=String.fromCharCode(773),edge=2.6*tick_len;ctx.font=axis_labels_font_size+"px "+font_name;var fit_points_drawn=0;if("none"===gs.fits);else{ctx.textAlign="left";var x=gs.fit_text_position.x*canvas.width,y=gs.fit_text_position.y*canvas.height,dy=1.2*axis_labels_font_size;for(i=0;i<this.data.length;i++){var label=this.captions[i]||"label";ctx.fillStyle=this.colors[i];var string1="",string2="",string3="";if(this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/2,ctx.strokeText(label,x,y)),ctx.fillText(label,x,y),ctx.fillStyle=gs.color_fg,ctx.lineWidth=line_thickness,ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,"stats"===gs.fits){var stats=series_stats(this.data[i][0],this.data[i][1]);ctx.fillStyle=gs.color_fg,string1=" n = "+stats.n+",    cov(x,y) = "+mjs_precision(stats.cov,Math.min(gs.x_precision,gs.y_precision)+3),string2=bar+"x = "+number_quote(stats.x_mean,stats.sigma_x)+",   "+sigma+"(x) = "+mjs_precision(stats.sigma_x,2),string3=bar+"y = "+number_quote(stats.y_mean,stats.sigma_y)+",   "+sigma+"(y) = "+mjs_precision(stats.sigma_y,2),ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,ctx.beginPath();for(var k=-1;2>k;k++){var yi=graph.units_to_pixels(stats.y_mean+k*stats.sigma_y,"y");ctx.moveTo(graph.units_to_pixels(stats.xmin,"x"),yi),ctx.lineTo(graph.units_to_pixels(stats.xmax,"x"),yi)}ctx.stroke(),ctx.beginPath();for(var k=-1;2>k;k++){var xi=graph.units_to_pixels(stats.x_mean+k*stats.sigma_x,"x");ctx.moveTo(xi,graph.units_to_pixels(stats.ymax,"y")),ctx.lineTo(xi,graph.units_to_pixels(stats.ymin,"y"))}ctx.stroke(),drawEllipse(this,ctx,stats.x_mean,stats.y_mean,stats.sigma_x,stats.sigma_y),drawEllipse(this,ctx,stats.x_mean,stats.y_mean,2*stats.sigma_x,2*stats.sigma_y)}if("old"===gs.fits&&0==this.fit_data.length&&(gs.fits="none"),"old"===gs.fits&&(string1="previous fit shown",string2="pick new fit",fit_x=this.fit_data[i][0],fit_y=this.fit_data[i][1],ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,this.drawSimpleLine(ctx,fit_x,fit_y)),fits.fit_strings.indexOf(gs.fits)>-1){var fit,string1,string2,string3;if("time"===gs.x_scale_mode){var normed=fits.pre_fit_normalizing(this.data[i][0]);fit=fits.fit_funs[fits.fit_strings.indexOf(gs.fits)](normed.x,this.data[i][1]),string1=fit.strings[0]+"  "+normed.s,console.log("normalised: x = -"+normed.x_mean+" / "+normed.sigma_x)}else fit=fits.fit_funs[fits.fit_strings.indexOf(gs.fits)](this.data[i][0],this.data[i][1]),string1=fit.strings[0];if(string2=fit.strings[1],string3=fit.strings[2],gs.extrapolate)var fit_start=0,fit_end=canvas.width;else var fit_start=Math.max(0,this.units_to_pixels(Math.min.apply(null,this.data[i][0]),"x")),fit_end=Math.min(canvas.width,this.units_to_pixels(Math.max.apply(null,this.data[i][0]),"x"));for(var fit_x=[],j=fit_start;fit_end>j;j+=5)fit_x.push(this.pixels_to_units(j,"x"));if("time"===gs.x_scale_mode)var fit_y=fit.fun(fits.post_fit_normalizing(fit_x,normed),fit.parameters);else var fit_y=fit.fun(fit_x,fit.parameters);console.log("fit parameters: "+fit.parameters),this.fit_data[i]=[],this.fit_data[i][0]=fit_x,this.fit_data[i][1]=fit_y,ctx.strokeStyle=gs.color_fits?this.colors[i]:gs.color_fg,this.fit_points_drawn=0,this.drawSimpleLine(ctx,fit_x,fit_y)}this.transparent?(ctx.fillText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),y+=dy,ctx.fillText(string2,x,y),y+=dy,ctx.fillText(string3,x,y),y+=dy):(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),ctx.fillText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),y+=dy,ctx.strokeText(string2,x,y),ctx.fillText(string2,x,y),y+=dy,ctx.strokeText(string3,x,y),ctx.fillText(string3,x,y),y+=dy)}}if(ctx.lineWidth=graph_line_thickness,ctx.textAlign="center",ctx.strokeStyle=gs.color_fg,ctx.fillStyle=gs.color_fg,ctx.font=title_font_size+"px "+font_name,ctx.fillText(title,canvas.width/2,tick_len+title_spacing+title_font_size),ctx.font=axis_labels_font_size+"px "+font_name,ctx.fillText(gs.subtitle,canvas.width/2,tick_len+title_spacing+axis_labels_font_size+title_font_size),ctx.fillText(gs.subtitle2,canvas.width/2,tick_len+title_spacing+2*axis_labels_font_size+title_font_size),gs.data_transforms.length>0&&gs.showTransformTexts){ctx.font=axis_labels_font_size+"px "+font_name;var label="["+gs.data_transforms.join("|")+"]",labely=title_spacing+title_font_size+tick_len+axis_labels_font_size;gs.subtitle.length>0&&(labely+=axis_labels_font_size),gs.subtitle2.length>0&&(labely+=axis_labels_font_size),ctx.fillText(label,canvas.width/2,labely)}if(ctx.beginPath(),ctx.stroke(),gs.i>=1){ctx.strokeStyle=gs.color_fg,ctx.lineWidth=graph_line_thickness,ctx.fillStyle=gs.color_bg,ctx.rect(2*edge,2*edge,canvas.width-4*edge,canvas.height-4*edge),ctx.fill(),ctx.stroke(),ctx.fillStyle=gs.color_fg,ctx.textAlign="left";var y=3*edge,dy=1.5*axis_labels_font_size;ctx.fillText("canvas width : "+canvas.width,3*edge,y),y+=dy,ctx.fillText("canvas height : "+canvas.height,3*edge,y),y+=dy,ctx.fillText("canvas ID : "+this.canvas_name,3*edge,y),y+=dy,ctx.fillText("graph name : "+this.graph_name,3*edge,y),y+=dy,ctx.fillText("No. series : "+this.data.length+" of "+this.data_backup.length,3*edge,y),y+=dy,ctx.fillText("Points drawn : "+this.points_drawn,3*edge,y),y+=dy,ctx.fillText("Drawn points for fits : "+fit_points_drawn,3*edge,y),y+=dy,ctx.fillText("Touch : "+is_touch_device(),3*edge,y),y+=dy;var end_time=new Date;graph.ui.draw_time=end_time.getTime()-start_time.getTime(),ctx.fillText("Draw Time : "+graph.ui.draw_time+"ms",3*edge,y),y+=dy,ctx.fillText("Copy Time : "+graph.ui.copy_time+"ms",3*edge,y),y+=dy,ctx.textAlign="right";var label="MJS2015";ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-axis_labels_font_size-2*edge);var label="version: "+MJS_PLOT_VERSION;ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-2.5*axis_labels_font_size-2*edge);var label="web:"+MJS_PLOT_WEBSITE;ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-3.5*axis_labels_font_size-2*edge)}if(this.points_drawn=0,this.errors.length>0){ctx.font=axis_labels_font_size+"px "+font_name;var oldfill=ctx.fillStyle;ctx.fillStyle="#FF0000",ctx.textAlign="center";for(var i=0;i<this.errors.length;i++){var s="error > "+this.errors[i],x=canvas.width/2,y=2*tick_len+title_spacing+axis_labels_font_size+canvas.height/2-axis_labels_font_size*this.errors.length/2+axis_labels_font_size*i;ctx.fillText(s,x,y)}ctx.fillStyle=oldfill}this.errors=[],ctx.textAlign="left",ctx.beginPath(),ctx.stroke(),ctx.beginPath(),ctx.rect(graph_line_thickness/2,graph_line_thickness/2,canvas.width-graph_line_thickness,canvas.height-graph_line_thickness),ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=gs.color_fg,ctx.stroke(),gs.modified=!0,save_gs(this.graph_name,gs),this.isSVG||(this.graph_image=ctx.getImageData(0,0,canvas.width,canvas.height)),this.plot_failed=!1;for(var i=0;i<this.onPlotFunctions.length;i++)this.onPlotFunctions[i]()},units_to_pixels:function(e,t){if("x"===t){if("lin"===this.graphics_style.x_scale_mode||"time"===this.graphics_style.x_scale_mode)return(e-this.graphics_style.x_auto_min)*this.canvas.width/(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min);if("log"===this.graphics_style.x_scale_mode)return(Math.log10(e)-this.graphics_style.x_auto_min)*this.canvas.width/(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)||0}if("y"===t){if("lin"===this.graphics_style.y_scale_mode||"time"===this.graphics_style.y_scale_mode)return this.canvas.height-(e-this.graphics_style.y_auto_min)*this.canvas.height/(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min);if("log"===this.graphics_style.y_scale_mode)return this.canvas.height-(Math.log10(e)-this.graphics_style.y_auto_min)*this.canvas.height/(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)||canvas.height}},pixels_to_units:function(e,t){if("x"===t){if("lin"===this.graphics_style.x_scale_mode||"time"===this.graphics_style.x_scale_mode)return e/this.canvas.width*(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)+this.graphics_style.x_auto_min;if("log"===this.graphics_style.x_scale_mode)return Math.pow(10,e/this.canvas.width*(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)+this.graphics_style.x_auto_min)}if("y"===t){if("lin"===this.graphics_style.y_scale_mode||"time"===this.graphics_style.y_scale_mode)return(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)*(this.canvas.height-e)/this.canvas.height+this.graphics_style.y_auto_min;if("log"===this.graphics_style.y_scale_mode){var a=Math.pow(10,(this.canvas.height-e)/this.canvas.height*(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)+this.graphics_style.y_auto_min);return 1e-200>a?1e-200:a}}},get_axis_string:function(e,t,a){if(isFinite(a)||("x"==t&&(a=this.graphics_style.x_precision+1),"y"==t&&(a=this.graphics_style.y_precision+1)),"x"==t){var i=this.graphics_style.x_axis_prefix||"";if("lin"===this.graphics_style.x_scale_mode||"log"===this.graphics_style.x_scale_mode)switch(this.graphics_style.x_label_mode){case"norm":i+=mjs_precision(e,a);break;case"infix":i+=eng_form_infix(e,a);break;case"postfix":i+=eng_form_postfix(e,a);break;case"sci":i+=e.toExponential(a-1)}return"time"===this.graphics_style.x_scale_mode&&(i+=mjs_date_print(e,0,a)),i+=this.graphics_style.x_axis_postfix}if("y"==t){var i=this.graphics_style.y_axis_prefix||"";if("lin"===this.graphics_style.y_scale_mode||"log"===this.graphics_style.y_scale_mode)switch(this.graphics_style.y_label_mode){case"norm":i+=mjs_precision(e,a);break;case"infix":i+=eng_form_infix(e,a);break;case"postfix":i+=eng_form_postfix(e,a);break;case"sci":i+=e.toExponential(a-1)}return"time"===this.graphics_style.y_scale_mode&&(i+=mjs_date_print(e,0,a)),i+=this.graphics_style.y_axis_postfix}},make_full_screen:function(e){var t=window.document;full_screen_graph=e;var a=full_screen_graph.canvas;full_screen_graph.orignal_canvas_width=full_screen_graph.canvas.width,full_screen_graph.orignal_canvas_height=full_screen_graph.canvas.height;var i=a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen||a.msRequestFullscreen;t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement?(full_screen_graph.errors.push("can't go fullscreen"),full_screen_graph.isFullscreen=!1):(i.call(a),full_screen_graph.isFullscreen=!0,full_screen_graph.canvas.width=window.innerWidth,full_screen_graph.canvas.height=window.innerHeight,document.addEventListener("fullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("webkitfullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("mozfullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("MSFullscreenChange",full_screen_graph.full_screen_handler),window.addEventListener("resize",full_screen_graph.keep_full_screen,!0))},full_screen_handler:function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||full_screen_graph.exit_full_screen()},exit_full_screen:function(){full_screen_graph.isFullscreen=!1,document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),window.removeEventListener("resize",full_screen_graph.keep_full_screen,!0),full_screen_graph.canvas.width=full_screen_graph.orignal_canvas_width,full_screen_graph.canvas.height=full_screen_graph.orignal_canvas_height,full_screen_graph.mjs_plot()},keep_full_screen:function(){full_screen_graph.canvas.width=window.innerWidth,full_screen_graph.canvas.height=window.innerHeight,full_screen_graph.mjs_plot()}};return graph.canvas=canvas,make_interactive(graph),graph},get_graph_style:function(){if(is_touch_device())var e="drag";else var e="zoom";return{graph_line_thickness:1,symbol_size:5,line_thickness:2,tick_len:7,mode:"dot line",symbol_mode:"dot",line_mode:"line",font_name:"serif",title_font_size:20,title:"Title",subtitle:"",subtitle2:"",title_spacing:2,tick_labels_font_size:10,tick_lables_font_padding:2,axis_labels_font_size:10,lable_spacing:8,x_axis_title:"x axis (units)",y_axis_title:"y axis (units)",x_axis_prefix:"",x_axis_postfix:"",y_axis_prefix:"",y_axis_postfix:"",x_label_mode:"norm",y_label_mode:"norm",minor_tick_len:5,guideWidthx:35,guideWidthy:30,scaling_factor:1,mouse_mode:e,fits:"none",extrapolate:!1,color_fits:!1,x_scale_auto_max:!0,x_scale_auto_min:!0,y_scale_auto_max:!0,y_scale_auto_min:!0,x_manual_min:0,x_manual_max:1,y_manual_min:0,y_manual_max:1,x_scale_mode:"lin",y_scale_mode:"lin",x_scale_tight:!1,y_scale_tight:!1,show_captions:!0,showTransformTexts:!0,captions_display:"none",color_fg:"#111111",color_bg:"#eeeeee",color_mg:"#555555",show_grid:!1,v:MJS_PLOT_VERSION,caption_colors:!1,hidden_lines:[],data_transforms:[],data_transforms_args:[],i:0,o:0,modified:!1,x_precision:2,y_precision:2,fit_text_position:{x:.1,y:.2},caption_position:{x:-10,y:10},function_lines:[]}},convert_time_strings:function(e){for(var t=[],a=0;a<e.length;a++)t.push(Date.parse(e[a]));return t}},mjs_plot}();var LZString=function(){function e(e,t){if(!s[e]){s[e]={};for(var a=0;a<e.length;a++)s[e][e.charAt(a)]=a}return s[e][t]}var t=String.fromCharCode,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={},n={compressToBase64:function(e){if(null==e)return"";var t=n._compress(e,6,function(e){return a.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,function(i){return e(a,t.charAt(i))})},compressToUTF16:function(e){return null==e?"":n._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=n.compress(e),a=new Uint8Array(2*t.length),i=0,s=t.length;s>i;i++){var o=t.charCodeAt(i);a[2*i]=o>>>8,a[2*i+1]=o%256}return a},decompressFromUint8Array:function(e){if(null===e||void 0===e)return n.decompress(e);for(var a=new Array(e.length/2),i=0,s=a.length;s>i;i++)a[i]=256*e[2*i]+e[2*i+1];var o=[];return a.forEach(function(e){o.push(t(e))}),n.decompress(o.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,function(e){return i.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,function(a){return e(i,t.charAt(a))}))},compress:function(e){return n._compress(e,16,function(e){return t(e)})},_compress:function(e,t,a){if(null==e)return"";var i,s,n,o={},r={},_="",l="",g="",h=2,c=3,d=2,m=[],x=0,f=0;for(n=0;n<e.length;n+=1)if(_=e.charAt(n),Object.prototype.hasOwnProperty.call(o,_)||(o[_]=c++,r[_]=!0),l=g+_,Object.prototype.hasOwnProperty.call(o,l))g=l;else{if(Object.prototype.hasOwnProperty.call(r,g)){if(g.charCodeAt(0)<256){for(i=0;d>i;i++)x<<=1,f==t-1?(f=0,m.push(a(x)),x=0):f++;for(s=g.charCodeAt(0),i=0;8>i;i++)x=x<<1|1&s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s>>=1}else{for(s=1,i=0;d>i;i++)x=x<<1|s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s=0;for(s=g.charCodeAt(0),i=0;16>i;i++)x=x<<1|1&s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s>>=1}h--,0==h&&(h=Math.pow(2,d),d++),delete r[g]}else for(s=o[g],i=0;d>i;i++)x=x<<1|1&s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s>>=1;h--,0==h&&(h=Math.pow(2,d),d++),o[l]=c++,g=String(_)}if(""!==g){if(Object.prototype.hasOwnProperty.call(r,g)){if(g.charCodeAt(0)<256){for(i=0;d>i;i++)x<<=1,f==t-1?(f=0,m.push(a(x)),x=0):f++;for(s=g.charCodeAt(0),i=0;8>i;i++)x=x<<1|1&s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s>>=1}else{for(s=1,i=0;d>i;i++)x=x<<1|s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s=0;for(s=g.charCodeAt(0),i=0;16>i;i++)x=x<<1|1&s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s>>=1}h--,0==h&&(h=Math.pow(2,d),d++),delete r[g]}else for(s=o[g],i=0;d>i;i++)x=x<<1|1&s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s>>=1;h--,0==h&&(h=Math.pow(2,d),d++)}for(s=2,i=0;d>i;i++)x=x<<1|1&s,f==t-1?(f=0,m.push(a(x)),x=0):f++,s>>=1;for(;;){if(x<<=1,f==t-1){m.push(a(x));break}f++}return m.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,a,i){var s,n,o,r,_,l,g,h,c=[],d=4,m=4,x=3,f="",p=[],u={val:i(0),position:a,index:1};for(n=0;3>n;n+=1)c[n]=n;for(r=0,l=Math.pow(2,2),g=1;g!=l;)_=u.val&u.position,u.position>>=1,0==u.position&&(u.position=a,u.val=i(u.index++)),r|=(_>0?1:0)*g,g<<=1;switch(s=r){case 0:for(r=0,l=Math.pow(2,8),g=1;g!=l;)_=u.val&u.position,u.position>>=1,0==u.position&&(u.position=a,u.val=i(u.index++)),r|=(_>0?1:0)*g,g<<=1;h=t(r);break;case 1:for(r=0,l=Math.pow(2,16),g=1;g!=l;)_=u.val&u.position,u.position>>=1,0==u.position&&(u.position=a,u.val=i(u.index++)),r|=(_>0?1:0)*g,g<<=1;h=t(r);break;case 2:return""}for(c[3]=h,o=h,p.push(h);;){if(u.index>e)return"";for(r=0,l=Math.pow(2,x),g=1;g!=l;)_=u.val&u.position,u.position>>=1,0==u.position&&(u.position=a,u.val=i(u.index++)),r|=(_>0?1:0)*g,g<<=1;switch(h=r){case 0:for(r=0,l=Math.pow(2,8),g=1;g!=l;)_=u.val&u.position,u.position>>=1,0==u.position&&(u.position=a,u.val=i(u.index++)),r|=(_>0?1:0)*g,g<<=1;c[m++]=t(r),h=m-1,d--;break;case 1:for(r=0,l=Math.pow(2,16),g=1;g!=l;)_=u.val&u.position,u.position>>=1,0==u.position&&(u.position=a,u.val=i(u.index++)),r|=(_>0?1:0)*g,g<<=1;c[m++]=t(r),h=m-1,d--;break;case 2:return p.join("")}if(0==d&&(d=Math.pow(2,x),x++),c[h])f=c[h];else{if(h!==m)return null;f=o+o.charAt(0)}p.push(f),c[m++]=o+f.charAt(0),d--,o=f,0==d&&(d=Math.pow(2,x),x++)}}};return n}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);