from IPython import get_ipython
import datetime

import os

__active_plot = ''
__graph_folder = ''
__has_graph_folder = False

def setupGraphFolder(f= 'mjsplotGraphs'):
	global __graph_folder
	global __has_graph_folder
	
	if not os.path.exists(f):
		os.makedirs(f)
		
	__graph_folder = f
	__has_graph_folder = True

	filename = os.path.join(__graph_folder,'mjs_plot_0_4_n_min.js')
	if not os.path.isfile(filename):
		__text_to_file(__mjsplotmin,filename)
	


import random
def filterFileName(s):
    r = ''.join([c for c in s if c.isalpha() or c.isdigit() or c is "_"]).rstrip()
    if len(r) == 0:
        r = 'G' + str(random.random())[-6:-1]
    return r

#get data out for mjsplot?
def __jsData(a,name = 'a'):
    r = name + '='+ __jsArray(a) + '; '
    return r


def __dataFromPlot(p):
    ax = p.gca()
    r = '';
    n = '\n'
    i=0
    labels = ''
    for line in ax.lines:
        
        label = safeName(line.get_label())+str(i)
        r += jsData( line.get_xdata(), label+'x') + n
        r += jsData(line.get_ydata(), label+'y') + n
        i+=1
        labels += 'plot(' + label+'x'+ ',' + label+'y'+');\n'
    return r + '\n'+ labels

def dataFromPlot(p):
    """Take a matplotlib plt object and get the data into an mjsplot"""
    ax = p.gca()
    i=0
    xlabel(ax.get_xlabel())
    ylabel(ax.get_ylabel())
    title(ax.get_title())

    for line in ax.lines:
        label = __safeName(line.get_label())+str(i)
        plot( line.get_xdata(),line.get_ydata(), __safeName(line.get_label())  )
        i+=1

def __safeName(s):
    return "".join([c for c in s if c.isalpha() or c.isdigit()]).rstrip()


def __jsArray(a):
    r = '['
    i=0
    for v in a:
	s = ''
	if v == v:
	    s = str(v)
        r += s + ','
        if i%20 == 0:
            r+= ' '
        i+=1
    r = r[:-1]
    r += ']'
    return r

def __text_to_file(text,f):
    with open(f, 'w') as f:
        f.write(text)
    f.closed

def __save_data_from_graph(p,f):
    text_to_file(dataFromPlot(p),f)
    
def axis(a):
    setStyle('x_manual_min',a[0])
    setStyle('x_manual_max',a[1])
    setStyle('y_manual_min',a[2])
    setStyle('y_manual_max',a[3])
    setStyle('x_scale_auto_max',0)
    setStyle('x_scale_auto_min',0)
    setStyle('y_scale_auto_max',0)
    setStyle('y_scale_auto_min',0)

def timeseries(x,y,label=None):
	t = ["'"+str(e)+"'" for e in x]
	global __active_plot
	lt = ''
	if label:
		lt = ',"'+label+'"'
	__active_plot = __active_plot +  "g.timeseries("+__jsArray(t)+',' + __jsArray(y)+lt +");\n"

def xlabel(s):
	global __active_plot
	__active_plot = __active_plot +  "g.xlabel('"+s+"');\n"
def ylabel(s):
	global __active_plot
	__active_plot = __active_plot +  "g.ylabel('"+s+"');\n"
def title(s):
	global __active_plot
	__active_plot = __active_plot +  "g.title('"+s+"');\n"
def title(s,subtitle=False,subsubtitle=False):
	global __active_plot
	s = '"' + s + '"'
	ss = ''
	if subtitle:
		ss = ',"'+subtitle+'"'
	sss = ''
	if subsubtitle:
		sss = ',"'+subsubtitle+'"'
	__active_plot = __active_plot +  "g.title("+s+ss+sss+");\n"
def setStyle(e,v):
	global __active_plot
	if isinstance(v, basestring):
		v = "'"+v+"'"
	else:
		v = str(v)
	__active_plot = __active_plot +  "g.default_graphics_style."+e+" = "+v+";\n"
def grid(s):
	global __active_plot
	b = 'false'
	if s:
		b = 'true'
	__active_plot = __active_plot +  "g.grid('"+b+"');\n"
def useDefaults():
	global __active_plot
	__active_plot = __active_plot +  "g.useDefaults();\n"
def plot(x,y,label=None):
	global __active_plot
	lt = ''
	if label:
		lt = ',"'+label+'"'
	__active_plot = __active_plot +  "g.plot("+__jsArray(x)+',' + __jsArray(y)+lt +");\n"
def semilogy(x,y,label=None):
	global __active_plot
	lt = ''
	if label:
		lt = ',"'+label+'"'
	__active_plot = __active_plot +  "g.semilogy("+__jsArray(x)+',' + __jsArray(y)+lt +");\n"
def semilogx(x,y,label=None):
	global __active_plot
	lt = ''
	if label:
		lt = ',"'+label+'"'
	__active_plot = __active_plot +  "g.semilogx("+__jsArray(x)+',' + __jsArray(y)+lt +");\n"
def loglog(x,y,label=None):
	global __active_plot
	lt = ''
	if label:
		lt = ',"'+label+'"'
	__active_plot = __active_plot +  "g.loglog("+__jsArray(x)+',' + __jsArray(y)+lt +");\n"

def thesisStyle():
	setStyle("color_bg","white")
	setStyle("color_fg","black")
	setStyle("font_name","serif")
	setStyle("title_font_size","12")
	setStyle("tick_labels_font_size","12")
	setStyle("axis_labels_font_size","12")
	setStyle("graph_line_thickness","0.545")
	setStyle("minor_tick_len","4")
	setStyle("tick_len","7")

# width='418px', height='258px'

def save(f,width='100%',height='400px'):
	global __active_plot
	global __graph_folder
	global __has_graph_folder
	
	if not __has_graph_folder:
		setupGraphFolder()
	f = filterFileName(f)+'.html'
	filename = os.path.join(__graph_folder,f)
	
	__text_to_file(__pagetotext + __active_plot + __pagetailtext,filename)
	__active_plot = ''
	ipython = get_ipython()
	ipython.run_cell_magic('HTML','',"""<iframe src="{0}" width={1} height={2} style="border:none"></iframe>""".format(filename,width,height)) 
	
	
__pagetotext = """<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF8">
<script src="mjs_plot_0_4_n_min.js"></script>
</head>
<body>
<canvas id="c" width="600" height="400"></canvas>

<script>
var g = mjs_plot.new_graph("c");"""

__pagetailtext = """
g.forceFullPage();
</script>
</body>
</html>
"""

#make using https://javascript-minifier.com/
__mjsplotmin = r"""
mjs_plot=function(){function hslToRgb(t,e,i){function a(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var s,o,n;if(0==e)s=o=n=i;else{var r=.5>i?i*(1+e):i+e-i*e,l=2*i-r;s=a(l,r,t+1/3),o=a(l,r,t),n=a(l,r,t-1/3)}return"rgb("+Math.round(255*s)+","+Math.round(255*o)+","+Math.round(255*n)+")"}function get_color(t,e){if(e<color_table.length)return color_table[e][t];var i=1-Math.exp(-1.1*e),a=.5+(1-Math.exp(-1.1*e))*Math.cos(t*Math.PI)*.15;return hslToRgb(t/(e+1),i,a)}function parseExpression(text,ax,ay){for(var sin=Math.sin,cos=Math.cos,tan=Math.tan,ln=Math.log,pi=Math.PI,e=Math.E,pow=Math.pow,sqrt=Math.sqrt,log=function(t){return Math.log(t)/Math.log(10)},now=(new Date).getTime(),returny=[],i=0;i<ax.length;i++){var x=ax[i],y=ay[i];returny.push(eval(text))}return returny}function string_hash(t){for(var e=321,i=0;i<50*t.length;i++)e=t.charCodeAt(i%t.length)+((e<<5)-e);return e&e}function color_from_string(t){return hash=string_hash(t),hue=Math.abs(hash%256/256),sat=.9,lightness=.3+.2*(Math.abs(hash)%3),hslToRgb(hue,sat,lightness)}function clone(t){var e=t instanceof Array?[]:{};for(i in t)"clone"!=i&&(t[i]&&"object"==typeof t[i]?e[i]=clone(t[i]):e[i]=t[i]);return e}function hasLocalStorage(){try{return localStorage.setItem("MJSplot","Stored"),localStorage.removeItem("MJSplot"),!0}catch(t){return!1}}function isMobile(){var t={Android:function(){return/Android/i.test(navigator.userAgent)},BlackBerry:function(){return/BlackBerry/i.test(navigator.userAgent)},iOS:function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},Windows:function(){return/IEMobile/i.test(navigator.userAgent)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Windows()}};return t.any()}function is_touch_device(){var t="ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0;return t&&isMobile()||DEBUGG_FORCE_TOUCH}function eng_form_infix(t,e){if(isFinite(e)||(e=5),1>e&&(e=1),e>21&&(e=21),Math.abs(t)<1e-24||Math.abs(t)>=1e27)return mjs_precision(t,e);var i="";0>t&&(i="-"),t=Math.abs(t);var a=Math.floor(Math.log10(t)/3),s=t*Math.pow(1e3,-a),o=(s.toFixed(Math.max(e-3,0))+".").split("."),n=(s.toFixed(Math.max(0,e-o[0].length))+".").split("."),r=n[0]+si_prefixes[a+8]+n[1];return 0==n[1].length&&0==a&&(r=n[0]),i+r}function eng_form_postfix(t,e){if(isFinite(e)||(e=5),1>e&&(e=1),e>21&&(e=21),Math.abs(t)<1e-24||Math.abs(t)>=1e27)return mjs_precision(t,e);var i="";0>t&&(i="-"),t=Math.abs(t);var a=Math.floor(Math.log10(t)/3),s=t*Math.pow(1e3,-a),o=(s.toFixed(Math.max(e-3,0))+".").split("."),n=(s.toFixed(Math.max(0,e-o[0].length))+".").split("."),r=n[0]+"."+n[1]+si_prefixes[a+8];return 0!=n[1].length&&0==a&&(r=n[0]+"."+n[1]),0==n[1].length&&0!=a&&(r=n[0]+si_prefixes[a+8]),0==n[1].length&&0==a&&(r=n[0]),i+r}function toSuperscript(t){var e;0>t?(e=superscriptMinus,t*=-1):e="",t=parseInt(t).toString();for(var i=0;i<t.length;i++)e+=String.fromCharCode(superscriptCharacters[parseInt(t[i])]);return e}function maths_form(t,e){var i=t.toExponential(trim(e-1,0,20)),a=i.split("e");return"1"===a[0]?"10"+toSuperscript(a[1]):a[0]+unicodeTimes+"10"+toSuperscript(a[1])}function download_text(t,e,i){var a=i||"data:text/plain;charset=utf-8",s=document.createElement("a");s.setAttribute("href",a+","+encodeURIComponent(t)),s.setAttribute("download",e),s.style.display="none",document.body.appendChild(s),console.log("downloading "+e),s.click(),document.body.removeChild(s)}function new_window_with_text(t,e,i,a){var s="data:text/plain;charset=utf-8;base64,"+btoa(t);window.open(s,e,"width="+i+", height="+a)}function save_gs(t,e){if(hasLocalStorage()){var i=JSON.stringify(e);localStorage.setItem(t,i)}else console.log("No local storage!")}function load_gs(t){var e=mjs_plot.get_graph_style();if(hasLocalStorage()){var i=localStorage.getItem(t);i&&(i=JSON.parse(i)),i&&(e=i)}else console.log("No local storage!");return e}function linear_regression(t,e){for(var i=0,a=0,s=0,o=0,n=0;n<t.length;n++)i+=t[n],s+=t[n]*t[n],a+=e[n],o+=t[n]*e[n];var r=t.length;o-=i*a/r,s-=i*i/r;var l=o/s,_=a/r-l*i/r;return slope={a:_,b:l}}function series_stats(t,e){for(var i=0,a=0,s=0,o=0,n=0,r=0;r<t.length;r++)i+=t[r],s+=t[r]*t[r],a+=e[r],o+=t[r]*e[r],n+=e[r]*e[r];var l=t.length;o-=i*a/l,s-=i*i/l,n-=a*a/l;var _=o*o/s/n,h=i/l,c=a/l,g=Math.sqrt(s/l),m=Math.sqrt(n/l),x=o/l,d=o/s,f=a/l-d*i/l,u=Math.sqrt((n-o*o/s)/(l-2)),p=u/Math.sqrt(s),y=u*Math.sqrt(1/l+h*h/s),v=Math.min.apply(null,e),w=Math.max.apply(null,e),T=Math.min.apply(null,t),b=Math.max.apply(null,t);return stats={x_mean:h,y_mean:c,sigma_x:g,sigma_y:m,cov:x,b:d,a:f,s_b:p,s_a:y,n:l,r_2:_,ymin:v,ymax:w,xmin:T,xmax:b}}function padLeft(t,e,i){return Array(e-String(t).length+1).join(i||"0")+t}function trim(t,e,i){return t=Math.max(t,e),t=Math.min(t,i)}function getFloat(t,e){var i=parseFloat(prompt(t,e));return isFinite(i)?i:e}function getInt(t,e){var i=parseInt(prompt(t,e));return isFinite(i)?i:e}function getString(t,e){var i=prompt(t,e);return"string"==typeof i?i:e}function getDrawFunctionRotateable(t){for(var e=t.split(" "),i=[],a=[],s=0;s<e.length;s++)isNaN(e[s])?i.push(e[s]):a.push(parseFloat(e[s]));str="d=["+a.join(",")+"];n=0;";for(var s=0;s<i.length;s++)switch(i[s]){case"b":str+="ctx.beginPath();";break;case"l":str+="ctx.lineTo(x + s*(Math.cos(r)*d[n] - Math.sin(r)*d[n+1] ),y + s*(Math.sin(r)*d[n] + Math.cos(r)*d[n+1]));n+=2;";break;case"m":str+="ctx.moveTo(x + s*(Math.cos(r)*d[n] - Math.sin(r)*d[n+1] ),y + s*(Math.sin(r)*d[n] + Math.cos(r)*d[n+1]));n+=2;";break;case"c":str+="ctx.closePath();";break;case"f":str+="ctx.fill();";break;case"s":str+="ctx.stroke();";break;case"q":str+="ctx.quadraticCurveTo(x + s*(Math.cos(r)*d[n] - Math.sin(r)*d[n+1] ),y + s*(Math.sin(r)*d[n] + Math.cos(r)*d[n+1]),x + s*(Math.cos(r)*d[n+2] - Math.sin(r)*d[n+3] ),y + s*(Math.sin(r)*d[n+2] + Math.cos(r)*d[n+3]));n+=4;";break;case"a":str+="ctx.arc(x + s*(Math.cos(r)*d[n] - Math.sin(r)*d[n+1] ),y + s*(Math.sin(r)*d[n] + Math.cos(r)*d[n+1]),s*d[n+2],r + d[n+3]*6.283185307179586,r + d[n+4]*6.283185307179586,false);n+=5;"}return new Function("ctx","x","y","s","r",str)}function sumArray(t){for(var e=0,i=0,a=t.length;a>i;i++)e+=t[i];return e}function mjs_time_difference_print(t){var e=t/1e3;t%=1e3;var i=Math.floor(e%60),a=Math.floor(e/60%60),s=Math.floor(e/60/60%24),o=Math.floor(e/60/60/24),n="";return i>0&&(n=i+"seconds "+t.toFixed(0)+"ms"),a>0&&(n=a+"min "+i+"seconds"),s>0&&(n=s+"hours "+a+"min "+i+"seconds"),o>0&&(n=o+"days "+s+"hours "+a+"min"),n}function mjs_date_print(t,e,i){e=isFinite(e)?e:0,i=isFinite(i)?i:8,e=trim(e,0,8),i=trim(i,0,8),e=Math.min(e,i);var a=new Date(t),s="",o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return 2==e&&3==i?(s+=o[a.getDay()],s+=" "+padLeft(a.getHours(),2,"0")+"h"):(2==e&&2==i&&(s+=a.getMonth()+1+"-"),1==e&&i>1&&(s+=n[a.getMonth()]+"-",e++),3!=e||4!=i&&3!=i?4==e&&4==i?(s+=padLeft(a.getHours(),2,"0"),s+=":"+padLeft(a.getMinutes(),2,"0")):4==e&&5==i?(s+=padLeft(a.getMinutes(),2,"0"),s+="m"+padLeft(a.getSeconds(),2,"0")+"s"):1==e&&1==i?s=n[a.getMonth()]:(0>=e&&(s+=a.getFullYear()),0>=e&&i>=1&&(s+="-"),1>=e&&i>=1&&(s+=a.getMonth()+1),1>=e&&i>=2&&(s+="-"),2>=e&&i>=2&&(s+=a.getDate()),2>=e&&i>=3&&(s+=" "),3>=e&&i>=3&&(s+=padLeft(a.getHours(),2,"0")),3>=e&&i>=4&&(s+=":"),4>=e&&i>=4&&(s+=padLeft(a.getMinutes(),2,"0")),4>=e&&i>=5&&(s+=":"),5>=e&&i>=5&&(s+=padLeft(a.getSeconds(),2,"0")),5>=e&&i>=6&&(s+="."),6>=e&&i>=6&&(s+=padLeft(a.getMilliseconds(),3,"0")[0]),7>=e&&i>=7&&(s+=padLeft(a.getMilliseconds(),3,"0")[1]),8>=e&&i>=8&&(s+=padLeft(a.getMilliseconds(),3,"0")[2]),3==i&&3>=e&&(s+="h"),4==i&&4==e&&(s+="m"),5!=i||5!=e&&4!=e||(s+="s"),s):(s+=padLeft(a.getHours(),2,"0"),s+=":"+padLeft(a.getMinutes(),2,"0")))}function round_to_month(t){var e=new Date(t),i=e.getDate(),a=new Date(e.getFullYear(),e.getMonth()+1,0),s=a.getDate()-i;return s>i?t-24*(i-1)*60*60*1e3:t+24*(s+1)*60*60*1e3}function round_to_year(t){var e=new Date(t),i=new Date(e.getFullYear(),0,1),a=new Date(e.getFullYear()+1,0,1);return e.getTime()-i.getTime()<a.getTime()-e.getTime()?i.getTime():a.getTime()}function mjs_precision(t,e){e=trim(e,1,21);var i=0>t?"-":"";if(t=Math.abs(t),.002>=t){var a=t.toExponential(e-1);if(parseInt(a.split("e")[1])<-3)return i+a}var a=t.toPrecision(e);return a.length>=t.toPrecision(e+1).length&&(a=t.toPrecision(e+1)),a.length>=t.toPrecision(e+2).length&&(a=t.toPrecision(e+2)),a.length>=t.toPrecision(e+3).length&&(a=t.toPrecision(e+3)),i+a}function number_quote(t,e){return isFinite(e)||(e=1e-20),isFinite(t)||(t=0),mjs_precision(t,Math.max(2,Math.floor(Math.log10(Math.abs(t)))-Math.floor(Math.log10(Math.abs(e)))+2))}function drawEllipse(t,e,i,a,s,o){e.beginPath();for(var n=.5,r=0*Math.PI;r<2*Math.PI;r+=.01){var l=i-s*Math.sin(r)*Math.sin(n*Math.PI)+o*Math.cos(r)*Math.cos(n*Math.PI),_=a+o*Math.cos(r)*Math.sin(n*Math.PI)+s*Math.sin(r)*Math.cos(n*Math.PI);0==r?e.moveTo(t.units_to_pixels(l,"x"),t.units_to_pixels(_,"y")):e.lineTo(t.units_to_pixels(l,"x"),t.units_to_pixels(_,"y"))}e.stroke()}function mouse_move_event(t,e){e.ui.latestEvent=t,e.ui.ticking||(e.ui.ticking=!0,requestAnimationFrame(function(){mouse_move_event_shim(e.ui.latestEvent,e)}))}function mouse_move_event_shim(t,e){var i=new Date;mouse_move_event_actual(t,e);var a=new Date;e.ui.copy_time=a.getTime()-i.getTime(),e.ui.ticking=!1}function mouse_move_event_actual(t,e){var i=e.canvas,a=i.getContext("2d"),s=e.graphics_style,o=i.getBoundingClientRect(),n=t.clientX-o.left,r=t.clientY-o.top,l=e.pixels_to_units(n,"x"),_=e.pixels_to_units(r,"y");if(e.graph_image){if(a.putImageData(e.graph_image,0,0),e.ui.touch)var h=Math.min(Math.min(i.width/22,i.height/15));else var h=Math.min(s.tick_labels_font_size/.55*s.scaling_factor,Math.min(i.width/22,i.height/15));e.ui.size=h;var c=h/4;if(a.font=.55*h+"px "+s.font_name,DEBUGG_FPS&&a.fillText("fps: "+1/e.ui.copy_time*1e3,30,30),0==mouse_down){if(a.textAlign="left",a.fillStyle=s.color_fg,a.strokeStyle=s.color_fg,n>h&&r>h&&i.height-r>h&&i.width-n>h){if("zoom"===s.mouse_mode&&(a.beginPath(),a.arc(n,r,c,0,2*Math.PI,!0),a.stroke()),"zoom"===s.mouse_mode||"drag"===s.mouse_mode||"measure"===s.mouse_mode){var g=e.get_axis_string(l,"x"),m=a.measureText(g).width,x=e.get_axis_string(_,"y");lw=x.length*s.scaling_factor*s.axis_labels_font_size,e.ui.touch&&e.ui.is_touching?(a.fillText(g,Math.min(n+c,i.width-h-m),i.height-2*h),a.fillText(x,2*h,r-c)):(a.fillText(g,Math.min(n+c,i.width-h-m),Math.min(r+2*c+2*h,i.height-2*h)),a.fillText(x,Math.max(n-2*c-lw-2*h,2*h),Math.max(r-c,s.scaling_factor*s.axis_labels_font_size+h))),a.beginPath(),a.moveTo(n,r+h),a.lineTo(n,i.height),a.moveTo(n,r-h),a.lineTo(n,0),a.moveTo(n-h,r),a.lineTo(0,r),a.moveTo(n+h,r),a.lineTo(i.width,r),a.stroke(),a.beginPath(),a.stroke()}if("trim"===s.mouse_mode&&(a.fillText("trim",n+2*c,r-2*c),a.beginPath(),a.moveTo(n,0),a.lineTo(n,i.height),a.moveTo(0,r),a.lineTo(i.width,r),a.stroke()),"cut"===s.mouse_mode&&(a.fillText("cut",n+2*c,r-2*c),a.beginPath(),a.moveTo(n,0),a.lineTo(n,i.height),a.moveTo(0,r),a.lineTo(i.width,r),a.stroke()),"sublin"===s.mouse_mode&&a.fillText("draw a line to subtract",n+2*c,r-2*c),"x-c"===s.mouse_mode&&(q=e.get_axis_string(l,"x"),a.fillText("x-"+q,n+2*c,r-2*c),a.beginPath(),a.moveTo(n,0),a.lineTo(n,i.height),a.stroke()),"y-c"===s.mouse_mode&&(q=e.get_axis_string(_,"y"),a.fillText("y-"+q,n+2*c,r-2*c),a.beginPath(),a.moveTo(0,r),a.lineTo(i.width,r),a.stroke()),"addmarkertext"===s.mouse_mode&&(q=e.markerText,a.textAlign="center",a.fillText(q,n,r)),("addmarkerline"===s.mouse_mode||"addmarkerlinentext"===s.mouse_mode||"addmarkerarrowntext"===s.mouse_mode||"addmarkerbox"===s.mouse_mode)&&(q="  click and drag to draw",a.fillText(q,n+c,r+c)),"removeMarker"===s.mouse_mode||"markeredit"===s.mouse_mode)for(var d=0;d<s.markers.length;d++){var f=s.markers[d];a.beginPath(),a.arc(e.units_to_pixels(f.x,"x"),e.units_to_pixels(f.y,"y"),c,0,2*Math.PI,!0),a.stroke()}if("removeMarker"===s.mouse_mode&&a.fillText("  click to remove",n+c,r+c),"markeredit"===s.mouse_mode&&a.fillText("  click to edit text",n+c,r+c),"mouse"===s.mouse_mode){for(var d=0;d<s.markers.length;d++)for(var f=s.markers[d],u=0;u<f.handles.length;u++)a.beginPath(),a.arc(e.units_to_pixels(f.handles[u][0],"x"),e.units_to_pixels(f.handles[u][1],"y"),c,0,2*Math.PI,!0),a.stroke();"none"!==s.fits&&(a.beginPath(),a.arc(s.fit_text_position.x*i.width,s.fit_text_position.y*i.height,c,0,2*Math.PI,!0),a.stroke()),a.beginPath();var p=(s.tick_len+s.title_spacing+s.title_font_size)*s.scaling_factor;if(a.arc(i.width/2,p,c,0,2*Math.PI,!0),a.stroke(),s.show_captions>0){var y=s.scaling_factor*s.caption_position.x;s.caption_position.x>0?y+=s.scaling_factor*s.tick_len:(y=i.width+y,y-=s.scaling_factor*s.tick_len),cap_y=s.scaling_factor*s.caption_position.y,s.caption_position.y>0?cap_y+=s.scaling_factor*s.tick_len:(cap_y=i.height+cap_y,cap_y-=s.scaling_factor*s.tick_len),a.beginPath(),a.arc(y,cap_y,c,0,2*Math.PI,!0),a.stroke()}}if(a.beginPath(),a.stroke(),"measure"===s.mouse_mode&&(a.beginPath(),a.moveTo(n-c,r-c),a.lineTo(n+c,r+c),a.moveTo(n-c,r+c),a.lineTo(n+c,r-c),a.stroke(),a.beginPath(),a.stroke()),"drag"===s.mouse_mode&&(drag_x=n-.5*h,drag_y=r-.5*h,a.beginPath(),a.moveTo(drag_x+.2*h,drag_y+.5*h),a.lineTo(drag_x+.8*h,drag_y+.5*h),a.moveTo(drag_x+.5*h,drag_y+.2*h),a.lineTo(drag_x+.5*h,drag_y+.8*h),a.moveTo(drag_x+.2*h,drag_y+.5*h),a.lineTo(drag_x+.3*h,drag_y+.6*h),a.moveTo(drag_x+.2*h,drag_y+.5*h),a.lineTo(drag_x+.3*h,drag_y+.4*h),a.moveTo(drag_x+.8*h,drag_y+.5*h),a.lineTo(drag_x+.7*h,drag_y+.6*h),a.moveTo(drag_x+.8*h,drag_y+.5*h),a.lineTo(drag_x+.7*h,drag_y+.4*h),a.moveTo(drag_x+.5*h,drag_y+.2*h),a.lineTo(drag_x+.4*h,drag_y+.3*h),a.moveTo(drag_x+.5*h,drag_y+.2*h),a.lineTo(drag_x+.6*h,drag_y+.3*h),a.moveTo(drag_x+.5*h,drag_y+.8*h),a.lineTo(drag_x+.4*h,drag_y+.7*h),a.moveTo(drag_x+.5*h,drag_y+.8*h),a.lineTo(drag_x+.6*h,drag_y+.7*h),a.stroke(),a.beginPath(),a.stroke()),"reader"===s.mouse_mode){var v=e.reader_index[0],w=e.reader_index[1],T=e.units_to_pixels(e.data[v][0][w],"x"),b=e.units_to_pixels(e.data[v][1][w],"y"),k=a.lineWidth;a.strokeStyle=s.color_bg,a.lineWidth=s.scaling_factor*s.axis_labels_font_size/3,("lin"===s.x_scale_mode||"log"===s.x_scale_mode)&&(q=mjs_precision(e.data[v][0][w],s.x_precision+5)),"time"===s.x_scale_mode&&(q=mjs_date_print(e.data[v][0][w],0,8)),a.strokeText(q,n+2*c,r+1.6*s.axis_labels_font_size),a.fillText(q,n+2*c,r+1.6*s.axis_labels_font_size),("lin"===s.y_scale_mode||"log"===s.y_scale_mode)&&(q=mjs_precision(e.data[v][1][w],s.y_precision+5)),"time"===s.y_scale_mode&&(q=mjs_date_print(e.data[v][1][w],0,8)),a.strokeText(q,n+2*c,r),a.fillText(q,n+2*c,r),q=e.captions[v],a.strokeText(q,n+2*c,r-1.6*s.axis_labels_font_size),a.fillText(q,n+2*c,r-1.6*s.axis_labels_font_size),q="i="+w,a.strokeText(q,n+2*c,r+1.6*s.axis_labels_font_size*2),a.fillText(q,n+2*c,r+1.6*s.axis_labels_font_size*2),a.lineWidth=k,a.strokeStyle=s.color_fg,a.beginPath(),a.moveTo(n,r),a.lineTo(T,b),a.stroke(),a.beginPath(),a.arc(n,r,.3*h*.8,0,2*Math.PI,!0),a.moveTo(n,r-.3*h),a.lineTo(n,r+.3*h),a.moveTo(n+.3*h,r),a.lineTo(n-.3*h,r),a.stroke()}}if(h>r&&(a.fillStyle=s.color_bg,a.beginPath(),a.rect(0,0,4*h,h),a.rect(4*h,0,4*h,h),a.rect(14*h,0,3*h,h),a.rect(i.width-5*h,0,3*h,h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.fillText("symbol/line",.2*h,.8*h),a.fillText("Graph",4.2*h,.8*h),a.fillText("Style",i.width-4.8*h,.8*h),a.fillText("Markers",14.2*h,.8*h),a.fillStyle=s.color_bg,a.rect(9*h,0,h,h),a.fill(),a.stroke(),a.beginPath(),a.moveTo(9.2*h,.5*h),a.lineTo(9.8*h,.5*h),a.moveTo(9.5*h,.2*h),a.lineTo(9.5*h,.8*h),a.moveTo(9.2*h,.5*h),a.lineTo(9.3*h,.6*h),a.moveTo(9.2*h,.5*h),a.lineTo(9.3*h,.4*h),a.moveTo(9.8*h,.5*h),a.lineTo(9.7*h,.6*h),a.moveTo(9.8*h,.5*h),a.lineTo(9.7*h,.4*h),a.moveTo(9.5*h,.2*h),a.lineTo(9.4*h,.3*h),a.moveTo(9.5*h,.2*h),a.lineTo(9.6*h,.3*h),a.moveTo(9.5*h,.8*h),a.lineTo(9.4*h,.7*h),a.moveTo(9.5*h,.8*h),a.lineTo(9.6*h,.7*h),a.stroke(),a.rect(10*h,0,h,h),a.fill(),a.stroke(),a.beginPath(),a.arc(10.5*h,.5*h,.3*h*.8,0,2*Math.PI,!0),a.moveTo(10.4*h,.5*h),a.lineTo(10.6*h,.5*h),a.moveTo(10.5*h,.4*h),a.lineTo(10.5*h,.6*h),a.moveTo(10.5*h+.3*h*.8*.707,.5*h+.3*h*.8*.707),a.lineTo(10.9*h,.9*h),a.stroke(),a.rect(11*h,0,h,h),a.fill(),a.stroke(),a.beginPath(),a.moveTo(11.2*h,.8*h),a.lineTo(11.8*h,.8*h),a.lineTo(11.8*h,.2*h),a.lineTo(11.2*h,.8*h),a.stroke(),a.rect(12*h,0,h,h),a.fill(),a.stroke(),a.beginPath(),a.arc(12.5*h,.5*h,.3*h*.8,0,2*Math.PI,!0),a.moveTo(12.5*h,.2*h),a.lineTo(12.5*h,.8*h),a.moveTo(12.2*h,.5*h),a.lineTo(12.8*h,.5*h),a.stroke(),a.rect(13*h,0,h,h),a.fill(),a.stroke(),a.beginPath(),a.moveTo(13.3*h,.2*h),a.lineTo(13.3*h,.8*h),a.lineTo(13.7*h,.6*h),a.lineTo(13.3*h,.2*h),a.fillStyle=s.color_bg,a.rect(i.width-h,0,h,h),a.rect(i.width-2*h,0,h,h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.fillText("c",i.width-.7*h,.7*h),a.fillStyle=s.color_fg,a.fillText("i",i.width-1.7*h,.7*h),a.fillStyle=s.color_fg,a.beginPath(),a.stroke()),r>i.height-h){a.fillStyle=s.color_bg,a.beginPath(),a.rect(0,i.height-h,2*h,h),a.rect(2*h,i.height-h,2*h,h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.fillText("x",.2*h,i.height-.3*h),a.fillText("y",2.2*h,i.height-.3*h),a.fillStyle=s.color_bg,a.rect(4*h,i.height-h,h,h),a.fill(),a.stroke(),a.beginPath();var M=4*h,j=i.height-h;a.moveTo(M+.2*h,j+.4*h),a.lineTo(M+.8*h,j+.4*h),a.moveTo(M+.2*h,j+.6*h),a.lineTo(M+.8*h,j+.6*h),a.moveTo(M+.4*h,j+.2*h),a.lineTo(M+.4*h,j+.8*h),a.moveTo(M+.6*h,j+.2*h),a.lineTo(M+.6*h,j+.8*h),a.stroke(),a.rect(5*h,i.height-h,h,h),a.fill(),a.stroke(),a.rect(6*h,i.height-h,h,h),a.fill(),a.stroke(),a.rect(7*h,i.height-h,h,h),a.fill(),a.stroke(),"log"==s.y_scale_mode?(a.moveTo(5*h,i.height-.2*h),a.lineTo(6*h,i.height-.2*h),a.moveTo(5*h,i.height-.4*h),a.lineTo(6*h,i.height-.4*h),a.moveTo(5*h,i.height-.6*h),a.lineTo(6*h,i.height-.6*h),a.moveTo(5*h,i.height-.8*h),a.lineTo(6*h,i.height-.8*h)):(a.moveTo(5*h,i.height-.4*h),a.lineTo(6*h,i.height-.4*h),a.moveTo(5*h,i.height-.65*h),a.lineTo(6*h,i.height-.65*h),a.moveTo(5*h,i.height-.8*h),a.lineTo(6*h,i.height-.8*h),a.moveTo(5*h,i.height-.9*h),a.lineTo(6*h,i.height-.9*h)),"log"===s.x_scale_mode?(a.moveTo(6.2*h,i.height),a.lineTo(6.2*h,i.height-h),a.moveTo(6.4*h,i.height),a.lineTo(6.4*h,i.height-h),a.moveTo(6.6*h,i.height),a.lineTo(6.6*h,i.height-h),a.moveTo(6.8*h,i.height),a.lineTo(6.8*h,i.height-h)):(a.moveTo(6.4*h,i.height),a.lineTo(6.4*h,i.height-h),a.moveTo(6.65*h,i.height),a.lineTo(6.65*h,i.height-h),a.moveTo(6.8*h,i.height),a.lineTo(6.8*h,i.height-h),a.moveTo(6.9*h,i.height),a.lineTo(6.9*h,i.height-h)),a.stroke();var M=7*h,j=i.height-h;a.beginPath(),a.moveTo(M+.1*h,j+.6*h),a.lineTo(M+.1*h,j+.9*h),a.lineTo(M+.9*h,j+.9*h),a.lineTo(M+.9*h,j+.6*h),a.moveTo(M+.5*h,j+.9*h),a.lineTo(M+.5*h,j+.8*h),a.stroke(),a.beginPath(),a.arc(M+.5*h,j+.4*h,.3*h,0,2*Math.PI,!0),a.moveTo(M+.5*h,j+.2*h),a.lineTo(M+.5*h,j+.4*h),a.lineTo(M+.6*h,j+.4*h),a.stroke(),a.fillStyle=s.color_bg,a.rect(8*h,i.height-h,3*h,h),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("f()",8.2*h,i.height-.3*h),a.stroke(),a.fillStyle=s.color_bg,a.rect(11*h,i.height-h,4*h,h),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("lines",11.2*h,i.height-.3*h),a.stroke(),a.fillStyle=s.color_bg,a.rect(15*h,i.height-h,4*h,h),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("fits",15.2*h,i.height-.3*h),a.stroke(),a.fillStyle=s.color_bg,a.rect(i.width-h,i.height-h,h,h),a.rect(i.width-3*h,i.height-h,h,h),a.rect(i.width-2.8*h,i.height-.8*h,.6*h,.6*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.fillText("e",i.width-.7*h,i.height-.3*h),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.rect(i.width-2*h,i.height-h,h,h),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_bg,a.moveTo(i.width-2*h,i.height),a.lineTo(i.width-h-1,i.height-h+1),a.lineTo(i.width-h-1,i.height),a.closePath(),a.fill(),a.beginPath(),a.fill(),a.stroke()}if(e.drawStylemenu)if(n<i.width-2*h&&n>i.width-10*h&&14*h>r){a.fillStyle=s.color_bg,a.rect(i.width-10*h,0,8*h,14*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var j=.8*h,S=-1*h,M=i.width-10*h+.2*h;a.textAlign="left",a.fillText("Style",M+5*h,j),j-=S,a.fillText("Pick Font",M,j),s.font_name.length<10?a.fillText(s.font_name,M+4*h,j):a.fillText(s.font_name.slice(0,9)+"...",M+4*h,j),j-=S,a.fillText("Font Size:",M,j),a.fillText("Title:",M+4*h,j),j-=S,a.fillText("Ticks:",M+4*h,j),j-=S,a.fillText("Axis:",M+4*h,j),j-=S,a.fillText("Spacing:",M,j),a.fillText("Title:",M+4*h,j),j-=S,a.fillText("Ticks:",M+4*h,j),j-=S,a.fillText("Axis:",M+4*h,j),j-=S,a.fillText("Colors:",M,j),a.fillText("FG:",M+4*h,j),j-=S,a.fillText("BG:",M+4*h,j),j-=S,a.fillText("MG:",M+4*h,j),j-=S,a.fillText("Line Width:",M,j),j-=S,a.fillText("Tick Len -major:",M,j),j-=S,a.fillText("Tick Len -minor:",M,j),j-=S,j=2.8*h,a.textAlign="center",M=i.width-3.5*h,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[edit]",M+.5*h,j),j-=S,a.fillText("[edit]",M+.5*h,j),j-=S,a.fillText("[edit]",M+.5*h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S,a.fillText("[-]",M,j),a.fillText("[+]",M+h,j),j-=S}else e.drawStylemenu=!1;if(e.drawxmenu)if(12*h>n&&r>i.height-9*h){a.fillStyle=s.color_bg,a.rect(0,i.height-9*h,12*h,9*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var j=i.height-.2*h,S=h,M=.2*h;a.textAlign="left",a.fillText("x:",M,j),j-=S,a.fillText("Min:"+e.get_axis_string(s.x_manual_min,"x"),M,j),j-=S,a.fillText("Max:"+e.get_axis_string(s.x_manual_max,"x"),M,j),j-=S,a.fillText("Mode:",M,j),j-=S,a.fillText("Spacing: "+mjs_precision(s.guideWidthx,2),M,j),j-=S,a.fillText("Style:",M,j),j-=S,a.fillText("Set Prefix:",M,j),j-=S,a.fillText("Set Postfix:",M,j),j-=S,a.fillText("Set Label:",M,j),j-=S,j=i.height-1.2*h,a.textAlign="center",a.fillText("[auto]",6*h,j),a.fillText("[manual]",10*h,j),j-=S,a.fillText("[auto]",6*h,j),a.fillText("[manual]",10*h,j),j-=S,a.fillText("[lin]",4.5*h,j),a.fillText("[log]",7.5*h,j),a.fillText("[time]",10.5*h,j),j-=S,a.fillText("[-]",6*h,j),a.fillText("[+]",10*h,j),j-=S,a.fillText("[1200]",5*h,j),a.fillText("[1k2]",7*h,j),a.fillText("[1.2k]",9*h,j),a.fillText("[1.2e3]",11*h,j),j-=S,a.fillText('"'+s.x_axis_prefix+'"',8*h,j),j-=S,a.fillText('"'+s.x_axis_postfix+'"',8*h,j),j-=S,a.fillText('"'+s.x_axis_title+'"',8*h,j),a.textAlign="left"}else e.drawxmenu=!1;if(e.drawymenu)if(14*h>n&&n>2*h&&r>i.height-9*h){a.fillStyle=s.color_bg,a.rect(2*h,i.height-9*h,12*h,9*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var j=i.height-.2*h,S=h,M=2.2*h;a.textAlign="left",a.fillText("y:",M,j),j-=S,a.fillText("Min:"+e.get_axis_string(s.y_manual_min,"y"),M,j),j-=S,a.fillText("Max:"+e.get_axis_string(s.y_manual_max,"y"),M,j),j-=S,a.fillText("Mode:",M,j),j-=S,a.fillText("Spacing: "+mjs_precision(s.guideWidthy,2),M,j),j-=S,a.fillText("Style:",M,j),j-=S,a.fillText("Set Prefix:",M,j),j-=S,a.fillText("Set Postfix:",M,j),j-=S,a.fillText("Set Label:",M,j),j-=S,j=i.height-1.2*h,a.textAlign="center";var M=2*h;a.fillText("[auto]",M+6*h,j),a.fillText("[manual]",M+10*h,j),j-=S,a.fillText("[auto]",M+6*h,j),a.fillText("[manual]",M+10*h,j),j-=S,a.fillText("[lin]",M+4.5*h,j),a.fillText("[log]",M+7.5*h,j),a.fillText("[time]",M+10.5*h,j),j-=S,a.fillText("[-]",M+6*h,j),a.fillText("[+]",M+10*h,j),j-=S,a.fillText("[1200]",M+5*h,j),a.fillText("[1k2]",M+7*h,j),a.fillText("[1.2k]",M+9*h,j),a.fillText("[1.2e3]",M+11*h,j),j-=S,a.fillText('"'+s.y_axis_prefix+'"',M+8*h,j),j-=S,a.fillText('"'+s.y_axis_postfix+'"',M+8*h,j),j-=S,a.fillText('"'+s.y_axis_title+'"',M+8*h,j),a.textAlign="left"}else e.drawymenu=!1;if(e.drawmodemenu)if(10*h>n&&3*h>r){a.fillStyle=s.color_bg,a.beginPath(),a.rect(0,0,10*h,3*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath(),a.fillText("symbol/line",.2*h,.8*h),a.beginPath(),a.moveTo(.2*h,1.5*h),a.lineTo(.8*h,1.5*h),a.moveTo(.5*h,1.2*h),a.lineTo(.5*h,1.8*h),a.moveTo(1.2*h,1.5*h),a.lineTo(1.8*h,1.5*h),a.stroke(),a.beginPath(),a.moveTo(.2*h,2.5*h),a.lineTo(.8*h,2.5*h),a.moveTo(.5*h,2.2*h),a.lineTo(.5*h,2.8*h),a.moveTo(1.2*h,2.5*h),a.lineTo(1.8*h,2.5*h),a.stroke(),a.beginPath(),a.moveTo(0,h),a.lineTo(10*h,h),a.moveTo(0,2*h),a.lineTo(10*h,2*h),a.moveTo(2*h,1*h),a.lineTo(2*h,3*h),a.stroke(),a.beginPath(),a.arc(2.5*h,1.5*h,.35*h,0,2*Math.PI,!0),a.stroke(),a.beginPath(),a.moveTo(2.2*h,1.2*h),a.lineTo(2.8*h,1.8*h),a.stroke(),a.beginPath(),a.arc(2.5*h,2.5*h,.35*h,0,2*Math.PI,!0),a.stroke(),a.beginPath(),a.moveTo(2.2*h,2.2*h),a.lineTo(2.8*h,2.8*h),a.stroke();var M=3*h,j=1*h;a.fillStyle=s.color_fg,a.rect(M+.3*h,j+.3*h,.4*h,.4*h),a.fill(),M+=h,a.arc(.5*h+M,j+.5*h,.3*h,0,2*Math.PI,!0),a.fill(),M+=h,a.fillStyle=s.color_bg,a.beginPath(),a.rect(M+.3*h,j+.3*h,.4*h,.4*h),a.stroke(),M+=h,a.beginPath(),a.arc(.5*h+M,j+.5*h,.3*h,0,2*Math.PI,!0),a.stroke(),M+=h,a.beginPath(),a.moveTo(M+.3*h,j+.3*h),a.lineTo(M+.7*h,j+.7*h),a.moveTo(M+.7*h,j+.3*h),a.lineTo(M+.3*h,j+.7*h),a.stroke(),M+=h,a.beginPath(),a.moveTo(M+.5*h,j+.3*h),a.lineTo(M+.5*h,j+.7*h),a.moveTo(M+.7*h,j+.5*h),a.lineTo(M+.3*h,j+.5*h),a.stroke(),j+=1.5*h,M=3.5*h;var P=.3;a.beginPath(),a.moveTo(M-P*h,j-P*h),a.lineTo(M+P*h,j+P*h),M+=h,a.moveTo(M-P*h,j+P*h),a.quadraticCurveTo(M-P*h,j-P*h,M+P*h,j-P*h),M+=h,a.moveTo(M-P*h,j+P*h),a.bezierCurveTo(M+P*h,j+P*h,M-P*h,j-P*h,M+P*h,j-P*h),M+=h,a.moveTo(M-P*h,j-P*h),a.lineTo(M-P*h,j+P*h),a.lineTo(M+P*h,j+P*h),M+=h,a.moveTo(M-P*h,j-P*h),a.lineTo(M+P*h,j-P*h),a.lineTo(M+P*h,j+P*h),M+=h,a.moveTo(M-P*h,j-P*h),a.lineTo(M,j-P*h),a.lineTo(M,j+P*h),a.lineTo(M+P*h,j+P*h),M+=h,a.moveTo(M-P*h,j-P*h),a.lineTo(M-P*h,j+P*h),a.moveTo(M-P*h,j),a.lineTo(M+P*h,j),a.lineTo(M+P*h,j+P*h),a.stroke()}else console.log("leaving menu"),e.drawmodemenu=!1;if(e.drawmarkermenu)if(21*h>n&&n>14*h&&10*h>r){a.fillStyle=s.color_bg,a.rect(14*h,0,7*h,10*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var j=.8*h,S=-h,M=14.2*h,z=17.2*h;a.fillText("Marker",M,j),j-=S,a.fillText("Clear All",M,j),a.fillText("Hide/Show",z,j),j-=S,a.fillText("Remove",M,j),a.fillText("edit",z,j),j-=S,a.fillText("Add Text",M,j),j-=S,a.fillText("Add line",M,j),a.fillText("+text",z,j),j-=S,a.fillText("Add box",M,j),a.fillText("+text",z,j),j-=S,a.fillText("Add arrow",M,j),a.fillText("+text",z,j),j-=S}else e.drawmarkermenu=!1;if(e.drawgraphmenu)if(12*h>n&&n>4*h&&11*h>r){a.fillStyle=s.color_bg,a.rect(4*h,0,8*h,11*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var j=.8*h,S=-h,M=4.2*h;a.fillText("Graph",M,j),j-=S,a.fillText("Set title",M,j),j-=S,a.fillText("Set subtitle",M,j),j-=S,a.fillText("Set subtitle2",M,j),j-=S,a.fillText("Toggle show transforms",M,j),j-=S,a.fillText("set x-axis title",M,j),j-=S,a.fillText("set y-axis title",M,j),j-=S,a.fillText("Scaling Factor down",M,j),j-=S,a.fillText("Scaling Factor up",M,j),j-=S,a.fillText("Remake Colors",M,j),j-=S,a.fillText("Reset Graph",M,j),j-=S}else e.drawgraphmenu=!1;if(e.drawFontMenu){var F=MJSFontList.fontList.length+1;if(n<i.width-2*h&&n>i.width-10*h&&h*F>r){a.fillStyle=s.color_bg,a.rect(i.width-10*h,0,8*h,h*F),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var j=.8*h,S=-1*h,M=i.width-10*h+.2*h;a.textAlign="left",a.fillText("Other ...",M,j),j-=S;for(var d=0;F-1>d;d++)a.fillText(MJSFontList.fontList[d],M,j),j-=S}else e.drawFontMenu=!1}if(e.drawexportmenu)if(n>i.width-16*h&&r>i.height-14*h){a.fillStyle=s.color_bg,a.rect(i.width-16*h,i.height-14*h,16*h,14*h),a.fill(),a.stroke(),a.fillStyle=s.color_fg,a.beginPath();var j=i.height-.1*h,S=h,M=i.width-7.8*h;a.fillText("export",M,j),j-=S,a.fillText("data (csv)",M,j),j-=S,a.fillText("data (code)",M,j),j-=S,a.fillText("data (code [matlab])",M,j),j-=S,a.fillText("data (code [JSON])",M,j),j-=S,a.fillText("data (tabbed)",M,j),j-=S,a.fillText("png (hi res)",M,j),j-=S,a.fillText("png (low res)",M,j),j-=S,a.fillText("png (small figure)",M,j),j-=S,a.fillText("png (large figure)",M,j),j-=S,a.fillText("svg",M,j),j-=S,a.fillText("svg (small figure)",M,j),j-=S,a.fillText("svg (large figure)",M,j),j-=S,a.fillText("HTML [Full link]",M,j),j-=S,M=i.width-15.8*h,j=i.height-10.1*h,a.fillText("svg+png",M,j),j-=S,a.fillText("svg+png(small fig)",M,j),j-=S,a.fillText("svg+png(large fig)",M,j),j-=S,a.fillText("HTML [Short link]",M,j),j-=S}else e.drawexportmenu=!1;if(e.drawcaptionmenu&&(n>i.width-4*h&&10*h>r?(a.fillStyle=s.color_bg,a.beginPath(),a.rect(i.width-4*h,0,4*h,10*h),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("captions",i.width-3.8*h,.8*h),a.fillText("Show/Hide",i.width-3.8*h,1.8*h),a.fillText("x",i.width-3.8*h,2.8*h),a.fillText("y",i.width-1.8*h,2.8*h),a.fillText("First",i.width-3.8*h,3.8*h),a.fillText("Last",i.width-3.8*h,4.8*h),a.fillText("Min",i.width-3.8*h,5.8*h),a.fillText("Max",i.width-3.8*h,6.8*h),a.fillText("First",i.width-1.8*h,3.8*h),a.fillText("Last",i.width-1.8*h,4.8*h),a.fillText("Min",i.width-1.8*h,5.8*h),a.fillText("Max",i.width-1.8*h,6.8*h),a.fillText("None",i.width-2.8*h,7.8*h),a.fillText("Extra Precision:",i.width-3.8*h,8.8*h),a.fillText(s.captions_extra_precision,i.width-3.8*h,9.8*h),a.fillText("[-]",i.width-1.8*h,9.8*h),a.fillText("[+]",i.width-.8*h,9.8*h),a.beginPath(),a.moveTo(i.width-4*h,h),a.lineTo(i.width,h),a.moveTo(i.width-4*h,2*h),a.lineTo(i.width,2*h),a.moveTo(i.width-4*h,3*h),a.lineTo(i.width,3*h),a.moveTo(i.width-2*h,2*h),a.lineTo(i.width-2*h,7*h),a.moveTo(i.width-4*h,8*h),a.lineTo(i.width,8*h),a.stroke()):e.drawcaptionmenu=!1),e.drawfxmenu)if(n>8*h&&22*h>n&&r>i.height-14*h){a.fillStyle=s.color_bg,a.rect(8*h,i.height-14*h,14*h,14*h),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("functions",8.2*h,i.height-.3*h),a.stroke(),a.beginPath();for(var d=1;14>d;d++)a.moveTo(8*h,i.height-h*d),a.lineTo(22*h,i.height-h*d);a.moveTo(12*h,i.height),a.lineTo(12*h,i.height-14*h),a.moveTo(16*h,i.height),a.lineTo(16*h,i.height-14*h),a.moveTo(10*h,i.height-9*h),a.lineTo(10*h,i.height-13*h),a.moveTo(10*h,i.height-4*h),a.lineTo(10*h,i.height-5*h),a.moveTo(14*h,i.height-9*h),a.lineTo(14*h,i.height-13*h),a.moveTo(14*h,i.height-3*h),a.lineTo(14*h,i.height-5*h),a.stroke(),a.fillText("reset",8.2*h,i.height-1.3*h),a.fillText("cut",8.2*h,i.height-2.3*h),a.fillText("norm(y)",8.2*h,i.height-3.3*h),a.fillText("y-c",8.2*h,i.height-4.3*h),a.fillText("x-c",10.2*h,i.height-4.3*h),a.fillText("smooth",8.2*h,i.height-5.3*h),a.fillText("interpolate",8.2*h,i.height-6.3*h),a.fillText("-(mx+c)",8.2*h,i.height-7.3*h),a.fillText("dy/dx",8.2*h,i.height-8.3*h),a.fillText("ln x",8.2*h,i.height-9.3*h),a.fillText("e^x",10.2*h,i.height-9.3*h),a.fillText("log x",8.2*h,i.height-10.3*h),a.fillText("10^x",10.2*h,i.height-10.3*h),a.fillText("10x",8.2*h,i.height-11.3*h),a.fillText("x/10",10.2*h,i.height-11.3*h),a.fillText("-x",8.2*h,i.height-12.3*h),a.fillText("1/x",10.2*h,i.height-12.3*h),a.fillText("x<->y",12.2*h,i.height-1.3*h),a.fillText("trim",12.2*h,i.height-2.3*h),a.fillText("x^n",12.2*h,i.height-3.3*h),a.fillText("y^n",14.2*h,i.height-3.3*h),a.fillText("rt x",12.2*h,i.height-4.3*h),a.fillText("rt y",14.2*h,i.height-4.3*h),a.fillText("sum",12.2*h,i.height-5.3*h),a.fillText("jitter(y)",12.2*h,i.height-6.3*h),a.fillText("Hist",12.2*h,i.height-7.3*h),a.fillText("Intergrate",12.2*h,i.height-8.3*h),a.fillText("ln y",12.2*h,i.height-9.3*h),a.fillText("e^y",14.2*h,i.height-9.3*h),a.fillText("log y",12.2*h,i.height-10.3*h),a.fillText("10^y",14.2*h,i.height-10.3*h),a.fillText("10y",12.2*h,i.height-11.3*h),a.fillText("y/10",14.2*h,i.height-11.3*h),a.fillText("-y",12.2*h,i.height-12.3*h),a.fillText("1/y",14.2*h,i.height-12.3*h),a.fillText("pop",12.2*h,i.height-.3*h),a.fillText("y vs y",8.2*h,i.height-13.3*h),a.fillText("sub fit",16.2*h,i.height-13.3*h),a.fillText("rmv outliers",16.2*h,i.height-12.3*h),a.fillText("keep outliers",16.2*h,i.height-11.3*h),a.fillText("custom y=f(x,y)",16.2*h,i.height-10.3*h),a.fillText("custom filter",16.2*h,i.height-9.3*h),
a.fillText("accumulate(y)",16.2*h,i.height-4.3*h),a.fillText("view last n",16.2*h,i.height-3.3*h),a.fillText("(y - mean)/sigma",16.2*h,i.height-2.3*h),a.fillText("x spacing",16.2*h,i.height-1.3*h),a.fillText("time->number",16.2*h,i.height-.3*h)}else e.drawfxmenu=!1;if(e.drawtimemenu)if(e.drawfxmenu=!1,n>10*h&&20*h>n&&r>i.height-6*h){a.fillStyle=s.color_bg,a.beginPath(),a.rect(10*h,i.height-6*h,10*h,6*h),a.fill(),a.stroke(),a.beginPath(),a.fillStyle=s.color_fg,a.fillText("time->number",10.2*h,i.height-.3*h);for(var C=[["days","hours","mins","sec"],["now","ago","start","end"]],M=10.2*h,A=2*h,j=i.height-3.3*h,D=h,d=0;2>d;d++)for(var u=0;4>u;u++){var q=C[d][u];q=e.timemenuoptions[d]==u?"["+q+"]":" "+q+" ",a.fillText(q,M+u*A,j-d*D)}a.fillText("Pick reference and unit",M,j-2*D),a.fillText("apply on x",M,j+2*D),a.fillText("apply on y",M+3*A,j+2*D)}else e.drawtimemenu=!1;if(e.drawlinemenu){for(var N=e.data_backup.length,d=0;N>d;d++)s.hidden_lines[d]=s.hidden_lines[d]||!1;var E=s.function_lines.length;if(n>11*h&&21*h>n&&r>i.height-h*(N+E+2)){a.fillStyle=s.color_bg,a.rect(11*h,i.height-h*(N+E+2),10*h,h*(N+E+2)),a.fill(),a.stroke(),a.beginPath(),a.moveTo(11*h,i.height-h),a.lineTo(21*h,i.height-h),a.moveTo(11*h,i.height-h*(N+1)),a.lineTo(21*h,i.height-h*(N+1)),a.stroke(),a.fillStyle=s.color_fg,a.fillText("line menu",11.2*h+.2,i.height-.2*h);for(var j=i.height-N*h-.2*h,M=13.2*h+.2,d=0;E>d;d++)j-=h,a.fillText(s.function_lines[d],M,j),a.fillText("(-) ",11.2*h+.2,j);j-=h,a.fillText("new function line",M,j);for(var d=N-1;d+1>0;d--){var q=e.captions_backup[d]||"label";a.fillStyle=e.colors_backup[d],a.fillText(q,13.2*h+.2,i.height-N*h+h*(d-.2)),s.hidden_lines[d]?a.fillText("( )",11.2*h+.2,i.height-N*h+h*(d-.2)):a.fillText("(+)",11.2*h+.2,i.height-N*h+h*(d-.2)),a.beginPath(),a.rect(20.2*h,i.height-N*h+h*(d-.8),.6*h,.6*h),a.fill(),a.beginPath(),a.rect(19.2*h,i.height-N*h+h*(d-.8),.6*h,.6*h),a.stroke()}a.fillStyle=s.color_fg,a.fillText("all",15.2*h+.2,i.height-.2*h),a.fillText("none",17.2*h+.2,i.height-.2*h)}else e.drawlinemenu=!1}if(e.drawfitsmenu)if(n>15*h&&21*h>n&&r>i.height-10*h){a.fillStyle=s.color_bg,a.rect(15*h,i.height-10*h,6*h,10*h),a.fill(),a.stroke(),a.beginPath(),a.stroke(),a.fillStyle=s.color_fg;var q="";q=s.extrapolate?"(+) extrapolate":"( ) extrapolate";var M=18.2*h,j=i.height-.3*h,L=h;a.fillText("none",M,j),j-=L,j-=L,a.fillText("stats",M,j),j-=L,a.fillText("ae^bx",M,j),j-=L,a.fillText("a+be^cx",M,j),j-=L,a.fillText("a+blnx",M,j),j-=L,a.fillText("ax^b",M,j),j-=L,a.fillText("a+bx^c",M,j),j-=L,a.fillText("gauss",M,j),j-=L,M=15.2*h,j=i.height-.3*h,a.fillText("fits",M,j),j-=L,a.fillText(q,M,j),j-=L,a.fillText("y=c",M,j),j-=L,a.fillText("linear",M,j),j-=L,a.fillText("quad",M,j),j-=L,a.fillText("cubic",M,j),j-=L,a.fillText("poly 4",M,j),j-=L,a.fillText("poly 5",M,j),j-=L,a.fillText("poly 6",M,j),j-=L,a.fillText("poly 7",M,j),j-=L}else e.drawfitsmenu=!1;if(!e.ui.touch||!e.ui.is_touching||"zoom"!==s.mouse_mode&&"drag"!==s.mouse_mode||e.drawxmenu||e.drawymenu||(a.fillStyle=s.color_bg,a.rect(0,i.height-2*h,4*h,h),a.fill(),a.stroke(),"zoom"===s.mouse_mode&&(a.rect(0,i.height-3*h,4*h,h),a.fill(),a.stroke()),a.fillStyle=s.color_fg,a.fillText("Auto Zoom",.2*h,i.height-1.3*h),"zoom"===s.mouse_mode&&a.fillText("Zoom out",.2*h,i.height-2.3*h)),e.ui.touch&&e.ui.is_touching){var I=a.getImageData(n-2*h,r-2*h,4*h,4*h);a.beginPath(),a.moveTo(n,r),a.lineTo(i.width/2,i.height/2),a.stroke(),a.rect(i.width/2-2*h-2,i.height/2-2*h-2,4*h+4,4*h+4),a.stroke(),a.putImageData(I,i.width/2-2*h,i.height/2-2*h),a.beginPath();var O=Math.max(.1*h,2);a.rect(i.width/2-O,i.height/2-O,2*O,2*O),a.fill()}}if(a.beginPath(),a.stroke(),mouse_down&&"zoom"===s.mouse_mode&&(end_x=n,end_y=r,a.beginPath(),a.rect(start_x+1,start_y+1,end_x-start_x-1,end_y-start_y-1),a.moveTo(start_x,0),a.lineTo(start_x,2*h),a.moveTo(start_x,i.height),a.lineTo(start_x,i.height-2*h),a.moveTo(end_x,i.height),a.lineTo(end_x,i.height-2*h),a.moveTo(end_x,0),a.lineTo(end_x,2*h),a.moveTo(0,start_y),a.lineTo(2*h,start_y),a.moveTo(i.width-2*h,start_y),a.lineTo(i.width,start_y),a.moveTo(0,end_y),a.lineTo(2*h,end_y),a.moveTo(i.width-2*h,end_y),a.lineTo(i.width,end_y),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"drag"===s.mouse_mode&&(e.ui.is_touching?(is_touch_dragging=!0,start_x=.5*(touch_start_x[0]+touch_start_x[1]),start_y=.5*(touch_start_y[0]+touch_start_y[1]),end_x=.5*(touch_x[0]+touch_x[1]),end_y=.5*(touch_y[0]+touch_y[1]),scale_x=(touch_x[0]-touch_x[1])/(touch_start_x[0]-touch_start_x[1]),scale_y=(touch_y[0]-touch_y[1])/(touch_start_y[0]-touch_start_y[1]),scale_x=trim(Math.abs(scale_x),.1,10),scale_y=trim(Math.abs(scale_y),.1,10),a.putImageData(e.graph_image_for_drag,0,0),a.save(),a.translate(start_x,start_y),a.scale(scale_x,scale_y),a.translate((end_x-start_x)/scale_x,(end_y-start_y)/scale_y),a.drawImage(i,-start_x,-start_y),a.restore()):(end_x=n,end_y=r,a.fillStyle=s.color_bg,a.fillRect(0,0,i.width,i.height),a.putImageData(e.graph_image_for_drag,end_x-start_x,end_y-start_y))),mouse_down&&"measure"===s.mouse_mode){if(a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(n,r),a.stroke(),dx=n-start_x,S=r-start_y,l=e.pixels_to_units(n,"x"),_=e.pixels_to_units(r,"y"),px_start=e.pixels_to_units(start_x,"x"),py_start=e.pixels_to_units(start_y,"y"),q=e.get_axis_string(l,"x"),a.fillText(q,n+c,i.height-1.5*h),q=e.get_axis_string(_,"y"),a.fillText(q,2*h,r-2*c),a.beginPath(),a.moveTo(n,i.height),a.lineTo(n,i.height-1.5*h),a.moveTo(n,0),a.lineTo(n,2*h),a.moveTo(0,r),a.lineTo(2*h,r),a.moveTo(i.width,r),a.lineTo(i.width-2*h,r),a.stroke(),a.beginPath(),a.stroke(),q=e.get_axis_string(px_start,"x"),a.fillText(q,start_x+c,i.height-2*h),q=e.get_axis_string(py_start,"y"),a.fillText(q,2*h,start_y-2*c),a.beginPath(),a.moveTo(start_x,i.height),a.lineTo(start_x,i.height-2*h),a.moveTo(start_x,0),a.lineTo(start_x,2*h),a.moveTo(0,start_y),a.lineTo(2*h,start_y),a.moveTo(i.width,start_y),a.lineTo(i.width-2*h,start_y),a.stroke(),a.beginPath(),a.stroke(),(dx>h/2||dx<-h/2)&&(x_meas=Math.min(r,start_y)-h,a.beginPath(),a.moveTo(n,x_meas-.3*h),a.lineTo(n,x_meas+.3*h),a.moveTo(start_x,x_meas-.3*h),a.lineTo(start_x,x_meas+.3*h),a.moveTo(n,x_meas),a.lineTo(start_x,x_meas),a.stroke(),q="time"===s.x_scale_mode?mjs_time_difference_print(l-px_start):e.get_axis_string(l-px_start,"x"),a.fillText(q,(n+start_x)/2-.3*s.scaling_factor*s.axis_labels_font_size*q.length,x_meas-.4*s.axis_labels_font_size)),(S>h/2||-h/2>S)&&(y_meas=Math.min(n,start_x)-h,q="time"===s.y_scale_mode?mjs_time_difference_print(_-py_start):e.get_axis_string(_-py_start,"y"),label_pos=y_meas-.7*s.axis_labels_font_size*s.scaling_factor*q.length,a.beginPath(),a.moveTo(y_meas-.3*h,r),a.lineTo(y_meas+.3*h,r),a.moveTo(y_meas-.3*h,start_y),a.lineTo(y_meas+.3*h,start_y),a.moveTo(y_meas,r),a.lineTo(y_meas,start_y),a.stroke(),a.fillText(q,label_pos,(r+start_y)/2)),(dx>h/2||dx<-h/2)&&(S>h/2||-h/2>S)){grad=(_-py_start)/(l-px_start);var G="";if("lin"!==s.y_scale_mode&&"log"!==s.y_scale_mode||"time"!==s.x_scale_mode?grad=mjs_precision(grad,Math.min(s.y_precision,s.x_precision)):(G="/ms",Math.abs(grad)<1&&(grad*=1e3,G="/s"),Math.abs(grad)<1&&(grad*=60,G="/m"),Math.abs(grad)<1&&(grad*=60,G="/h"),Math.abs(grad)<1&&(grad*=24,G="/d"),grad=mjs_precision(grad,5)),a.fillText("g = "+grad+G,n+c,r-c),"log"===s.y_scale_mode&&("lin"===s.x_scale_mode||"time"===s.x_scale_mode)){var Y=(Math.log10(_)-Math.log10(py_start))/(l-px_start);"time"===s.x_scale_mode?(G="/ms",Math.abs(Y)<1&&(Y*=1e3,G="/s"),Math.abs(Y)<1&&(Y*=60,G="/m"),Math.abs(Y)<1&&(Y*=60,G="/h"),Math.abs(Y)<1&&(Y*=24,G="/d"),Y=mjs_precision(Y,5)):(G="",Y=mjs_precision(Y,Math.min(s.y_precision,s.x_precision))),a.fillText("tau ="+Y+G,n+c,r+c);var W=Math.ceil(Math.max(dx,S)/4);a.beginPath();for(var R=0;W>R;R++){var b=e.units_to_pixels(py_start+R*(_-py_start)/W,"y"),T=e.units_to_pixels(px_start+R*(l-px_start)/W,"x");a.moveTo(T,b);var b=e.units_to_pixels(py_start+(R+1)*(_-py_start)/W,"y"),T=e.units_to_pixels(px_start+(R+1)*(l-px_start)/W,"x");a.lineTo(T,b)}a.stroke()}if("log"===s.y_scale_mode&&"log"===s.x_scale_mode){var B=(Math.log10(_)-Math.log10(py_start))/(Math.log10(l)-Math.log10(px_start));B=mjs_precision(B,Math.min(s.y_precision,s.x_precision)),a.fillText("p ="+B,n+c,r+c);var W=Math.ceil(Math.max(dx,S)/2);a.beginPath();for(var b=0,T=0,R=0;W>R;R++)T=Math.exp(Math.log(px_start)+R*(Math.log(l)-Math.log(px_start))/W),b=(T-px_start)*grad+py_start,T=e.units_to_pixels(T,"x"),b=e.units_to_pixels(b,"y"),a.moveTo(T,b),T=Math.exp(Math.log(px_start)+(R+1)*(Math.log(l)-Math.log(px_start))/W),b=(T-px_start)*grad+py_start,T=e.units_to_pixels(T,"x"),b=e.units_to_pixels(b,"y"),a.lineTo(T,b);a.stroke()}}a.beginPath(),a.stroke()}if(mouse_down&&"trim"===s.mouse_mode&&(end_x=n,end_y=r,a.beginPath(),a.rect(start_x,start_y,end_x-start_x,end_y-start_y),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"cut"===s.mouse_mode&&(end_x=n,end_y=r,a.beginPath(),a.rect(start_x,start_y,end_x-start_x,end_y-start_y),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"x-c"===s.mouse_mode&&(q=mjs_precision(l,s.y_precision+1),a.fillText("x-"+q,n+2*c,r-2*c),a.beginPath(),a.moveTo(n,0),a.lineTo(n,i.height),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"y-c"===s.mouse_mode&&(q=mjs_precision(_,s.y_precision+1),a.fillText("y-"+q,n+2*c,r-2*c),a.beginPath(),a.moveTo(0,r),a.lineTo(i.width,r),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"sublin"===s.mouse_mode&&(a.fillText("draw line to subtract",n+2*c,r-2*c),a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(n,r),a.stroke(),a.beginPath(),a.stroke()),mouse_down&&"mouse"===s.mouse_mode){e.ui.mouse_is_dragging=!1;var X=Math.sqrt(Math.pow(start_x-s.fit_text_position.x*i.width,2)+Math.pow(start_y-s.fit_text_position.y*i.height,2));if(2*c>X)return a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(n,r),a.stroke(),e.ui.mouse_is_dragging=!0,void(e.ui.drag_object="fit_text");if(X=Math.sqrt(Math.pow(start_x-i.width/2,2)+Math.pow(start_y-(s.tick_len+s.title_spacing+s.title_font_size)*s.scaling_factor,2)),2*c>X)return a.beginPath(),a.moveTo(i.width/2,start_y),a.lineTo(i.width/2,r),a.stroke(),e.ui.mouse_is_dragging=!0,void(e.ui.drag_object="title_spacing");var y=s.scaling_factor*s.caption_position.x;if(s.caption_position.x>0?y+=s.scaling_factor*s.tick_len:(y=i.width+y,y-=s.scaling_factor*s.tick_len),cap_y=s.scaling_factor*s.caption_position.y,s.caption_position.y>0?cap_y+=s.scaling_factor*s.tick_len:(cap_y=i.height+cap_y,cap_y-=s.scaling_factor*s.tick_len),X=Math.sqrt(Math.pow(start_x-y,2)+Math.pow(start_y-cap_y,2)),2*c>X){a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(n,r),a.stroke();var J=2*c;return a.beginPath(),n>i.width/2&&r>i.height/2&&(a.moveTo(n-J,r),a.lineTo(n,r),a.lineTo(n,r-J)),n>i.width/2&&r<i.height/2&&(a.moveTo(n-J,r),a.lineTo(n,r),a.lineTo(n,r+J)),n<i.width/2&&r>i.height/2&&(a.moveTo(n+J,r),a.lineTo(n,r),a.lineTo(n,r-J)),n<i.width/2&&r<i.height/2&&(a.moveTo(n+J,r),a.lineTo(n,r),a.lineTo(n,r+J)),a.stroke(),e.ui.mouse_is_dragging=!0,void(e.ui.drag_object="caption_position")}for(var V=1e200,H=0,U=0,X=1e200,d=0;d<s.markers.length;d++)for(var f=s.markers[d],u=0;u<f.handles.length;u++)X=Math.sqrt(Math.pow(start_x-e.units_to_pixels(f.handles[u][0],"x"),2)+Math.pow(start_y-e.units_to_pixels(f.handles[u][1],"y"),2)),V>X&&(V=X,H=d,U=u);if(2*c>V)return e.ui.mouse_is_dragging=!0,e.ui.drag_object={item:"marker",i:H,j:U},a.beginPath(),a.moveTo(e.units_to_pixels(s.markers[H].handles[U][0],"x"),e.units_to_pixels(s.markers[H].handles[U][1],"y")),a.lineTo(n,r),a.moveTo(0,r),a.lineTo(i.width,r),a.moveTo(n,0),a.lineTo(n,i.height),void a.stroke()}!mouse_down||"addmarkerline"!==s.mouse_mode&&"addmarkerlinentext"!==s.mouse_mode&&"addmarkerarrow"!==s.mouse_mode&&"addmarkerarrowntext"!==s.mouse_mode||(a.beginPath(),a.moveTo(start_x,start_y),a.lineTo(n,r),a.stroke()),!mouse_down||"addmarkerbox"!==s.mouse_mode&&"addmarkerboxntext"!==s.mouse_mode||(a.beginPath(),a.rect(start_x+1,start_y+1,n-start_x-1,r-start_y-1),a.stroke())}}function mouse_down_event(t,e){mouse_down=!0;var i=e.canvas,a=(i.getContext("2d"),i.getBoundingClientRect());start_x=t.clientX-a.left,start_y=t.clientY-a.top,drag_x_max=e.pixels_to_units(i.width,"x"),drag_x_min=e.pixels_to_units(0,"x"),drag_y_max=e.pixels_to_units(0,"y"),drag_y_min=e.pixels_to_units(i.height,"y")}function mouse_out_event(t,e){var i=e.canvas,a=i.getContext("2d");a.putImageData(e.graph_image,0,0),e.drawfxmenu=!1,e.drawlinemenu=!1,e.drawmodemenu=!1,e.drawfitsmenu=!1,e.drawtimemenu=!1,e.drawgraphmenu=!1,e.drawcaptionmenu=!1,e.drawxmenu=!1,e.drawymenu=!1,1==e.graphics_style.o&&(e.graphics_style.mouse_mode=e.pre_mouse_mode,e.graphics_style.o=0)}function keypress_event(t,e){console.log("in keypress");var i=String.fromCharCode(t.keyCode||t.charCode);console.log(i),console.log("in keypress")}function mouse_up_event(t,e){"use strict";var i=e.canvas,a=e.graphics_style,s=i.getContext("2d");mouse_down=!1;var o=i.getBoundingClientRect(),n=t.clientX-o.left,r=t.clientY-o.top,l=a.tick_len,_=e.ui.size;if("zoom"===a.mouse_mode&&Math.abs(start_x-n)>l&&Math.abs(start_y-r)>l)return console.log("mouse zoom"),start_x=e.pixels_to_units(start_x,"x"),start_y=e.pixels_to_units(start_y,"y"),n=e.pixels_to_units(n,"x"),r=e.pixels_to_units(r,"y"),a.x_manual_min=Math.min(start_x,n),a.x_manual_max=Math.max(start_x,n),a.y_manual_min=Math.min(start_y,r),a.y_manual_max=Math.max(start_y,r),a.x_scale_auto_min=!1,a.y_scale_auto_min=!1,a.x_scale_auto_max=!1,a.y_scale_auto_max=!1,a.y_scale_tight=!0,a.x_scale_tight=!0,void e.mjs_plot();if(e.ui.touch&&("zoom"===a.mouse_mode||"drag"===a.mouse_mode)&&4*_>n&&r>i.height-2*_&&r<i.height-1*_&&(a.y_scale_auto_min=!0,a.y_scale_tight=!1,a.y_scale_auto_max=!0,a.y_scale_tight=!1,a.x_scale_auto_min=!0,a.x_scale_tight=!1,a.x_scale_auto_max=!0,a.x_scale_tight=!1),e.ui.touch&&"zoom"===a.mouse_mode&&4*_>n&&r>i.height-3*_&&r<i.height-2*_&&(t.button=2),e.drawcaptionmenu){var h=Math.floor((i.width-n)/2/_),c=Math.floor(r/_);if(e.drawcaptionmenu=!1,0==c)return void setTimeout(function(){mouse_move_event(t,e)},0);if(1==c&&(a.show_captions=!a.show_captions),7==c&&(a.captions_display="none"),1==h)switch(c){case 3:a.captions_display="xfirst";break;case 4:a.captions_display="xlast";break;case 5:a.captions_display="xmin";break;case 6:a.captions_display="xmax"}if(0==h)switch(c){case 3:a.captions_display="yfirst";break;case 4:a.captions_display="ylast";break;case 5:a.captions_display="ymin";break;case 6:a.captions_display="ymax"}return c>2&&7>c&&(a.show_captions=!0),c>7&&(e.drawcaptionmenu=!0,n>i.width-_?a.captions_extra_precision=Math.min(a.captions_extra_precision+1,10):n>i.width-2*_&&(a.captions_extra_precision=Math.max(0,a.captions_extra_precision-1))),e.mjs_plot(),void setTimeout(function(){mouse_move_event(t,e)},0)}if(e.drawxmenu){var h=Math.floor(n/_),c=Math.floor((i.height-r)/_);switch(c){case 0:return e.drawxmenu=!1,void mouse_move_event(t,e);case 1:if(8>h)a.x_scale_auto_min=!0,a.x_scale_tight=!1;else if(a.x_scale_auto_min=!1,"time"===a.x_scale_mode){var g=new Date(a.x_manual_min),m=Date.parse(prompt("new low limit",g.toISOString()));a.x_manual_min=m||a.x_manual_min}else a.x_manual_min=getFloat("new low limit",a.x_manual_min);break;case 2:if(8>h)a.x_scale_auto_max=!0,a.x_scale_tight=!1;else if(a.x_scale_auto_max=!1,"time"===a.x_scale_mode){var g=new Date(a.x_manual_max),m=Date.parse(prompt("new high limit",g.toISOString()));a.x_manual_max=m||a.x_manual_max}else a.x_manual_max=getFloat("new high limit",a.x_manual_max);break;case 3:6>h?a.x_scale_mode="lin":h>9?a.x_scale_mode="time":a.x_scale_mode="log";break;case 4:8>h?a.guideWidthx/=1.5:a.guideWidthx*=1.5;break;case 5:6>h?a.x_label_mode="norm":h>=10?a.x_label_mode="sci":h>=8?a.x_label_mode="postfix":a.x_label_mode="infix",console.log(a.x_label_mode);break;case 6:a.x_axis_prefix=getString("new prefix",a.x_axis_prefix);break;case 7:a.x_axis_postfix=getString("new postfix",a.x_axis_postfix);break;case 8:a.x_axis_title=getString("new title",a.x_axis_title),e.transform_index--}return e.mjs_plot(),void setTimeout(function(){mouse_move_event(t,e)},0)}if(e.drawymenu){var h=Math.floor(n/_)-2,c=Math.floor((i.height-r)/_);switch(c){case 0:return e.drawymenu=!1,void mouse_move_event(t,e);case 1:if(8>h)a.y_scale_auto_min=!0,a.y_scale_tight=!1;else if(a.y_scale_auto_min=!1,"time"===a.y_scale_mode){var g=new Date(a.y_manual_min),m=Date.parse(prompt("new low limit",g.toISOString()));a.y_manual_min=m||a.y_manual_min}else a.y_manual_min=getFloat("new low limit",a.y_manual_min);break;case 2:if(8>h)a.y_scale_auto_max=!0,a.y_scale_tight=!1;else if(a.y_scale_auto_max=!1,"time"===a.y_scale_mode){var g=new Date(a.y_manual_max),m=Date.parse(prompt("new high limit",g.toISOString()));a.y_manual_max=m||a.y_manual_max}else a.y_manual_max=getFloat("new high limit",a.y_manual_max);break;case 3:6>h?a.y_scale_mode="lin":h>9?a.y_scale_mode="time":a.y_scale_mode="log";break;case 4:8>h?a.guideWidthy/=1.5:a.guideWidthy*=1.5;break;case 5:6>h?a.y_label_mode="norm":h>=10?a.y_label_mode="sci":h>=8?a.y_label_mode="postfix":a.y_label_mode="infix",console.log(a.y_label_mode);break;case 6:a.y_axis_prefix=getString("new prefix",a.y_axis_prefix);break;case 7:a.y_axis_postfix=getString("new postfix",a.y_axis_postfix);break;case 8:a.y_axis_title=getString("new title",a.y_axis_title),e.transform_index--}return e.mjs_plot(),void setTimeout(function(){mouse_move_event(t,e)},0)}if(e.drawmodemenu){var h=Math.floor(n/_),c=Math.floor(r/_);if(0==c)return e.drawmodemenu=!1,void setTimeout(function(){mouse_move_event(t,e)},0);if(1==c){switch(h){case 0:a.symbol_size*=1.2;break;case 1:a.symbol_size/=1.2;break;case 2:a.symbol_mode="none";break;case 3:a.symbol_mode="dot";break;case 4:a.symbol_mode="cdot";break;case 5:a.symbol_mode="box";break;case 6:a.symbol_mode="circ";break;case 7:a.symbol_mode="x";break;case 8:a.symbol_mode="cross"}h>1&&(a.symbol_modes=[])}if(2==c){switch(h){case 0:a.line_thickness*=1.2;break;case 1:a.line_thickness/=1.2;break;case 2:a.line_mode="none";break;case 3:a.line_mode="line";break;case 4:a.line_mode="approx";break;case 5:a.line_mode="interp";break;case 6:a.line_mode="zig";break;case 7:a.line_mode="zag";break;case 8:a.line_mode="mid";break;case 9:a.line_mode="hist"}h>1&&(a.line_modes=[])}return e.do_line_modes(),e.mjs_plot(),void setTimeout(function(){mouse_move_event(t,e)},0)}if(e.drawgraphmenu){var c=Math.floor(r/_);switch(c){case 0:return e.drawgraphmenu=!1,void mouse_move_event(t,e);case 1:a.title=getString("new title",a.title);break;case 2:a.subtitle=getString("new subtitle",a.subtitle);break;case 3:a.subtitle2=getString("new subtitle",a.subtitle2);break;case 4:a.showTransformTexts=!a.showTransformTexts;break;case 5:a.x_axis_title=getString("new x axis title",a.x_axis_title),e.transform_index--;break;case 6:a.y_axis_title=getString("new y axis title",a.y_axis_title),e.transform_index--;break;case 7:a.scaling_factor/=1.1;break;case 8:a.scaling_factor*=1.1;break;case 9:e.redo_colours();break;case 10:e.reset()}return e.mjs_plot(),void setTimeout(function(){mouse_move_event(t,e)},0)}if(e.drawmarkermenu){var c=Math.floor(r/_);if(c>=2&&!a.show_markers&&(a.show_markers=!0,setTimeout(function(){e.mjs_plot()},0)),17*_>n)switch(c){case 0:break;case 1:a.markers=[],e.mjs_plot();break;case 2:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="removeMarker";break;case 3:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="addmarkertext",e.markerText=getString("Text:","");break;case 4:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="addmarkerline";break;case 5:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="addmarkerbox";break;case 6:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="addmarkerarrow"}else switch(c){case 0:break;case 1:a.show_markers=!a.show_markers,e.mjs_plot();break;case 2:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="markeredit";break;case 4:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="addmarkerlinentext",e.markerText=getString("Text:","");break;case 5:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="addmarkerboxntext",e.markerText=getString("Text:","");break;case 6:e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="addmarkerarrowntext",e.markerText=getString("Text:","")}return e.drawmarkermenu=!1,void setTimeout(function(){mouse_move_event(t,e)},0)}if(e.drawStylemenu){var c=Math.floor(r/_),h=Math.floor((i.width-n)/_)-2;switch(c){case 0:return e.drawStylemenu=!1,void mouse_move_event(t,e);case 1:return e.drawStylemenu=!1,e.drawFontMenu=!0,void mouse_move_event(t,e);case 2:h?a.title_font_size--:a.title_font_size++;break;case 3:h?a.tick_labels_font_size--:a.tick_labels_font_size++;break;case 4:h?a.axis_labels_font_size--:a.axis_labels_font_size++;break;case 5:h?a.title_spacing--:a.title_spacing++;break;case 6:h?a.tick_lables_font_padding--:a.tick_lables_font_padding++;break;case 7:h?a.lable_spacing--:a.lable_spacing++;break;case 8:a.color_fg=getString("new forground color",a.color_fg);break;case 9:a.color_bg=getString("new background color",a.color_bg);break;case 10:a.color_mg=getString("new midground color",a.color_mg);break;case 11:h?a.graph_line_thickness=Math.max(.1,a.graph_line_thickness-.5):a.graph_line_thickness+=.5;break;case 12:h?a.tick_len=Math.max(.1,a.tick_len-1):a.tick_len+=1;break;case 13:h?a.minor_tick_len=Math.max(.1,a.minor_tick_len-1):a.minor_tick_len+=1}return e.mjs_plot(),void mouse_move_event(t,e)}if(e.drawFontMenu){var c=Math.floor(r/_)-1;return-1==c?a.font_name=getString("font",a.font_name):a.font_name=MJSFontList.fontList[c],e.mjs_plot(),void mouse_move_event(t,e)}if(_>r)return 4*_>n?(e.drawmodemenu=!0,void mouse_move_event(t,e)):n>4*_&&8*_>n?(e.drawgraphmenu=!0,void mouse_move_event(t,e)):10*_>n&&n>9*_?(a.mouse_mode="drag",e.needs_drag_image=!0,e.mjs_plot(),void mouse_move_event(t,e)):11*_>n&&n>10*_?(a.mouse_mode="zoom",void mouse_move_event(t,e)):12*_>n&&n>11*_?(a.mouse_mode="measure",void mouse_move_event(t,e)):13*_>n&&n>12*_?(a.mouse_mode="reader",void mouse_move_event(t,e)):14*_>n&&n>13*_?(a.mouse_mode="mouse",void mouse_move_event(t,e)):n>14*_&&17*_>n?(e.drawmarkermenu=!0,void mouse_move_event(t,e)):n<i.width&&n>i.width-_?(e.drawcaptionmenu=!0,void mouse_move_event(t,e)):(n<i.width-_&&n>i.width-2*_&&(a.i=(a.i+1)%2),n<i.width-2*_&&n>i.width-5*_?(e.drawStylemenu=!0,void mouse_move_event(t,e)):(e.mjs_plot(),void mouse_move_event(t,e)));if(e.drawtimemenu){for(var h=10*_,x=2*_,c=i.height-3*_,d=_,f=0;2>f;f++)if(r>c-(f+1)*d&&c-f*d>r&&n>h&&h+4*x>n)for(var u=0;4>u;u++){var p=n>h+u*x&&h+(u+1)*x>n;p&&(e.timemenuoptions[f]=u)}if(c+2*d>r&&r>c+1*d&&n>h&&h+3*x>n){console.log("apply button");var y=a.data_transforms.length;a.data_transforms[y]="time_to_num",a.x_scale_mode="lin";var v=new Date;a.data_transforms_args[y]=[e.timemenuoptions[1],e.timemenuoptions[0],"x",v.getTime()],e.drawtimemenu=!1,e.mjs_plot()}if(c+2*d>r&&r>c+1*d&&n>h+3*x&&h+6*x>n){console.log("apply button");var y=a.data_transforms.length;a.data_transforms[y]="time_to_num",a.y_scale_mode="lin";var v=new Date;a.data_transforms_args[y]=[e.timemenuoptions[1],e.timemenuoptions[0],"y",v.getTime()],e.drawtimemenu=!1,e.mjs_plot()}return void mouse_move_event(t,e)}if(e.drawfxmenu){var y=a.data_transforms.length;if(12*_>n&&n>8*_&&r>i.height-_)return e.drawfxmenu=!1,void mouse_move_event(t,e);if(12*_>n&&n>8*_&&r>i.height-2*_&&r<i.height-1*_&&(console.log("resetbutton"),e.graphics_style.data_transforms=[],e.graphics_style.data_transforms_args=[],"hist dot"===a.mode&&(a.mode="line dot")),16*_>n&&n>12*_&&r>i.height-1*_&&(console.log("pop"),a.data_transforms.pop(),a.data_transforms_args.pop()),12*_>n&&n>8*_&&r>i.height-14*_&&r<i.height-13*_&&(console.log("y vs y"),"y_vs_y"==a.data_transforms[y-1]?(a.data_transforms_args[y-1][0]+=1,e.transform_index--):(a.data_transforms[y]="y_vs_y",a.data_transforms_args[y]=[1])),12*_>n&&n>8*_&&r>i.height-3*_&&r<i.height-2*_&&(console.log("cut button"),e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="cut",e.drawfxmenu=!1),12*_>n&&n>8*_&&r>i.height-4*_&&r<i.height-3*_&&(console.log("normalise"),"normalise"==a.data_transforms[y-1]?(a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="normalise",a.data_transforms_args[y]=[0]),a.y_scale_auto_min=!0,a.y_scale_auto_max=!0),10*_>n&&n>8*_&&r>i.height-5*_&&r<i.height-4*_&&(console.log("y-c"),e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="y-c",e.drawfxmenu=!1),12*_>n&&n>10*_&&r>i.height-5*_&&r<i.height-4*_&&(console.log("x-c"),e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="x-c",e.drawfxmenu=!1),12*_>n&&n>8*_&&r>i.height-6*_&&r<i.height-5*_&&(console.log("smooth"),"smooth"==a.data_transforms[y-1]?(a.data_transforms_args[y-1][0]=1.467799*a.data_transforms_args[y-1][0],e.transform_index--):(a.data_transforms[y]="smooth",a.data_transforms_args[y]=[2.1544339])),12*_>n&&n>8*_&&r>i.height-7*_&&r<i.height-6*_&&(console.log("interpolate"),"interpolate"==a.data_transforms[y-1]?(a.data_transforms_args[y-1][0]*=2,e.transform_index--):(a.data_transforms[y]="interpolate",a.data_transforms_args[y]=[20])),12*_>n&&n>8*_&&r>i.height-8*_&&r<i.height-7*_&&(console.log("-baseline"),e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="sublin",e.drawfxmenu=!1),12*_>n&&n>8*_&&r>i.height-9*_&&r<i.height-8*_&&(console.log("dy/dx"),a.data_transforms[y]="differentiate",a.data_transforms_args[y]=[0],a.y_scale_auto_min=!0,a.y_scale_auto_max=!0),12*_>n&&n>10*_&&r>i.height-10*_&&r<i.height-9*_&&(console.log("ex"),"ln_x"==a.data_transforms[y-1]?(a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="e_to_x",a.data_transforms_args[y]=[0])),10*_>n&&n>8*_&&r>i.height-10*_&&r<i.height-9*_&&(console.log("lnx"),"e_to_x"==a.data_transforms[y-1]?(a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="ln_x",a.data_transforms_args[y]=[0])),12*_>n&&n>10*_&&r>i.height-11*_&&r<i.height-10*_&&(console.log("10^x"),"log_x"==a.data_transforms[y-1]?(a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="ten_to_x",a.data_transforms_args[y]=[0])),10*_>n&&n>8*_&&r>i.height-11*_&&r<i.height-10*_&&(console.log("logx"),"ten_to_x"==a.data_transforms[y-1]?(a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="log_x",a.data_transforms_args[y]=[0])),12*_>n&&n>10*_&&r>i.height-12*_&&r<i.height-11*_&&(console.log("x/10"),"scale_x"==a.data_transforms[y-1]?(console.log("incresing scaling"),a.data_transforms_args[y-1][0]*=.1,e.transform_index--):(a.data_transforms[y]="scale_x",a.data_transforms_args[y]=[.1]),a.x_manual_min*=.1,a.x_manual_max*=.1),10*_>n&&n>8*_&&r>i.height-12*_&&r<i.height-11*_&&(console.log("10x"),"scale_x"==a.data_transforms[y-1]?(console.log("incresing scaling"),a.data_transforms_args[y-1][0]*=10,e.transform_index--):(a.data_transforms[y]="scale_x",a.data_transforms_args[y]=[10]),a.x_manual_min*=10,a.x_manual_max*=10),12*_>n&&n>10*_&&r>i.height-13*_&&r<i.height-12*_&&(console.log("1/x"),"one_over_x"==a.data_transforms[y-1]?(a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="one_over_x",a.data_transforms_args[y]=[])),10*_>n&&n>8*_&&r>i.height-13*_&&r<i.height-12*_){console.log("-x"),"scale_x"==a.data_transforms[y-1]?(console.log("incresing scaling"),a.data_transforms_args[y-1][0]*=-1,e.transform_index--):(a.data_transforms[y]="scale_x",a.data_transforms_args[y]=[-1]);var w=-1*a.x_manual_min,T=-1*a.x_manual_max;a.x_manual_min=Math.min(w,T),a.x_manual_max=Math.max(w,T)}if(16*_>n&&n>12*_&&r>i.height-2*_&&r<i.height-1*_){console.log("x<->y"),"swap_x_y"==a.data_transforms[y-1]?(console.log("undoing swap"),a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="swap_x_y",a.data_transforms_args[y]=[]);var b=a.x_manual_min;a.x_manual_min=a.y_manual_min,a.y_manual_min=b,b=a.x_manual_max,a.x_manual_max=a.y_manual_max,a.y_manual_max=b,b=a.x_scale_mode,a.x_scale_mode=a.y_scale_mode,a.y_scale_mode=b,b=a.x_axis_prefix,a.x_axis_prefix=a.y_axis_prefix,a.y_axis_prefix=b,b=a.x_axis_postfix,a.x_axis_postfix=a.y_axis_postfix,a.y_axis_postfix=b,b=a.x_label_mode,a.x_label_mode=a.y_label_mode,a.y_label_mode=b}if(16*_>n&&n>12*_&&r>i.height-3*_&&r<i.height-2*_&&(console.log("trim"),e.pre_mouse_mode=a.mouse_mode,a.mouse_mode="trim",e.drawfxmenu=!1),16*_>n&&n>14*_&&r>i.height-4*_&&r<i.height-3*_)if(console.log("y^(n)"),"y_pow_n"==a.data_transforms[y-1]){console.log("incresing power"),a.data_transforms_args[y-1][0]+=1;var k=a.data_transforms_args[y-1][0];a.y_manual_min=Math.pow(a.y_manual_min,k/(k-1)),a.y_manual_max=Math.pow(a.y_manual_max,k/(k-1)),e.transform_index--}else a.data_transforms[y]="y_pow_n",a.data_transforms_args[y]=[2],a.y_manual_min=Math.pow(a.y_manual_min,2),a.y_manual_max=Math.pow(a.y_manual_max,2);if(14*_>n&&n>12*_&&r>i.height-4*_&&r<i.height-3*_)if(console.log("x^(n)"),"x_pow_n"==a.data_transforms[y-1]){console.log("incresing power"),a.data_transforms_args[y-1][0]+=1;var k=a.data_transforms_args[y-1][0];a.x_manual_min=Math.pow(a.x_manual_min,k/(k-1)),a.x_manual_max=Math.pow(a.x_manual_max,k/(k-1)),e.transform_index--}else a.data_transforms[y]="x_pow_n",a.data_transforms_args[y]=[2],a.x_manual_min=Math.pow(a.x_manual_min,2),a.x_manual_max=Math.pow(a.x_manual_max,2);if(16*_>n&&n>14*_&&r>i.height-5*_&&r<i.height-4*_){if(console.log("sqrty"),"y_nth_root"==a.data_transforms[y-1]){console.log("incresing power"),a.data_transforms_args[y-1][0]+=1;var k=a.data_transforms_args[y-1][0];e.transform_index--}else{a.data_transforms[y]="y_nth_root",a.data_transforms_args[y]=[2];var k=2}var M=Math.pow(Math.abs(a.y_manual_min),.5),j=Math.pow(Math.abs(a.y_manual_max),.5);if(a.y_manual_min<0&&a.y_manual_max>0)var S=0;else S=1;a.y_manual_min=Math.min(M,j)*S,a.y_manual_max=Math.max(M,j)}if(14*_>n&&n>12*_&&r>i.height-5*_&&r<i.height-4*_){if(console.log("sqrtx"),"x_nth_root"==a.data_transforms[y-1]){console.log("incresing power"),a.data_transforms_args[y-1][0]+=1;var k=a.data_transforms_args[y-1][0];e.transform_index--}else{a.data_transforms[y]="x_nth_root",a.data_transforms_args[y]=[2];var k=2}var M=Math.pow(Math.abs(a.x_manual_min),.5),j=Math.pow(Math.abs(a.x_manual_max),.5);if(a.x_manual_min<0&&a.x_manual_max>0)var S=0;else S=1;a.x_manual_min=Math.min(M,j)*S,a.x_manual_max=Math.max(M,j)}if(16*_>n&&n>14*_&&r>i.height-6*_&&r<i.height-5*_&&console.log("B-A"),14*_>n&&n>12*_&&r>i.height-6*_&&r<i.height-5*_&&(console.log("sum"),a.data_transforms[y]="sum",a.data_transforms_args[y]=[]),16*_>n&&n>12*_&&r>i.height-7*_&&r<i.height-6*_&&(console.log("Jitter"),"jitter"==a.data_transforms[y-1]?(a.data_transforms_args[y-1][0]+=1,e.transform_index--):(a.data_transforms[y]="jitter",a.data_transforms_args[y]=[1])),16*_>n&&n>12*_&&r>i.height-8*_&&r<i.height-7*_&&(console.log("Hist"),a.data_transforms[y]="hist",a.data_transforms_args[y]=[0],a.x_scale_auto_max=!0,a.x_scale_auto_min=!0,a.y_scale_auto_max=!0,a.y_scale_auto_min=!0,a.x_scale_mode="lin",a.y_scale_mode="lin",a.mode="hist dot"),16*_>n&&n>12*_&&r>i.height-9*_&&r<i.height-8*_&&(console.log("Intergrate"),a.data_transforms[y]="intergrate",a.data_transforms_args[y]=[0],a.y_scale_auto_min=!0,a.y_scale_auto_max=!0),16*_>n&&n>14*_&&r>i.height-10*_&&r<i.height-9*_&&(console.log("ey"),a.data_transforms[y]="e_to_y",a.data_transforms_args[y]=[0]),14*_>n&&n>12*_&&r>i.height-10*_&&r<i.height-9*_&&(console.log("lny"),a.data_transforms[y]="ln_y",a.data_transforms_args[y]=[0]),16*_>n&&n>14*_&&r>i.height-11*_&&r<i.height-10*_&&(console.log("10^y"),a.data_transforms[y]="ten_to_y",a.data_transforms_args[y]=[0]),14*_>n&&n>12*_&&r>i.height-11*_&&r<i.height-10*_&&(console.log("logy"),a.data_transforms[y]="log_y",a.data_transforms_args[y]=[0]),16*_>n&&n>14*_&&r>i.height-12*_&&r<i.height-11*_&&(console.log("y/10"),"scale_y"==a.data_transforms[y-1]?(console.log("incresing scaling"),a.data_transforms_args[y-1][0]*=.1,e.transform_index--):(a.data_transforms[y]="scale_y",a.data_transforms_args[y]=[.1])),14*_>n&&n>12*_&&r>i.height-12*_&&r<i.height-11*_&&(console.log("10y"),"scale_y"==a.data_transforms[y-1]?(console.log("incresing scaling"),a.data_transforms_args[y-1][0]*=10,e.transform_index--):(a.data_transforms[y]="scale_y",a.data_transforms_args[y]=[10])),16*_>n&&n>14*_&&r>i.height-13*_&&r<i.height-12*_&&(console.log("1/y"),"one_over_y"==a.data_transforms[y-1]?(a.data_transforms.pop(),a.data_transforms_args.pop()):(a.data_transforms[y]="one_over_y",
a.data_transforms_args[y]=[])),14*_>n&&n>12*_&&r>i.height-13*_&&r<i.height-12*_){console.log("-y"),"scale_y"==a.data_transforms[y-1]?(console.log("incresing scaling"),a.data_transforms_args[y-1][0]*=-1,e.transform_index--):(a.data_transforms[y]="scale_y",a.data_transforms_args[y]=[-1]);var w=-1*a.y_manual_min,T=-1*a.y_manual_max;a.y_manual_min=Math.min(w,T),a.y_manual_max=Math.max(w,T)}if(22*_>n&&n>16*_&&r>i.height-14*_&&r<i.height-13*_&&(console.log("subtract trend"),fits.fit_strings.indexOf(a.fits)>-1?(a.data_transforms[y]="subtract_fit",a.data_transforms_args[y]=[a.fits],a.fits="none"):e.errors.push("No fit chosen")),22*_>n&&n>16*_&&r>i.height-13*_&&r<i.height-12*_&&(console.log("subtract trend"),"remove_outliers"==a.data_transforms[y-1]?(a.data_transforms_args[y-1][1]-=1,e.transform_index--):fits.fit_strings.indexOf(a.fits)>-1?(a.data_transforms[y]="remove_outliers",a.data_transforms_args[y]=[a.fits,5],a.fits="old"):e.errors.push("No fit chosen")),22*_>n&&n>16*_&&r>i.height-12*_&&r<i.height-11*_&&(console.log("subtract trend"),"keep_outliers"==a.data_transforms[y-1]?(a.data_transforms_args[y-1][1]+=1,e.transform_index--):fits.fit_strings.indexOf(a.fits)>-1?(a.data_transforms[y]="keep_outliers",a.data_transforms_args[y]=[a.fits,0],a.fits="old"):e.errors.push("No fit chosen")),22*_>n&&n>16*_&&r>i.height-11*_&&r<i.height-10*_){console.log("custom f(x) button");var P=prompt("y = f(x,y) =","y");P&&(a.data_transforms[y]="custom_y",a.data_transforms_args[y]=[P])}if(22*_>n&&n>16*_&&r>i.height-10*_&&r<i.height-9*_){console.log("custom filter button");var P;P="time"===a.x_scale_mode||"time"===a.y_scale_mode?prompt("use, >, <, >=, <=, ==, x, y, now (time) and maths","x > now - 1000*60*60"):prompt("use, >, <, >=, <=, ==, x, y and maths","x*2+y*2 < 16"),P&&(a.data_transforms[y]="custom_filter",a.data_transforms_args[y]=[P])}return 22*_>n&&n>16*_&&r>i.height-2*_&&r<i.height-1*_&&(console.log("x spacing"),a.data_transforms[y]="spacing",a.data_transforms_args[y]=[]),22*_>n&&n>16*_&&r>i.height-5*_&&r<i.height-4*_&&(a.data_transforms[y]="accumulate",a.data_transforms_args[y]=[]),22*_>n&&n>16*_&&r>i.height-4*_&&r<i.height-3*_&&(console.log("view_last_n"),a.data_transforms[y]="view_last_n",a.data_transforms_args[y]=[getInt("How Many Points",512)]),22*_>n&&n>16*_&&r>i.height-3*_&&r<i.height-2*_&&(console.log("mean_normalise"),a.data_transforms[y]="mean_normalise",a.data_transforms_args[y]=[]),22*_>n&&n>16*_&&r>i.height-1*_&&r<i.height&&(console.log("time menu"),e.drawtimemenu=!0,e.drawfxmenu=!1),e.mjs_plot(),void mouse_move_event(t,e)}if(e.drawlinemenu){if(15*_>n&&n>11*_&&r>i.height-_)return e.drawlinemenu=!1,void mouse_move_event(t,e);if(21*_>n&&n>11*_&&r<i.height-_){var z=e.data_backup.length,F=a.function_lines.length,C=Math.floor(z+F+1-((i.height-r)/_-1));if(0==C){console.log("new function");var P;P="time"===a.x_scale_mode?prompt("y = f(x)","cos(2*pi*x/1000/60/60/24)"):prompt("y = f(x)","x*x/2"),P&&a.function_lines.push(P)}if(C-=1,F>C&&C>=0&&13*_>n&&(console.log("remove item "+C),a.function_lines.splice(F-C-1,1)),F>C&&C>=0&&n>13*_){console.log("edit item "+C);var P=prompt("y = f(x)",a.function_lines[F-C-1]);P&&(a.function_lines[F-C-1]=P)}C-=F,C>=0&&(console.log("hideshow"+C),n>20*_?a.line_colours[C]=getString("new color name or hex",e.colors_backup[C]):n>19*_?(a.symbol_modes[C]=getString("new symbol mode ( dot cdot circ box x cross)",e.symbol_modes_backup[C]),a.line_modes[C]=getString("new line mode ( line zig zag mid arrpox interp hist)",e.line_modes_backup[C]),e.do_line_modes()):a.hidden_lines[C]=!a.hidden_lines[C])}if(17*_>n&&n>15*_&&r>i.height-_){console.log("all");for(var A=0;A<a.hidden_lines.length;A++)a.hidden_lines[A]=!1}if(19*_>n&&n>17*_&&r>i.height-_){console.log("non");for(var A=0;A<a.hidden_lines.length;A++)a.hidden_lines[A]=!0}return e.transform_index--,e.mjs_plot(),void mouse_move_event(t,e)}if(e.drawexportmenu){e.drawexportmenu=!1,mouse_move_event(t,e);var D=i.height,q=_;if(r>D-q&&D>r)return;if(D-=q,r>D-q&&D>r){for(console.log("csv"),I=0,f=0;f<e.data.length;f++)I=Math.max(I,e.data[f][0].length);for(var N="",E=0;I>E;E++){for(f=0;f<e.data.length;f++)try{N+=e.data[f][0][E].toString()+","+e.data[f][1][E].toString()+","}catch(L){N+=",,"}N=N.substring(0,N.length-1),N+="\n"}download_text(N,"mjsplot_graph.csv")}if(D-=q,r>D-q&&D>r){console.log("code");var N=(document.getElementsByTagName("body")[0],"");for(f=0;f<e.data.length;f++){for(N+=e.captions[f].replace(/\W/g,"")+"_x = [",E=0;E<e.data[f][0].length-1;E++)N+=e.data[f][0][E]+",";for(N+=e.data[f][0][E]+"];\n",N+=e.captions[f].replace(/\W/g,"")+"_y = [",E=0;E<e.data[f][1].length-1;E++)N+=e.data[f][1][E]+",";N+=e.data[f][1][E]+"];\n"}new_window_with_text(N,e.graphics_style.title,e.canvas.width,e.canvas.height)}if(D-=q,r>D-q&&D>r){console.log("code matlab");var N=(document.getElementsByTagName("body")[0],"");for(f=0;f<e.data.length;f++){for(N+=e.captions[f].replace(/\W/g,"")+"_x = [",E=0;E<e.data[f][0].length-1;E++)N+=e.data[f][0][E]+" ";for(N+=e.data[f][0][E]+"];\n",N+=e.captions[f].replace(/\W/g,"")+"_y = [",E=0;E<e.data[f][1].length-1;E++)N+=e.data[f][1][E]+" ";N+=e.data[f][1][E]+"];\n"}new_window_with_text(N,e.graphics_style.title,e.canvas.width,e.canvas.height)}if(D-=q,r>D-q&&D>r){console.log("code JSON");var N="";N=JSON.stringify(e.data),download_text(N,"mjsplot_graph.json")}if(D-=q,r>D-q&&D>r){console.log("tabbed");var I=0;for(f=0;f<e.data.length;f++)I=Math.max(I,e.data[f][0].length);for(var N="",E=0;I>E;E++){for(f=0;f<e.data.length;f++)try{N+=e.data[f][0][E].toString()+"	"+e.data[f][1][E].toString()+"	"}catch(L){N+="		"}N+="\n"}download_text(N,"mjsplot_graph.dat")}if(D-=q,r>D-q&&D>r&&(console.log("png hi"),e.export_png(3*e.canvas.width,3*e.canvas.height,3)),D-=q,r>D-q&&D>r&&(console.log("png low"),e.export_png(e.canvas.width,e.canvas.height,1)),D-=q,r>D-q&&D>r&&(console.log("png (small figure)"),e.export_png(1e3,750,2.5)),D-=q,r>D-q&&D>r&&(console.log("png (large figure)"),e.export_png(2e3,1500,2.5)),D-=q,n>i.width-8*_?(r>D-q&&D>r&&(console.log("svg"),e.export_svg(e.canvas.width,e.canvas.height)),D-=q,r>D-q&&D>r&&(console.log("svg (small fig)"),e.export_svg(400,300)),D-=q,r>D-q&&D>r&&(console.log("svg (large fig)"),e.export_svg(800,600)),D-=q):(r>D-q&&D>r&&(console.log("svgpng"),e.export_svg_png(e.canvas.width,e.canvas.height,3)),D-=q,r>D-q&&D>r&&(console.log("svgpng (small fig)"),e.export_svg_png(400,300,3)),D-=q,r>D-q&&D>r&&(console.log("svgpng (large fig)"),e.export_svg_png(800,600,3)),D-=q),r>D-q&&D>r){var N="",O=" \n",G="egraph";if(n>i.width-8*_){console.log("html (link)");var Y=JSON.stringify(e.data_backup),W=JSON.stringify(e.graphics_style),R=JSON.stringify(e.captions_backup);N+=G+".set_data( "+Y+" );"+O,N+=G+".set_captions( "+R+" ); "+O,N+=G+".default_graphics_style = "+W+"; "+O}else{var Y=JSON.stringify(e.data),B=clone(e.graphics_style);console.log(B),B.data_transforms=[],B.data_transforms_args=[];var W=JSON.stringify(B),R=JSON.stringify(e.captions);N+=G+".set_data( "+Y+" );"+O,N+=G+".set_captions( "+R+" ); "+O,N+=G+".default_graphics_style = "+W+"; "+O}var X=MJS_PLOT_LINK_LOADER,J=X+LZString.compressToEncodedURIComponent(N);window.open(J,e.graphics_style.title,"width="+e.canvas.width+", height="+e.canvas.height)}return void(D-=q)}if(e.drawfitsmenu)return 21*_>n&&n>18*_&&r>i.height-_&&(a.fits="none"),r>i.height-2*_&&r<i.height-1*_&&(a.extrapolate=!a.extrapolate),r>i.height-3*_&&r<i.height-2*_&&n>18*_&&(a.fits="stats"),r>i.height-4*_&&r<i.height-3*_&&n>18*_&&(a.fits="exp"),r>i.height-5*_&&r<i.height-4*_&&n>18*_&&(a.fits="exp_c"),r>i.height-6*_&&r<i.height-5*_&&n>18*_&&(a.fits="log"),r>i.height-7*_&&r<i.height-6*_&&n>18*_&&(a.fits="power"),r>i.height-8*_&&r<i.height-7*_&&n>18*_&&(a.fits="power_c"),r>i.height-9*_&&r<i.height-8*_&&n>18*_&&(a.fits="gauss"),r>i.height-3*_&&r<i.height-2*_&&18*_>n&&(a.fits="const"),r>i.height-4*_&&r<i.height-3*_&&18*_>n&&(a.fits="linear"),r>i.height-5*_&&r<i.height-4*_&&18*_>n&&(a.fits="quad"),r>i.height-6*_&&r<i.height-5*_&&18*_>n&&(a.fits="cubic"),r>i.height-7*_&&r<i.height-6*_&&18*_>n&&(a.fits="poly4"),r>i.height-8*_&&r<i.height-7*_&&18*_>n&&(a.fits="poly5"),r>i.height-9*_&&r<i.height-8*_&&18*_>n&&(a.fits="poly6"),r>i.height-10*_&&r<i.height-9*_&&18*_>n&&(a.fits="poly5"),18*_>n&&n>15*_&&r>i.height-_?(e.drawfitsmenu=!1,void mouse_move_event(t,e)):(21*_>n&&n>18*_&&r>i.height-_&&(a.fits="none",e.drawfitsmenu=!1),e.mjs_plot(),console.log(a.fits),void mouse_move_event(t,e));if(r>i.height-_){if(2*_>n&&n>0*_)return e.drawxmenu=!0,void mouse_move_event(t,e);if(4*_>n&&n>2*_)return e.drawymenu=!0,void mouse_move_event(t,e);if(5*_>n&&n>4*_&&(a.show_grid=!a.show_grid),6*_>n&&n>5*_&&("log"===a.y_scale_mode?a.y_scale_mode="lin":a.y_scale_mode="log"),7*_>n&&n>6*_&&("log"===a.x_scale_mode?a.x_scale_mode="lin":a.x_scale_mode="log"),8*_>n&&n>7*_&&(a.x_scale_mode="time"),11*_>n&&n>8*_)return e.drawfxmenu=!0,void mouse_move_event(t,e);if(15*_>n&&n>11*_)return console.log("line menu button"),e.drawlinemenu=!0,void mouse_move_event(t,e);if(19*_>n&&n>15*_)return console.log("fits menu button"),e.drawfitsmenu=!0,void mouse_move_event(t,e);if(n<i.width&&n>i.width-_)return e.drawexportmenu=!0,void mouse_move_event(t,e);if(n<i.width-_&&n>i.width-2*_){var b=a.color_fg;a.color_fg=a.color_bg,a.color_bg=b}return n<i.width-2*_&&n>i.width-3*_&&(e.isFullscreen?e.exit_full_screen():e.make_full_screen(e)),e.mjs_plot(),void mouse_move_event(t,e)}if("zoom"===a.mouse_mode)if(s.rect(start_x-.5*l,start_y-.5*l,l,l),s.stroke(),0===t.button)a.x_scale_auto_min=!0,a.y_scale_auto_min=!0,a.x_scale_auto_max=!0,a.y_scale_auto_max=!0,a.y_scale_tight=!1,a.x_scale_tight=!1;else if(2===t.button){a.x_scale_auto_min=!1,a.y_scale_auto_min=!1,a.x_scale_auto_max=!1,a.y_scale_auto_max=!1,a.y_scale_tight=!1,a.x_scale_tight=!1;var P=.8;a.x_manual_min=e.pixels_to_units(-P*a.guideWidthx,"x"),a.x_manual_max=e.pixels_to_units(i.width+P*a.guideWidthx,"x"),a.y_manual_min=e.pixels_to_units(i.height+P*a.guideWidthy,"y"),a.y_manual_max=e.pixels_to_units(-P*a.guideWidthy,"y")}if(e.ui.touch&&"measure"===a.mouse_mode&&e.ui.is_touching)return void(e.graph_image=s.getImageData(0,0,i.width,i.height));if(e.ui.touch&&"measure"===a.mouse_mode)return void e.mjs_plot();if("drag"===a.mouse_mode){if(e.ui.touch&&e.ui.is_touching){start_x=.5*(touch_start_x[0]+touch_start_x[1]),start_y=.5*(touch_start_y[0]+touch_start_y[1]),n=.5*(touch_x[0]+touch_x[1]),r=.5*(touch_y[0]+touch_y[1]);var V=(touch_x[0]-touch_x[1])/(touch_start_x[0]-touch_start_x[1]),H=(touch_y[0]-touch_y[1])/(touch_start_y[0]-touch_start_y[1]);V=trim(Math.abs(V),.1,10),H=trim(Math.abs(H),.1,10);var U=0+(1-1/H)*(start_y-0)+(-r+start_y)/H,Z=i.height+(1-1/H)*(start_y-i.height)+(-r+start_y)/H,Q=i.width+(1-1/V)*(start_x-i.width)+(-n+start_x)/V,K=0+(1-1/V)*(start_x-0)+(-n+start_x)/V;return a.y_manual_max=Math.min(1e250,e.pixels_to_units(U,"y")),a.y_manual_min=Math.max(-1e250,e.pixels_to_units(Z,"y")),a.x_manual_min=Math.max(-1e250,e.pixels_to_units(K,"x")),a.x_manual_max=Math.min(1e250,e.pixels_to_units(Q,"x")),a.x_scale_auto_min=!1,a.y_scale_auto_min=!1,a.x_scale_auto_max=!1,a.y_scale_auto_max=!1,a.y_scale_tight=!0,a.x_scale_tight=!0,void e.mjs_plot()}if(!e.ui.touch)return a.y_manual_max=e.pixels_to_units(start_y-r+a.guideWidthy+1,"y"),a.y_manual_min=e.pixels_to_units(i.height+start_y-r-a.guideWidthy-1,"y"),a.x_manual_min=e.pixels_to_units(start_x-n+a.guideWidthx-1,"x"),a.x_manual_max=e.pixels_to_units(i.width+start_x-n-a.guideWidthx+1,"x"),a.x_scale_auto_min=!1,a.y_scale_auto_min=!1,a.x_scale_auto_max=!1,a.y_scale_auto_max=!1,a.y_scale_tight=!0,a.x_scale_tight=!0,void e.mjs_plot()}if("reader"===a.mouse_mode){var $=0,tt=0,et=1e200,it=1e200;for(f=0;f<e.data.length;f++)for(u=0;u<e.data[f][0].length;u++){var at=e.units_to_pixels(e.data[f][0][u],"x"),st=e.units_to_pixels(e.data[f][1][u],"y");it=Math.sqrt(Math.pow(at-n,2)+Math.pow(st-r,2)),et>it&&(et=it,$=f,tt=u)}return e.reader_index=[$,tt],void mouse_move_event(t,e)}if("trim"===a.mouse_mode){console.log("mouse trim");var ot=e.pixels_to_units(start_x,"x"),nt=e.pixels_to_units(start_y,"y"),rt=e.pixels_to_units(n,"x"),lt=e.pixels_to_units(r,"y"),_t=Math.min(ot,rt),ht=Math.min(nt,lt),ct=Math.max(ot,rt),gt=Math.max(nt,lt),y=a.data_transforms.length;return a.data_transforms[y]="trim",a.data_transforms_args[y]=[_t,ct,ht,gt],a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("sublin"===a.mouse_mode){console.log("sublin");var ot=e.pixels_to_units(start_x,"x"),nt=e.pixels_to_units(start_y,"y"),rt=e.pixels_to_units(n,"x"),lt=e.pixels_to_units(r,"y"),mt=(lt-nt)/(rt-ot),xt=nt-mt*ot;if(isFinite(mt)&&isFinite(xt)){var y=a.data_transforms.length;a.data_transforms[y]="sublin",a.data_transforms_args[y]=[mt,xt],a.mouse_mode=e.pre_mouse_mode,e.mjs_plot()}return void(a.mouse_mode=e.pre_mouse_mode)}if("cut"===a.mouse_mode){console.log("mouse cut");var ot=e.pixels_to_units(start_x,"x"),nt=e.pixels_to_units(start_y,"y"),rt=e.pixels_to_units(n,"x"),lt=e.pixels_to_units(r,"y"),_t=Math.min(ot,rt),ht=Math.min(nt,lt),ct=Math.max(ot,rt),gt=Math.max(nt,lt),y=a.data_transforms.length;return a.data_transforms[y]="cut",a.data_transforms_args[y]=[_t,ct,ht,gt],a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("y-c"===e.graphics_style.mouse_mode){console.log("y-c");var dt=e.pixels_to_units(r,"y"),y=a.data_transforms.length;return a.data_transforms[y]="y_c",a.data_transforms_args[y]=[dt],a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("x-c"===a.mouse_mode){console.log("y-c");var dt=e.pixels_to_units(n,"x"),y=a.data_transforms.length;return a.data_transforms[y]="x_c",a.data_transforms_args[y]=[dt],a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("addmarkertext"===a.mouse_mode){var ft=e.pixels_to_units(n,"x"),ut=e.pixels_to_units(r,"y");return a.markers.push({type:"text",text:e.markerText,handles:[[ft,ut]]}),a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("addmarkerarrow"===a.mouse_mode){var ft=e.pixels_to_units(n,"x"),ut=e.pixels_to_units(r,"y"),pt=e.pixels_to_units(start_x,"x"),yt=e.pixels_to_units(start_y,"y");return a.markers.push({type:"arrow",text:"",handles:[[ft,ut],[pt,yt]]}),a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("addmarkerarrowntext"===a.mouse_mode){var ft=e.pixels_to_units(n,"x"),ut=e.pixels_to_units(r,"y"),pt=e.pixels_to_units(start_x,"x"),yt=e.pixels_to_units(start_y,"y");return a.markers.push({type:"arrowntext",text:e.markerText,handles:[[ft,ut],[pt,yt]]}),a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("addmarkerline"===a.mouse_mode){console.log("adding marker line");var pt=e.pixels_to_units(start_x,"x"),yt=e.pixels_to_units(start_y,"y"),vt=e.pixels_to_units(n,"x"),wt=e.pixels_to_units(r,"y");return a.markers.push({type:"line",text:"",handles:[[pt,yt],[vt,wt]]}),a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("addmarkerlinentext"===a.mouse_mode){console.log("adding marker line");var pt=e.pixels_to_units(start_x,"x"),yt=e.pixels_to_units(start_y,"y"),vt=e.pixels_to_units(n,"x"),wt=e.pixels_to_units(r,"y");return a.markers.push({type:"linentext",text:e.markerText,handles:[[pt,yt],[vt,wt]]}),a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("addmarkerbox"===a.mouse_mode){console.log("adding marker line");var pt=e.pixels_to_units(start_x,"x"),yt=e.pixels_to_units(start_y,"y"),vt=e.pixels_to_units(n,"x"),wt=e.pixels_to_units(r,"y");return a.markers.push({type:"box",text:"",handles:[[pt,yt],[vt,wt]]}),a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("addmarkerboxntext"===a.mouse_mode){console.log("adding marker line");var pt=e.pixels_to_units(start_x,"x"),yt=e.pixels_to_units(start_y,"y"),vt=e.pixels_to_units(n,"x"),wt=e.pixels_to_units(r,"y");return a.markers.push({type:"boxntext",text:e.markerText,handles:[[pt,yt],[vt,wt]]}),a.mouse_mode=e.pre_mouse_mode,void e.mjs_plot()}if("removeMarker"===a.mouse_mode){var et=1e200,it=1e200,$=0;for(f=0;f<a.markers.length;f++){var Tt=a.markers[f];it=Math.sqrt(Math.pow(e.units_to_pixels(Tt.x,"x")-n,2)+Math.pow(e.units_to_pixels(Tt.y,"y")-r,2)),et>it&&(et=it,$=f)}if(_>et)return a.markers.splice($,1),void e.mjs_plot()}if("markeredit"===a.mouse_mode){var et=1e200,it=1e200,$=0;for(f=0;f<a.markers.length;f++){var Tt=a.markers[f];it=Math.sqrt(Math.pow(e.units_to_pixels(Tt.x,"x")-n,2)+Math.pow(e.units_to_pixels(Tt.y,"y")-r,2)),et>it&&(et=it,$=f)}if(_>et)return a.markers[$].text=getString("New Text:",a.markers[$].text),void e.mjs_plot()}return"mouse"===a.mouse_mode?(console.log(e.ui.drag_object.item),e.ui.mouse_is_dragging&&"marker"===e.ui.drag_object.item&&(console.log(e.ui.drag_object),a.markers[e.ui.drag_object.i].handles[e.ui.drag_object.j][0]=e.pixels_to_units(n,"x"),a.markers[e.ui.drag_object.i].handles[e.ui.drag_object.j][1]=e.pixels_to_units(r,"y")),e.ui.mouse_is_dragging&&"fit_text"===e.ui.drag_object&&(a.fit_text_position.x=n/i.width,a.fit_text_position.y=r/i.height),e.ui.mouse_is_dragging&&"title_spacing"===e.ui.drag_object&&(a.title_spacing=(r-(a.tick_len+a.title_font_size)*a.scaling_factor)/a.scaling_factor),e.ui.mouse_is_dragging&&"caption_position"===e.ui.drag_object&&(n>i.width/2?a.caption_position.x=-1*(i.width-n-a.tick_len*a.scaling_factor)/a.scaling_factor:a.caption_position.x=(n-a.tick_len*a.scaling_factor)/a.scaling_factor,r>i.height/2?a.caption_position.y=-1*(i.height-r-a.tick_len*a.scaling_factor)/a.scaling_factor:a.caption_position.y=(r-a.tick_len*a.scaling_factor)/a.scaling_factor),e.mjs_plot(),mouse_move_event(t,e),void(e.ui.mouse_is_dragging=!1)):("i"===a.mouse_mode&&(a.mouse_mode=e.pre_mouse_mode,a.i=0,"i"===a.mouse_mode&&(a.mouse_mode="zoom")),void e.mjs_plot())}function touch_start_event(t,e){t.preventDefault(),e.ui.is_touching=!0;var i=e.canvas.getBoundingClientRect();touch_start_x[0]=t.targetTouches[0].clientX-i.left,touch_start_y[0]=t.targetTouches[0].clientY-i.top,t.targetTouches.length>=2&&(touch_start_x[1]=t.targetTouches[1].clientX-i.left,touch_start_y[1]=t.targetTouches[1].clientY-i.top),touch_move_event(t,e)}function touch_move_event(t,e){my_touches=t.targetTouches,t.preventDefault(),e.ui.is_touching=!0,mouse_down=my_touches.length>=2;var i=e.canvas.getBoundingClientRect();start_x=t.targetTouches[0].clientX-i.left,start_y=t.targetTouches[0].clientY-i.top,touch_x[0]=t.targetTouches[0].clientX-i.left,touch_y[0]=t.targetTouches[0].clientY-i.top,t.targetTouches.length>1&&(touch_x[1]=t.targetTouches[1].clientX-i.left,touch_y[1]=t.targetTouches[1].clientY-i.top),t.clientX=my_touches[my_touches.length-1].clientX,t.clientY=my_touches[my_touches.length-1].clientY,mouse_move_event(t,e)}function touch_cancel_event(t,e){e.ui.is_touching=0!=t.targetTouches.length,t.preventDefault(),touch_end_event(t,e)}function touch_leave_event(t,e){touch_end_event(t,e)}function touch_click_event(t,e){rect=e.canvas.getBoundingClientRect(),start_x=t.clientX-rect.left,start_y=t.clientY-rect.top,mouse_up_event(t,e)}function touch_end_event(t,e){e.ui.is_touching=0!=t.targetTouches.length,rect=e.canvas.getBoundingClientRect(),start_x=my_touches[0].clientX-rect.left,start_y=my_touches[0].clientY-rect.top,t.clientX=my_touches[my_touches.length-1].clientX,t.clientY=my_touches[my_touches.length-1].clientY,mouse_up_event(t,e)}function __draw_shim(t){t.data_backup.length!=t.__items_plotted.length&&(console.log("call to shim"),t.set_data(t.__items_plotted),t.set_captions(t.__items_captions)),t.mjs_plot(),t.ui.ticking=!1}function keep_parent_sized(t){t.canvas.style.width="100%",t.canvas.style.height="100%",t.canvas.width=t.canvas.offsetWidth,t.canvas.height=t.canvas.offsetHeight,t.mjs_plot()}function keep_page_sized(t){document.querySelector('meta[name="viewport"]').content="user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1",t.canvas.style.position="absolute",t.canvas.style.left=0,t.canvas.style.top=0,t.canvas.width=window.innerWidth,t.canvas.height=window.innerHeight,t.mjs_plot()}function make_interactive(t){t.ui.touch?(t.canvas.addEventListener("touchstart",function(e){touch_start_event(e,t)},!1),t.canvas.addEventListener("touchend",function(e){touch_end_event(e,t)},!1),t.canvas.addEventListener("touchmove",function(e){touch_move_event(e,t)},!1),t.canvas.addEventListener("touchcancel",function(e){touch_cancel_event(e,t)},!1),t.canvas.addEventListener("touchleave",function(e){touch_leave_event(e,t)},!1),t.canvas.addEventListener("click",function(e){touch_click_event(e,t)},!1)):(t.canvas.addEventListener("mousemove",function(e){mouse_move_event(e,t)},!1),t.canvas.addEventListener("mousedown",function(e){mouse_down_event(e,t)},!1),t.canvas.addEventListener("mouseup",function(e){mouse_up_event(e,t)},!1),t.canvas.addEventListener("mouseout",function(e){mouse_out_event(e,t)},!1)),t.canvas.oncontextmenu=function(t){t.preventDefault()}}function SVGContext(t){this.target=document.getElementById("_mjsplotSVG"),this.targetStack=[],this._ctx=t,this.x=0,this.y=0,this.strokeStyle="#000",this.lineWidth=2,this.lineCap,this.lineJoin,this.miterLimit=10,this.font,this.textAlign="left",this.textBaseline="alphabetic",this.direction="inherit",this._pixel_precision=2,this._shape_type="path",this.fillStyle="#000",this._path="",this._isdrawn=!1,this.clearAll=function(){for(;this.target.lastChild;)this.target.removeChild(this.target.lastChild)},this.arc=function(t,e,i,a,s,o){this._shape_type="arc",this._shape=document.createElementNS(svgNS,"circle"),this._shape.setAttributeNS(null,"stroke-width",this.lineWidth.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"stroke",this.strokeStyle),this._shape.setAttributeNS(null,"r",i.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"cx",t.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"cy",e.toFixed(this._pixel_precision))},this.moveTo=function(t,e){this._path+=" M"+t.toFixed(this._pixel_precision)+" "+e.toFixed(this._pixel_precision)},this.lineTo=function(t,e){this._path+=" L"+t.toFixed(this._pixel_precision)+" "+e.toFixed(this._pixel_precision)},this.beginPath=function(){this._shape_type="path",this._shape=document.createElementNS(svgNS,"path"),this._path="",this._isdrawn=!1},this.closePath=function(){this._path+="Z"},this.quadraticCurveTo=function(t,e,i,a){this._path+=" Q"+t.toFixed(this._pixel_precision)+" "+e.toFixed(this._pixel_precision)+" "+i.toFixed(this._pixel_precision)+" "+a.toFixed(this._pixel_precision)},this.bezierCurveTo=function(t,e,i,a,s,o){console.log("bezierCurveTo is not implemented yet"),this._path+=" Q"+(t+i)/2+" "+(e+a)/2+" "+s.toFixed(this._pixel_precision)+" "+o.toFixed(this._pixel_precision)},this.stroke=function(){this._shape.setAttributeNS(null,"fill","none"),this._shape.setAttributeNS(null,"stroke-width",this.lineWidth.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"stroke",this.strokeStyle),this._isdrawn||("path"===this._shape_type&&this._shape.setAttributeNS(null,"d",this._path),this.globalAlpha<1&&this._shape.setAttributeNS(null,"opacity",this.globalAlpha.toFixed(2)),this.target.appendChild(this._shape),this._isdrawn=!0)},this.fill=function(){this._shape.setAttributeNS(null,"fill",this.fillStyle),this._isdrawn||("path"===this._shape_type&&this._shape.setAttributeNS(null,"d",this._path),this.target.appendChild(this._shape),this._isdrawn=!0)},this.fillText=function(t,e,i){var a=document.createElementNS(svgNS,"text"),s="start";switch(this.textAlign){case"left":s="start";break;case"right":s="end";break;case"center":s="middle";break;case"middle":s="middle"}a.setAttributeNS(null,"text-anchor",s),a.setAttributeNS(null,"fill",this.fillStyle),a.setAttributeNS(null,"x",e.toFixed(this._pixel_precision)),a.setAttributeNS(null,"x",e.toFixed(this._pixel_precision)),a.setAttributeNS(null,"font-family",this.font_name),a.setAttributeNS(null,"y",i.toFixed(this._pixel_precision)),a.setAttributeNS(null,"font-size",parseFloat(this.font.split(" ")[0].slice(0,-2)).toFixed(this._pixel_precision)),a.textContent=t,this.target.appendChild(a)},this.rect=function(t,e,i,a){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+a),this.lineTo(t,e+a),this.lineTo(t,e)},this.fillRect=function(t,e,i,a){this.beginPath(),this.rect(t,e,i,a),this.fill()},this.strokeText=function(t,e,i){},this.startGroup=function(){this.targetStack.push(this.target);var t=document.createElementNS(svgNS,"g");this.target.appendChild(t),this.target=t},this.endGroup=function(){this.target=this.targetStack.pop()},this.startClipBox=function(t,e,i,a){var s=document.createElementNS(svgNS,"defs"),o=document.createElementNS(svgNS,"clipPath");o.setAttributeNS(null,"id","graphClipPath");var n=document.createElementNS(svgNS,"rect");n.setAttributeNS(null,"x",t.toFixed()),n.setAttributeNS(null,"y",e.toFixed()),n.setAttributeNS(null,"width",i.toFixed()),n.setAttributeNS(null,"height",a.toFixed()),o.appendChild(n),s.appendChild(o),this.target.appendChild(s),this.targetStack.push(this.target);var r=document.createElementNS(svgNS,"g");r.setAttributeNS(null,"clip-path","url(#graphClipPath)"),this.target.appendChild(r),this.target=r},this.getImageData=this._ctx.getImageData,this.measureText=function(t){return{width:this._ctx.measureText(t).width}},this.image=function(t,e,i,a,s){this._shape=document.createElementNS(svgNS,"image"),this._shape.setAttributeNS(null,"x",t.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"y",e.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"width",i.toFixed(this._pixel_precision)),this._shape.setAttributeNS(null,"height",a.toFixed(this._pixel_precision)),this._shape.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s),this.target.appendChild(this._shape),this._isdrawn=!0}}function drawSplash(t,e){e.textAlign="center",e.beginPath(),e.font='20 px "Monaco","Menlo","Ubuntu Mono","Consolas","source-code-pro",monospace"',e.fillText("MJS Plot",t.width/2,t.height/2-20),e.font='10 px "Monaco","Menlo","Ubuntu Mono","Consolas","source-code-pro",monospace"',e.fillText("Setting Up",t.width/2,t.height/2+20),e.rect(10,10,t.width-20,t.height-20),e.stroke()}var MJS_PLOT_VERSION="0_4_0",MJS_PLOT_AUTOR="MJS",MJS_PLOT_DATE="2016",MJS_PLOT_WEBSITE="http://generalsarsby.github.io/mjs_plot/",MJS_PLOT_LINK_LOADER="http://generalsarsby.github.io/mjs_plot/load_4.html#",DEBUGG_FORCE_TOUCH=!1,DEBUGG_FPS=!1,svgNS="http://www.w3.org/2000/svg",vals=[1,2,5],few_minor_ticks=[2,2,5],many_minor_ticks=[5,4,5],color_table=[["#aa3939"],["#aa3939","#383276"],["#aa3939","#236467","#7b9f35"],["#aa3939","#aa6d39","#236467","#2d882d"],["#aa3939","#aa6d39","#236467","#2d882d","#304473"],["#aa3939","#aa6d39","#236467","#2d882d","#304473","#ac873c"]],mouse_down=!1,start_x=0,end_x=0,full_screen_graph;try{Math.log10(100)}catch(e){Math.log10=function(t){return Math.log(t)/Math.LN10}}var log_vals=[[1],[1,3],[1,2,4],[1,2,3,6],[1,2,3,4,6],[1,2,3,4,6,8],[1,1.5,2,3,4,6,8],[1,1.5,2,2.5,3,4,6,8],[1,1.5,2,2.5,3,4,6,7,8],[1,1.2,1.5,2,2.5,3,4,5,6,7,9],[1,1.2,1.5,2,2.5,3,4,5,6,7,8,9],[1,1.2,1.4,1.6,1.8,2,2.5,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.1,1.2,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5],[1,1.05,1.1,1.15,1.2,1.25,1.3,1.35,1.4,1.45,1.5,1.55,1.6,1.65,1.7,1.75,1.8,1.85,1.9,1.95,2,2.1,2.2,2.3,2.4,2.5,2.6,2.7,2.8,2.9,3,3.2,3.4,3.6,3.8,4,4.2,4.4,4.6,4.8,5,5.5,6,6.5,7,7.5,8,8.5,9,9.5]],log_vals_ticks=[[1,3],[1,2,3,4,5,6,7,8,9],[1,2,3,4,5,6,7,8,9],[1,2,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.5,3,4,5,6,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.25,2.75,3,3.5,4,4.5,5,5.5,6,6.5,7,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.25,2.75,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9],[1,1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,1.9,2,2.2,2.4,2.6,2.8,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9]],allowed_intervals=[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,3e4,6e4,12e4,3e5,6e5,9e5,12e5,18e5,36e5,72e5,108e5,216e5,432e5,864e5,1728e5,432e6,6048e5,12096e5,2592e6,5184e6,15552e6,31536e6,63072e6,15768e7,31536e7,63072e7,15768e8,31536e8,63072e8,15768e9,31536e9],time_ticks=[.2,.5,1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,3e4,6e4,12e4,3e5,3e5,6e5,12e5,18e5,36e5,72e5,108e5,216e5,432e5,864e5,864e5,1728e5,864e6,1728e6,2592e6,7884e6,31536e6,31536e6,63072e6,15768e7,31536e7,63072e7,15768e8,31536e8,63072e8],string_precisions=[8,8,8,7,7,7,6,6,6,5,5,5,5,5,5,4,4,4,4,4,4,4,3,3,3,3,3,2,2,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0];si_prefixes=["y","z","a","f","p","n",String.fromCharCode(181),"m",".","k","M","G","T","P","E","Z","Y"];var superscriptCharacters=[8304,185,178,179,8308,8309,8310,8311,8312,8313],superscriptMinus=String.fromCharCode(8315),superscriptPlus=String.fromCharCode(8314),unicodeTimes=String.fromCharCode(215),arrow="b m 1 0 l -5 -2 l -4 0 l -5 2 l 1 0 c f";drawArrow=getDrawFunctionRotateable(arrow);var fits={exponential_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]*Math.pow(Math.E,e[1]*t[a]));return i},exponential:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)e[s]>0&&(i.push(t[s]),a.push(e[s]));for(var o=[0,0,0,0,0,0],n=0;n<i.length;n++)o[0]+=i[n],o[1]+=a[n],o[2]+=i[n]*i[n]*a[n],o[3]+=a[n]*Math.log(a[n]),o[4]+=i[n]*a[n]*Math.log(a[n]),o[5]+=i[n]*a[n];var r=o[1]*o[2]-o[5]*o[5],l=Math.pow(Math.E,(o[2]*o[3]-o[5]*o[4])/r),_=(o[1]*o[4]-o[5]*o[3])/r,h="y = "+mjs_precision(l,5)+"e^("+mjs_precision(_,5)+"x)";return{parameters:[l,_],strings:[h,"",""],fun:fits.exponential_fun}},exponential_plus_c_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]+e[1]*Math.exp(e[2]*t[a]));return i},exponential_plus_c:function(t,e){var i=t.length,s=0,o=0,n=0,r=0,l=0,_=[];_[0]=0;for(var h=1;i>h;h++)_[h]=_[h-1]+.5*(e[h]+e[h-1])*(t[h]-t[h-1]);for(var h=0;i>h;h++)s+=(t[h]-t[0])*(t[h]-t[0]),o+=(t[h]-t[0])*_[h],n+=_[h]*_[h],r+=(e[h]-e[0])*(t[h]-t[0]),l+=(e[h]-e[0])*_[h];var c=1/(s*n-o*o),g=c*(n*r-o*l),m=c*(s*l-o*r);a=-1*g/m;for(var x=0,d=0,f=0,u=0,p=0,h=0;i>h;h++)p=Math.exp(m*t[h]),x+=p,d+=p*p,f+=e[h],u+=e[h]*p;c=1/(d*i-x*x);var y=c*(d*f-x*u),v=c*(i*u-x*f);a=y;var w="y = "+mjs_precision(a,5)+"+"+mjs_precision(v,5)+"e^("+mjs_precision(m,5)+"x)";return{parameters:[a,v,m],strings:[w,"",""],fun:fits.exponential_plus_c_fun}},gauss_fun:function(t,e){for(var i=[],a=e[0],s=e[1],o=Math.sqrt(2*Math.PI),n=0;n<t.length;n++)i.push(e[2]/o/s*Math.exp(-.5*Math.pow((t[n]-a)/s,2)));return i},gauss:function(t,e){var i=t.length,a=[];a[0]=0;for(var s=0,o=1;i>o;o++)a[o]=a[o-1]+.5*(e[o]+e[o-1])*(t[o]-t[o-1]);s=Math.abs(a[o-1]);var n=[];n[0]=0;for(var o=1;i>o;o++)n[o]=n[o-1]+.5*(t[o]*e[o]+t[o-1]*e[o-1])*(t[o]-t[o-1]);for(var r=0,l=0,_=0,h=0,c=0,o=0;i>o;o++)r+=a[o]*a[o],l+=a[o]*n[o],_+=n[o]*n[o],h+=(e[o]-e[0])*a[o],c+=(e[o]-e[0])*n[o];var g=1/(r*_-l*l),m=g*(_*h-l*c),x=g*(r*c-l*h),d=-1/x*Math.sqrt(2/Math.PI),d=Math.sqrt(-1/x),f=-m/x,u="A/(sig * sqrt(2pi)) exp(-0.5*((x-mu)/sig)^2)",p="sig = "+mjs_precision(d,5)+",  A = "+ +mjs_precision(s,5),y="mu = "+mjs_precision(f,5);return{parameters:[f,d,s],strings:[u,p,y],fun:fits.gauss_fun}},linear_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(t[a]*e[0]+e[1]);return i},linear:function(t,e){for(var i=0,a=0,s=0,o=0,n=0,r=0;r<t.length;r++)i+=t[r],s+=t[r]*t[r],a+=e[r],o+=t[r]*e[r],n+=e[r]*e[r];var l=t.length;o-=i*a/l,s-=i*i/l,n-=a*a/l;var _=i/l,h=o*o/s/n,c=o/s,g=a/l-c*i/l,m=Math.sqrt((n-o*o/s)/(l-2)),x=m/Math.sqrt(s),d=m*Math.sqrt(1/l+_*_/s),f=String.fromCharCode(178);return string1="r"+f+" = "+number_quote(h,1-h),string2="intecept a = "+number_quote(g,d)+String.fromCharCode(177)+mjs_precision(d,2),string3="slope b = "+number_quote(c,x)+String.fromCharCode(177)+mjs_precision(x,2),{parameters:[c,g],strings:[string1,string2,string3],fun:fits.linear_fun}},constant_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]);return i},constant:function(t,e){for(var i=0,a=0,s=0;s<t.length;s++)i+=e[s],a+=e[s]*e[s];var o=t.length;a-=i*i/o;var n=i/o,r=Math.sqrt(a/o);
return string1="y="+number_quote(n,r)+String.fromCharCode(177)+mjs_precision(r,2),{parameters:[n],strings:[string1,"",""],fun:fits.constant_fun}},poly2:function(t,e){return fits.polyn_fit(t,e,2)},poly3:function(t,e){return fits.polyn_fit(t,e,3)},poly4:function(t,e){return fits.polyn_fit(t,e,4)},poly5:function(t,e){return fits.polyn_fit(t,e,5)},poly6:function(t,e){return fits.polyn_fit(t,e,6)},poly7:function(t,e){return fits.polyn_fit(t,e,7)},poly8:function(t,e){return fits.polyn_fit(t,e,8)},polyn_fun:function(t,e){for(var i=[],a=0;a<t.length;a++){i[a]=0;for(var s=0;s<e.length;s++)i[a]+=e[s]*Math.pow(t[a],s)}return i},polyn_fit:function(t,e,i){for(var a=[],s=[],o=0,n=0,r=0,l=i+1,r=0;l>r;r++){for(var _=0,h=t.length;h>_;_++)o+=Math.pow(t[_],r)*e[_];a.push(o),o=0;for(var c=[],g=0;l>g;g++){for(var _=0,h=t.length;h>_;_++)n+=Math.pow(t[_],r+g);c.push(n),n=0}s.push(c)}s.push(a);var g=0,l=0,m=0,x=0,d=s.length-1;for(r=0;d>r;r++){for(m=r,g=r+1;d>g;g++)Math.abs(s[r][g])>Math.abs(s[r][m])&&(m=g);for(l=r;d+1>l;l++)x=s[l][r],s[l][r]=s[l][m],s[l][m]=x;for(g=r+1;d>g;g++)for(l=d;l>=r;l--)s[l][g]-=s[l][r]*s[r][g]/s[r][r]}var f=[];for(g=d-1;g>=0;g--){for(x=0,l=g+1;d>l;l++)x+=s[l][g]*f[l];f[g]=(s[d][g]-x)/s[g][g]}fit=[];for(var r=0;r<t.length;r++){fit[r]=0;for(var u=0;u<f.length;u++)fit[r]+=f[u]*Math.pow(t[r],u)}for(var p=0,y=0,v=0,w=0,T=0,r=0;r<t.length;r++)p+=t[r],v+=t[r]*t[r],y+=e[r],w+=e[r]*e[r];for(var b=y/t.length,k=0,M=0,r=0;r<t.length;r++)k+=(fit[r]-b)*(fit[r]-b),M+=(fit[r]-e[r])*(fit[r]-e[r]);var d=t.length,j=w-y*y/d,k=T,S=1-M/j,P=String.fromCharCode(178),z="",F="";if(f.length>4){for(var r=f.length-1;r>=4;r--)z+=r>1?mjs_precision(f[r],4)+"x^"+r+" + ":1==r?mjs_precision(f[r],4)+"x + ":mjs_precision(f[r],4);for(;r>=0;r--)F+=r>1?mjs_precision(f[r],4)+"x^"+r+" + ":1==r?mjs_precision(f[r],4)+"x + ":mjs_precision(f[r],4)}else for(var r=f.length-1;r>=0;r--)z+=r>1?mjs_precision(f[r],4)+"x^"+r+" + ":1==r?mjs_precision(f[r],4)+"x + ":mjs_precision(f[r],4);return string1="r"+P+" = "+number_quote(S,1-S),{parameters:f,strings:[string1,z,F],fun:fits.polyn_fun}},log_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]+e[1]*Math.log(t[a]));return i},log:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)t[s]>0&&(i.push(t[s]),a.push(e[s]));var o=0,r=0,l=0,_=0,h=i.length;for(n=0;n<h;n++)o+=Math.log(i[n]),r+=a[n]*Math.log(i[n]),l+=a[n],_+=Math.pow(Math.log(i[n]),2);var c=(n*r-l*o)/(n*_-o*o),g=(l-c*o)/n,m="y="+mjs_precision(g,4)+" + "+mjs_precision(c,4)+" ln(x)";return{parameters:[g,c],strings:[m,"",""],fun:fits.log_fun}},power_plus_c_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]+e[1]*Math.pow(t[a],e[2]));return i},power_plus_c:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)xi=Math.log(t[s]),isFinite(xi)&&(i.push(xi),a.push(e[s]));var o=fits.exponential_plus_c(i,a),n="y = "+mjs_precision(o.parameters[0],5)+"+"+mjs_precision(o.parameters[1],5)+"x^"+mjs_precision(o.parameters[2],5);return o.strings=[n,"",""],o.fun=fits.power_plus_c_fun,o},power_fun:function(t,e){for(var i=[],a=0;a<t.length;a++)i.push(e[0]*Math.pow(t[a],e[1]));return i},power:function(t,e){for(var i=[],a=[],s=0;s<t.length;s++)t[s]>0&&e[s]>0&&(i.push(t[s]),a.push(e[s]));for(var o=i.length,n=0,r=0,l=0,_=0,s=0;o>s;s++)n+=Math.log(i[s]),r+=Math.log(a[s])*Math.log(i[s]),l+=Math.log(a[s]),_+=Math.pow(Math.log(i[s]),2);var h=(o*r-l*n)/(o*_-n*n),c=Math.pow(Math.E,(l-h*n)/o),g="y="+mjs_precision(c,4)+"x^"+mjs_precision(h,4);return{parameters:[c,h],strings:[g,"",""],fun:fits.power_fun}},pre_fit_normalizing:function(t){for(var e=series_stats(t,t),i=clone(t),a=0;a<t.length;a++)i[a]=(t[a]-e.x_mean)/e.sigma_x;var s="normalized (x-"+e.x_mean.toFixed()+")/"+e.sigma_x.toFixed();return{x:i,s:s,x_mean:e.x_mean,sigma_x:e.sigma_x}},post_fit_normalizing:function(t,e){for(var i=clone(t),a=0;a<t.length;a++)i[a]=(t[a]-e.x_mean)/e.sigma_x;return i}};fits.fit_strings=["exp","exp_c","linear","quad","cubic","poly4","poly5","poly6","poly7","const","log","power","power_c","gauss"],fits.fit_funs=[fits.exponential,fits.exponential_plus_c,fits.linear,fits.poly2,fits.poly3,fits.poly4,fits.poly5,fits.poly6,fits.poly7,fits.constant,fits.log,fits.power,fits.power_plus_c,fits.gauss];var dotcount=0,touch_start_x=[],touch_start_y=[],touch_x=[],touch_y=[],transforms={scale_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=t[i][0][j]*e[0];a.transform_text_x=a.transform_text_x+"*"+mjs_precision(e[0],1)},log_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.log10(t[i][0][j]);transforms.clean(t,a),a.transform_text_x="log("+a.transform_text_x+")"},x_c:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=t[i][0][j]-e[0];a.transform_text_x=a.transform_text_x+"-"+mjs_precision(e[0],a.graphics_style.x_precision+1)},y_c:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=t[i][1][j]-e[0];a.transform_text_y=a.transform_text_y+"-"+mjs_precision(e[0],a.graphics_style.y_precision+1)},remove_lines:function(t,e,i){for(var a=t.length-1;a>=0;a--)e[a]&&(t.splice(a,1),i.captions.splice(a,1),i.colors.splice(a,1),i.line_modes.splice(a,1),i.symbol_modes.splice(a,1))},y_vs_y:function(t,e,i){var a=e[0]%t.length;console.log(a);for(var s=t[a][0].length,o=0;o<t.length;o++){var s=Math.min(t[o][0].length,t[a][0].length);if(o!=a){for(var n=[],r=[],l=0;s>l;l++)n[l]=t[a][1][l],r[l]=t[o][1][l];t[o]=[clone(n),clone(r)],i.captions[o]=i.captions[a]+" vs "+i.captions[o]}}i.transform_text_x=i.captions[a]+"("+i.transform_text_y+")",i.captions.splice(a,1),t.splice(a,1),i.colors.splice(a,1)},sum:function(t,e,a){var s=(Math.min(t[0][0].length),[]),o=[];for(j=0;j<t[0][0].length;j++)for(s[j]=t[0][0][j],o[j]=0,i=0;i<t.length;i++)o[j]+=t[i][1][j];var n="sum(";for(i=0;i<t.length;i++)n+=", "+a.captions[i];n+=")",t[0]=[s,o],t.splice(1,t.length-1),a.captions[0]=n,a.captions.splice(1,t.length-1),a.transform_text_y="sum("+a.transform_text_y+")",transforms.clean(t,a)},ln_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.log(t[i][0][j]);transforms.clean(t,a),console.log(t),a.transform_text_x="ln("+a.transform_text_x+")"},e_to_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(Math.E,t[i][0][j]);a.transform_text_x="e^("+a.transform_text_x+")"},ten_to_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(10,t[i][0][j]);a.transform_text_x="10^("+a.transform_text_x+")"},scale_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][1][j]=t[i][1][j]*e[0];a.transform_text_y=a.transform_text_y+"*"+mjs_precision(e[0],1)},log_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.log10(t[i][1][j]);transforms.clean(t,a),a.transform_text_y="log("+a.transform_text_y+")"},ln_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.log(t[i][1][j]);transforms.clean(t,a),a.transform_text_y="ln("+a.transform_text_y+")"},e_to_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(Math.E,t[i][1][j]);a.transform_text_y="e^("+a.transform_text_y+")"},ten_to_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(10,t[i][1][j]);a.transform_text_y="10^("+a.transform_text_y+")"},one_over_y:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][1][j]=1/t[i][1][j];transforms.clean(t,a),a.transform_text_y="1/("+a.transform_text_y+")"},custom_y:function(t,e,a){for(i=0;i<t.length;i++)t[i][1]=parseExpression(e[0],t[i][0],t[i][1]);transforms.clean(t,a),a.transform_text_y="f("+a.transform_text_y+")"},custom_filter:function(t,e,a){for(i=0;i<t.length;i++){var s=parseExpression(e[0],t[i][0],t[i][1]);for(j=0;j<t[i][0].length;j++)s[j]||(t[i][1][j]=NaN)}transforms.clean(t,a),a.transform_text_y="filter("+a.transform_text_y+")"},one_over_x:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=1/t[i][0][j];transforms.clean(t,a),a.transform_text_x="1/("+a.transform_text_x+")"},x_pow_n:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(t[i][0][j],e[0]);a.transform_text_x="("+a.transform_text_x+")^"+e[0]},y_pow_n:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(t[i][1][j],e[0]);a.transform_text_y="("+a.transform_text_y+")^"+e[0]},add_me:function(t,e,i){i.data=[[[2,2,3,4,4],[2,5,4,5,2]],[[5,7,6,6,5],[5,5,5,2,2]],[[8,10,10,8,8,10],[2,2,4,4,5,5]],[[1,1,11,11,1],[1,6,6,1,1]]],i.captions=["m","j","s"," "]},y_nth_root:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=Math.pow(Math.abs(t[i][1][j]),1/e[0]);a.transform_text_y="("+a.transform_text_y+")^1/"+e[0]},x_nth_root:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][0][j]=Math.pow(Math.abs(t[i][0][j]),1/e[0]);a.transform_text_x="("+a.transform_text_x+")^1/"+e[0]},trim:function(t,e,a){var s=e[0],o=e[1],n=e[2],r=e[3];for(i=0;i<t.length;i++)for(var l=t[i][0].length-1;l>=0;l--)(t[i][0][l]<s||t[i][0][l]>o||t[i][1][l]<n||t[i][1][l]>r)&&(t[i][0][l]=NaN);transforms.clean(t,a),a.transform_text_x="trim("+a.transform_text_x+")",a.transform_text_y="trim("+a.transform_text_y+")"},cut:function(t,e,a){var s=e[0],o=e[1],n=e[2],r=e[3];for(i=0;i<t.length;i++)for(var l=t[i][0].length-1;l>=0;l--)t[i][0][l]<s||t[i][0][l]>o||t[i][1][l]<n||t[i][1][l]>r||(t[i][0][l]=NaN);transforms.clean(t,a),a.transform_text_x="cut("+a.transform_text_x+")",a.transform_text_y="cut("+a.transform_text_y+")"},remove_linear:function(t,e,a){for(i=0;i<t.length;i++)for(slope=linear_regression(t[i][0],t[i][1]),j=0;j<t[i][0].length;j++)t[i][1][j]=t[i][1][j]-slope.a-slope.b*t[i][0][j];a.transform_text_y="sub_linear("+a.transform_text_y+")"},sublin:function(t,e,a){for(i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][1][j]=t[i][1][j]-e[1]-e[0]*t[i][0][j];var s=Math.max(a.graphics_style.x_precision,a.graphics_style.y_precision)+1;a.transform_text_y=a.transform_text_y+"-"+mjs_precision(e[1],s)+"-"+mjs_precision(e[0],s)+"x"},swap_x_y:function(t,e,a){for(i=0;i<t.length;i++)s=t[i][0],t[i][0]=t[i][1],t[i][1]=s;var s=a.transform_text_x;a.transform_text_x=a.transform_text_y,a.transform_text_y=s},normalise:function(t,e,a){for(i=0;i<t.length;i++)for(ymin=Math.min.apply(null,t[i][1]),ymax=Math.max.apply(null,t[i][1]),j=0;j<t[i][1].length;j++)t[i][1][j]=(t[i][1][j]-ymin)/(ymax-ymin);a.transform_text_y="norm("+a.transform_text_y+")"},mean_normalise:function(t,e,a){for(i=0;i<t.length;i++){var s=series_stats(t[i][0],t[i][1]);for(j=0;j<t[i][1].length;j++)t[i][1][j]=(t[i][1][j]-s.y_mean)/s.sigma_y}a.transform_text_y="norm("+a.transform_text_y+")"},clean:function(t,e){for(i=0;i<t.length;i++){if(2==t[i].length){for(var a=0,s=t[i][0].length,o=0,n=0;s>o;)isFinite(t[i][1][o])&&isFinite(t[i][0][o])?(t[i][0][n]=t[i][0][o],t[i][1][n]=t[i][1][o],n++):a++,o++;t[i][0]=t[i][0].slice(0,s-a),t[i][1]=t[i][1].slice(0,s-a)}if(3==t[i].length){for(var a=0,s=t[i][0].length,o=0,n=0;s>o;)isFinite(t[i][1][o])&&isFinite(t[i][0][o])?(t[i][0][n]=t[i][0][o],t[i][1][n]=t[i][1][o],t[i][2][n]=t[i][2][o],n++):a++,o++;t[i][0]=t[i][0].slice(0,s-a),t[i][1]=t[i][1].slice(0,s-a),t[i][2]=t[i][2].slice(0,s-a)}if(4==t[i].length){for(var a=0,s=t[i][0].length,o=0,n=0;s>o;)isFinite(t[i][1][o])&&isFinite(t[i][0][o])?(t[i][0][n]=t[i][0][o],t[i][1][n]=t[i][1][o],t[i][2][n]=t[i][2][o],t[i][3][n]=t[i][3][o],n++):a++,o++;t[i][0]=t[i][0].slice(0,s-a),t[i][1]=t[i][1].slice(0,s-a),t[i][2]=t[i][2].slice(0,s-a),t[i][3]=t[i][3].slice(0,s-a)}}for(var o=t.length-1;o>=0;o--)0==t[o][0].length&&(t.splice(o,1),e.captions.splice(o,1),e.colors.splice(o,1),e.symbol_modes.splice(o,1),e.line_modes.splice(o,1))},intergrate:function(t,e,a){var s=0;for(i=0;i<t.length;i++){for(s=0,tallys=[],tallys[0]=0,j=0;j<t[i][0].length-1;j++)s+=(t[i][0][j+1]-t[i][0][j])*(t[i][1][j+1]+t[i][1][j])/2,tallys[j+1]=s;for(j=0;j<t[i][0].length;j++)t[i][1][j]=tallys[j]}a.transform_text_y="int("+a.transform_text_y+")"},accumulate:function(t,e,a){for(i=0;i<t.length;i++)for(j=1;j<t[i][0].length;j++)t[i][1][j]=t[i][1][j]+t[i][1][j-1];a.transform_text_y="accumulate("+a.transform_text_y+")"},smooth:function(t,e,a){var s=0,o=0,n=0,r=0;for(i=0;i<t.length;i++){var l=Math.round(Math.min(t[i][0].length/3,e[0]/2)),_=[],h=[],c=[],g=t[i][0].length;for(c[0]=Math.sqrt(Math.pow(2*(t[i][0][1]-t[i][0][0]),2)+Math.pow(2*(t[i][1][1]-t[i][1][0]),2)),c[g-1]=Math.sqrt(Math.pow(2*(t[i][0][g-1]-t[i][0][g-2]),2)+Math.pow(2*(t[i][0][g-1]-t[i][1][g-2]),2)),j=1;j<t[i][0].length-1;j++)c[j]=Math.sqrt(Math.pow(t[i][0][j+1]-t[i][0][j-1],2)+Math.pow(t[i][1][j+1]-t[i][1][j-1],2));for(j=0;j<t[i][0].length;j++){s=Math.max(j-l,0),o=Math.min(j+l,t[i][0].length-1),d=o-s,n=0,r=0,sumw=0;for(var m=s;o>m;m++)r+=t[i][0][m]*c[m],n+=t[i][1][m]*c[m],sumw+=c[m];h[j]=n/sumw,_[j]=r/sumw}t[i]=[_,h]}a.transform_text_y="smooth("+a.transform_text_y+","+Math.round(e[0])+")"},hist:function(t,e,a){for(i=0;i<t.length;i++){for(var s=Math.min.apply(null,t[i][1]),o=Math.max.apply(null,t[i][1]),n=0,r=-13,l=0,_=2,h=2*Math.floor(Math.pow(t[i][1].length,.5)),l=vals[n]*Math.pow(10,r),c=Math.ceil(o/l)-Math.floor(s/l)+_;c>h;)n+=1,3==n&&(n=0,r+=1),l=vals[n]*Math.pow(10,r),c=Math.ceil(o/l)-Math.floor(s/l)+_;var g=Math.floor(s/l-1)*l,m=Math.ceil(o/l+1)*l,x=[],d=[],f=0;for(bin_start=g;bin_start<m;bin_start+=l){var u=bin_start+l;for(d[f]=0,j=0;j<t[i][1].length-1;j++)bin_start<t[i][1][j]&&t[i][1][j]<u&&(d[f]+=1);x[f]=(bin_start+u)/2,f++}t[i][0]=x,t[i][1]=d}a.transform_text_y="hist("+a.transform_text_y+")",a.transform_text_x="bin_centers("+a.transform_text_x+")"},interpolate:function(t,e,a){var s=Math.min.apply(null,t[0][0]),o=Math.max.apply(null,t[0][0]);for(i=0;i<t.length;i++){var n=Math.min.apply(null,t[i][0]),r=Math.max.apply(null,t[i][0]);s=Math.min(s,n),o=Math.max(o,r)}var l=(o-s)/e[0];for(i=0;i<t.length;i++){var _=[],h=[];for(j=0;j<e[0];j++){_[j]=s+j*l;var c=1e200,g=1,m=1e200,x=t[i][0].length-2;for(k=0;k<t[i][0].length;k++){var d=_[j]-t[i][0][k];d>=0&&c>d&&(c=d,g=k),0>d&&m>-1*d&&(m=-1*d,x=k)}h[j]=t[i][1][g]+(t[i][1][x]-t[i][1][g])/(t[i][0][x]-t[i][0][g])*(_[j]-t[i][0][g])}t[i][0]=_,t[i][1]=h}transforms.clean(t,a),a.transform_text_y="interpolate("+a.transform_text_y+","+e[0]+")",a.transform_text_x="interpolate("+a.transform_text_x+","+e[0]+")"},differentiate:function(t,e,a){for(i=0;i<t.length;i++){for(j=0;j<t[i][0].length-1;j++)t[i][1][j]=(t[i][1][j+1]-t[i][1][j])/(t[i][0][j+1]-t[i][0][j]),t[i][0][j]=(t[i][0][j]+t[i][0][j+1])/2;t[i][1].pop(),t[i][0].pop()}transforms.clean(t,a),a.transform_text_y="d/dx("+a.transform_text_y+")"},subtract_fit:function(t,e,a){var s=e[0];for(i=0;i<t.length;i++){var o=fits.fit_funs[fits.fit_strings.indexOf(s)](t[i][0],t[i][1]),n=o.fun(t[i][0],o.parameters);for(j=0;j<t[i][0].length;j++)t[i][1][j]-=n[j]}transforms.clean(t,a),a.transform_text_y=a.transform_text_y+"-"+o.strings[0]},keep_outliers:function(t,e,i){transforms.outliers_generic(t,e,i,!1)},remove_outliers:function(t,e,i){transforms.outliers_generic(t,e,i,!0)},outliers_generic:function(t,e,i,a){var s=e[0],o=[.5,1,1.5,2,2.5,3],n=e[1]%o.length;0>n&&(n+=o.length);var r=o[n];for(n=0;n<t.length;n++){var l=fits.fit_funs[fits.fit_strings.indexOf(s)](t[n][0],t[n][1]),_=l.fun(t[n][0],l.parameters),h=[],c=0;for(x=0;x<t[n][0].length;x++)c=t[n][1][x]-_[x],isFinite(c)&&h.push(c);for(var g=0,m=0,x=0;x<h.length;x++)g+=h[x],m+=h[x]*h[x];var d=h.length;m-=g*g/d;var f=Math.sqrt(m/d);if(a)for(x=0;x<t[n][0].length;x++)t[n][1][x]-_[x]>r*f&&(t[n][1][x]=NaN);else for(x=0;x<t[n][0].length;x++)t[n][1][x]-_[x]<r*f&&(t[n][1][x]=NaN)}transforms.clean(t,i),a?i.transform_text_y="remove_outliers("+i.transform_text_y+","+s+","+r+")":i.transform_text_y="keep_outliers("+i.transform_text_y+","+s+","+r+")"},jitter:function(t,e,a){var s=e[0];for(i=0;i<t.length;i++)for(j=0;j<t[i][1].length;j++)t[i][1][j]=t[i][1][j]+(2*Math.random()-1)*s*t[i][1][j]/100;a.transform_text_y="jitter("+a.transform_text_y+","+s+"%)"},view_last_n:function(t,e,a){for(i=0;i<t.length;i++){var s=t[i][1].length;t[i][1]=t[i][1].slice(Math.max(0,s-e[0]),s),t[i][0]=t[i][0].slice(Math.max(0,s-e[0]),s)}},spacing:function(t,e,a){for(i=0;i<t.length;i++){for(j=0;j<t[i][1].length-1;j++)t[i][1][j]=t[i][0][j+1]-t[i][0][j];for(j=0;j<t[i][1].length-1;j++)t[i][0][j]=(t[i][0][j+1]+t[i][0][j])/2;t[i][0][j]=1/0}transforms.clean(t,a),a.transform_text_y="spacing("+a.transform_text_y+")"},dft:function(t,e,i){},time_to_num:function(t,e,a){var s=e[2],o=e[0],n="x"===s?0:1,r=[864e5,36e5,6e4,1e3],l=r[e[1]],_=0;if(0==o&&(_=e[3]),1==o){var h=new Date;_=h.getTime()}if(2==o){var c=1e307,g=1e307;for(i=0;i<t.length;i++){var c=Math.min.apply(null,t[i][n]);g=Math.min(c,g)}_=g}if(3==o){var m=1e-307,x=1e-307;for(i=0;i<t.length;i++){var m=Math.max.apply(null,t[i][n]);x=Math.max(m,x)}_=x}for(console.log(_),console.log(l),i=0;i<t.length;i++)for(j=0;j<t[i][0].length;j++)t[i][n][j]=(t[i][n][j]-_)/l;transforms.clean(t,a)}};return mjs_plot={new_graph:function(canvasname,name){"use strict";var canvas=document.getElementById(canvasname),ctx=canvas.getContext("2d");drawSplash(canvas,ctx);var graphname;"String"==typeof name?graphname=name:(graphname=canvasname+window.location.pathname,graphname="G"+Math.abs(string_hash(graphname)));var gs=load_gs(graphname);gs.v===MJS_PLOT_VERSION?console.log("version is same"):(gs=mjs_plot.get_graph_style(),console.log("version changed, get new style"));var graph={graphics_style:gs,default_graphics_style:mjs_plot.get_graph_style(),graph_name:graphname,canvas_name:canvasname,drawfxmenu:!1,drawlinemenu:!1,drawmodemenu:!1,drawfitsmenu:!1,drawtimemenu:!1,drawgraphmenu:!1,drawFontMenu:!1,drawStylemenu:!1,drawcaptionmenu:!1,drawxmenu:!1,drawymenu:!1,drawmarkermenu:!1,timemenuoptions:[0,0],plot_failed:!1,transparent:!1,needs_drag_image:!0,points_drawn:0,orignal_canvas_width:600,orignal_canvas_height:400,isFullscreen:!1,isSVG:!1,isPNGSVG:!1,svg:"",errors:[],data:[],data_backup:[],colors:[],colors_backup:[],captions:[],captions_backup:[],symbol_modes:[],symbol_modes_backup:[],line_modes:[],line_modes_backup:[],__items_plotted:[],__items_captions:[],onPlotFunctions:[],fit_data:[],reader_index:[0,0],transform_index:-1,transform_text_x:"x",ui:{size:20,touch:is_touch_device(),mouse_is_dragging:!1,is_touching:!1,draw_time:1e200,copy_time:1e200,ticking:!1,latestEvent:!1},transform_text_y:"y",drawing_methods:{draw_y_errors:function(t,e,i,a,s,o){e.beginPath(),o/=2,t.points_drawn+=s-a,e.beginPath();for(var n=a;s>n;n++){var r=t.units_to_pixels(t.data[i][0][n],"x"),l=t.units_to_pixels(t.data[i][1][n]+t.data[i][2][n],"y"),_=t.units_to_pixels(t.data[i][1][n]-t.data[i][2][n],"y");e.moveTo(r,_),e.lineTo(r,l),e.moveTo(r-o,_),e.lineTo(r+o,_),e.moveTo(r-o,l),e.lineTo(r+o,l)}e.stroke()},draw_x_errors:function(t,e,i,a,s,o){e.beginPath(),o/=2,t.points_drawn+=s-a,e.beginPath();for(var n=a;s>n;n++){var r=t.units_to_pixels(t.data[i][1][n],"y"),l=t.units_to_pixels(t.data[i][0][n]+t.data[i][3][n],"x"),_=t.units_to_pixels(t.data[i][0][n]-t.data[i][3][n],"x");e.moveTo(l,r),e.lineTo(_,r),e.moveTo(l,r+o),e.lineTo(l,r-o),e.moveTo(_,r+o),e.lineTo(_,r-o)}e.stroke()},draw_line:function(t,e,i,a,s){var o=t.units_to_pixels(t.data[i][0][a],"x"),n=t.units_to_pixels(t.data[i][1][a],"y");e.beginPath(),e.moveTo(o,n),t.points_drawn+=s-a;for(var r=a;s>r;r++){o=t.units_to_pixels(t.data[i][0][r],"x"),n=t.units_to_pixels(t.data[i][1][r],"y"),e.lineTo(o,n)}e.stroke()},draw_dot:function(t,e,i,a,s,o){t.points_drawn+=s-a;var n,r;e.beginPath();for(var l=a;s>l;l++)n=t.units_to_pixels(t.data[i][0][l],"x"),r=t.units_to_pixels(t.data[i][1][l],"y"),e.rect(n-o/2,r-o/2,o,o);e.fill()},draw_cdot:function(t,e,i,a,s,o){o/=2,t.points_drawn+=s-a;for(var n=a;s>n;n++){e.beginPath();var r=t.units_to_pixels(t.data[i][0][n],"x"),l=t.units_to_pixels(t.data[i][1][n],"y");e.arc(r,l,o,0,2*Math.PI,!0),e.fill()}},draw_circ:function(t,e,i,a,s,o){o/=2,e.beginPath(),t.points_drawn+=s-a;for(var n=a;s>n;n++){var r=t.units_to_pixels(t.data[i][0][n],"x"),l=t.units_to_pixels(t.data[i][1][n],"y");e.beginPath(),e.arc(r,l,o,0,2*Math.PI,!0),e.stroke()}},draw_cross:function(t,e,i,a,s,o){o/=2,e.beginPath(),t.points_drawn+=s-a;for(var n=a;s>n;n++){var r=t.units_to_pixels(t.data[i][0][n],"x"),l=t.units_to_pixels(t.data[i][1][n],"y");e.moveTo(r,l-o),e.lineTo(r,l+o),e.moveTo(r-o,l),e.lineTo(r+o,l)}e.stroke()},draw_x:function(t,e,i,a,s,o){o/=2,e.beginPath(),t.points_drawn+=s-a;for(var n=a;s>n;n++){var r=t.units_to_pixels(t.data[i][0][n],"x"),l=t.units_to_pixels(t.data[i][1][n],"y");e.moveTo(r-o,l-o),e.lineTo(r+o,l+o),e.moveTo(r-o,l+o),e.lineTo(r+o,l-o)}e.stroke()},draw_box:function(t,e,i,a,s,o){e.beginPath(),t.points_drawn+=s-a;for(var n=a;s>n;n++){var r=t.units_to_pixels(t.data[i][0][n],"x"),l=t.units_to_pixels(t.data[i][1][n],"y");e.beginPath(),e.rect(r-o/2,l-o/2,o,o),e.stroke()}},draw_zig:function(t,e,i,a,s){var o=t.units_to_pixels(t.data[i][0][a],"x"),n=t.units_to_pixels(t.data[i][1][a],"y"),r=o,l=n;t.points_drawn+=s-a,e.beginPath(),e.moveTo(o,n);for(var _=a;s>_;_++)o=t.units_to_pixels(t.data[i][0][_],"x"),n=t.units_to_pixels(t.data[i][1][_],"y"),e.lineTo(r,n),e.lineTo(o,n),r=o,l=n;e.stroke()},draw_zag:function(t,e,i,a,s){var o=t.units_to_pixels(t.data[i][0][a],"x"),n=t.units_to_pixels(t.data[i][1][a],"y"),r=o,l=n;t.points_drawn+=s-a,e.beginPath(),e.moveTo(o,n);for(var _=a;s>_;_++)o=t.units_to_pixels(t.data[i][0][_],"x"),n=t.units_to_pixels(t.data[i][1][_],"y"),e.lineTo(o,l),e.lineTo(o,n),r=o,l=n;e.stroke()},draw_mid:function(t,e,i,a,s){var o=t.units_to_pixels(t.data[i][0][a],"x"),n=t.units_to_pixels(t.data[i][1][a],"y"),r=o,l=n,_=o,h=n;t.points_drawn+=s-a,e.beginPath(),e.moveTo(o,n);for(var c=a;s>c;c++)o=t.units_to_pixels(t.data[i][0][c],"x"),n=t.units_to_pixels(t.data[i][1][c],"y"),e.lineTo((_+o)/2,h),e.lineTo((_+o)/2,n),r=_,l=h,_=o,h=n;o=t.units_to_pixels(t.data[i][0][s-1],"x"),n=t.units_to_pixels(t.data[i][1][s-1],"y"),e.lineTo(o,n),e.stroke()},draw_hist:function(t,e,i,a,s){var o=Math.min(t.units_to_pixels(0,"y"),canvas.height),n=t.units_to_pixels(t.data[i][0][a],"x"),r=t.units_to_pixels(t.data[i][1][a],"y"),l=n,_=r,h=n,c=r;t.points_drawn+=s-a,n=t.units_to_pixels(t.data[i][0][a+1],"x"),r=t.units_to_pixels(t.data[i][1][a+1],"y"),e.beginPath(),e.moveTo(h-(n-h)/2,o),e.lineTo(h-(n-h)/2,c),e.lineTo((n+h)/2,c);for(var g=a+1;s>g;g++)n=t.units_to_pixels(t.data[i][0][g],"x"),r=t.units_to_pixels(t.data[i][1][g],"y"),e.lineTo((h+l)/2,c),e.lineTo((h+n)/2,c),e.lineTo((h+n)/2,o),l=h,_=c,h=n,c=r;n=t.units_to_pixels(t.data[i][0][s-1],"x"),r=t.units_to_pixels(t.data[i][1][s-1],"y"),e.moveTo((l+n)/2,o),e.lineTo((l+n)/2,r),e.lineTo(n+(n-l)/2,r),e.lineTo(n+(n-l)/2,o),e.stroke()},draw_approx:function(t,e,i,a,s){t.points_drawn+=s-a;var o=t.units_to_pixels(t.data[i][0][a],"x"),n=t.units_to_pixels(t.data[i][1][a],"y"),r=o,l=n,_=o,h=n,c=o,g=n;e.beginPath(),e.moveTo(r,l),e.lineTo((r+o)/2,(l+n)/2);for(var m=a+1;s>m;m++)o=t.units_to_pixels(t.data[i][0][m],"x"),n=t.units_to_pixels(t.data[i][1][m],"y"),e.quadraticCurveTo(c,g,(c+o)/2,(g+n)/2),r=_,l=h,_=c,h=g,c=o,g=n;o=t.units_to_pixels(t.data[i][0][s-1],"x"),n=t.units_to_pixels(t.data[i][1][s-1],"y"),e.lineTo(o,n),e.stroke()},draw_interp:function(t,e,i,a,s){3>s-a&&this.draw_line(t,e,i,a,s),t.points_drawn+=s-a;var o=t.units_to_pixels(t.data[i][0][a],"x"),n=t.units_to_pixels(t.data[i][1][a],"y"),r=o,l=n,_=o,h=n,c=t.units_to_pixels(t.data[i][0][a+1],"x"),g=t.units_to_pixels(t.data[i][1][a+1],"y"),o=t.units_to_pixels(t.data[i][0][a+2],"x"),n=t.units_to_pixels(t.data[i][1][a+2],"y");e.beginPath();var m=5;e.moveTo(r,l),e.bezierCurveTo((c-r)/m+r,(g-l)/m+l,c-(o-r)/m,g-(n-l)/m,c,g),e.moveTo(_,h);for(var x=a+2;s>x;x++)o=t.units_to_pixels(t.data[i][0][x],"x"),n=t.units_to_pixels(t.data[i][1][x],"y"),e.bezierCurveTo((c-r)/m+_,(g-l)/m+h,c-(o-_)/m,g-(n-h)/m,c,g),r=_,l=h,_=c,h=g,c=o,g=n;o=t.units_to_pixels(t.data[i][0][s-1],"x"),n=t.units_to_pixels(t.data[i][1][s-1],"y"),e.bezierCurveTo((o-r)/m+_,(n-l)/m+h,o-(o-_)/m,n-(n-h)/m,o,n),e.stroke()},draw_scribble:function(t,e,i,a,s){3>s-a&&this.draw_line(t,e,i,a,s),t.points_drawn+=s-a;var o=t.units_to_pixels(t.data[i][0][a],"x"),n=t.units_to_pixels(t.data[i][1][a],"y"),r=o,l=n,_=o,h=n,c=t.units_to_pixels(t.data[i][0][a+1],"x"),g=t.units_to_pixels(t.data[i][1][a+1],"y"),o=t.units_to_pixels(t.data[i][0][a+2],"x"),n=t.units_to_pixels(t.data[i][1][a+2],"y");e.beginPath();var m=.2;e.moveTo(r,l),e.bezierCurveTo((c-r)/m+r,(g-l)/m+l,c-(o-r)/m,g-(n-l)/m,c,g),e.moveTo(_,h);for(var x=a+2;s>x;x++)o=t.units_to_pixels(t.data[i][0][x],"x"),n=t.units_to_pixels(t.data[i][1][x],"y"),e.bezierCurveTo((c-r)/m+_,(g-l)/m+h,c-(o-_)/m,g-(n-h)/m,c,g),r=_,l=h,_=c,h=g,c=o,g=n;o=t.units_to_pixels(t.data[i][0][s-1],"x"),n=t.units_to_pixels(t.data[i][1][s-1],"y"),e.bezierCurveTo((o-r)/m+_,(n-l)/m+h,o-(o-_)/m,n-(n-h)/m,o,n),e.stroke()}},__plot:function(t,e,i,a,s,o){var n;if(e instanceof Array)n=[t,e];else{for(var r=[],l=0;l<t.length;l++)r.push(l);n=[r,t]}i instanceof Array&&n.push(i),a instanceof Array&&n.push(a);for(var s="Unlabeled",l=0;l<arguments.length;l++)"string"==typeof arguments[l]&&(s=arguments[l]);this.__items_captions.push(s),this.__items_plotted.push(n),this.draw()},plot:function(t,e,i,a,s,o){this.default_graphics_style.x_scale_mode="lin",this.default_graphics_style.y_scale_mode="lin",this.__plot(t,e,i,a,s,o)},loglog:function(t,e,i,a,s,o){this.default_graphics_style.x_scale_mode="log",this.default_graphics_style.y_scale_mode="log",this.__plot(t,e,i,a,s,o)},semilogy:function(t,e,i,a,s,o){this.default_graphics_style.x_scale_mode="lin",this.default_graphics_style.y_scale_mode="log",this.__plot(t,e,i,a,s,o)},semilogx:function(t,e,i,a,s,o){this.default_graphics_style.x_scale_mode="log",this.default_graphics_style.y_scale_mode="lin",this.__plot(t,e,i,a,s,o)},timeseries:function(t,e,i,a,s,o){this.default_graphics_style.x_scale_mode="time",this.default_graphics_style.y_scale_mode="lin",this.__plot(mjs_plot.convert_time_strings(t),e,i,a,s,o)},grid:function(t){this.default_graphics_style.show_grid=t},useDefaults:function(){this.graphics_style.modified=!1},draw:function(){console.log("call to draw"),this.ui.ticking||(this.ui.ticking=!0,requestAnimationFrame(function(){__draw_shim(graph)}))},title:function(t,e,i){this.default_graphics_style.title=t,e&&(this.default_graphics_style.subtitle=e),i&&(this.default_graphics_style.subtitle2=i)},xlabel:function(t){this.default_graphics_style.x_axis_title=t},ylabel:function(t){this.default_graphics_style.y_axis_title=t},set_data:function(t){this.transform_index=-1;for(var e=0;e<t.length;e++)t[e][0].length!=t[e][1].length&&this.errors.push("series "+e+"had different legnth x and y arrays");if(this.data_backup=clone(t),transforms.clean(this.data_backup,this),this.data=clone(this.data_backup),this.data.length!=t.length)this.errors.push("A series was cleaned away in set_data");else for(var e=0;e<t.length;e++)this.data[e][0].length!=t[e][0].length&&this.errors.push("series "+e+" had non finite values");for(var e=0;e<this.data.length;e++)this.graphics_style.hidden_lines[e]=this.graphics_style.hidden_lines[e]||!1;this.do_colours(),this.do_line_modes()},do_colours:function(){this.colors=[];for(var t=0;t<this.data_backup.length;t++)if(this.graphics_style.caption_colors)try{this.colors[t]=color_from_string(this.captions[t]||"label")}catch(e){this.colors[t]=color_from_string("label")}else this.colors[t]=this.graphics_style.line_colours[t]||get_color(t,this.data_backup.length-1);this.colors_backup=clone(this.colors),this.graphics_style.line_colours=clone(this.colors)},redo_colours:function(){for(var t=0;t<this.data_backup.length;t++)this.graphics_style.line_colours[t]=get_color(t,this.data_backup.length-1);this.do_colours()},do_line_modes:function(){for(var t=0;t<this.data_backup.length;t++)this.graphics_style.line_modes[t]=this.graphics_style.line_modes[t]||this.graphics_style.line_mode,this.graphics_style.symbol_modes[t]=this.graphics_style.symbol_modes[t]||this.graphics_style.symbol_mode;this.line_modes=clone(this.graphics_style.line_modes),this.symbol_modes=clone(this.graphics_style.symbol_modes),this.line_modes_backup=clone(this.graphics_style.line_modes),this.symbol_modes_backup=clone(this.graphics_style.symbol_modes)},reset:function(){this.graphics_style=JSON.parse(JSON.stringify(graph.default_graphics_style)),this.graphics_style.modified=!1,this.transform_index=-1,this.do_colours(),this.do_line_modes()},set_captions:function(t){this.captions_backup=clone(t),this.captions=clone(t),this.captions.length!=this.data_backup.length&&this.errors.push("number of captions and number of series don't match"),this.do_colours()},matchParentSize:function(){window.addEventListener("resize",function(){keep_parent_sized(graph)}),requestAnimationFrame(function(){keep_parent_sized(graph)})},forceFullPage:function(){var t=document.createElement("meta");t.id="viewport",t.name="viewport",t.content="user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1",document.getElementsByTagName("head")[0].appendChild(t),graph.canvas.position="absolute",graph.canvas.style.left=0,graph.canvas.style.top=0,graph.canvas.style.width=window.innerWidth,graph.canvas.style.height=window.innerHeight,window.addEventListener("resize",function(){keep_page_sized(graph)}),requestAnimationFrame(function(){keep_page_sized(graph)})},find_scale:function(t,e,i,a,s,o,n){if("lin"===s){var r=0;if(Math.abs(t)>1e-250)var l=Math.floor(Math.log10(e-t))-10;else l=-250;var _,h=0,c=0;c=o?0:2;for(var g=Math.floor(i/a)+c,h=vals[r]*Math.pow(10,l),m=Math.ceil(e/h)-Math.floor(t/h)+c;m>g;)r+=1,3==r&&(r=0,l+=1),h=vals[r]*Math.pow(10,l),m=Math.ceil(e/h)-Math.floor(t/h)+c;if(_=0==m?i:i/m,o)var x=Math.floor(t/h)*h,d=Math.ceil(e/h)*h;else var x=Math.floor(t/h-1)*h,d=Math.ceil(e/h+1)*h;return F={lowpoint:x,highpoint:d,scale:h,width:_,val_i:r,val_i_low:1,power_low:1,val_i_high:1,power_high:1,scalemode:s}}if("log"===s){var r=0,l=100,f=-1,u=!1,p=Math.floor(i/a/2);for(m=0;p>m;){for(f+=1,l=Math.ceil(Math.log10(t))+1,r=0;log_vals[f][r]*Math.pow(10,l)>=t;)r-=1,0>r&&(l-=1,r=log_vals[f].length-1);o===!1&&(r-=1,0>r&&(l-=1,r=log_vals[f].length-1));var y=r,v=l;for(m=0;log_vals[f][r]*Math.pow(10,l)<=e;)r+=1,m+=1,r>=log_vals[f].length&&(l+=1,r=0);o===!1&&(r+=1,m+=1,r>=log_vals[f].length&&(l+=1,r=0));var w=r,T=l;(f>=log_vals.length||Math.log10(e)-Math.log10(t)<.6)&&0==u?(m=p,F=this.find_scale(t,e,i,a,"lin",o),F.lowpoint<=0&&(u=!0,m=0),x=Math.log10(F.lowpoint),d=Math.log10(F.highpoint),h=F.scale,_=F.width,f=F.val_i):(x=Math.log10(log_vals[f][y]*Math.pow(10,v)),d=Math.log10(log_vals[f][w]*Math.pow(10,T)),h=-1,_=-1,f=f)}if(0==f&&m>2*p){var b="y"===n&&("infix"===this.graphics_style.y_label_mode||"postfix"===this.graphics_style.y_label_mode);b=b||"x"===n&&("infix"===this.graphics_style.x_label_mode||"postfix"===this.graphics_style.x_label_mode),b&&(vals=[1,3,6,9]),F=this.find_scale(Math.max(-249,Math.log10(t)),Math.min(249,Math.log10(e)),i,a,"lin",o),b&&(vals=[1,2,5]),x=F.lowpoint,d=F.highpoint,h=F.scale,s="log",_=F.width,f=-1}return F={lowpoint:x,highpoint:d,scale:h,width:_,val_i:f,val_i_low:y,power_low:v,val_i_high:w,power_high:T,scalemode:s}}if("time"===s){if(o)var c=0;else var c=2;for(var k=Math.floor(i/a)+c,M=(e-t)/k,j=0;allowed_intervals[j]<M;)j++;j=Math.min(j,allowed_intervals.length-1),c/=2;var S=t-t%allowed_intervals[j]-c*allowed_intervals[j],P=e-e%allowed_intervals[j]+c*allowed_intervals[j];if(allowed_intervals[j]>=31536e6){var z=new Date(S);z=new Date(z.getFullYear(),0,0),S=z.getTime();var z=new Date(P);z=new Date(z.getFullYear()+Math.round(allowed_intervals[j]/1e3/60/60/24/365)+Math.round(z.getMonth()/12),0,0),P=z.getTime()}if(allowed_intervals[j]>=2592e6&&allowed_intervals[j]<31536e6){var z=new Date(S);z=new Date(z.getFullYear(),z.getMonth(),1),S=z.getTime();var z=new Date(P);z=z.getDate()<15?new Date(z.getFullYear(),z.getMonth(),1):new Date(z.getFullYear(),z.getMonth()+1,1),P=z.getTime()+allowed_intervals[j]}if(allowed_intervals[j]>=432e5&&allowed_intervals[j]<2592e6){var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),0,0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),0,0,0,0),
P=z.getTime()+allowed_intervals[j]}if(allowed_intervals[j]>=18e5&&allowed_intervals[j]<=216e5){var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),z.getHours(),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),z.getHours()+1,0,0,0),P=z.getTime()}if(72e5==allowed_intervals[j]){var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),2*Math.floor(z.getHours()/2),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),2*Math.floor(1+z.getHours()/2),0,0,0),P=z.getTime()}if(108e5==allowed_intervals[j]){console.log("every three horus");var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),3*Math.floor(z.getHours()/3),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),3*Math.floor(1+z.getHours()/3),0,0,0),P=z.getTime()}if(216e5==allowed_intervals[j]){console.log("every six horus");var z=new Date(S),b=new Date(z.getFullYear(),z.getMonth(),z.getDate(),6*Math.floor(z.getHours()/6),0,0,0);S=b.getTime();var z=new Date(P);z=new Date(z.getFullYear(),z.getMonth(),z.getDate(),6*Math.floor(1+z.getHours()/6),0,0,0),P=z.getTime()}allowed_intervals[j]<18e5&&(P+=allowed_intervals[j]);var F,C=Math.floor((P-S)/allowed_intervals[j]),h=i/C,A=Math.floor((P-S)/time_ticks[j]),D=i/A;return F={lowpoint:S,highpoint:P,scale:h,width:D,val_i:j,val_i_low:0,power_low:0,val_i_high:0,power_high:0,scalemode:"time"}}},find_limits:function(t,e,i,a,s,o,n){s=Math.min(s,1e250),a=Math.max(a,-1e250);var r=s;if(s=Math.max(s,a),a=Math.min(r,a),"time"===o&&(s=Math.min(s,1e14),a=Math.max(a,-1e14)),this.no_data=!1,0==t.length)return e||i?(h=1,c=10,e=!0,i=!0):(h=a,c=s),"log"===o&&(0>=h&&(h=1),(0>=c||h>c)&&(c=10)),this.no_data=!0,{low:h,high:c,automax:i,automin:e,scale:o};if("log"===o&&(0>=a&&0==e&&(e=!0,this.errors.push(n+" minimum was negative - using auto")),0>=s&&0==i&&(e=!0,i=!0,this.errors.push(n+" maximum was negative - using auto"))),1==e||1==i||h>=c){var l=1e307,_=-1e307,h=1e307,c=-1e307;for(g=0;g<t.length;g++){var l=Math.min.apply(null,t[g]),_=Math.max.apply(null,t[g]);h=Math.min(l,h),c=Math.max(_,c)}}if(h==c&&(h=.6*Math.min(h,c),c=1.6*Math.max(h,c)),1==this.data.length&&1==this.data[0][0].length&&(h=.6*Math.min(h,c),c=1.6*Math.max(h,c)),a>c&&i&&!e&&(e=!0,i=!0,this.errors.push(n+" can't have inverted scale - using auto")),h>s&&e&&!i&&(e=!0,i=!0,this.errors.push(n+" can't have inverted scale - using auto")),0==e&&(h=a),0==i&&(c=s),"log"===o&&0>=c&&(o="lin",this.errors.push("all "+n+" data is negative, cant plot that log"+n)),"log"===o&&2e-250>=h){h=2e250;for(var g=0;g<t.length;g++)for(var m=0;m<this.data[g][1].length;m++)t[g][m]>0&&t[g][m]<h&&(h=t[g][m])}return"log"===o&&(s=Math.max(s,2e-250),a=Math.max(a,2e-250)),{low:h,high:c,automax:i,automin:e,scale:o}},use_scale:function(t,e,i,a){var s,o,n,r=t.lowpoint,l=t.highpoint,_=t.scale,h=t.width,c=t.val_i,g=t.val_i_low,m=t.power_low,x=t.val_i_high,d=t.power_high,f=t.scalemode,u=1,p=[],y=[],v=[];if("lin"===f){for(var w=0,T=" ",b=1,k="",M=(0-r)*e/(l-r);e>=w;)A=w/h*_+r,k=A.toPrecision(b),k===T&&(b+=1,k=A.toPrecision(b)),T=k,w+=h;w=h;for(var j=1;e-1>w;)A=j*_+r,p.push(w),k=Math.abs(w-M)<2?0..toFixed(Math.max(1,b-1)):this.get_axis_string(A,a,b),y.push(k),w+=h,j+=1;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>h;w=0;var P=1;for(P=h>i*u?many_minor_ticks[c]:few_minor_ticks[c];e-2>w;)w+=h/P,v.push(w);v.pop()}if("log"===f&&-1==c){for(var w=0,T=" ",b=1,k="";e>=w;)A=Math.pow(10,w/h*_+r),k=A.toPrecision(b),k===T&&(b+=1,k=A.toPrecision(b)),T=k,w+=h;w=h;for(var j=1;e-1>w;)A=Math.pow(10,j*_+r),p.push(w),k=this.get_axis_string(A,a,b),y.push(k),w+=h,j+=1;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>h;w=0;var P=1;for(P=h>i*u?many_minor_ticks[c]:few_minor_ticks[c];e>=w;)v.push(w),w+=h/P;v.pop()}if("log"===f&&-1!=c)if(0>_){s=g,o=m,A=log_vals[c][g]*Math.pow(10,m),n=A,b=1;for(var z="",F="";A<log_vals[c][x]*Math.pow(10,d);)s+=1,s>=log_vals[c].length&&(o+=1,s=0),A=log_vals[c][s]*Math.pow(10,o),w=(Math.log10(A)-r)*e/(l-r),z=this.get_axis_string(A,a,b),z===F&&(b++,z=this.get_axis_string(A,a,b)),F=z;for(A=log_vals[c][g]*Math.pow(10,m),s=g,o=m;A<log_vals[c][x]*Math.pow(10,d);){if(s+=1,s>=log_vals[c].length&&(o+=1,s=0),A=log_vals[c][s]*Math.pow(10,o),w=(Math.log10(A)-r)*e/(l-r),e-10>w&&(y.push(this.get_axis_string(A,a,b)),p.push(w)),c>8){var C=(Math.log10((n+A)/2)-r)*e/(l-r);v.push(C)}n=A}if(8>=c){for(A=log_vals[c][g]*Math.pow(10,m),s=g,o=m;A<log_vals[c][x]*Math.pow(10,d);)s+=1,s>=log_vals_ticks[c].length&&(o+=1,s=0),A=log_vals_ticks[c][s]*Math.pow(10,o),w=(Math.log10(A)-r)*e/(l-r),v.push(w);v.pop()}}else{var w=0,T=" ",b=1,k="";for(A=Math.pow(10,r);A<=Math.pow(10,l);)k=A.toPrecision(b),k===T&&(b+=1,k=A.toPrecision(b)),T=k,A+=_;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>=h;for(A=Math.pow(10,r)+_;A<Math.pow(10,l)-_/2;)k=this.get_axis_string(A,a,b),w=(Math.log10(A)-r)*e/(l-r),p.push(w),y.push(k),A+=_;var P=1;for(P=h>i*u?many_minor_ticks[c]:few_minor_ticks[c],A=Math.pow(10,r);A<Math.pow(10,l);)A+=_/P,w=(Math.log10(A)-r)*e/(l-r),v.push(w);v.pop()}if("time"===f){var A=t.val_i,D=l-r;for(j=0;allowed_intervals[j]<D;)j++;j--;for(var q=string_precisions[A],N=string_precisions[j],E=r,L=mjs_date_print(E,N,N),w=0,I="",k="";l>E;)E+=allowed_intervals[A],allowed_intervals[A]>=2592e6&&(E=round_to_month(E)),w=(E-r)/D*e,k=mjs_date_print(E,N,q),k===I&&q++,I=k;var O=mjs_date_print(E,N,N);O===L&&N++;for(var E=r,w=0,G=0;E<l-allowed_intervals[A]&&e-2>w+_;){for(E+=allowed_intervals[A],allowed_intervals[A]>=2592e6&&(E=round_to_month(E)),w=(E-r)/D*e,p.push(w),k=mjs_date_print(E,N,q),y.push(k);w>G;)G+=h,v.push(G);var G=w;v.pop()}for(;e-2>=G;)G+=h,v.push(G);v.pop(),S=!1;var S=.7*k.length*this.graphics_style.tick_labels_font_size*this.graphics_style.scaling_factor>_;b=q}return{pos:p,strings:y,minor_pos:v,stepping:S,precision:b}},fit_points_drawn:0,drawSimpleLine:function(t,e,i){var a=this.units_to_pixels(e[0],"x"),s=this.units_to_pixels(i[0],"y"),o=a,n=s;t.beginPath(),t.moveTo(a,s);for(var r=!0,l=!0,_=0;_<e.length;_++){this.fit_points_drawn++;var s=this.units_to_pixels(i[_],"y"),a=this.units_to_pixels(e[_],"x");r=s>0&&s<this.canvas.height,r&&l&&t.lineTo(a,s),!r&&l&&(t.lineTo(a,s),t.stroke()),r&&!l&&(t.beginPath(),t.moveTo(o,n),t.lineTo(a,s)),l=r,o=a,n=s}t.stroke()},mjs_plot:function(){console.log("call to plot");var start_time=new Date;this.plot_failed&&(this.errors.push("failed for unknown reason"),this.reset()),this.plot_failed=!0,0==this.graphics_style.modified&&(console.log("getting defautts"),this.reset());var gs=this.graphics_style,ctx=this.canvas.getContext("2d");if(this.isPNGSVG&&(this.isSVG=!0),this.isSVG)var oldctx=ctx,ctx=new SVGContext(ctx);ctx.lineJoin="round";var canvas=this.canvas,scaling_factor=gs.scaling_factor,graph_line_thickness=gs.graph_line_thickness*scaling_factor,symbol_size=gs.symbol_size*scaling_factor,line_thickness=gs.line_thickness*scaling_factor,tick_len=gs.tick_len*scaling_factor,mode=gs.mode,font_name=gs.font_name,title_font_size=gs.title_font_size*scaling_factor,title=gs.title,subtitle=gs.subtitle,title_spacing=gs.title_spacing*scaling_factor,tick_labels_font_size=gs.tick_labels_font_size*scaling_factor,tick_lables_font_padding=gs.tick_lables_font_padding*scaling_factor,axis_labels_font_size=gs.axis_labels_font_size*scaling_factor,lable_spacing=gs.lable_spacing*scaling_factor,x_axis_title=gs.x_axis_title,y_axis_title=gs.y_axis_title,minor_tick_len=gs.minor_tick_len*scaling_factor,guideWidthx=gs.guideWidthx*scaling_factor,guideWidthy=gs.guideWidthy*scaling_factor;try{ctx.font=tick_labels_font_size+"px "+font_name,ctx.fillText("font test",10,10)}catch(e){this.errors.push("font faliure"),font_name="Courier New",gs.font_name="Courier New"}for(ctx.fillStyle=gs.color_bg,ctx.strokeStyle=gs.color_fg,this.transparent?ctx.clearRect(0,0,canvas.width,canvas.height):ctx.fillRect(0,0,canvas.width,canvas.height),this.isSVG&&(ctx.clearAll(),ctx.font_name=font_name,ctx.startClipBox(0,0,canvas.width,canvas.height)),this.transform_index!=gs.data_transforms.length&&(this.data=clone(this.data_backup),this.captions=clone(this.captions_backup),this.colors_backup=clone(gs.line_colours),this.line_modes_backup=clone(gs.line_modes),this.symbol_modes_backup=clone(gs.symbol_modes),this.colors=clone(this.colors_backup),this.line_modes=clone(this.line_modes_backup),this.symbol_modes=clone(this.symbol_modes_backup),this.transform_index=0,this.transform_text_x=x_axis_title,this.transform_text_y=y_axis_title,transforms.remove_lines(this.data,gs.hidden_lines,this));this.transform_index<gs.data_transforms.length;){var fun=eval("transforms."+gs.data_transforms[this.transform_index]);console.log("running "+gs.data_transforms[this.transform_index]),fun(this.data,gs.data_transforms_args[this.transform_index],this),this.transform_index++}for(var xdata=[],ydata=[],i=0;i<this.data.length;i++)xdata.push(this.data[i][0]),ydata.push(this.data[i][1]);var xlimits=this.find_limits(xdata,gs.x_scale_auto_min,gs.x_scale_auto_max,gs.x_manual_min,gs.x_manual_max,gs.x_scale_mode,"x"),xlow=xlimits.low,xhigh=xlimits.high;gs.x_scale_auto_min=xlimits.automin,gs.x_scale_auto_max=xlimits.automax,gs.x_scale_mode=xlimits.scale;var ylimits=this.find_limits(ydata,gs.y_scale_auto_min,gs.y_scale_auto_max,gs.y_manual_min,gs.y_manual_max,gs.y_scale_mode,"y"),ylow=ylimits.low,yhigh=ylimits.high;gs.y_scale_auto_min=ylimits.automin,gs.y_scale_auto_max=ylimits.automax,gs.y_scale_mode=ylimits.scale;var the_scalex=this.find_scale(xlow,xhigh,this.canvas.width,guideWidthx,gs.x_scale_mode,gs.x_scale_tight,"x"),lowpointx=the_scalex.lowpoint,highpointx=the_scalex.highpoint,scalex=the_scalex.scale,widthx=the_scalex.width,val_ix=the_scalex.val_i,val_i_lowx=the_scalex.val_i_low,power_lowx=the_scalex.power_low,val_i_highx=the_scalex.val_i_high,power_highx=the_scalex.power_high,the_scaley=this.find_scale(ylow,yhigh,this.canvas.height,guideWidthy,gs.y_scale_mode,gs.y_scale_tight,"y"),lowpointy=the_scaley.lowpoint,highpointy=the_scaley.highpoint,scaley=the_scaley.scale,widthy=the_scaley.width,val_iy=the_scaley.val_i,val_i_lowy=the_scaley.val_i_low,power_lowy=the_scaley.power_low,val_i_highy=the_scaley.val_i_high,power_highy=the_scaley.power_high;gs.x_auto_min=lowpointx,gs.x_auto_max=highpointx,gs.y_auto_min=lowpointy,gs.y_auto_max=highpointy;var positionsx=this.use_scale(the_scalex,canvas.width,guideWidthx,"x"),positionsy=this.use_scale(the_scaley,canvas.height,guideWidthy,"y");if(gs.y_scale_auto_min&&(gs.y_manual_min=this.pixels_to_units(this.canvas.height,"y")),gs.y_scale_auto_max&&(gs.y_manual_max=this.pixels_to_units(0,"y")),gs.x_scale_auto_min&&(gs.x_manual_min=this.pixels_to_units(0,"x")),gs.x_scale_auto_max&&(gs.x_manual_max=this.pixels_to_units(this.canvas.width,"x")),gs.scalex=scalex,gs.scaley=scaley,gs.widthx=widthx,gs.widthy=widthy,gs.show_grid){ctx.strokeStyle=gs.color_mg,ctx.beginPath();for(var i=0;i<positionsy.pos.length;i++){var y=canvas.height-positionsy.pos[i];ctx.moveTo(0,y),ctx.lineTo(canvas.width,y)}for(var i=0;i<positionsx.pos.length;i++){var x=positionsx.pos[i];ctx.moveTo(x,0),ctx.lineTo(x,canvas.height)}ctx.stroke()}for(var lines_start=0,lines_end=canvas.width,fit_x=[],j=lines_start;lines_end>j;j+=2)fit_x.push(this.pixels_to_units(j,"x"));for(var fit_y=[],i=0;i<gs.function_lines.length;i++)try{fit_y=parseExpression(gs.function_lines[i],fit_x,fit_x),this.drawSimpleLine(ctx,fit_x,fit_y)}catch(e){this.errors.push("function line:y="+gs.function_lines[i]+" fails")}ctx.font=tick_labels_font_size+"px "+font_name,ctx.lineWidth=line_thickness;var drawn_something=!1,drawn_caps=!1,points_drawn=0,hist_zero=Math.min(this.units_to_pixels(0,"y"),canvas.height);if(this.isPNGSVG){var svgctx=ctx;ctx=oldctx,this.isSVG=!1}var full_auto_zoom=gs.y_scale_auto_min&&gs.y_scale_auto_max&&gs.x_scale_auto_min&&gs.x_scale_auto_max;for(i=0;i<this.data.length;i++){ctx.strokeStyle=this.colors[i];var symbol_mode=this.symbol_modes[i],line_mode=this.line_modes[i];if(ctx.fillStyle=ctx.strokeStyle,"none"===gs.symbol_mode&&"none"==gs.line_mode&&this.errors.push("no symbols or lines to draw"),full_auto_zoom)seq_start=[0],seq_end=[this.data[i][0].length];else{for(var ongraph=!1,wasOngraph=!1,graph_top=this.pixels_to_units(0,"y"),graph_bottom=this.pixels_to_units(canvas.height,"y"),graph_left=this.pixels_to_units(0,"x"),graph_right=this.pixels_to_units(canvas.width,"x"),seq_start=[],seq_end=[],k=0;k<this.data[i][0].length;k++)ongraph=this.data[i][0][k]>graph_left&&this.data[i][0][k]<graph_right&&this.data[i][1][k]>graph_bottom&&this.data[i][1][k]<graph_top,!ongraph&&wasOngraph&&seq_end.push(Math.min(k+2,this.data[i][0].length)),ongraph&&!wasOngraph&&seq_start.push(Math.max(k-2,0)),wasOngraph=ongraph;for(seq_start.length>seq_end.length&&seq_end.push(k),k=seq_start.length-1;k>=0;k--)seq_start[k]<=seq_end[k-1]+2&&(seq_end[k-1]=seq_end[k],seq_end.splice(k,1),seq_start.splice(k,1))}for(drawn_something=drawn_something||seq_start.length>0,this.isSVG&&ctx.startGroup(),k=0;k<seq_start.length;k++)line_mode.indexOf("line")>-1&&this.drawing_methods.draw_line(this,ctx,i,seq_start[k],seq_end[k]),"dot"===symbol_mode&&this.drawing_methods.draw_dot(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"cdot"===symbol_mode&&this.drawing_methods.draw_cdot(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"circ"===symbol_mode&&this.drawing_methods.draw_circ(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"box"===symbol_mode&&this.drawing_methods.draw_box(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"x"===symbol_mode&&this.drawing_methods.draw_x(this,ctx,i,seq_start[k],seq_end[k],symbol_size),"cross"===symbol_mode&&this.drawing_methods.draw_cross(this,ctx,i,seq_start[k],seq_end[k],symbol_size),line_mode.indexOf("zig")>-1&&this.drawing_methods.draw_zig(this,ctx,i,seq_start[k],seq_end[k]),line_mode.indexOf("zag")>-1&&this.drawing_methods.draw_zag(this,ctx,i,seq_start[k],seq_end[k]),line_mode.indexOf("mid")>-1&&this.drawing_methods.draw_mid(this,ctx,i,seq_start[k],seq_end[k]),line_mode.indexOf("approx")>-1&&this.drawing_methods.draw_approx(this,ctx,i,seq_start[k],seq_end[k]),line_mode.indexOf("interp")>-1&&this.drawing_methods.draw_interp(this,ctx,i,seq_start[k],seq_end[k]),line_mode.indexOf("scribble")>-1&&this.drawing_methods.draw_scribble(this,ctx,i,seq_start[k],seq_end[k]),line_mode.indexOf("hist")>-1&&this.drawing_methods.draw_hist(this,ctx,i,seq_start[k],seq_end[k]),this.data[i].length>=3&&this.drawing_methods.draw_y_errors(this,ctx,i,seq_start[k],seq_end[k],symbol_size),this.data[i].length>=4&&this.drawing_methods.draw_x_errors(this,ctx,i,seq_start[k],seq_end[k],symbol_size);this.isSVG&&ctx.endGroup()}this.isPNGSVG&&(ctx=svgctx,this.isSVG=!0,ctx.image(0,0,canvas.width,canvas.height,this.pngbackground)),this.isSVG||(this.needs_drag_image||"drag"===gs.mouse_mode)&&(this.graph_image_for_drag=ctx.getImageData(0,0,canvas.width,canvas.height),this.needs_drag_image=!1),ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=gs.color_fg,ctx.fillStyle=gs.color_fg,drawn_something||0!=this.no_data||0!=gs.function_lines.length||this.errors.push("there might be data around, just not where you're looking");var l=positionsx.strings.length,stepping=ctx.measureText(positionsx.strings[1]+" ").width>positionsx.pos[1]-positionsx.pos[0]||ctx.measureText(positionsx.strings[l-1]+" ").width>positionsx.pos[l-1]-positionsx.pos[l-2];if(stepping)var j=-1*tick_labels_font_size/2,o=tick_labels_font_size/2;else var j=0,o=0;ctx.textAlign="center",ctx.beginPath();for(var i=0;i<positionsx.pos.length;i++){var x=positionsx.pos[i];if(x>graph_line_thickness&&x<canvas.width-graph_line_thickness){var label=positionsx.strings[i];ctx.fillText(label,x,canvas.height-1.2*tick_len-tick_lables_font_padding-o-j),j*=-1,ctx.moveTo(x,graph_line_thickness/2),ctx.lineTo(x,tick_len),ctx.moveTo(x,canvas.height-graph_line_thickness/2),ctx.lineTo(x,canvas.height-tick_len)}}ctx.stroke(),ctx.beginPath();for(var i=0;i<positionsx.minor_pos.length;i++)x=positionsx.minor_pos[i],x>graph_line_thickness&&x<canvas.width-graph_line_thickness&&(ctx.moveTo(x,graph_line_thickness/2),ctx.lineTo(x,minor_tick_len),ctx.moveTo(x,canvas.height-graph_line_thickness/2),ctx.lineTo(x,canvas.height-minor_tick_len));ctx.stroke(),gs.x_precision=positionsx.precision,ctx.textAlign="left",ctx.beginPath();for(var i=0;i<positionsy.pos.length;i++){var y=canvas.height-positionsy.pos[i];if(y>graph_line_thickness&&y<canvas.height-graph_line_thickness){var label=positionsy.strings[i];y>tick_len+lable_spacing+axis_labels_font_size+tick_labels_font_size/2&&y<canvas.height-tick_labels_font_size-tick_lables_font_padding-tick_len-tick_labels_font_size/2&&ctx.fillText(label,1.2*tick_len+tick_lables_font_padding+2,y+3),ctx.moveTo(graph_line_thickness/2,y),ctx.lineTo(tick_len,y),ctx.moveTo(canvas.width-graph_line_thickness/2,y),ctx.lineTo(canvas.width-tick_len,y)}}ctx.stroke(),ctx.beginPath();for(var i=0;i<positionsy.minor_pos.length;i++)y=canvas.height-positionsy.minor_pos[i],y>graph_line_thickness&&y<canvas.height-graph_line_thickness&&(ctx.moveTo(graph_line_thickness/2,y),ctx.lineTo(minor_tick_len,y),ctx.moveTo(canvas.width-graph_line_thickness/2,y),ctx.lineTo(canvas.width-minor_tick_len,y));if(ctx.stroke(),gs.y_precision=positionsy.precision,gs.show_captions){for(ctx.font=tick_labels_font_size+"px "+font_name,x=gs.scaling_factor*gs.caption_position.x,y=gs.scaling_factor*gs.caption_position.y,gs.caption_position.y>0?(y+=tick_labels_font_size,dy=tick_labels_font_size,y+=tick_len):(dy=tick_labels_font_size,y=canvas.height+y,y+=tick_labels_font_size-this.data.length*dy,y-=tick_len),gs.caption_position.x>0?(ctx.textAlign="left",x+=tick_len):(ctx.textAlign="right",x=canvas.width+x,x-=tick_len),i=0;i<this.data.length;i++){ctx.fillStyle=this.colors[i],label=this.captions[i]||"label";var splitter=" : ";switch(gs.captions_display){case"ylast":label+=splitter+this.get_axis_string(this.data[i][1][this.data[i][1].length-1],"y",gs.captions_extra_precision+gs.y_precision);break;case"xlast":label+=splitter+this.get_axis_string(this.data[i][0][this.data[i][0].length-1],"x",gs.captions_extra_precision+gs.x_precision);break;case"xfirst":label+=splitter+this.get_axis_string(this.data[i][0][0],"x",gs.captions_extra_precision+gs.x_precision);break;case"yfirst":label+=splitter+this.get_axis_string(this.data[i][1][0],"y",gs.captions_extra_precision+gs.y_precision);break;case"xmin":label+=splitter+this.get_axis_string(Math.min.apply(null,this.data[i][0]),"x",gs.captions_extra_precision+gs.x_precision);break;case"ymin":label+=splitter+this.get_axis_string(Math.min.apply(null,this.data[i][1]),"y",gs.captions_extra_precision+gs.y_precision);break;case"ymax":label+=splitter+this.get_axis_string(Math.max.apply(null,this.data[i][1]),"y",gs.captions_extra_precision+gs.y_precision);break;case"xmax":label+=splitter+this.get_axis_string(Math.max.apply(null,this.data[i][0]),"x",gs.captions_extra_precision+gs.x_precision)}this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(label,x,y)),ctx.fillText(label,x,y),y+=dy}this.data.length!=this.data_backup.length&&(label="other lines hidden",this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(label,x,y)),ctx.fillStyle=gs.color_mg,ctx.fillText(label,x,y))}if(ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=graph.graphics_style.color_fg,ctx.fillStyle=graph.graphics_style.color_fg,(this.transform_text_x.length>1||this.transform_text_y.length>1)&&gs.showTransformTexts)var x_label=this.transform_text_x,y_label=this.transform_text_y;else var x_label=x_axis_title,y_label=y_axis_title;ctx.font=axis_labels_font_size+"px "+font_name,ctx.textAlign="right";var label=x_label;"time"===gs.x_scale_mode&&this.graphics_style.x_precision>1&&(label+=" "+mjs_date_print(this.pixels_to_units(canvas.width,"x"),0,Math.max(this.graphics_style.x_precision-1,0))),stepping?ctx.fillText(label,canvas.width-lable_spacing-tick_len,canvas.height-tick_len-lable_spacing-2*tick_labels_font_size-tick_lables_font_padding):ctx.fillText(label,canvas.width-lable_spacing-tick_len,canvas.height-tick_len-lable_spacing-tick_labels_font_size-tick_lables_font_padding),ctx.textAlign="left";var label=y_label;"time"===gs.y_scale_mode&&this.graphics_style.y_precision>1&&(label+=" "+mjs_date_print(this.pixels_to_units(0,"y"),0,Math.max(this.graphics_style.y_precision-1,0))),ctx.fillText(label,tick_len+lable_spacing+tick_lables_font_padding,tick_len+lable_spacing+axis_labels_font_size),ctx.beginPath(),ctx.stroke();var sigma=String.fromCharCode(963),squared=String.fromCharCode(178),bar=String.fromCharCode(773),edge=2.6*tick_len;ctx.font=axis_labels_font_size+"px "+font_name;var fit_points_drawn=0;if("none"===gs.fits);else{ctx.textAlign="left";var x=gs.fit_text_position.x*canvas.width,y=gs.fit_text_position.y*canvas.height,dy=1.2*axis_labels_font_size;for(i=0;i<this.data.length;i++){var label=this.captions[i]||"label";ctx.fillStyle=this.colors[i];var string1="",string2="",string3="";if(this.transparent||(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/2,ctx.strokeText(label,x,y)),ctx.fillText(label,x,y),ctx.fillStyle=gs.color_fg,ctx.lineWidth=line_thickness,gs.color_fits?ctx.strokeStyle=this.colors[i]:ctx.strokeStyle=gs.color_fg,"stats"===gs.fits){var stats=series_stats(this.data[i][0],this.data[i][1]);ctx.fillStyle=gs.color_fg,string1=" n = "+stats.n+",    cov(x,y) = "+mjs_precision(stats.cov,Math.min(gs.x_precision,gs.y_precision)+3),string2=bar+"x = "+number_quote(stats.x_mean,stats.sigma_x)+",   "+sigma+"(x) = "+mjs_precision(stats.sigma_x,2),string3=bar+"y = "+number_quote(stats.y_mean,stats.sigma_y)+",   "+sigma+"(y) = "+mjs_precision(stats.sigma_y,2),gs.color_fits?ctx.strokeStyle=this.colors[i]:ctx.strokeStyle=gs.color_fg,ctx.beginPath();for(var k=-1;2>k;k++){var yi=graph.units_to_pixels(stats.y_mean+k*stats.sigma_y,"y");ctx.moveTo(graph.units_to_pixels(stats.xmin,"x"),yi),ctx.lineTo(graph.units_to_pixels(stats.xmax,"x"),yi)}ctx.stroke(),ctx.beginPath();for(var k=-1;2>k;k++){var xi=graph.units_to_pixels(stats.x_mean+k*stats.sigma_x,"x");ctx.moveTo(xi,graph.units_to_pixels(stats.ymax,"y")),ctx.lineTo(xi,graph.units_to_pixels(stats.ymin,"y"))}ctx.stroke(),drawEllipse(this,ctx,stats.x_mean,stats.y_mean,stats.sigma_x,stats.sigma_y),drawEllipse(this,ctx,stats.x_mean,stats.y_mean,2*stats.sigma_x,2*stats.sigma_y)}if("old"===gs.fits&&0==this.fit_data.length&&(gs.fits="none"),"old"===gs.fits&&(string1="previous fit shown",string2="pick new fit",fit_x=this.fit_data[i][0],fit_y=this.fit_data[i][1],gs.color_fits?ctx.strokeStyle=this.colors[i]:ctx.strokeStyle=gs.color_fg,this.drawSimpleLine(ctx,fit_x,fit_y)),fits.fit_strings.indexOf(gs.fits)>-1){var fit,string1,string2,string3;if("time"===gs.x_scale_mode){var normed=fits.pre_fit_normalizing(this.data[i][0]);fit=fits.fit_funs[fits.fit_strings.indexOf(gs.fits)](normed.x,this.data[i][1]),string1=fit.strings[0]+"  "+normed.s,console.log("normalised: x = -"+normed.x_mean+" / "+normed.sigma_x)}else fit=fits.fit_funs[fits.fit_strings.indexOf(gs.fits)](this.data[i][0],this.data[i][1]),string1=fit.strings[0];if(string2=fit.strings[1],string3=fit.strings[2],gs.extrapolate)var fit_start=0,fit_end=canvas.width;else var fit_start=Math.max(0,this.units_to_pixels(Math.min.apply(null,this.data[i][0]),"x")),fit_end=Math.min(canvas.width,this.units_to_pixels(Math.max.apply(null,this.data[i][0]),"x"));for(var fit_x=[],j=fit_start;fit_end>j;j+=5)fit_x.push(this.pixels_to_units(j,"x"));if("time"===gs.x_scale_mode)var fit_y=fit.fun(fits.post_fit_normalizing(fit_x,normed),fit.parameters);else var fit_y=fit.fun(fit_x,fit.parameters);console.log("fit parameters: "+fit.parameters),this.fit_data[i]=[],this.fit_data[i][0]=fit_x,this.fit_data[i][1]=fit_y,gs.color_fits?ctx.strokeStyle=this.colors[i]:ctx.strokeStyle=gs.color_fg,this.fit_points_drawn=0,this.drawSimpleLine(ctx,fit_x,fit_y)}this.transparent?(ctx.fillText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),y+=dy,ctx.fillText(string2,x,y),y+=dy,ctx.fillText(string3,x,y),y+=dy):(ctx.strokeStyle=gs.color_bg,ctx.lineWidth=axis_labels_font_size/3,ctx.strokeText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),ctx.fillText(string1,x+.6*(label.length+1)*axis_labels_font_size,y),y+=dy,ctx.strokeText(string2,x,y),ctx.fillText(string2,x,y),y+=dy,ctx.strokeText(string3,x,y),ctx.fillText(string3,x,y),y+=dy)}}ctx.textAlign="center";for(var h=axis_labels_font_size,p=axis_labels_font_size/5,i=gs.show_markers?0:gs.markers.length;i<gs.markers.length;i++){var marker=gs.markers[i],handles=marker.handles;marker.x=0,marker.y=0;for(var j=0,l=handles.length;l>j;j++)marker.x+=handles[j][0],marker.y+=handles[j][1];marker.x/=handles.length,marker.y/=handles.length;var x=0,y=0,dx=0,dy=0,w;switch(marker.type){case"text":x=this.units_to_pixels(handles[0][0],"x"),y=this.units_to_pixels(handles[0][1],"y"),ctx.fillText(marker.text,x,y);break;case"line":ctx.beginPath(),x=this.units_to_pixels(handles[0][0],"x"),y=this.units_to_pixels(handles[0][1],"y"),ctx.moveTo(x,y),x=this.units_to_pixels(handles[1][0],"x"),y=this.units_to_pixels(handles[1][1],"y"),ctx.lineTo(x,y),ctx.stroke();break;case"linentext":ctx.beginPath(),x1=this.units_to_pixels(handles[0][0],"x"),y1=this.units_to_pixels(handles[0][1],"y"),ctx.moveTo(x1,y1),x2=this.units_to_pixels(handles[1][0],"x"),y2=this.units_to_pixels(handles[1][1],"y"),ctx.lineTo(x2,y2),ctx.stroke(),w=ctx.measureText(marker.text).width;var xm=(x1+x2)/2,ym=(y1+y2)/2,t=Math.atan((y2-y1)/(x2-x1)),mag=Math.abs(Math.sin(t)*w/2)+h;t-=Math.PI/2,x1>x2&&(t+=Math.PI);var ox=mag*Math.cos(t),oy=mag*Math.sin(t);ctx.fillText(marker.text,xm+ox,ym+oy+h/2);break;case"arrow":ctx.beginPath(),x=this.units_to_pixels(handles[0][0],"x"),y=this.units_to_pixels(handles[0][1],"y"),ctx.moveTo(x,y),dx=this.units_to_pixels(handles[1][0],"x"),dy=this.units_to_pixels(handles[1][1],"y"),ctx.lineTo(dx,dy),ctx.stroke(),drawArrow(ctx,x,y,h/6,Math.atan((dy-y)/(dx-x))+(dx>x?Math.PI:0));break;case"box":ctx.beginPath(),x=this.units_to_pixels(handles[0][0],"x"),y=this.units_to_pixels(handles[0][1],"y"),dx=this.units_to_pixels(handles[1][0],"x"),dy=this.units_to_pixels(handles[1][1],"y"),ctx.rect(x,y,dx-x,dy-y),ctx.stroke();break;case"boxntext":ctx.beginPath(),x=this.units_to_pixels(handles[0][0],"x"),y=this.units_to_pixels(handles[0][1],"y"),dx=this.units_to_pixels(handles[1][0],"x"),dy=this.units_to_pixels(handles[1][1],"y"),ctx.rect(x,y,dx-x,dy-y),ctx.stroke(),y>dy?ctx.fillText(marker.text,(x+dx)/2,y+h):ctx.fillText(marker.text,(x+dx)/2,y-h/3);break;case"arrowntext":var x1=this.units_to_pixels(handles[0][0],"x"),y1=this.units_to_pixels(handles[0][1],"y"),x2=this.units_to_pixels(handles[1][0],"x"),y2=this.units_to_pixels(handles[1][1],"y");ctx.fillText(marker.text,x2,y2),w=ctx.measureText(marker.text).width;var minX=x2-w/2-p,maxX=x2+w/2+p,minY=y2-h-p,maxY=y2+h/2+p;if(x1>=minX&&maxX>=x1&&y1>=minY&&maxY>=y1)break;ctx.beginPath(),ctx.moveTo(x1,y1);var midX=(minX+maxX)/2,midY=(minY+maxY)/2,m=(midY-y1)/(midX-x1);if(midX>x1){var minXy=m*(minX-x1)+y1;minXy>minY&&maxY>minXy&&ctx.lineTo(minX,minXy)}if(x1>midX){var maxXy=m*(maxX-x1)+y1;maxXy>minY&&maxY>maxXy&&ctx.lineTo(maxX,maxXy)}if(midY>y1){var minYx=(minY-y1)/m+x1;minYx>minX&&maxX>minYx&&ctx.lineTo(minYx,minY)}if(y1>midY){var maxYx=(maxY-y1)/m+x1;maxYx>minX&&maxX>maxYx&&ctx.lineTo(maxYx,maxY)}ctx.stroke(),drawArrow(ctx,x1,y1,h/6,Math.atan((y2-y1)/(x2-x1))+(x2>x1?Math.PI:0))}}if(ctx.lineWidth=graph_line_thickness,ctx.textAlign="center",ctx.strokeStyle=gs.color_fg,ctx.fillStyle=gs.color_fg,ctx.font=title_font_size+"px "+font_name,ctx.fillText(title,canvas.width/2,tick_len+title_spacing+title_font_size),ctx.font=axis_labels_font_size+"px "+font_name,ctx.fillText(gs.subtitle,canvas.width/2,tick_len+title_spacing+axis_labels_font_size+title_font_size),ctx.fillText(gs.subtitle2,canvas.width/2,tick_len+title_spacing+2*axis_labels_font_size+title_font_size),gs.data_transforms.length>0&&gs.showTransformTexts){ctx.font=axis_labels_font_size+"px "+font_name;var label="["+gs.data_transforms.join("|")+"]",labely=title_spacing+title_font_size+tick_len+axis_labels_font_size;gs.subtitle.length>0&&(labely+=axis_labels_font_size),gs.subtitle2.length>0&&(labely+=axis_labels_font_size),ctx.fillText(label,canvas.width/2,labely)}if(ctx.beginPath(),ctx.stroke(),gs.i>=1){ctx.strokeStyle=gs.color_fg,ctx.lineWidth=graph_line_thickness,ctx.fillStyle=gs.color_bg,ctx.rect(2*edge,2*edge,canvas.width-4*edge,canvas.height-4*edge),ctx.fill(),ctx.stroke(),ctx.fillStyle=gs.color_fg,ctx.textAlign="left";var y=3*edge,dy=1.5*axis_labels_font_size;ctx.fillText("canvas width : "+canvas.width,3*edge,y),y+=dy,ctx.fillText("canvas height : "+canvas.height,3*edge,y),y+=dy,ctx.fillText("canvas ID : "+this.canvas_name,3*edge,y),y+=dy,ctx.fillText("graph name : "+this.graph_name,3*edge,y),y+=dy,ctx.fillText("No. series : "+this.data.length+" of "+this.data_backup.length,3*edge,y),y+=dy,ctx.fillText("Points drawn : "+this.points_drawn,3*edge,y),y+=dy,ctx.fillText("Drawn points for fits : "+fit_points_drawn,3*edge,y),y+=dy,ctx.fillText("Touch : "+is_touch_device(),3*edge,y),y+=dy;var end_time=new Date;graph.ui.draw_time=end_time.getTime()-start_time.getTime(),ctx.fillText("Draw Time : "+graph.ui.draw_time+"ms",3*edge,y),y+=dy,ctx.fillText("Copy Time : "+graph.ui.copy_time+"ms",3*edge,y),y+=dy,ctx.textAlign="right";var label="MJS2015";ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-axis_labels_font_size-2*edge);var label="version: "+MJS_PLOT_VERSION;ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-2.5*axis_labels_font_size-2*edge);var label="web:"+MJS_PLOT_WEBSITE;ctx.fillText(label,canvas.width-tick_len-2*edge,canvas.height-3.5*axis_labels_font_size-2*edge)}if(this.points_drawn=0,this.errors.length>0){ctx.font=axis_labels_font_size+"px "+font_name;var oldfill=ctx.fillStyle;ctx.fillStyle="#FF0000",ctx.textAlign="center";for(var i=0;i<this.errors.length;i++){var s="error > "+this.errors[i],x=canvas.width/2,y=2*tick_len+title_spacing+axis_labels_font_size+canvas.height/2-axis_labels_font_size*this.errors.length/2+axis_labels_font_size*i;ctx.fillText(s,x,y)}ctx.fillStyle=oldfill}this.errors=[],ctx.textAlign="left",ctx.beginPath(),ctx.stroke(),ctx.beginPath(),ctx.rect(graph_line_thickness/2,graph_line_thickness/2,canvas.width-graph_line_thickness,canvas.height-graph_line_thickness),ctx.lineWidth=graph_line_thickness,ctx.strokeStyle=gs.color_fg,ctx.stroke(),gs.modified=!0,save_gs(this.graph_name,gs),this.isSVG||(this.graph_image=ctx.getImageData(0,0,canvas.width,canvas.height)),this.plot_failed=!1;for(var i=0;i<this.onPlotFunctions.length;i++)this.onPlotFunctions[i]()},units_to_pixels:function(t,e){if("x"===e){if("lin"===this.graphics_style.x_scale_mode||"time"===this.graphics_style.x_scale_mode)return(t-this.graphics_style.x_auto_min)*this.canvas.width/(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min);if("log"===this.graphics_style.x_scale_mode)return(Math.log10(t)-this.graphics_style.x_auto_min)*this.canvas.width/(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)||0}if("y"===e){if("lin"===this.graphics_style.y_scale_mode||"time"===this.graphics_style.y_scale_mode)return this.canvas.height-(t-this.graphics_style.y_auto_min)*this.canvas.height/(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min);if("log"===this.graphics_style.y_scale_mode)return this.canvas.height-(Math.log10(t)-this.graphics_style.y_auto_min)*this.canvas.height/(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)||canvas.height}},pixels_to_units:function(t,e){if("x"===e){if("lin"===this.graphics_style.x_scale_mode||"time"===this.graphics_style.x_scale_mode)return t/this.canvas.width*(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)+this.graphics_style.x_auto_min;if("log"===this.graphics_style.x_scale_mode)return Math.pow(10,t/this.canvas.width*(this.graphics_style.x_auto_max-this.graphics_style.x_auto_min)+this.graphics_style.x_auto_min);
}if("y"===e){if("lin"===this.graphics_style.y_scale_mode||"time"===this.graphics_style.y_scale_mode)return(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)*(this.canvas.height-t)/this.canvas.height+this.graphics_style.y_auto_min;if("log"===this.graphics_style.y_scale_mode){var i=Math.pow(10,(this.canvas.height-t)/this.canvas.height*(this.graphics_style.y_auto_max-this.graphics_style.y_auto_min)+this.graphics_style.y_auto_min);return 1e-200>i?1e-200:i}}},get_axis_string:function(t,e,i){if(isFinite(i)||("x"==e&&(i=this.graphics_style.x_precision+1),"y"==e&&(i=this.graphics_style.y_precision+1)),"x"==e){var a=this.graphics_style.x_axis_prefix||"";if("lin"===this.graphics_style.x_scale_mode||"log"===this.graphics_style.x_scale_mode)switch(this.graphics_style.x_label_mode){case"norm":a+=mjs_precision(t,i);break;case"infix":a+=eng_form_infix(t,i);break;case"postfix":a+=eng_form_postfix(t,i);break;case"maths":a+=maths_form(t,i);break;case"sci":a+=t.toExponential(i-1)}return"time"===this.graphics_style.x_scale_mode&&(a+=mjs_date_print(t,0,i)),a+=this.graphics_style.x_axis_postfix}if("y"==e){var a=this.graphics_style.y_axis_prefix||"";if("lin"===this.graphics_style.y_scale_mode||"log"===this.graphics_style.y_scale_mode)switch(this.graphics_style.y_label_mode){case"norm":a+=mjs_precision(t,i);break;case"infix":a+=eng_form_infix(t,i);break;case"postfix":a+=eng_form_postfix(t,i);break;case"sci":a+=t.toExponential(i-1);break;case"maths":a+=maths_form(t,i)}return"time"===this.graphics_style.y_scale_mode&&(a+=mjs_date_print(t,0,i)),a+=this.graphics_style.y_axis_postfix}},make_full_screen:function(t){var e=window.document;full_screen_graph=t;var i=full_screen_graph.canvas;full_screen_graph.orignal_canvas_width=full_screen_graph.canvas.width,full_screen_graph.orignal_canvas_height=full_screen_graph.canvas.height;var a=i.requestFullscreen||i.mozRequestFullScreen||i.webkitRequestFullScreen||i.msRequestFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?(full_screen_graph.errors.push("can't go fullscreen"),full_screen_graph.isFullscreen=!1):(a.call(i),full_screen_graph.isFullscreen=!0,full_screen_graph.canvas.width=window.innerWidth,full_screen_graph.canvas.height=window.innerHeight,document.addEventListener("fullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("webkitfullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("mozfullscreenchange",full_screen_graph.full_screen_handler),document.addEventListener("MSFullscreenChange",full_screen_graph.full_screen_handler),window.addEventListener("resize",full_screen_graph.keep_full_screen,!0))},full_screen_handler:function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||full_screen_graph.exit_full_screen()},exit_full_screen:function(){full_screen_graph.isFullscreen=!1,document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),window.removeEventListener("resize",full_screen_graph.keep_full_screen,!0),full_screen_graph.canvas.width=full_screen_graph.orignal_canvas_width,full_screen_graph.canvas.height=full_screen_graph.orignal_canvas_height,full_screen_graph.mjs_plot()},keep_full_screen:function(){full_screen_graph.canvas.width=window.innerWidth,full_screen_graph.canvas.height=window.innerHeight,full_screen_graph.mjs_plot()},export_svg:function(t,e){var i=this.canvas.width,a=this.canvas.height;this.canvas.width=t,this.canvas.height=e;var s=document.createElement("div");s.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+this.canvas.width+'" height="'+this.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(s),this.isSVG=!0,this.mjs_plot();var o=document.getElementById("_mjsplotSVG").outerHTML,n='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';download_text(n+o,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(s),this.isSVG=!1,this.canvas.width=i,this.canvas.height=a,this.mjs_plot()},export_svg_png:function(t,e,i){var a=this.canvas.width,s=this.canvas.height;this.canvas.width=t*i,this.canvas.height=e*i,this.graphics_style.scaling_factor*=i,this.transparent=!0,this.needs_drag_image=!0,this.mjs_plot();var o=this.canvas.getContext("2d");o.putImageData(this.graph_image_for_drag,0,0),this.pngbackground=this.canvas.toDataURL(),this.transparent=!1,this.graphics_style.scaling_factor/=i,this.canvas.width=t,this.canvas.height=e;var n=document.createElement("div");n.innerHTML='<svg id="_mjsplotSVG" version="1.1" width="'+this.canvas.width+'" height="'+this.canvas.height+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"/>',document.body.appendChild(n),this.isSVG=!1,this.isPNGSVG=!0,this.mjs_plot();var r=document.getElementById("_mjsplotSVG").outerHTML,l='<?xml version="1.0" encoding="utf-8" standalone="yes"?> ';download_text(l+r,"mjsplot_graph.svg","data:image/svg+xml;charset=utf-8"),document.body.removeChild(n),this.isSVG=!1,this.isPNGSVG=!1,this.canvas.width=a,this.canvas.height=s,this.mjs_plot()},export_png:function(t,e,i){var a=this.canvas.width,s=this.canvas.height;this.canvas.width=t,this.canvas.height=e,this.graphics_style.scaling_factor*=i,this.transparent=!0,this.mjs_plot();var o=this.canvas.toDataURL();window.open(o,"toDataURL() image","width="+t+", height="+e),this.transparent=!1,this.graphics_style.scaling_factor/=i,this.canvas.width=a,this.canvas.height=s,this.mjs_plot()}};return graph.canvas=canvas,make_interactive(graph),graph},get_graph_style:function(){if(is_touch_device())var t="drag";else var t="zoom";return{graph_line_thickness:1,symbol_size:5,line_thickness:2,tick_len:7,mode:"dot line",symbol_mode:"dot",line_mode:"line",symbol_modes:[],line_modes:[],font_name:"serif",title_font_size:20,title:"Title",subtitle:"",subtitle2:"",title_spacing:2,tick_labels_font_size:10,tick_lables_font_padding:2,axis_labels_font_size:10,lable_spacing:4,x_axis_title:"x axis (units)",y_axis_title:"y axis (units)",x_axis_prefix:"",x_axis_postfix:"",y_axis_prefix:"",y_axis_postfix:"",x_label_mode:"norm",y_label_mode:"norm",minor_tick_len:5,guideWidthx:35,guideWidthy:20,scaling_factor:1,mouse_mode:t,fits:"none",extrapolate:!1,color_fits:!1,x_scale_auto_max:!0,x_scale_auto_min:!0,y_scale_auto_max:!0,y_scale_auto_min:!0,x_manual_min:0,x_manual_max:1,y_manual_min:0,y_manual_max:1,x_scale_mode:"lin",y_scale_mode:"lin",x_scale_tight:!1,y_scale_tight:!1,show_captions:!0,showTransformTexts:!0,captions_display:"none",captions_extra_precision:1,color_fg:"#111",color_bg:"#eee",color_mg:"#aaa",show_grid:!1,v:MJS_PLOT_VERSION,caption_colors:!1,hidden_lines:[],line_colours:[],data_transforms:[],data_transforms_args:[],i:0,o:0,modified:!1,x_precision:2,y_precision:2,fit_text_position:{x:.1,y:.2},caption_position:{x:-10,y:10},markers:[],show_markers:!0,function_lines:[]}},convert_time_strings:function(t){for(var e,i=[],a=0;a<t.length;a++)e=Date.parse(t[a]),e?i.push(e):(e=Date.parse(t[a].replace(" ","T")),e&&i.push(e));return i}},mjs_plot}();var LZString=function(){function t(t,e){if(!s[t]){s[t]={};for(var i=0;i<t.length;i++)s[t][t.charAt(i)]=i}return s[t][e]}var e=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={},o={compressToBase64:function(t){if(null==t)return"";var e=o._compress(t,6,function(t){return i.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,function(a){return t(i,e.charAt(a))})},compressToUTF16:function(t){return null==t?"":o._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:o._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=o.compress(t),i=new Uint8Array(2*e.length),a=0,s=e.length;s>a;a++){var n=e.charCodeAt(a);i[2*a]=n>>>8,i[2*a+1]=n%256}return i},decompressFromUint8Array:function(t){if(null===t||void 0===t)return o.decompress(t);for(var i=new Array(t.length/2),a=0,s=i.length;s>a;a++)i[a]=256*t[2*a]+t[2*a+1];var n=[];return i.forEach(function(t){n.push(e(t))}),o.decompress(n.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":o._compress(t,6,function(t){return a.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,function(i){return t(a,e.charAt(i))}))},compress:function(t){return o._compress(t,16,function(t){return e(t)})},_compress:function(t,e,i){if(null==t)return"";var a,s,o,n={},r={},l="",_="",h="",c=2,g=3,m=2,x=[],d=0,f=0;for(o=0;o<t.length;o+=1)if(l=t.charAt(o),Object.prototype.hasOwnProperty.call(n,l)||(n[l]=g++,r[l]=!0),_=h+l,Object.prototype.hasOwnProperty.call(n,_))h=_;else{if(Object.prototype.hasOwnProperty.call(r,h)){if(h.charCodeAt(0)<256){for(a=0;m>a;a++)d<<=1,f==e-1?(f=0,x.push(i(d)),d=0):f++;for(s=h.charCodeAt(0),a=0;8>a;a++)d=d<<1|1&s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s>>=1}else{for(s=1,a=0;m>a;a++)d=d<<1|s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s=0;for(s=h.charCodeAt(0),a=0;16>a;a++)d=d<<1|1&s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s>>=1}c--,0==c&&(c=Math.pow(2,m),m++),delete r[h]}else for(s=n[h],a=0;m>a;a++)d=d<<1|1&s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s>>=1;c--,0==c&&(c=Math.pow(2,m),m++),n[_]=g++,h=String(l)}if(""!==h){if(Object.prototype.hasOwnProperty.call(r,h)){if(h.charCodeAt(0)<256){for(a=0;m>a;a++)d<<=1,f==e-1?(f=0,x.push(i(d)),d=0):f++;for(s=h.charCodeAt(0),a=0;8>a;a++)d=d<<1|1&s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s>>=1}else{for(s=1,a=0;m>a;a++)d=d<<1|s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s=0;for(s=h.charCodeAt(0),a=0;16>a;a++)d=d<<1|1&s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s>>=1}c--,0==c&&(c=Math.pow(2,m),m++),delete r[h]}else for(s=n[h],a=0;m>a;a++)d=d<<1|1&s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s>>=1;c--,0==c&&(c=Math.pow(2,m),m++)}for(s=2,a=0;m>a;a++)d=d<<1|1&s,f==e-1?(f=0,x.push(i(d)),d=0):f++,s>>=1;for(;;){if(d<<=1,f==e-1){x.push(i(d));break}f++}return x.join("")},decompress:function(t){return null==t?"":""==t?null:o._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(t,i,a){var s,o,n,r,l,_,h,c,g=[],m=4,x=4,d=3,f="",u=[],p={val:a(0),position:i,index:1};for(o=0;3>o;o+=1)g[o]=o;for(r=0,_=Math.pow(2,2),h=1;h!=_;)l=p.val&p.position,p.position>>=1,0==p.position&&(p.position=i,p.val=a(p.index++)),r|=(l>0?1:0)*h,h<<=1;switch(s=r){case 0:for(r=0,_=Math.pow(2,8),h=1;h!=_;)l=p.val&p.position,p.position>>=1,0==p.position&&(p.position=i,p.val=a(p.index++)),r|=(l>0?1:0)*h,h<<=1;c=e(r);break;case 1:for(r=0,_=Math.pow(2,16),h=1;h!=_;)l=p.val&p.position,p.position>>=1,0==p.position&&(p.position=i,p.val=a(p.index++)),r|=(l>0?1:0)*h,h<<=1;c=e(r);break;case 2:return""}for(g[3]=c,n=c,u.push(c);;){if(p.index>t)return"";for(r=0,_=Math.pow(2,d),h=1;h!=_;)l=p.val&p.position,p.position>>=1,0==p.position&&(p.position=i,p.val=a(p.index++)),r|=(l>0?1:0)*h,h<<=1;switch(c=r){case 0:for(r=0,_=Math.pow(2,8),h=1;h!=_;)l=p.val&p.position,p.position>>=1,0==p.position&&(p.position=i,p.val=a(p.index++)),r|=(l>0?1:0)*h,h<<=1;g[x++]=e(r),c=x-1,m--;break;case 1:for(r=0,_=Math.pow(2,16),h=1;h!=_;)l=p.val&p.position,p.position>>=1,0==p.position&&(p.position=i,p.val=a(p.index++)),r|=(l>0?1:0)*h,h<<=1;g[x++]=e(r),c=x-1,m--;break;case 2:return u.join("")}if(0==m&&(m=Math.pow(2,d),d++),g[c])f=g[c];else{if(c!==x)return null;f=n+n.charAt(0)}u.push(f),g[x++]=n+f.charAt(0),m--,n=f,0==m&&(m=Math.pow(2,d),d++)}}};return o}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString),MJSFontList=function(){function t(t){var e,i,a,s=0;if(0==t.length)return s;for(e=0,a=t.length;a>e;e++)i=t.charCodeAt(e),s=(s<<5)-s+i,s|=0;return s}function e(e){h.clearRect(0,0,r,l),h.font=_+e,h.fillText(o,0,l/2);var i=n.toDataURL("image/png");return t(i)}function i(t){return-1==c.indexOf(e(t))}var a=["sans-serif","serif","monospace","cursive"],s=["Arial","Arial Black","Baskerville","Batang","Big Caslon","Book Antiqua","Brush Script MT","Calibri","Candara","Century Gothic","Charcoal","Comic Sans MS","Computer Modern","Copperplate","Courier","DejaVu Sans","DejaVu Sans Mono","DejaVu Serif","Didot","Droid Sans","Droid Sans Mono","Droid Serif","Franklin Gothic Medium","Futura","Gadget","Garamond","Geneva","Georgia","Goudy Old Style","Helvetica","Impact","Latin Modern Roman","Latin Modern Mono","Latin Modern Sans","Lato","Lora","Lucida Console","Lucida Grande","Lucida Sans Unicode","Monaco","Open Sans Condensed","Oswald","PT Sans","Palatino","Palatino Linotype","Roboto","Rockwell","Rockwell Extra Bold","Segoe UI","Source Sans Pro","Tahoma","Times New Roman","Trebuchet MS","Ubuntu","Ubuntu-Title","Ubuntu Mono","Verdana","cursive"],o=(document.getElementsByTagName("body")[0],["agAmMqQwWlLi1"]),n=document.createElement("canvas"),r=100,l=15;n.width=r,n.height=l;for(var _="10px ",h=n.getContext("2d"),c=[],g=0;g<a.length;g++)c.push(e(a[g]));for(var m=a,g=0;g<s.length;g++)i(s[g])&&m.push(s[g]);return{fontList:m,hasFont:i,getFontMetric:e}}();
"""
